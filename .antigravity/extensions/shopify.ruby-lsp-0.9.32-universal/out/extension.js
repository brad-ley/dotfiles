"use strict";var BR=Object.create;var go=Object.defineProperty;var GR=Object.getOwnPropertyDescriptor;var JR=Object.getOwnPropertyNames;var XR=Object.getPrototypeOf,QR=Object.prototype.hasOwnProperty;var I=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),YR=(r,e)=>{for(var t in e)go(r,t,{get:e[t],enumerable:!0})},ug=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of JR(e))!QR.call(r,i)&&i!==t&&go(r,i,{get:()=>e[i],enumerable:!(n=GR(e,i))||n.enumerable});return r};var re=(r,e,t)=>(t=r!=null?BR(XR(r)):{},ug(e||!r||!r.__esModule?go(t,"default",{value:r,enumerable:!0}):t,r)),ZR=r=>ug(go({},"__esModule",{value:!0}),r);var Vn=I(vt=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.asPromise=vt.thenable=vt.typedArray=vt.stringArray=vt.array=vt.func=vt.error=vt.number=vt.string=vt.boolean=void 0;function eS(r){return r===!0||r===!1}vt.boolean=eS;function dg(r){return typeof r=="string"||r instanceof String}vt.string=dg;function tS(r){return typeof r=="number"||r instanceof Number}vt.number=tS;function nS(r){return r instanceof Error}vt.error=nS;function lg(r){return typeof r=="function"}vt.func=lg;function fg(r){return Array.isArray(r)}vt.array=fg;function rS(r){return fg(r)&&r.every(e=>dg(e))}vt.stringArray=rS;function iS(r,e){return Array.isArray(r)&&r.every(e)}vt.typedArray=iS;function hg(r){return r&&lg(r.then)}vt.thenable=hg;function sS(r){return r instanceof Promise?r:hg(r)?new Promise((e,t)=>{r.then(n=>e(n),n=>t(n))}):Promise.resolve(r)}vt.asPromise=sS});var Pi=I(Vt=>{"use strict";Object.defineProperty(Vt,"__esModule",{value:!0});Vt.stringArray=Vt.array=Vt.func=Vt.error=Vt.number=Vt.string=Vt.boolean=void 0;function oS(r){return r===!0||r===!1}Vt.boolean=oS;function pg(r){return typeof r=="string"||r instanceof String}Vt.string=pg;function aS(r){return typeof r=="number"||r instanceof Number}Vt.number=aS;function cS(r){return r instanceof Error}Vt.error=cS;function uS(r){return typeof r=="function"}Vt.func=uS;function gg(r){return Array.isArray(r)}Vt.array=gg;function dS(r){return gg(r)&&r.every(e=>pg(e))}Vt.stringArray=dS});var Tu=I(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.Message=se.NotificationType9=se.NotificationType8=se.NotificationType7=se.NotificationType6=se.NotificationType5=se.NotificationType4=se.NotificationType3=se.NotificationType2=se.NotificationType1=se.NotificationType0=se.NotificationType=se.RequestType9=se.RequestType8=se.RequestType7=se.RequestType6=se.RequestType5=se.RequestType4=se.RequestType3=se.RequestType2=se.RequestType1=se.RequestType=se.RequestType0=se.AbstractMessageSignature=se.ParameterStructures=se.ResponseError=se.ErrorCodes=void 0;var oi=Pi(),tu;(function(r){r.ParseError=-32700,r.InvalidRequest=-32600,r.MethodNotFound=-32601,r.InvalidParams=-32602,r.InternalError=-32603,r.jsonrpcReservedErrorRangeStart=-32099,r.serverErrorStart=-32099,r.MessageWriteError=-32099,r.MessageReadError=-32098,r.PendingResponseRejected=-32097,r.ConnectionInactive=-32096,r.ServerNotInitialized=-32002,r.UnknownErrorCode=-32001,r.jsonrpcReservedErrorRangeEnd=-32e3,r.serverErrorEnd=-32e3})(tu||(se.ErrorCodes=tu={}));var nu=class r extends Error{constructor(e,t,n){super(t),this.code=oi.number(e)?e:tu.UnknownErrorCode,this.data=n,Object.setPrototypeOf(this,r.prototype)}toJson(){let e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),e}};se.ResponseError=nu;var an=class r{constructor(e){this.kind=e}static is(e){return e===r.auto||e===r.byName||e===r.byPosition}toString(){return this.kind}};se.ParameterStructures=an;an.auto=new an("auto");an.byPosition=new an("byPosition");an.byName=new an("byName");var et=class{constructor(e,t){this.method=e,this.numberOfParams=t}get parameterStructures(){return an.auto}};se.AbstractMessageSignature=et;var ru=class extends et{constructor(e){super(e,0)}};se.RequestType0=ru;var iu=class extends et{constructor(e,t=an.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};se.RequestType=iu;var su=class extends et{constructor(e,t=an.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};se.RequestType1=su;var ou=class extends et{constructor(e){super(e,2)}};se.RequestType2=ou;var au=class extends et{constructor(e){super(e,3)}};se.RequestType3=au;var cu=class extends et{constructor(e){super(e,4)}};se.RequestType4=cu;var uu=class extends et{constructor(e){super(e,5)}};se.RequestType5=uu;var du=class extends et{constructor(e){super(e,6)}};se.RequestType6=du;var lu=class extends et{constructor(e){super(e,7)}};se.RequestType7=lu;var fu=class extends et{constructor(e){super(e,8)}};se.RequestType8=fu;var hu=class extends et{constructor(e){super(e,9)}};se.RequestType9=hu;var pu=class extends et{constructor(e,t=an.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};se.NotificationType=pu;var gu=class extends et{constructor(e){super(e,0)}};se.NotificationType0=gu;var mu=class extends et{constructor(e,t=an.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};se.NotificationType1=mu;var vu=class extends et{constructor(e){super(e,2)}};se.NotificationType2=vu;var yu=class extends et{constructor(e){super(e,3)}};se.NotificationType3=yu;var bu=class extends et{constructor(e){super(e,4)}};se.NotificationType4=bu;var wu=class extends et{constructor(e){super(e,5)}};se.NotificationType5=wu;var Cu=class extends et{constructor(e){super(e,6)}};se.NotificationType6=Cu;var Ru=class extends et{constructor(e){super(e,7)}};se.NotificationType7=Ru;var Su=class extends et{constructor(e){super(e,8)}};se.NotificationType8=Su;var _u=class extends et{constructor(e){super(e,9)}};se.NotificationType9=_u;var mg;(function(r){function e(i){let s=i;return s&&oi.string(s.method)&&(oi.string(s.id)||oi.number(s.id))}r.isRequest=e;function t(i){let s=i;return s&&oi.string(s.method)&&i.id===void 0}r.isNotification=t;function n(i){let s=i;return s&&(s.result!==void 0||!!s.error)&&(oi.string(s.id)||oi.number(s.id)||s.id===null)}r.isResponse=n})(mg||(se.Message=mg={}))});var Pu=I(Nr=>{"use strict";var vg;Object.defineProperty(Nr,"__esModule",{value:!0});Nr.LRUCache=Nr.LinkedMap=Nr.Touch=void 0;var zt;(function(r){r.None=0,r.First=1,r.AsOld=r.First,r.Last=2,r.AsNew=r.Last})(zt||(Nr.Touch=zt={}));var mo=class{constructor(){this[vg]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=zt.None){let n=this._map.get(e);if(n)return t!==zt.None&&this.touch(n,t),n.value}set(e,t,n=zt.None){let i=this._map.get(e);if(i)i.value=t,n!==zt.None&&this.touch(i,n);else{switch(i={key:e,value:t,next:void 0,previous:void 0},n){case zt.None:this.addItemLast(i);break;case zt.First:this.addItemFirst(i);break;case zt.Last:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let n=this._state,i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.key,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}values(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.value,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}entries(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:[t.key,t.value],done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}[(vg=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,n=this.size;for(;t&&n>e;)this._map.delete(t.key),t=t.next,n--;this._head=t,this._size=n,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==zt.First&&t!==zt.Last)){if(t===zt.First){if(e===this._head)return;let n=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===zt.Last){if(e===this._tail)return;let n=e.next,i=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,n)=>{e.push([n,t])}),e}fromJSON(e){this.clear();for(let[t,n]of e)this.set(t,n)}};Nr.LinkedMap=mo;var Du=class extends mo{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=zt.AsNew){return super.get(e,t)}peek(e){return super.get(e,zt.None)}set(e,t){return super.set(e,t,zt.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}};Nr.LRUCache=Du});var bg=I(vo=>{"use strict";Object.defineProperty(vo,"__esModule",{value:!0});vo.Disposable=void 0;var yg;(function(r){function e(t){return{dispose:t}}r.create=e})(yg||(vo.Disposable=yg={}))});var Ar=I(xu=>{"use strict";Object.defineProperty(xu,"__esModule",{value:!0});var ku;function Eu(){if(ku===void 0)throw new Error("No runtime abstraction layer installed");return ku}(function(r){function e(t){if(t===void 0)throw new Error("No runtime abstraction layer provided");ku=t}r.install=e})(Eu||(Eu={}));xu.default=Eu});var Ei=I(ki=>{"use strict";Object.defineProperty(ki,"__esModule",{value:!0});ki.Emitter=ki.Event=void 0;var lS=Ar(),wg;(function(r){let e={dispose(){}};r.None=function(){return e}})(wg||(ki.Event=wg={}));var Iu=class{add(e,t=null,n){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(n)&&n.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(!this._callbacks)return;let n=!1;for(let i=0,s=this._callbacks.length;i<s;i++)if(this._callbacks[i]===e)if(this._contexts[i]===t){this._callbacks.splice(i,1),this._contexts.splice(i,1);return}else n=!0;if(n)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];let t=[],n=this._callbacks.slice(0),i=this._contexts.slice(0);for(let s=0,o=n.length;s<o;s++)try{t.push(n[s].apply(i[s],e))}catch(a){(0,lS.default)().console.error(a)}return t}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},yo=class r{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,n)=>{this._callbacks||(this._callbacks=new Iu),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t);let i={dispose:()=>{this._callbacks&&(this._callbacks.remove(e,t),i.dispose=r._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(n)&&n.push(i),i}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}};ki.Emitter=yo;yo._noop=function(){}});var Co=I(xi=>{"use strict";Object.defineProperty(xi,"__esModule",{value:!0});xi.CancellationTokenSource=xi.CancellationToken=void 0;var fS=Ar(),hS=Pi(),qu=Ei(),bo;(function(r){r.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:qu.Event.None}),r.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:qu.Event.None});function e(t){let n=t;return n&&(n===r.None||n===r.Cancelled||hS.boolean(n.isCancellationRequested)&&!!n.onCancellationRequested)}r.is=e})(bo||(xi.CancellationToken=bo={}));var pS=Object.freeze(function(r,e){let t=(0,fS.default)().timer.setTimeout(r.bind(e),0);return{dispose(){t.dispose()}}}),wo=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?pS:(this._emitter||(this._emitter=new qu.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},Ou=class{get token(){return this._token||(this._token=new wo),this._token}cancel(){this._token?this._token.cancel():this._token=bo.Cancelled}dispose(){this._token?this._token instanceof wo&&this._token.dispose():this._token=bo.None}};xi.CancellationTokenSource=Ou});var Cg=I(Ii=>{"use strict";Object.defineProperty(Ii,"__esModule",{value:!0});Ii.SharedArrayReceiverStrategy=Ii.SharedArraySenderStrategy=void 0;var gS=Co(),bs;(function(r){r.Continue=0,r.Cancelled=1})(bs||(bs={}));var Fu=class{constructor(){this.buffers=new Map}enableCancellation(e){if(e.id===null)return;let t=new SharedArrayBuffer(4),n=new Int32Array(t,0,1);n[0]=bs.Continue,this.buffers.set(e.id,t),e.$cancellationData=t}async sendCancellation(e,t){let n=this.buffers.get(t);if(n===void 0)return;let i=new Int32Array(n,0,1);Atomics.store(i,0,bs.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}};Ii.SharedArraySenderStrategy=Fu;var Lu=class{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===bs.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}},Mu=class{constructor(e){this.token=new Lu(e)}cancel(){}dispose(){}},Nu=class{constructor(){this.kind="request"}createCancellationTokenSource(e){let t=e.$cancellationData;return t===void 0?new gS.CancellationTokenSource:new Mu(t)}};Ii.SharedArrayReceiverStrategy=Nu});var ju=I(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});Ro.Semaphore=void 0;var mS=Ar(),Au=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,mS.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};Ro.Semaphore=Au});var Sg=I(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});jr.ReadableStreamMessageReader=jr.AbstractMessageReader=jr.MessageReader=void 0;var Uu=Ar(),qi=Pi(),$u=Ei(),vS=ju(),Rg;(function(r){function e(t){let n=t;return n&&qi.func(n.listen)&&qi.func(n.dispose)&&qi.func(n.onError)&&qi.func(n.onClose)&&qi.func(n.onPartialMessage)}r.is=e})(Rg||(jr.MessageReader=Rg={}));var So=class{constructor(){this.errorEmitter=new $u.Emitter,this.closeEmitter=new $u.Emitter,this.partialMessageEmitter=new $u.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${qi.string(e.message)?e.message:"unknown"}`)}};jr.AbstractMessageReader=So;var Wu;(function(r){function e(t){let n,i,s,o=new Map,a,c=new Map;if(t===void 0||typeof t=="string")n=t??"utf-8";else{if(n=t.charset??"utf-8",t.contentDecoder!==void 0&&(s=t.contentDecoder,o.set(s.name,s)),t.contentDecoders!==void 0)for(let d of t.contentDecoders)o.set(d.name,d);if(t.contentTypeDecoder!==void 0&&(a=t.contentTypeDecoder,c.set(a.name,a)),t.contentTypeDecoders!==void 0)for(let d of t.contentTypeDecoders)c.set(d.name,d)}return a===void 0&&(a=(0,Uu.default)().applicationJson.decoder,c.set(a.name,a)),{charset:n,contentDecoder:s,contentDecoders:o,contentTypeDecoder:a,contentTypeDecoders:c}}r.fromOptions=e})(Wu||(Wu={}));var Hu=class extends So{constructor(e,t){super(),this.readable=e,this.options=Wu.fromOptions(t),this.buffer=(0,Uu.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new vS.Semaphore(1)}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;let t=this.readable.onData(n=>{this.onData(n)});return this.readable.onError(n=>this.fireError(n)),this.readable.onClose(()=>this.fireClose()),t}onData(e){try{for(this.buffer.append(e);;){if(this.nextMessageLength===-1){let n=this.buffer.tryReadHeaders(!0);if(!n)return;let i=n.get("content-length");if(!i){this.fireError(new Error(`Header must provide a Content-Length property.
${JSON.stringify(Object.fromEntries(n))}`));return}let s=parseInt(i);if(isNaN(s)){this.fireError(new Error(`Content-Length value must be a number. Got ${i}`));return}this.nextMessageLength=s}let t=this.buffer.tryReadBody(this.nextMessageLength);if(t===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{let n=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(t):t,i=await this.options.contentTypeDecoder.decode(n,this.options);this.callback(i)}).catch(n=>{this.fireError(n)})}}catch(t){this.fireError(t)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,Uu.default)().timer.setTimeout((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}};jr.ReadableStreamMessageReader=Hu});var kg=I($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});$r.WriteableStreamMessageWriter=$r.AbstractMessageWriter=$r.MessageWriter=void 0;var _g=Ar(),ws=Pi(),yS=ju(),Tg=Ei(),bS="Content-Length: ",Dg=`\r
`,Pg;(function(r){function e(t){let n=t;return n&&ws.func(n.dispose)&&ws.func(n.onClose)&&ws.func(n.onError)&&ws.func(n.write)}r.is=e})(Pg||($r.MessageWriter=Pg={}));var _o=class{constructor(){this.errorEmitter=new Tg.Emitter,this.closeEmitter=new Tg.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,n){this.errorEmitter.fire([this.asError(e),t,n])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${ws.string(e.message)?e.message:"unknown"}`)}};$r.AbstractMessageWriter=_o;var Vu;(function(r){function e(t){return t===void 0||typeof t=="string"?{charset:t??"utf-8",contentTypeEncoder:(0,_g.default)().applicationJson.encoder}:{charset:t.charset??"utf-8",contentEncoder:t.contentEncoder,contentTypeEncoder:t.contentTypeEncoder??(0,_g.default)().applicationJson.encoder}}r.fromOptions=e})(Vu||(Vu={}));var zu=class extends _o{constructor(e,t){super(),this.writable=e,this.options=Vu.fromOptions(t),this.errorCount=0,this.writeSemaphore=new yS.Semaphore(1),this.writable.onError(n=>this.fireError(n)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(n=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(n):n).then(n=>{let i=[];return i.push(bS,n.byteLength.toString(),Dg),i.push(Dg),this.doWrite(e,i,n)},n=>{throw this.fireError(n),n}))}async doWrite(e,t,n){try{return await this.writable.write(t.join(""),"ascii"),this.writable.write(n)}catch(i){return this.handleError(i,e),Promise.reject(i)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){this.writable.end()}};$r.WriteableStreamMessageWriter=zu});var Eg=I(To=>{"use strict";Object.defineProperty(To,"__esModule",{value:!0});To.AbstractMessageBuffer=void 0;var wS=13,CS=10,RS=`\r
`,Ku=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){let t=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(t),this._totalLength+=t.byteLength}tryReadHeaders(e=!1){if(this._chunks.length===0)return;let t=0,n=0,i=0,s=0;e:for(;n<this._chunks.length;){let d=this._chunks[n];for(i=0;i<d.length;){switch(d[i]){case wS:switch(t){case 0:t=1;break;case 2:t=3;break;default:t=0}break;case CS:switch(t){case 1:t=2;break;case 3:t=4,i++;break e;default:t=0}break;default:t=0}i++}s+=d.byteLength,n++}if(t!==4)return;let o=this._read(s+i),a=new Map,c=this.toString(o,"ascii").split(RS);if(c.length<2)return a;for(let d=0;d<c.length-2;d++){let p=c[d],v=p.indexOf(":");if(v===-1)throw new Error(`Message header must separate key and value using ':'
${p}`);let m=p.substr(0,v),S=p.substr(v+1).trim();a.set(e?m.toLowerCase():m,S)}return a}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){let s=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(s)}if(this._chunks[0].byteLength>e){let s=this._chunks[0],o=this.asNative(s,e);return this._chunks[0]=s.slice(e),this._totalLength-=e,o}let t=this.allocNative(e),n=0,i=0;for(;e>0;){let s=this._chunks[i];if(s.byteLength>e){let o=s.slice(0,e);t.set(o,n),n+=e,this._chunks[i]=s.slice(e),this._totalLength-=e,e-=e}else t.set(s,n),n+=s.byteLength,this._chunks.shift(),this._totalLength-=s.byteLength,e-=s.byteLength}return t}};To.AbstractMessageBuffer=Ku});var Fg=I(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});ye.createMessageConnection=ye.ConnectionOptions=ye.MessageStrategy=ye.CancellationStrategy=ye.CancellationSenderStrategy=ye.CancellationReceiverStrategy=ye.RequestCancellationReceiverStrategy=ye.IdCancellationReceiverStrategy=ye.ConnectionStrategy=ye.ConnectionError=ye.ConnectionErrors=ye.LogTraceNotification=ye.SetTraceNotification=ye.TraceFormat=ye.TraceValues=ye.Trace=ye.NullLogger=ye.ProgressType=ye.ProgressToken=void 0;var xg=Ar(),dt=Pi(),de=Tu(),Ig=Pu(),Cs=Ei(),Bu=Co(),_s;(function(r){r.type=new de.NotificationType("$/cancelRequest")})(_s||(_s={}));var Gu;(function(r){function e(t){return typeof t=="string"||typeof t=="number"}r.is=e})(Gu||(ye.ProgressToken=Gu={}));var Rs;(function(r){r.type=new de.NotificationType("$/progress")})(Rs||(Rs={}));var Ju=class{constructor(){}};ye.ProgressType=Ju;var Xu;(function(r){function e(t){return dt.func(t)}r.is=e})(Xu||(Xu={}));ye.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var Fe;(function(r){r[r.Off=0]="Off",r[r.Messages=1]="Messages",r[r.Compact=2]="Compact",r[r.Verbose=3]="Verbose"})(Fe||(ye.Trace=Fe={}));var qg;(function(r){r.Off="off",r.Messages="messages",r.Compact="compact",r.Verbose="verbose"})(qg||(ye.TraceValues=qg={}));(function(r){function e(n){if(!dt.string(n))return r.Off;switch(n=n.toLowerCase(),n){case"off":return r.Off;case"messages":return r.Messages;case"compact":return r.Compact;case"verbose":return r.Verbose;default:return r.Off}}r.fromString=e;function t(n){switch(n){case r.Off:return"off";case r.Messages:return"messages";case r.Compact:return"compact";case r.Verbose:return"verbose";default:return"off"}}r.toString=t})(Fe||(ye.Trace=Fe={}));var kn;(function(r){r.Text="text",r.JSON="json"})(kn||(ye.TraceFormat=kn={}));(function(r){function e(t){return dt.string(t)?(t=t.toLowerCase(),t==="json"?r.JSON:r.Text):r.Text}r.fromString=e})(kn||(ye.TraceFormat=kn={}));var Qu;(function(r){r.type=new de.NotificationType("$/setTrace")})(Qu||(ye.SetTraceNotification=Qu={}));var Do;(function(r){r.type=new de.NotificationType("$/logTrace")})(Do||(ye.LogTraceNotification=Do={}));var Ss;(function(r){r[r.Closed=1]="Closed",r[r.Disposed=2]="Disposed",r[r.AlreadyListening=3]="AlreadyListening"})(Ss||(ye.ConnectionErrors=Ss={}));var Oi=class r extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,r.prototype)}};ye.ConnectionError=Oi;var Yu;(function(r){function e(t){let n=t;return n&&dt.func(n.cancelUndispatched)}r.is=e})(Yu||(ye.ConnectionStrategy=Yu={}));var Po;(function(r){function e(t){let n=t;return n&&(n.kind===void 0||n.kind==="id")&&dt.func(n.createCancellationTokenSource)&&(n.dispose===void 0||dt.func(n.dispose))}r.is=e})(Po||(ye.IdCancellationReceiverStrategy=Po={}));var Zu;(function(r){function e(t){let n=t;return n&&n.kind==="request"&&dt.func(n.createCancellationTokenSource)&&(n.dispose===void 0||dt.func(n.dispose))}r.is=e})(Zu||(ye.RequestCancellationReceiverStrategy=Zu={}));var ko;(function(r){r.Message=Object.freeze({createCancellationTokenSource(t){return new Bu.CancellationTokenSource}});function e(t){return Po.is(t)||Zu.is(t)}r.is=e})(ko||(ye.CancellationReceiverStrategy=ko={}));var Eo;(function(r){r.Message=Object.freeze({sendCancellation(t,n){return t.sendNotification(_s.type,{id:n})},cleanup(t){}});function e(t){let n=t;return n&&dt.func(n.sendCancellation)&&dt.func(n.cleanup)}r.is=e})(Eo||(ye.CancellationSenderStrategy=Eo={}));var xo;(function(r){r.Message=Object.freeze({receiver:ko.Message,sender:Eo.Message});function e(t){let n=t;return n&&ko.is(n.receiver)&&Eo.is(n.sender)}r.is=e})(xo||(ye.CancellationStrategy=xo={}));var Io;(function(r){function e(t){let n=t;return n&&dt.func(n.handleMessage)}r.is=e})(Io||(ye.MessageStrategy=Io={}));var Og;(function(r){function e(t){let n=t;return n&&(xo.is(n.cancellationStrategy)||Yu.is(n.connectionStrategy)||Io.is(n.messageStrategy))}r.is=e})(Og||(ye.ConnectionOptions=Og={}));var nr;(function(r){r[r.New=1]="New",r[r.Listening=2]="Listening",r[r.Closed=3]="Closed",r[r.Disposed=4]="Disposed"})(nr||(nr={}));function SS(r,e,t,n){let i=t!==void 0?t:ye.NullLogger,s=0,o=0,a=0,c="2.0",d,p=new Map,v,m=new Map,S=new Map,b,E=new Ig.LinkedMap,x=new Map,$=new Set,U=new Map,M=Fe.Off,z=kn.Text,B,pe=nr.New,J=new Cs.Emitter,ce=new Cs.Emitter,Re=new Cs.Emitter,it=new Cs.Emitter,Ze=new Cs.Emitter,$e=n&&n.cancellationStrategy?n.cancellationStrategy:xo.Message;function Yt(l){if(l===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+l.toString()}function At(l){return l===null?"res-unknown-"+(++a).toString():"res-"+l.toString()}function Pt(){return"not-"+(++o).toString()}function kt(l,C){de.Message.isRequest(C)?l.set(Yt(C.id),C):de.Message.isResponse(C)?l.set(At(C.id),C):l.set(Pt(),C)}function bn(l){}function wn(){return pe===nr.Listening}function Ue(){return pe===nr.Closed}function Ct(){return pe===nr.Disposed}function qt(){(pe===nr.New||pe===nr.Listening)&&(pe=nr.Closed,ce.fire(void 0))}function Et(l){J.fire([l,void 0,void 0])}function dr(l){J.fire(l)}r.onClose(qt),r.onError(Et),e.onClose(qt),e.onError(dr);function Cn(){b||E.size===0||(b=(0,xg.default)().timer.setImmediate(()=>{b=void 0,Zn()}))}function Rn(l){de.Message.isRequest(l)?jn(l):de.Message.isNotification(l)?_n(l):de.Message.isResponse(l)?Sn(l):$n(l)}function Zn(){if(E.size===0)return;let l=E.shift();try{let C=n?.messageStrategy;Io.is(C)?C.handleMessage(l,Rn):Rn(l)}finally{Cn()}}let lr=l=>{try{if(de.Message.isNotification(l)&&l.method===_s.type.method){let C=l.params.id,P=Yt(C),O=E.get(P);if(de.Message.isRequest(O)){let ee=n?.connectionStrategy,ae=ee&&ee.cancelUndispatched?ee.cancelUndispatched(O,bn):void 0;if(ae&&(ae.error!==void 0||ae.result!==void 0)){E.delete(P),U.delete(C),ae.id=O.id,jt(ae,l.method,Date.now()),e.write(ae).catch(()=>i.error("Sending response for canceled message failed."));return}}let ne=U.get(C);if(ne!==void 0){ne.cancel(),Ht(l);return}else $.add(C)}kt(E,l)}finally{Cn()}};function jn(l){if(Ct())return;function C(G,ie,Z){let he={jsonrpc:c,id:l.id};G instanceof de.ResponseError?he.error=G.toJson():he.result=G===void 0?null:G,jt(he,ie,Z),e.write(he).catch(()=>i.error("Sending response failed."))}function P(G,ie,Z){let he={jsonrpc:c,id:l.id,error:G.toJson()};jt(he,ie,Z),e.write(he).catch(()=>i.error("Sending response failed."))}function O(G,ie,Z){G===void 0&&(G=null);let he={jsonrpc:c,id:l.id,result:G};jt(he,ie,Z),e.write(he).catch(()=>i.error("Sending response failed."))}fr(l);let ne=p.get(l.method),ee,ae;ne&&(ee=ne.type,ae=ne.handler);let ue=Date.now();if(ae||d){let G=l.id??String(Date.now()),ie=Po.is($e.receiver)?$e.receiver.createCancellationTokenSource(G):$e.receiver.createCancellationTokenSource(l);l.id!==null&&$.has(l.id)&&ie.cancel(),l.id!==null&&U.set(G,ie);try{let Z;if(ae)if(l.params===void 0){if(ee!==void 0&&ee.numberOfParams!==0){P(new de.ResponseError(de.ErrorCodes.InvalidParams,`Request ${l.method} defines ${ee.numberOfParams} params but received none.`),l.method,ue);return}Z=ae(ie.token)}else if(Array.isArray(l.params)){if(ee!==void 0&&ee.parameterStructures===de.ParameterStructures.byName){P(new de.ResponseError(de.ErrorCodes.InvalidParams,`Request ${l.method} defines parameters by name but received parameters by position`),l.method,ue);return}Z=ae(...l.params,ie.token)}else{if(ee!==void 0&&ee.parameterStructures===de.ParameterStructures.byPosition){P(new de.ResponseError(de.ErrorCodes.InvalidParams,`Request ${l.method} defines parameters by position but received parameters by name`),l.method,ue);return}Z=ae(l.params,ie.token)}else d&&(Z=d(l.method,l.params,ie.token));let he=Z;Z?he.then?he.then(_e=>{U.delete(G),C(_e,l.method,ue)},_e=>{U.delete(G),_e instanceof de.ResponseError?P(_e,l.method,ue):_e&&dt.string(_e.message)?P(new de.ResponseError(de.ErrorCodes.InternalError,`Request ${l.method} failed with message: ${_e.message}`),l.method,ue):P(new de.ResponseError(de.ErrorCodes.InternalError,`Request ${l.method} failed unexpectedly without providing any details.`),l.method,ue)}):(U.delete(G),C(Z,l.method,ue)):(U.delete(G),O(Z,l.method,ue))}catch(Z){U.delete(G),Z instanceof de.ResponseError?C(Z,l.method,ue):Z&&dt.string(Z.message)?P(new de.ResponseError(de.ErrorCodes.InternalError,`Request ${l.method} failed with message: ${Z.message}`),l.method,ue):P(new de.ResponseError(de.ErrorCodes.InternalError,`Request ${l.method} failed unexpectedly without providing any details.`),l.method,ue)}}else P(new de.ResponseError(de.ErrorCodes.MethodNotFound,`Unhandled method ${l.method}`),l.method,ue)}function Sn(l){if(!Ct())if(l.id===null)l.error?i.error(`Received response message without id: Error is: 
${JSON.stringify(l.error,void 0,4)}`):i.error("Received response message without id. No further error information provided.");else{let C=l.id,P=x.get(C);if(Un(l,P),P!==void 0){x.delete(C);try{if(l.error){let O=l.error;P.reject(new de.ResponseError(O.code,O.message,O.data))}else if(l.result!==void 0)P.resolve(l.result);else throw new Error("Should never happen.")}catch(O){O.message?i.error(`Response handler '${P.method}' failed with message: ${O.message}`):i.error(`Response handler '${P.method}' failed unexpectedly.`)}}}}function _n(l){if(Ct())return;let C,P;if(l.method===_s.type.method){let O=l.params.id;$.delete(O),Ht(l);return}else{let O=m.get(l.method);O&&(P=O.handler,C=O.type)}if(P||v)try{if(Ht(l),P)if(l.params===void 0)C!==void 0&&C.numberOfParams!==0&&C.parameterStructures!==de.ParameterStructures.byName&&i.error(`Notification ${l.method} defines ${C.numberOfParams} params but received none.`),P();else if(Array.isArray(l.params)){let O=l.params;l.method===Rs.type.method&&O.length===2&&Gu.is(O[0])?P({token:O[0],value:O[1]}):(C!==void 0&&(C.parameterStructures===de.ParameterStructures.byName&&i.error(`Notification ${l.method} defines parameters by name but received parameters by position`),C.numberOfParams!==l.params.length&&i.error(`Notification ${l.method} defines ${C.numberOfParams} params but received ${O.length} arguments`)),P(...O))}else C!==void 0&&C.parameterStructures===de.ParameterStructures.byPosition&&i.error(`Notification ${l.method} defines parameters by position but received parameters by name`),P(l.params);else v&&v(l.method,l.params)}catch(O){O.message?i.error(`Notification handler '${l.method}' failed with message: ${O.message}`):i.error(`Notification handler '${l.method}' failed unexpectedly.`)}else Re.fire(l)}function $n(l){if(!l){i.error("Received empty message.");return}i.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(l,null,4)}`);let C=l;if(dt.string(C.id)||dt.number(C.id)){let P=C.id,O=x.get(P);O&&O.reject(new Error("The received response has neither a result nor an error property."))}}function We(l){if(l!=null)switch(M){case Fe.Verbose:return JSON.stringify(l,null,4);case Fe.Compact:return JSON.stringify(l);default:return}}function er(l){if(!(M===Fe.Off||!B))if(z===kn.Text){let C;(M===Fe.Verbose||M===Fe.Compact)&&l.params&&(C=`Params: ${We(l.params)}

`),B.log(`Sending request '${l.method} - (${l.id})'.`,C)}else Ke("send-request",l)}function Tn(l){if(!(M===Fe.Off||!B))if(z===kn.Text){let C;(M===Fe.Verbose||M===Fe.Compact)&&(l.params?C=`Params: ${We(l.params)}

`:C=`No parameters provided.

`),B.log(`Sending notification '${l.method}'.`,C)}else Ke("send-notification",l)}function jt(l,C,P){if(!(M===Fe.Off||!B))if(z===kn.Text){let O;(M===Fe.Verbose||M===Fe.Compact)&&(l.error&&l.error.data?O=`Error data: ${We(l.error.data)}

`:l.result?O=`Result: ${We(l.result)}

`:l.error===void 0&&(O=`No result returned.

`)),B.log(`Sending response '${C} - (${l.id})'. Processing request took ${Date.now()-P}ms`,O)}else Ke("send-response",l)}function fr(l){if(!(M===Fe.Off||!B))if(z===kn.Text){let C;(M===Fe.Verbose||M===Fe.Compact)&&l.params&&(C=`Params: ${We(l.params)}

`),B.log(`Received request '${l.method} - (${l.id})'.`,C)}else Ke("receive-request",l)}function Ht(l){if(!(M===Fe.Off||!B||l.method===Do.type.method))if(z===kn.Text){let C;(M===Fe.Verbose||M===Fe.Compact)&&(l.params?C=`Params: ${We(l.params)}

`:C=`No parameters provided.

`),B.log(`Received notification '${l.method}'.`,C)}else Ke("receive-notification",l)}function Un(l,C){if(!(M===Fe.Off||!B))if(z===kn.Text){let P;if((M===Fe.Verbose||M===Fe.Compact)&&(l.error&&l.error.data?P=`Error data: ${We(l.error.data)}

`:l.result?P=`Result: ${We(l.result)}

`:l.error===void 0&&(P=`No result returned.

`)),C){let O=l.error?` Request failed: ${l.error.message} (${l.error.code}).`:"";B.log(`Received response '${C.method} - (${l.id})' in ${Date.now()-C.timerStart}ms.${O}`,P)}else B.log(`Received response ${l.id} without active response promise.`,P)}else Ke("receive-response",l)}function Ke(l,C){if(!B||M===Fe.Off)return;let P={isLSPMessage:!0,type:l,message:C,timestamp:Date.now()};B.log(P)}function gt(){if(Ue())throw new Oi(Ss.Closed,"Connection is closed.");if(Ct())throw new Oi(Ss.Disposed,"Connection is disposed.")}function xt(){if(wn())throw new Oi(Ss.AlreadyListening,"Connection is already listening")}function Zt(){if(!wn())throw new Error("Call listen() first.")}function Rt(l){return l===void 0?null:l}function Dn(l){if(l!==null)return l}function Wn(l){return l!=null&&!Array.isArray(l)&&typeof l=="object"}function en(l,C){switch(l){case de.ParameterStructures.auto:return Wn(C)?Dn(C):[Rt(C)];case de.ParameterStructures.byName:if(!Wn(C))throw new Error("Received parameters by name but param is not an object literal.");return Dn(C);case de.ParameterStructures.byPosition:return[Rt(C)];default:throw new Error(`Unknown parameter structure ${l.toString()}`)}}function Hn(l,C){let P,O=l.numberOfParams;switch(O){case 0:P=void 0;break;case 1:P=en(l.parameterStructures,C[0]);break;default:P=[];for(let ne=0;ne<C.length&&ne<O;ne++)P.push(Rt(C[ne]));if(C.length<O)for(let ne=C.length;ne<O;ne++)P.push(null);break}return P}let mt={sendNotification:(l,...C)=>{gt();let P,O;if(dt.string(l)){P=l;let ee=C[0],ae=0,ue=de.ParameterStructures.auto;de.ParameterStructures.is(ee)&&(ae=1,ue=ee);let G=C.length,ie=G-ae;switch(ie){case 0:O=void 0;break;case 1:O=en(ue,C[ae]);break;default:if(ue===de.ParameterStructures.byName)throw new Error(`Received ${ie} parameters for 'by Name' notification parameter structure.`);O=C.slice(ae,G).map(Z=>Rt(Z));break}}else{let ee=C;P=l.method,O=Hn(l,ee)}let ne={jsonrpc:c,method:P,params:O};return Tn(ne),e.write(ne).catch(ee=>{throw i.error("Sending notification failed."),ee})},onNotification:(l,C)=>{gt();let P;return dt.func(l)?v=l:C&&(dt.string(l)?(P=l,m.set(l,{type:void 0,handler:C})):(P=l.method,m.set(l.method,{type:l,handler:C}))),{dispose:()=>{P!==void 0?m.delete(P):v=void 0}}},onProgress:(l,C,P)=>{if(S.has(C))throw new Error(`Progress handler for token ${C} already registered`);return S.set(C,P),{dispose:()=>{S.delete(C)}}},sendProgress:(l,C,P)=>mt.sendNotification(Rs.type,{token:C,value:P}),onUnhandledProgress:it.event,sendRequest:(l,...C)=>{gt(),Zt();let P,O,ne;if(dt.string(l)){P=l;let G=C[0],ie=C[C.length-1],Z=0,he=de.ParameterStructures.auto;de.ParameterStructures.is(G)&&(Z=1,he=G);let _e=C.length;Bu.CancellationToken.is(ie)&&(_e=_e-1,ne=ie);let He=_e-Z;switch(He){case 0:O=void 0;break;case 1:O=en(he,C[Z]);break;default:if(he===de.ParameterStructures.byName)throw new Error(`Received ${He} parameters for 'by Name' request parameter structure.`);O=C.slice(Z,_e).map(hr=>Rt(hr));break}}else{let G=C;P=l.method,O=Hn(l,G);let ie=l.numberOfParams;ne=Bu.CancellationToken.is(G[ie])?G[ie]:void 0}let ee=s++,ae;ne&&(ae=ne.onCancellationRequested(()=>{let G=$e.sender.sendCancellation(mt,ee);return G===void 0?(i.log(`Received no promise from cancellation strategy when cancelling id ${ee}`),Promise.resolve()):G.catch(()=>{i.log(`Sending cancellation messages for id ${ee} failed`)})}));let ue={jsonrpc:c,id:ee,method:P,params:O};return er(ue),typeof $e.sender.enableCancellation=="function"&&$e.sender.enableCancellation(ue),new Promise(async(G,ie)=>{let Z=He=>{G(He),$e.sender.cleanup(ee),ae?.dispose()},he=He=>{ie(He),$e.sender.cleanup(ee),ae?.dispose()},_e={method:P,timerStart:Date.now(),resolve:Z,reject:he};try{await e.write(ue),x.set(ee,_e)}catch(He){throw i.error("Sending request failed."),_e.reject(new de.ResponseError(de.ErrorCodes.MessageWriteError,He.message?He.message:"Unknown reason")),He}})},onRequest:(l,C)=>{gt();let P=null;return Xu.is(l)?(P=void 0,d=l):dt.string(l)?(P=null,C!==void 0&&(P=l,p.set(l,{handler:C,type:void 0}))):C!==void 0&&(P=l.method,p.set(l.method,{type:l,handler:C})),{dispose:()=>{P!==null&&(P!==void 0?p.delete(P):d=void 0)}}},hasPendingResponse:()=>x.size>0,trace:async(l,C,P)=>{let O=!1,ne=kn.Text;P!==void 0&&(dt.boolean(P)?O=P:(O=P.sendNotification||!1,ne=P.traceFormat||kn.Text)),M=l,z=ne,M===Fe.Off?B=void 0:B=C,O&&!Ue()&&!Ct()&&await mt.sendNotification(Qu.type,{value:Fe.toString(l)})},onError:J.event,onClose:ce.event,onUnhandledNotification:Re.event,onDispose:Ze.event,end:()=>{e.end()},dispose:()=>{if(Ct())return;pe=nr.Disposed,Ze.fire(void 0);let l=new de.ResponseError(de.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(let C of x.values())C.reject(l);x=new Map,U=new Map,$=new Set,E=new Ig.LinkedMap,dt.func(e.dispose)&&e.dispose(),dt.func(r.dispose)&&r.dispose()},listen:()=>{gt(),xt(),pe=nr.Listening,r.listen(lr)},inspect:()=>{(0,xg.default)().console.log("inspect")}};return mt.onNotification(Do.type,l=>{if(M===Fe.Off||!B)return;let C=M===Fe.Verbose||M===Fe.Compact;B.log(l.message,C?l.verbose:void 0)}),mt.onNotification(Rs.type,l=>{let C=S.get(l.token);C?C(l.value):it.fire(l)}),mt}ye.createMessageConnection=SS});var qo=I(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.ProgressType=F.ProgressToken=F.createMessageConnection=F.NullLogger=F.ConnectionOptions=F.ConnectionStrategy=F.AbstractMessageBuffer=F.WriteableStreamMessageWriter=F.AbstractMessageWriter=F.MessageWriter=F.ReadableStreamMessageReader=F.AbstractMessageReader=F.MessageReader=F.SharedArrayReceiverStrategy=F.SharedArraySenderStrategy=F.CancellationToken=F.CancellationTokenSource=F.Emitter=F.Event=F.Disposable=F.LRUCache=F.Touch=F.LinkedMap=F.ParameterStructures=F.NotificationType9=F.NotificationType8=F.NotificationType7=F.NotificationType6=F.NotificationType5=F.NotificationType4=F.NotificationType3=F.NotificationType2=F.NotificationType1=F.NotificationType0=F.NotificationType=F.ErrorCodes=F.ResponseError=F.RequestType9=F.RequestType8=F.RequestType7=F.RequestType6=F.RequestType5=F.RequestType4=F.RequestType3=F.RequestType2=F.RequestType1=F.RequestType0=F.RequestType=F.Message=F.RAL=void 0;F.MessageStrategy=F.CancellationStrategy=F.CancellationSenderStrategy=F.CancellationReceiverStrategy=F.ConnectionError=F.ConnectionErrors=F.LogTraceNotification=F.SetTraceNotification=F.TraceFormat=F.TraceValues=F.Trace=void 0;var Xe=Tu();Object.defineProperty(F,"Message",{enumerable:!0,get:function(){return Xe.Message}});Object.defineProperty(F,"RequestType",{enumerable:!0,get:function(){return Xe.RequestType}});Object.defineProperty(F,"RequestType0",{enumerable:!0,get:function(){return Xe.RequestType0}});Object.defineProperty(F,"RequestType1",{enumerable:!0,get:function(){return Xe.RequestType1}});Object.defineProperty(F,"RequestType2",{enumerable:!0,get:function(){return Xe.RequestType2}});Object.defineProperty(F,"RequestType3",{enumerable:!0,get:function(){return Xe.RequestType3}});Object.defineProperty(F,"RequestType4",{enumerable:!0,get:function(){return Xe.RequestType4}});Object.defineProperty(F,"RequestType5",{enumerable:!0,get:function(){return Xe.RequestType5}});Object.defineProperty(F,"RequestType6",{enumerable:!0,get:function(){return Xe.RequestType6}});Object.defineProperty(F,"RequestType7",{enumerable:!0,get:function(){return Xe.RequestType7}});Object.defineProperty(F,"RequestType8",{enumerable:!0,get:function(){return Xe.RequestType8}});Object.defineProperty(F,"RequestType9",{enumerable:!0,get:function(){return Xe.RequestType9}});Object.defineProperty(F,"ResponseError",{enumerable:!0,get:function(){return Xe.ResponseError}});Object.defineProperty(F,"ErrorCodes",{enumerable:!0,get:function(){return Xe.ErrorCodes}});Object.defineProperty(F,"NotificationType",{enumerable:!0,get:function(){return Xe.NotificationType}});Object.defineProperty(F,"NotificationType0",{enumerable:!0,get:function(){return Xe.NotificationType0}});Object.defineProperty(F,"NotificationType1",{enumerable:!0,get:function(){return Xe.NotificationType1}});Object.defineProperty(F,"NotificationType2",{enumerable:!0,get:function(){return Xe.NotificationType2}});Object.defineProperty(F,"NotificationType3",{enumerable:!0,get:function(){return Xe.NotificationType3}});Object.defineProperty(F,"NotificationType4",{enumerable:!0,get:function(){return Xe.NotificationType4}});Object.defineProperty(F,"NotificationType5",{enumerable:!0,get:function(){return Xe.NotificationType5}});Object.defineProperty(F,"NotificationType6",{enumerable:!0,get:function(){return Xe.NotificationType6}});Object.defineProperty(F,"NotificationType7",{enumerable:!0,get:function(){return Xe.NotificationType7}});Object.defineProperty(F,"NotificationType8",{enumerable:!0,get:function(){return Xe.NotificationType8}});Object.defineProperty(F,"NotificationType9",{enumerable:!0,get:function(){return Xe.NotificationType9}});Object.defineProperty(F,"ParameterStructures",{enumerable:!0,get:function(){return Xe.ParameterStructures}});var ed=Pu();Object.defineProperty(F,"LinkedMap",{enumerable:!0,get:function(){return ed.LinkedMap}});Object.defineProperty(F,"LRUCache",{enumerable:!0,get:function(){return ed.LRUCache}});Object.defineProperty(F,"Touch",{enumerable:!0,get:function(){return ed.Touch}});var _S=bg();Object.defineProperty(F,"Disposable",{enumerable:!0,get:function(){return _S.Disposable}});var Lg=Ei();Object.defineProperty(F,"Event",{enumerable:!0,get:function(){return Lg.Event}});Object.defineProperty(F,"Emitter",{enumerable:!0,get:function(){return Lg.Emitter}});var Mg=Co();Object.defineProperty(F,"CancellationTokenSource",{enumerable:!0,get:function(){return Mg.CancellationTokenSource}});Object.defineProperty(F,"CancellationToken",{enumerable:!0,get:function(){return Mg.CancellationToken}});var Ng=Cg();Object.defineProperty(F,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return Ng.SharedArraySenderStrategy}});Object.defineProperty(F,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return Ng.SharedArrayReceiverStrategy}});var td=Sg();Object.defineProperty(F,"MessageReader",{enumerable:!0,get:function(){return td.MessageReader}});Object.defineProperty(F,"AbstractMessageReader",{enumerable:!0,get:function(){return td.AbstractMessageReader}});Object.defineProperty(F,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return td.ReadableStreamMessageReader}});var nd=kg();Object.defineProperty(F,"MessageWriter",{enumerable:!0,get:function(){return nd.MessageWriter}});Object.defineProperty(F,"AbstractMessageWriter",{enumerable:!0,get:function(){return nd.AbstractMessageWriter}});Object.defineProperty(F,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return nd.WriteableStreamMessageWriter}});var TS=Eg();Object.defineProperty(F,"AbstractMessageBuffer",{enumerable:!0,get:function(){return TS.AbstractMessageBuffer}});var Ut=Fg();Object.defineProperty(F,"ConnectionStrategy",{enumerable:!0,get:function(){return Ut.ConnectionStrategy}});Object.defineProperty(F,"ConnectionOptions",{enumerable:!0,get:function(){return Ut.ConnectionOptions}});Object.defineProperty(F,"NullLogger",{enumerable:!0,get:function(){return Ut.NullLogger}});Object.defineProperty(F,"createMessageConnection",{enumerable:!0,get:function(){return Ut.createMessageConnection}});Object.defineProperty(F,"ProgressToken",{enumerable:!0,get:function(){return Ut.ProgressToken}});Object.defineProperty(F,"ProgressType",{enumerable:!0,get:function(){return Ut.ProgressType}});Object.defineProperty(F,"Trace",{enumerable:!0,get:function(){return Ut.Trace}});Object.defineProperty(F,"TraceValues",{enumerable:!0,get:function(){return Ut.TraceValues}});Object.defineProperty(F,"TraceFormat",{enumerable:!0,get:function(){return Ut.TraceFormat}});Object.defineProperty(F,"SetTraceNotification",{enumerable:!0,get:function(){return Ut.SetTraceNotification}});Object.defineProperty(F,"LogTraceNotification",{enumerable:!0,get:function(){return Ut.LogTraceNotification}});Object.defineProperty(F,"ConnectionErrors",{enumerable:!0,get:function(){return Ut.ConnectionErrors}});Object.defineProperty(F,"ConnectionError",{enumerable:!0,get:function(){return Ut.ConnectionError}});Object.defineProperty(F,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return Ut.CancellationReceiverStrategy}});Object.defineProperty(F,"CancellationSenderStrategy",{enumerable:!0,get:function(){return Ut.CancellationSenderStrategy}});Object.defineProperty(F,"CancellationStrategy",{enumerable:!0,get:function(){return Ut.CancellationStrategy}});Object.defineProperty(F,"MessageStrategy",{enumerable:!0,get:function(){return Ut.MessageStrategy}});var DS=Ar();F.RAL=DS.default});var $g=I(od=>{"use strict";Object.defineProperty(od,"__esModule",{value:!0});var Ag=require("util"),Tr=qo(),Oo=class r extends Tr.AbstractMessageBuffer{constructor(e="utf-8"){super(e)}emptyBuffer(){return r.emptyBuffer}fromString(e,t){return Buffer.from(e,t)}toString(e,t){return e instanceof Buffer?e.toString(t):new Ag.TextDecoder(t).decode(e)}asNative(e,t){return t===void 0?e instanceof Buffer?e:Buffer.from(e):e instanceof Buffer?e.slice(0,t):Buffer.from(e,0,t)}allocNative(e){return Buffer.allocUnsafe(e)}};Oo.emptyBuffer=Buffer.allocUnsafe(0);var rd=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),Tr.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),Tr.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),Tr.Disposable.create(()=>this.stream.off("end",e))}onData(e){return this.stream.on("data",e),Tr.Disposable.create(()=>this.stream.off("data",e))}},id=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),Tr.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),Tr.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),Tr.Disposable.create(()=>this.stream.off("end",e))}write(e,t){return new Promise((n,i)=>{let s=o=>{o==null?n():i(o)};typeof e=="string"?this.stream.write(e,t,s):this.stream.write(e,s)})}end(){this.stream.end()}},jg=Object.freeze({messageBuffer:Object.freeze({create:r=>new Oo(r)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(r,e)=>{try{return Promise.resolve(Buffer.from(JSON.stringify(r,void 0,0),e.charset))}catch(t){return Promise.reject(t)}}}),decoder:Object.freeze({name:"application/json",decode:(r,e)=>{try{return r instanceof Buffer?Promise.resolve(JSON.parse(r.toString(e.charset))):Promise.resolve(JSON.parse(new Ag.TextDecoder(e.charset).decode(r)))}catch(t){return Promise.reject(t)}}})}),stream:Object.freeze({asReadableStream:r=>new rd(r),asWritableStream:r=>new id(r)}),console,timer:Object.freeze({setTimeout(r,e,...t){let n=setTimeout(r,e,...t);return{dispose:()=>clearTimeout(n)}},setImmediate(r,...e){let t=setImmediate(r,...e);return{dispose:()=>clearImmediate(t)}},setInterval(r,e,...t){let n=setInterval(r,e,...t);return{dispose:()=>clearInterval(n)}}})});function sd(){return jg}(function(r){function e(){Tr.RAL.install(jg)}r.install=e})(sd||(sd={}));od.default=sd});var ui=I(Ee=>{"use strict";var PS=Ee&&Ee.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),kS=Ee&&Ee.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&PS(e,r,t)};Object.defineProperty(Ee,"__esModule",{value:!0});Ee.createMessageConnection=Ee.createServerSocketTransport=Ee.createClientSocketTransport=Ee.createServerPipeTransport=Ee.createClientPipeTransport=Ee.generateRandomPipeName=Ee.StreamMessageWriter=Ee.StreamMessageReader=Ee.SocketMessageWriter=Ee.SocketMessageReader=Ee.PortMessageWriter=Ee.PortMessageReader=Ee.IPCMessageWriter=Ee.IPCMessageReader=void 0;var Fi=$g();Fi.default.install();var Ug=require("path"),ES=require("os"),xS=require("crypto"),Mo=require("net"),En=qo();kS(qo(),Ee);var ad=class extends En.AbstractMessageReader{constructor(e){super(),this.process=e;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose())}listen(e){return this.process.on("message",e),En.Disposable.create(()=>this.process.off("message",e))}};Ee.IPCMessageReader=ad;var cd=class extends En.AbstractMessageWriter{constructor(e){super(),this.process=e,this.errorCount=0;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose)}write(e){try{return typeof this.process.send=="function"&&this.process.send(e,void 0,void 0,t=>{t?(this.errorCount++,this.handleError(t,e)):this.errorCount=0}),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};Ee.IPCMessageWriter=cd;var ud=class extends En.AbstractMessageReader{constructor(e){super(),this.onData=new En.Emitter,e.on("close",()=>this.fireClose),e.on("error",t=>this.fireError(t)),e.on("message",t=>{this.onData.fire(t)})}listen(e){return this.onData.event(e)}};Ee.PortMessageReader=ud;var dd=class extends En.AbstractMessageWriter{constructor(e){super(),this.port=e,this.errorCount=0,e.on("close",()=>this.fireClose()),e.on("error",t=>this.fireError(t))}write(e){try{return this.port.postMessage(e),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};Ee.PortMessageWriter=dd;var ai=class extends En.ReadableStreamMessageReader{constructor(e,t="utf-8"){super((0,Fi.default)().stream.asReadableStream(e),t)}};Ee.SocketMessageReader=ai;var ci=class extends En.WriteableStreamMessageWriter{constructor(e,t){super((0,Fi.default)().stream.asWritableStream(e),t),this.socket=e}dispose(){super.dispose(),this.socket.destroy()}};Ee.SocketMessageWriter=ci;var Fo=class extends En.ReadableStreamMessageReader{constructor(e,t){super((0,Fi.default)().stream.asReadableStream(e),t)}};Ee.StreamMessageReader=Fo;var Lo=class extends En.WriteableStreamMessageWriter{constructor(e,t){super((0,Fi.default)().stream.asWritableStream(e),t)}};Ee.StreamMessageWriter=Lo;var Wg=process.env.XDG_RUNTIME_DIR,IS=new Map([["linux",107],["darwin",103]]);function qS(){let r=(0,xS.randomBytes)(21).toString("hex");if(process.platform==="win32")return`\\\\.\\pipe\\vscode-jsonrpc-${r}-sock`;let e;Wg?e=Ug.join(Wg,`vscode-ipc-${r}.sock`):e=Ug.join(ES.tmpdir(),`vscode-${r}.sock`);let t=IS.get(process.platform);return t!==void 0&&e.length>t&&(0,Fi.default)().console.warn(`WARNING: IPC handle "${e}" is longer than ${t} characters.`),e}Ee.generateRandomPipeName=qS;function OS(r,e="utf-8"){let t,n=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let o=(0,Mo.createServer)(a=>{o.close(),t([new ai(a,e),new ci(a,e)])});o.on("error",s),o.listen(r,()=>{o.removeListener("error",s),i({onConnected:()=>n})})})}Ee.createClientPipeTransport=OS;function FS(r,e="utf-8"){let t=(0,Mo.createConnection)(r);return[new ai(t,e),new ci(t,e)]}Ee.createServerPipeTransport=FS;function LS(r,e="utf-8"){let t,n=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let o=(0,Mo.createServer)(a=>{o.close(),t([new ai(a,e),new ci(a,e)])});o.on("error",s),o.listen(r,"127.0.0.1",()=>{o.removeListener("error",s),i({onConnected:()=>n})})})}Ee.createClientSocketTransport=LS;function MS(r,e="utf-8"){let t=(0,Mo.createConnection)(r,"127.0.0.1");return[new ai(t,e),new ci(t,e)]}Ee.createServerSocketTransport=MS;function NS(r){let e=r;return e.read!==void 0&&e.addListener!==void 0}function AS(r){let e=r;return e.write!==void 0&&e.addListener!==void 0}function jS(r,e,t,n){t||(t=En.NullLogger);let i=NS(r)?new Fo(r):r,s=AS(e)?new Lo(e):e;return En.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,En.createMessageConnection)(i,s,t,n)}Ee.createMessageConnection=jS});var ld=I((gE,Hg)=>{"use strict";Hg.exports=ui()});var Ao=I((Vg,No)=>{(function(r){if(typeof No=="object"&&typeof No.exports=="object"){var e=r(require,Vg);e!==void 0&&(No.exports=e)}else typeof define=="function"&&define.amd&&define(["require","exports"],r)})(function(r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextDocument=e.EOL=e.WorkspaceFolder=e.InlineCompletionContext=e.SelectedCompletionInfo=e.InlineCompletionTriggerKind=e.InlineCompletionList=e.InlineCompletionItem=e.StringValue=e.InlayHint=e.InlayHintLabelPart=e.InlayHintKind=e.InlineValueContext=e.InlineValueEvaluatableExpression=e.InlineValueVariableLookup=e.InlineValueText=e.SemanticTokens=e.SemanticTokenModifiers=e.SemanticTokenTypes=e.SelectionRange=e.DocumentLink=e.FormattingOptions=e.CodeLens=e.CodeAction=e.CodeActionContext=e.CodeActionTriggerKind=e.CodeActionKind=e.DocumentSymbol=e.WorkspaceSymbol=e.SymbolInformation=e.SymbolTag=e.SymbolKind=e.DocumentHighlight=e.DocumentHighlightKind=e.SignatureInformation=e.ParameterInformation=e.Hover=e.MarkedString=e.CompletionList=e.CompletionItem=e.CompletionItemLabelDetails=e.InsertTextMode=e.InsertReplaceEdit=e.CompletionItemTag=e.InsertTextFormat=e.CompletionItemKind=e.MarkupContent=e.MarkupKind=e.TextDocumentItem=e.OptionalVersionedTextDocumentIdentifier=e.VersionedTextDocumentIdentifier=e.TextDocumentIdentifier=e.WorkspaceChange=e.WorkspaceEdit=e.DeleteFile=e.RenameFile=e.CreateFile=e.TextDocumentEdit=e.AnnotatedTextEdit=e.ChangeAnnotationIdentifier=e.ChangeAnnotation=e.TextEdit=e.Command=e.Diagnostic=e.CodeDescription=e.DiagnosticTag=e.DiagnosticSeverity=e.DiagnosticRelatedInformation=e.FoldingRange=e.FoldingRangeKind=e.ColorPresentation=e.ColorInformation=e.Color=e.LocationLink=e.Location=e.Range=e.Position=e.uinteger=e.integer=e.URI=e.DocumentUri=void 0;var t;(function(g){function R(_){return typeof _=="string"}g.is=R})(t||(e.DocumentUri=t={}));var n;(function(g){function R(_){return typeof _=="string"}g.is=R})(n||(e.URI=n={}));var i;(function(g){g.MIN_VALUE=-2147483648,g.MAX_VALUE=2147483647;function R(_){return typeof _=="number"&&g.MIN_VALUE<=_&&_<=g.MAX_VALUE}g.is=R})(i||(e.integer=i={}));var s;(function(g){g.MIN_VALUE=0,g.MAX_VALUE=2147483647;function R(_){return typeof _=="number"&&g.MIN_VALUE<=_&&_<=g.MAX_VALUE}g.is=R})(s||(e.uinteger=s={}));var o;(function(g){function R(y,f){return y===Number.MAX_VALUE&&(y=s.MAX_VALUE),f===Number.MAX_VALUE&&(f=s.MAX_VALUE),{line:y,character:f}}g.create=R;function _(y){var f=y;return D.objectLiteral(f)&&D.uinteger(f.line)&&D.uinteger(f.character)}g.is=_})(o||(e.Position=o={}));var a;(function(g){function R(y,f,k,A){if(D.uinteger(y)&&D.uinteger(f)&&D.uinteger(k)&&D.uinteger(A))return{start:o.create(y,f),end:o.create(k,A)};if(o.is(y)&&o.is(f))return{start:y,end:f};throw new Error("Range#create called with invalid arguments[".concat(y,", ").concat(f,", ").concat(k,", ").concat(A,"]"))}g.create=R;function _(y){var f=y;return D.objectLiteral(f)&&o.is(f.start)&&o.is(f.end)}g.is=_})(a||(e.Range=a={}));var c;(function(g){function R(y,f){return{uri:y,range:f}}g.create=R;function _(y){var f=y;return D.objectLiteral(f)&&a.is(f.range)&&(D.string(f.uri)||D.undefined(f.uri))}g.is=_})(c||(e.Location=c={}));var d;(function(g){function R(y,f,k,A){return{targetUri:y,targetRange:f,targetSelectionRange:k,originSelectionRange:A}}g.create=R;function _(y){var f=y;return D.objectLiteral(f)&&a.is(f.targetRange)&&D.string(f.targetUri)&&a.is(f.targetSelectionRange)&&(a.is(f.originSelectionRange)||D.undefined(f.originSelectionRange))}g.is=_})(d||(e.LocationLink=d={}));var p;(function(g){function R(y,f,k,A){return{red:y,green:f,blue:k,alpha:A}}g.create=R;function _(y){var f=y;return D.objectLiteral(f)&&D.numberRange(f.red,0,1)&&D.numberRange(f.green,0,1)&&D.numberRange(f.blue,0,1)&&D.numberRange(f.alpha,0,1)}g.is=_})(p||(e.Color=p={}));var v;(function(g){function R(y,f){return{range:y,color:f}}g.create=R;function _(y){var f=y;return D.objectLiteral(f)&&a.is(f.range)&&p.is(f.color)}g.is=_})(v||(e.ColorInformation=v={}));var m;(function(g){function R(y,f,k){return{label:y,textEdit:f,additionalTextEdits:k}}g.create=R;function _(y){var f=y;return D.objectLiteral(f)&&D.string(f.label)&&(D.undefined(f.textEdit)||B.is(f))&&(D.undefined(f.additionalTextEdits)||D.typedArray(f.additionalTextEdits,B.is))}g.is=_})(m||(e.ColorPresentation=m={}));var S;(function(g){g.Comment="comment",g.Imports="imports",g.Region="region"})(S||(e.FoldingRangeKind=S={}));var b;(function(g){function R(y,f,k,A,ge,st){var Be={startLine:y,endLine:f};return D.defined(k)&&(Be.startCharacter=k),D.defined(A)&&(Be.endCharacter=A),D.defined(ge)&&(Be.kind=ge),D.defined(st)&&(Be.collapsedText=st),Be}g.create=R;function _(y){var f=y;return D.objectLiteral(f)&&D.uinteger(f.startLine)&&D.uinteger(f.startLine)&&(D.undefined(f.startCharacter)||D.uinteger(f.startCharacter))&&(D.undefined(f.endCharacter)||D.uinteger(f.endCharacter))&&(D.undefined(f.kind)||D.string(f.kind))}g.is=_})(b||(e.FoldingRange=b={}));var E;(function(g){function R(y,f){return{location:y,message:f}}g.create=R;function _(y){var f=y;return D.defined(f)&&c.is(f.location)&&D.string(f.message)}g.is=_})(E||(e.DiagnosticRelatedInformation=E={}));var x;(function(g){g.Error=1,g.Warning=2,g.Information=3,g.Hint=4})(x||(e.DiagnosticSeverity=x={}));var $;(function(g){g.Unnecessary=1,g.Deprecated=2})($||(e.DiagnosticTag=$={}));var U;(function(g){function R(_){var y=_;return D.objectLiteral(y)&&D.string(y.href)}g.is=R})(U||(e.CodeDescription=U={}));var M;(function(g){function R(y,f,k,A,ge,st){var Be={range:y,message:f};return D.defined(k)&&(Be.severity=k),D.defined(A)&&(Be.code=A),D.defined(ge)&&(Be.source=ge),D.defined(st)&&(Be.relatedInformation=st),Be}g.create=R;function _(y){var f,k=y;return D.defined(k)&&a.is(k.range)&&D.string(k.message)&&(D.number(k.severity)||D.undefined(k.severity))&&(D.integer(k.code)||D.string(k.code)||D.undefined(k.code))&&(D.undefined(k.codeDescription)||D.string((f=k.codeDescription)===null||f===void 0?void 0:f.href))&&(D.string(k.source)||D.undefined(k.source))&&(D.undefined(k.relatedInformation)||D.typedArray(k.relatedInformation,E.is))}g.is=_})(M||(e.Diagnostic=M={}));var z;(function(g){function R(y,f){for(var k=[],A=2;A<arguments.length;A++)k[A-2]=arguments[A];var ge={title:y,command:f};return D.defined(k)&&k.length>0&&(ge.arguments=k),ge}g.create=R;function _(y){var f=y;return D.defined(f)&&D.string(f.title)&&D.string(f.command)}g.is=_})(z||(e.Command=z={}));var B;(function(g){function R(k,A){return{range:k,newText:A}}g.replace=R;function _(k,A){return{range:{start:k,end:k},newText:A}}g.insert=_;function y(k){return{range:k,newText:""}}g.del=y;function f(k){var A=k;return D.objectLiteral(A)&&D.string(A.newText)&&a.is(A.range)}g.is=f})(B||(e.TextEdit=B={}));var pe;(function(g){function R(y,f,k){var A={label:y};return f!==void 0&&(A.needsConfirmation=f),k!==void 0&&(A.description=k),A}g.create=R;function _(y){var f=y;return D.objectLiteral(f)&&D.string(f.label)&&(D.boolean(f.needsConfirmation)||f.needsConfirmation===void 0)&&(D.string(f.description)||f.description===void 0)}g.is=_})(pe||(e.ChangeAnnotation=pe={}));var J;(function(g){function R(_){var y=_;return D.string(y)}g.is=R})(J||(e.ChangeAnnotationIdentifier=J={}));var ce;(function(g){function R(k,A,ge){return{range:k,newText:A,annotationId:ge}}g.replace=R;function _(k,A,ge){return{range:{start:k,end:k},newText:A,annotationId:ge}}g.insert=_;function y(k,A){return{range:k,newText:"",annotationId:A}}g.del=y;function f(k){var A=k;return B.is(A)&&(pe.is(A.annotationId)||J.is(A.annotationId))}g.is=f})(ce||(e.AnnotatedTextEdit=ce={}));var Re;(function(g){function R(y,f){return{textDocument:y,edits:f}}g.create=R;function _(y){var f=y;return D.defined(f)&&Ue.is(f.textDocument)&&Array.isArray(f.edits)}g.is=_})(Re||(e.TextDocumentEdit=Re={}));var it;(function(g){function R(y,f,k){var A={kind:"create",uri:y};return f!==void 0&&(f.overwrite!==void 0||f.ignoreIfExists!==void 0)&&(A.options=f),k!==void 0&&(A.annotationId=k),A}g.create=R;function _(y){var f=y;return f&&f.kind==="create"&&D.string(f.uri)&&(f.options===void 0||(f.options.overwrite===void 0||D.boolean(f.options.overwrite))&&(f.options.ignoreIfExists===void 0||D.boolean(f.options.ignoreIfExists)))&&(f.annotationId===void 0||J.is(f.annotationId))}g.is=_})(it||(e.CreateFile=it={}));var Ze;(function(g){function R(y,f,k,A){var ge={kind:"rename",oldUri:y,newUri:f};return k!==void 0&&(k.overwrite!==void 0||k.ignoreIfExists!==void 0)&&(ge.options=k),A!==void 0&&(ge.annotationId=A),ge}g.create=R;function _(y){var f=y;return f&&f.kind==="rename"&&D.string(f.oldUri)&&D.string(f.newUri)&&(f.options===void 0||(f.options.overwrite===void 0||D.boolean(f.options.overwrite))&&(f.options.ignoreIfExists===void 0||D.boolean(f.options.ignoreIfExists)))&&(f.annotationId===void 0||J.is(f.annotationId))}g.is=_})(Ze||(e.RenameFile=Ze={}));var $e;(function(g){function R(y,f,k){var A={kind:"delete",uri:y};return f!==void 0&&(f.recursive!==void 0||f.ignoreIfNotExists!==void 0)&&(A.options=f),k!==void 0&&(A.annotationId=k),A}g.create=R;function _(y){var f=y;return f&&f.kind==="delete"&&D.string(f.uri)&&(f.options===void 0||(f.options.recursive===void 0||D.boolean(f.options.recursive))&&(f.options.ignoreIfNotExists===void 0||D.boolean(f.options.ignoreIfNotExists)))&&(f.annotationId===void 0||J.is(f.annotationId))}g.is=_})($e||(e.DeleteFile=$e={}));var Yt;(function(g){function R(_){var y=_;return y&&(y.changes!==void 0||y.documentChanges!==void 0)&&(y.documentChanges===void 0||y.documentChanges.every(function(f){return D.string(f.kind)?it.is(f)||Ze.is(f)||$e.is(f):Re.is(f)}))}g.is=R})(Yt||(e.WorkspaceEdit=Yt={}));var At=function(){function g(R,_){this.edits=R,this.changeAnnotations=_}return g.prototype.insert=function(R,_,y){var f,k;if(y===void 0?f=B.insert(R,_):J.is(y)?(k=y,f=ce.insert(R,_,y)):(this.assertChangeAnnotations(this.changeAnnotations),k=this.changeAnnotations.manage(y),f=ce.insert(R,_,k)),this.edits.push(f),k!==void 0)return k},g.prototype.replace=function(R,_,y){var f,k;if(y===void 0?f=B.replace(R,_):J.is(y)?(k=y,f=ce.replace(R,_,y)):(this.assertChangeAnnotations(this.changeAnnotations),k=this.changeAnnotations.manage(y),f=ce.replace(R,_,k)),this.edits.push(f),k!==void 0)return k},g.prototype.delete=function(R,_){var y,f;if(_===void 0?y=B.del(R):J.is(_)?(f=_,y=ce.del(R,_)):(this.assertChangeAnnotations(this.changeAnnotations),f=this.changeAnnotations.manage(_),y=ce.del(R,f)),this.edits.push(y),f!==void 0)return f},g.prototype.add=function(R){this.edits.push(R)},g.prototype.all=function(){return this.edits},g.prototype.clear=function(){this.edits.splice(0,this.edits.length)},g.prototype.assertChangeAnnotations=function(R){if(R===void 0)throw new Error("Text edit change is not configured to manage change annotations.")},g}(),Pt=function(){function g(R){this._annotations=R===void 0?Object.create(null):R,this._counter=0,this._size=0}return g.prototype.all=function(){return this._annotations},Object.defineProperty(g.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),g.prototype.manage=function(R,_){var y;if(J.is(R)?y=R:(y=this.nextId(),_=R),this._annotations[y]!==void 0)throw new Error("Id ".concat(y," is already in use."));if(_===void 0)throw new Error("No annotation provided for id ".concat(y));return this._annotations[y]=_,this._size++,y},g.prototype.nextId=function(){return this._counter++,this._counter.toString()},g}(),kt=function(){function g(R){var _=this;this._textEditChanges=Object.create(null),R!==void 0?(this._workspaceEdit=R,R.documentChanges?(this._changeAnnotations=new Pt(R.changeAnnotations),R.changeAnnotations=this._changeAnnotations.all(),R.documentChanges.forEach(function(y){if(Re.is(y)){var f=new At(y.edits,_._changeAnnotations);_._textEditChanges[y.textDocument.uri]=f}})):R.changes&&Object.keys(R.changes).forEach(function(y){var f=new At(R.changes[y]);_._textEditChanges[y]=f})):this._workspaceEdit={}}return Object.defineProperty(g.prototype,"edit",{get:function(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),g.prototype.getTextEditChange=function(R){if(Ue.is(R)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var _={uri:R.uri,version:R.version},y=this._textEditChanges[_.uri];if(!y){var f=[],k={textDocument:_,edits:f};this._workspaceEdit.documentChanges.push(k),y=new At(f,this._changeAnnotations),this._textEditChanges[_.uri]=y}return y}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");var y=this._textEditChanges[R];if(!y){var f=[];this._workspaceEdit.changes[R]=f,y=new At(f),this._textEditChanges[R]=y}return y}},g.prototype.initDocumentChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new Pt,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},g.prototype.initChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))},g.prototype.createFile=function(R,_,y){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var f;pe.is(_)||J.is(_)?f=_:y=_;var k,A;if(f===void 0?k=it.create(R,y):(A=J.is(f)?f:this._changeAnnotations.manage(f),k=it.create(R,y,A)),this._workspaceEdit.documentChanges.push(k),A!==void 0)return A},g.prototype.renameFile=function(R,_,y,f){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var k;pe.is(y)||J.is(y)?k=y:f=y;var A,ge;if(k===void 0?A=Ze.create(R,_,f):(ge=J.is(k)?k:this._changeAnnotations.manage(k),A=Ze.create(R,_,f,ge)),this._workspaceEdit.documentChanges.push(A),ge!==void 0)return ge},g.prototype.deleteFile=function(R,_,y){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var f;pe.is(_)||J.is(_)?f=_:y=_;var k,A;if(f===void 0?k=$e.create(R,y):(A=J.is(f)?f:this._changeAnnotations.manage(f),k=$e.create(R,y,A)),this._workspaceEdit.documentChanges.push(k),A!==void 0)return A},g}();e.WorkspaceChange=kt;var bn;(function(g){function R(y){return{uri:y}}g.create=R;function _(y){var f=y;return D.defined(f)&&D.string(f.uri)}g.is=_})(bn||(e.TextDocumentIdentifier=bn={}));var wn;(function(g){function R(y,f){return{uri:y,version:f}}g.create=R;function _(y){var f=y;return D.defined(f)&&D.string(f.uri)&&D.integer(f.version)}g.is=_})(wn||(e.VersionedTextDocumentIdentifier=wn={}));var Ue;(function(g){function R(y,f){return{uri:y,version:f}}g.create=R;function _(y){var f=y;return D.defined(f)&&D.string(f.uri)&&(f.version===null||D.integer(f.version))}g.is=_})(Ue||(e.OptionalVersionedTextDocumentIdentifier=Ue={}));var Ct;(function(g){function R(y,f,k,A){return{uri:y,languageId:f,version:k,text:A}}g.create=R;function _(y){var f=y;return D.defined(f)&&D.string(f.uri)&&D.string(f.languageId)&&D.integer(f.version)&&D.string(f.text)}g.is=_})(Ct||(e.TextDocumentItem=Ct={}));var qt;(function(g){g.PlainText="plaintext",g.Markdown="markdown";function R(_){var y=_;return y===g.PlainText||y===g.Markdown}g.is=R})(qt||(e.MarkupKind=qt={}));var Et;(function(g){function R(_){var y=_;return D.objectLiteral(_)&&qt.is(y.kind)&&D.string(y.value)}g.is=R})(Et||(e.MarkupContent=Et={}));var dr;(function(g){g.Text=1,g.Method=2,g.Function=3,g.Constructor=4,g.Field=5,g.Variable=6,g.Class=7,g.Interface=8,g.Module=9,g.Property=10,g.Unit=11,g.Value=12,g.Enum=13,g.Keyword=14,g.Snippet=15,g.Color=16,g.File=17,g.Reference=18,g.Folder=19,g.EnumMember=20,g.Constant=21,g.Struct=22,g.Event=23,g.Operator=24,g.TypeParameter=25})(dr||(e.CompletionItemKind=dr={}));var Cn;(function(g){g.PlainText=1,g.Snippet=2})(Cn||(e.InsertTextFormat=Cn={}));var Rn;(function(g){g.Deprecated=1})(Rn||(e.CompletionItemTag=Rn={}));var Zn;(function(g){function R(y,f,k){return{newText:y,insert:f,replace:k}}g.create=R;function _(y){var f=y;return f&&D.string(f.newText)&&a.is(f.insert)&&a.is(f.replace)}g.is=_})(Zn||(e.InsertReplaceEdit=Zn={}));var lr;(function(g){g.asIs=1,g.adjustIndentation=2})(lr||(e.InsertTextMode=lr={}));var jn;(function(g){function R(_){var y=_;return y&&(D.string(y.detail)||y.detail===void 0)&&(D.string(y.description)||y.description===void 0)}g.is=R})(jn||(e.CompletionItemLabelDetails=jn={}));var Sn;(function(g){function R(_){return{label:_}}g.create=R})(Sn||(e.CompletionItem=Sn={}));var _n;(function(g){function R(_,y){return{items:_||[],isIncomplete:!!y}}g.create=R})(_n||(e.CompletionList=_n={}));var $n;(function(g){function R(y){return y.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}g.fromPlainText=R;function _(y){var f=y;return D.string(f)||D.objectLiteral(f)&&D.string(f.language)&&D.string(f.value)}g.is=_})($n||(e.MarkedString=$n={}));var We;(function(g){function R(_){var y=_;return!!y&&D.objectLiteral(y)&&(Et.is(y.contents)||$n.is(y.contents)||D.typedArray(y.contents,$n.is))&&(_.range===void 0||a.is(_.range))}g.is=R})(We||(e.Hover=We={}));var er;(function(g){function R(_,y){return y?{label:_,documentation:y}:{label:_}}g.create=R})(er||(e.ParameterInformation=er={}));var Tn;(function(g){function R(_,y){for(var f=[],k=2;k<arguments.length;k++)f[k-2]=arguments[k];var A={label:_};return D.defined(y)&&(A.documentation=y),D.defined(f)?A.parameters=f:A.parameters=[],A}g.create=R})(Tn||(e.SignatureInformation=Tn={}));var jt;(function(g){g.Text=1,g.Read=2,g.Write=3})(jt||(e.DocumentHighlightKind=jt={}));var fr;(function(g){function R(_,y){var f={range:_};return D.number(y)&&(f.kind=y),f}g.create=R})(fr||(e.DocumentHighlight=fr={}));var Ht;(function(g){g.File=1,g.Module=2,g.Namespace=3,g.Package=4,g.Class=5,g.Method=6,g.Property=7,g.Field=8,g.Constructor=9,g.Enum=10,g.Interface=11,g.Function=12,g.Variable=13,g.Constant=14,g.String=15,g.Number=16,g.Boolean=17,g.Array=18,g.Object=19,g.Key=20,g.Null=21,g.EnumMember=22,g.Struct=23,g.Event=24,g.Operator=25,g.TypeParameter=26})(Ht||(e.SymbolKind=Ht={}));var Un;(function(g){g.Deprecated=1})(Un||(e.SymbolTag=Un={}));var Ke;(function(g){function R(_,y,f,k,A){var ge={name:_,kind:y,location:{uri:k,range:f}};return A&&(ge.containerName=A),ge}g.create=R})(Ke||(e.SymbolInformation=Ke={}));var gt;(function(g){function R(_,y,f,k){return k!==void 0?{name:_,kind:y,location:{uri:f,range:k}}:{name:_,kind:y,location:{uri:f}}}g.create=R})(gt||(e.WorkspaceSymbol=gt={}));var xt;(function(g){function R(y,f,k,A,ge,st){var Be={name:y,detail:f,kind:k,range:A,selectionRange:ge};return st!==void 0&&(Be.children=st),Be}g.create=R;function _(y){var f=y;return f&&D.string(f.name)&&D.number(f.kind)&&a.is(f.range)&&a.is(f.selectionRange)&&(f.detail===void 0||D.string(f.detail))&&(f.deprecated===void 0||D.boolean(f.deprecated))&&(f.children===void 0||Array.isArray(f.children))&&(f.tags===void 0||Array.isArray(f.tags))}g.is=_})(xt||(e.DocumentSymbol=xt={}));var Zt;(function(g){g.Empty="",g.QuickFix="quickfix",g.Refactor="refactor",g.RefactorExtract="refactor.extract",g.RefactorInline="refactor.inline",g.RefactorRewrite="refactor.rewrite",g.Source="source",g.SourceOrganizeImports="source.organizeImports",g.SourceFixAll="source.fixAll"})(Zt||(e.CodeActionKind=Zt={}));var Rt;(function(g){g.Invoked=1,g.Automatic=2})(Rt||(e.CodeActionTriggerKind=Rt={}));var Dn;(function(g){function R(y,f,k){var A={diagnostics:y};return f!=null&&(A.only=f),k!=null&&(A.triggerKind=k),A}g.create=R;function _(y){var f=y;return D.defined(f)&&D.typedArray(f.diagnostics,M.is)&&(f.only===void 0||D.typedArray(f.only,D.string))&&(f.triggerKind===void 0||f.triggerKind===Rt.Invoked||f.triggerKind===Rt.Automatic)}g.is=_})(Dn||(e.CodeActionContext=Dn={}));var Wn;(function(g){function R(y,f,k){var A={title:y},ge=!0;return typeof f=="string"?(ge=!1,A.kind=f):z.is(f)?A.command=f:A.edit=f,ge&&k!==void 0&&(A.kind=k),A}g.create=R;function _(y){var f=y;return f&&D.string(f.title)&&(f.diagnostics===void 0||D.typedArray(f.diagnostics,M.is))&&(f.kind===void 0||D.string(f.kind))&&(f.edit!==void 0||f.command!==void 0)&&(f.command===void 0||z.is(f.command))&&(f.isPreferred===void 0||D.boolean(f.isPreferred))&&(f.edit===void 0||Yt.is(f.edit))}g.is=_})(Wn||(e.CodeAction=Wn={}));var en;(function(g){function R(y,f){var k={range:y};return D.defined(f)&&(k.data=f),k}g.create=R;function _(y){var f=y;return D.defined(f)&&a.is(f.range)&&(D.undefined(f.command)||z.is(f.command))}g.is=_})(en||(e.CodeLens=en={}));var Hn;(function(g){function R(y,f){return{tabSize:y,insertSpaces:f}}g.create=R;function _(y){var f=y;return D.defined(f)&&D.uinteger(f.tabSize)&&D.boolean(f.insertSpaces)}g.is=_})(Hn||(e.FormattingOptions=Hn={}));var mt;(function(g){function R(y,f,k){return{range:y,target:f,data:k}}g.create=R;function _(y){var f=y;return D.defined(f)&&a.is(f.range)&&(D.undefined(f.target)||D.string(f.target))}g.is=_})(mt||(e.DocumentLink=mt={}));var l;(function(g){function R(y,f){return{range:y,parent:f}}g.create=R;function _(y){var f=y;return D.objectLiteral(f)&&a.is(f.range)&&(f.parent===void 0||g.is(f.parent))}g.is=_})(l||(e.SelectionRange=l={}));var C;(function(g){g.namespace="namespace",g.type="type",g.class="class",g.enum="enum",g.interface="interface",g.struct="struct",g.typeParameter="typeParameter",g.parameter="parameter",g.variable="variable",g.property="property",g.enumMember="enumMember",g.event="event",g.function="function",g.method="method",g.macro="macro",g.keyword="keyword",g.modifier="modifier",g.comment="comment",g.string="string",g.number="number",g.regexp="regexp",g.operator="operator",g.decorator="decorator"})(C||(e.SemanticTokenTypes=C={}));var P;(function(g){g.declaration="declaration",g.definition="definition",g.readonly="readonly",g.static="static",g.deprecated="deprecated",g.abstract="abstract",g.async="async",g.modification="modification",g.documentation="documentation",g.defaultLibrary="defaultLibrary"})(P||(e.SemanticTokenModifiers=P={}));var O;(function(g){function R(_){var y=_;return D.objectLiteral(y)&&(y.resultId===void 0||typeof y.resultId=="string")&&Array.isArray(y.data)&&(y.data.length===0||typeof y.data[0]=="number")}g.is=R})(O||(e.SemanticTokens=O={}));var ne;(function(g){function R(y,f){return{range:y,text:f}}g.create=R;function _(y){var f=y;return f!=null&&a.is(f.range)&&D.string(f.text)}g.is=_})(ne||(e.InlineValueText=ne={}));var ee;(function(g){function R(y,f,k){return{range:y,variableName:f,caseSensitiveLookup:k}}g.create=R;function _(y){var f=y;return f!=null&&a.is(f.range)&&D.boolean(f.caseSensitiveLookup)&&(D.string(f.variableName)||f.variableName===void 0)}g.is=_})(ee||(e.InlineValueVariableLookup=ee={}));var ae;(function(g){function R(y,f){return{range:y,expression:f}}g.create=R;function _(y){var f=y;return f!=null&&a.is(f.range)&&(D.string(f.expression)||f.expression===void 0)}g.is=_})(ae||(e.InlineValueEvaluatableExpression=ae={}));var ue;(function(g){function R(y,f){return{frameId:y,stoppedLocation:f}}g.create=R;function _(y){var f=y;return D.defined(f)&&a.is(y.stoppedLocation)}g.is=_})(ue||(e.InlineValueContext=ue={}));var G;(function(g){g.Type=1,g.Parameter=2;function R(_){return _===1||_===2}g.is=R})(G||(e.InlayHintKind=G={}));var ie;(function(g){function R(y){return{value:y}}g.create=R;function _(y){var f=y;return D.objectLiteral(f)&&(f.tooltip===void 0||D.string(f.tooltip)||Et.is(f.tooltip))&&(f.location===void 0||c.is(f.location))&&(f.command===void 0||z.is(f.command))}g.is=_})(ie||(e.InlayHintLabelPart=ie={}));var Z;(function(g){function R(y,f,k){var A={position:y,label:f};return k!==void 0&&(A.kind=k),A}g.create=R;function _(y){var f=y;return D.objectLiteral(f)&&o.is(f.position)&&(D.string(f.label)||D.typedArray(f.label,ie.is))&&(f.kind===void 0||G.is(f.kind))&&f.textEdits===void 0||D.typedArray(f.textEdits,B.is)&&(f.tooltip===void 0||D.string(f.tooltip)||Et.is(f.tooltip))&&(f.paddingLeft===void 0||D.boolean(f.paddingLeft))&&(f.paddingRight===void 0||D.boolean(f.paddingRight))}g.is=_})(Z||(e.InlayHint=Z={}));var he;(function(g){function R(_){return{kind:"snippet",value:_}}g.createSnippet=R})(he||(e.StringValue=he={}));var _e;(function(g){function R(_,y,f,k){return{insertText:_,filterText:y,range:f,command:k}}g.create=R})(_e||(e.InlineCompletionItem=_e={}));var He;(function(g){function R(_){return{items:_}}g.create=R})(He||(e.InlineCompletionList=He={}));var hr;(function(g){g.Invoked=0,g.Automatic=1})(hr||(e.InlineCompletionTriggerKind=hr={}));var Mr;(function(g){function R(_,y){return{range:_,text:y}}g.create=R})(Mr||(e.SelectedCompletionInfo=Mr={}));var h;(function(g){function R(_,y){return{triggerKind:_,selectedCompletionInfo:y}}g.create=R})(h||(e.InlineCompletionContext=h={}));var q;(function(g){function R(_){var y=_;return D.objectLiteral(y)&&n.is(y.uri)&&D.string(y.name)}g.is=R})(q||(e.WorkspaceFolder=q={})),e.EOL=[`
`,`\r
`,"\r"];var Y;(function(g){function R(k,A,ge,st){return new Oe(k,A,ge,st)}g.create=R;function _(k){var A=k;return!!(D.defined(A)&&D.string(A.uri)&&(D.undefined(A.languageId)||D.string(A.languageId))&&D.uinteger(A.lineCount)&&D.func(A.getText)&&D.func(A.positionAt)&&D.func(A.offsetAt))}g.is=_;function y(k,A){for(var ge=k.getText(),st=f(A,function(pr,u){var T=pr.range.start.line-u.range.start.line;return T===0?pr.range.start.character-u.range.start.character:T}),Be=ge.length,on=st.length-1;on>=0;on--){var Pn=st[on],tr=k.offsetAt(Pn.range.start),De=k.offsetAt(Pn.range.end);if(De<=Be)ge=ge.substring(0,tr)+Pn.newText+ge.substring(De,ge.length);else throw new Error("Overlapping edit");Be=tr}return ge}g.applyEdits=y;function f(k,A){if(k.length<=1)return k;var ge=k.length/2|0,st=k.slice(0,ge),Be=k.slice(ge);f(st,A),f(Be,A);for(var on=0,Pn=0,tr=0;on<st.length&&Pn<Be.length;){var De=A(st[on],Be[Pn]);De<=0?k[tr++]=st[on++]:k[tr++]=Be[Pn++]}for(;on<st.length;)k[tr++]=st[on++];for(;Pn<Be.length;)k[tr++]=Be[Pn++];return k}})(Y||(e.TextDocument=Y={}));var Oe=function(){function g(R,_,y,f){this._uri=R,this._languageId=_,this._version=y,this._content=f,this._lineOffsets=void 0}return Object.defineProperty(g.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),g.prototype.getText=function(R){if(R){var _=this.offsetAt(R.start),y=this.offsetAt(R.end);return this._content.substring(_,y)}return this._content},g.prototype.update=function(R,_){this._content=R.text,this._version=_,this._lineOffsets=void 0},g.prototype.getLineOffsets=function(){if(this._lineOffsets===void 0){for(var R=[],_=this._content,y=!0,f=0;f<_.length;f++){y&&(R.push(f),y=!1);var k=_.charAt(f);y=k==="\r"||k===`
`,k==="\r"&&f+1<_.length&&_.charAt(f+1)===`
`&&f++}y&&_.length>0&&R.push(_.length),this._lineOffsets=R}return this._lineOffsets},g.prototype.positionAt=function(R){R=Math.max(Math.min(R,this._content.length),0);var _=this.getLineOffsets(),y=0,f=_.length;if(f===0)return o.create(0,R);for(;y<f;){var k=Math.floor((y+f)/2);_[k]>R?f=k:y=k+1}var A=y-1;return o.create(A,R-_[A])},g.prototype.offsetAt=function(R){var _=this.getLineOffsets();if(R.line>=_.length)return this._content.length;if(R.line<0)return 0;var y=_[R.line],f=R.line+1<_.length?_[R.line+1]:this._content.length;return Math.max(Math.min(y+R.character,f),y)},Object.defineProperty(g.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),g}(),D;(function(g){var R=Object.prototype.toString;function _(De){return typeof De<"u"}g.defined=_;function y(De){return typeof De>"u"}g.undefined=y;function f(De){return De===!0||De===!1}g.boolean=f;function k(De){return R.call(De)==="[object String]"}g.string=k;function A(De){return R.call(De)==="[object Number]"}g.number=A;function ge(De,pr,u){return R.call(De)==="[object Number]"&&pr<=De&&De<=u}g.numberRange=ge;function st(De){return R.call(De)==="[object Number]"&&-2147483648<=De&&De<=2147483647}g.integer=st;function Be(De){return R.call(De)==="[object Number]"&&0<=De&&De<=2147483647}g.uinteger=Be;function on(De){return R.call(De)==="[object Function]"}g.func=on;function Pn(De){return De!==null&&typeof De=="object"}g.objectLiteral=Pn;function tr(De,pr){return Array.isArray(De)&&De.every(pr)}g.typedArray=tr})(D||(D={}))})});var ot=I(cn=>{"use strict";Object.defineProperty(cn,"__esModule",{value:!0});cn.ProtocolNotificationType=cn.ProtocolNotificationType0=cn.ProtocolRequestType=cn.ProtocolRequestType0=cn.RegistrationType=cn.MessageDirection=void 0;var Li=ui(),zg;(function(r){r.clientToServer="clientToServer",r.serverToClient="serverToClient",r.both="both"})(zg||(cn.MessageDirection=zg={}));var fd=class{constructor(e){this.method=e}};cn.RegistrationType=fd;var hd=class extends Li.RequestType0{constructor(e){super(e)}};cn.ProtocolRequestType0=hd;var pd=class extends Li.RequestType{constructor(e){super(e,Li.ParameterStructures.byName)}};cn.ProtocolRequestType=pd;var gd=class extends Li.NotificationType0{constructor(e){super(e)}};cn.ProtocolNotificationType0=gd;var md=class extends Li.NotificationType{constructor(e){super(e,Li.ParameterStructures.byName)}};cn.ProtocolNotificationType=md});var jo=I(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.objectLiteral=St.typedArray=St.stringArray=St.array=St.func=St.error=St.number=St.string=St.boolean=void 0;function $S(r){return r===!0||r===!1}St.boolean=$S;function Kg(r){return typeof r=="string"||r instanceof String}St.string=Kg;function US(r){return typeof r=="number"||r instanceof Number}St.number=US;function WS(r){return r instanceof Error}St.error=WS;function HS(r){return typeof r=="function"}St.func=HS;function Bg(r){return Array.isArray(r)}St.array=Bg;function VS(r){return Bg(r)&&r.every(e=>Kg(e))}St.stringArray=VS;function zS(r,e){return Array.isArray(r)&&r.every(e)}St.typedArray=zS;function KS(r){return r!==null&&typeof r=="object"}St.objectLiteral=KS});var Xg=I($o=>{"use strict";Object.defineProperty($o,"__esModule",{value:!0});$o.ImplementationRequest=void 0;var Gg=ot(),Jg;(function(r){r.method="textDocument/implementation",r.messageDirection=Gg.MessageDirection.clientToServer,r.type=new Gg.ProtocolRequestType(r.method)})(Jg||($o.ImplementationRequest=Jg={}))});var Zg=I(Uo=>{"use strict";Object.defineProperty(Uo,"__esModule",{value:!0});Uo.TypeDefinitionRequest=void 0;var Qg=ot(),Yg;(function(r){r.method="textDocument/typeDefinition",r.messageDirection=Qg.MessageDirection.clientToServer,r.type=new Qg.ProtocolRequestType(r.method)})(Yg||(Uo.TypeDefinitionRequest=Yg={}))});var nm=I(Mi=>{"use strict";Object.defineProperty(Mi,"__esModule",{value:!0});Mi.DidChangeWorkspaceFoldersNotification=Mi.WorkspaceFoldersRequest=void 0;var Wo=ot(),em;(function(r){r.method="workspace/workspaceFolders",r.messageDirection=Wo.MessageDirection.serverToClient,r.type=new Wo.ProtocolRequestType0(r.method)})(em||(Mi.WorkspaceFoldersRequest=em={}));var tm;(function(r){r.method="workspace/didChangeWorkspaceFolders",r.messageDirection=Wo.MessageDirection.clientToServer,r.type=new Wo.ProtocolNotificationType(r.method)})(tm||(Mi.DidChangeWorkspaceFoldersNotification=tm={}))});var sm=I(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.ConfigurationRequest=void 0;var rm=ot(),im;(function(r){r.method="workspace/configuration",r.messageDirection=rm.MessageDirection.serverToClient,r.type=new rm.ProtocolRequestType(r.method)})(im||(Ho.ConfigurationRequest=im={}))});var cm=I(Ni=>{"use strict";Object.defineProperty(Ni,"__esModule",{value:!0});Ni.ColorPresentationRequest=Ni.DocumentColorRequest=void 0;var Vo=ot(),om;(function(r){r.method="textDocument/documentColor",r.messageDirection=Vo.MessageDirection.clientToServer,r.type=new Vo.ProtocolRequestType(r.method)})(om||(Ni.DocumentColorRequest=om={}));var am;(function(r){r.method="textDocument/colorPresentation",r.messageDirection=Vo.MessageDirection.clientToServer,r.type=new Vo.ProtocolRequestType(r.method)})(am||(Ni.ColorPresentationRequest=am={}))});var lm=I(Ai=>{"use strict";Object.defineProperty(Ai,"__esModule",{value:!0});Ai.FoldingRangeRefreshRequest=Ai.FoldingRangeRequest=void 0;var zo=ot(),um;(function(r){r.method="textDocument/foldingRange",r.messageDirection=zo.MessageDirection.clientToServer,r.type=new zo.ProtocolRequestType(r.method)})(um||(Ai.FoldingRangeRequest=um={}));var dm;(function(r){r.method="workspace/foldingRange/refresh",r.messageDirection=zo.MessageDirection.serverToClient,r.type=new zo.ProtocolRequestType0(r.method)})(dm||(Ai.FoldingRangeRefreshRequest=dm={}))});var pm=I(Ko=>{"use strict";Object.defineProperty(Ko,"__esModule",{value:!0});Ko.DeclarationRequest=void 0;var fm=ot(),hm;(function(r){r.method="textDocument/declaration",r.messageDirection=fm.MessageDirection.clientToServer,r.type=new fm.ProtocolRequestType(r.method)})(hm||(Ko.DeclarationRequest=hm={}))});var vm=I(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.SelectionRangeRequest=void 0;var gm=ot(),mm;(function(r){r.method="textDocument/selectionRange",r.messageDirection=gm.MessageDirection.clientToServer,r.type=new gm.ProtocolRequestType(r.method)})(mm||(Bo.SelectionRangeRequest=mm={}))});var Cm=I(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.WorkDoneProgressCancelNotification=Ur.WorkDoneProgressCreateRequest=Ur.WorkDoneProgress=void 0;var BS=ui(),Go=ot(),ym;(function(r){r.type=new BS.ProgressType;function e(t){return t===r.type}r.is=e})(ym||(Ur.WorkDoneProgress=ym={}));var bm;(function(r){r.method="window/workDoneProgress/create",r.messageDirection=Go.MessageDirection.serverToClient,r.type=new Go.ProtocolRequestType(r.method)})(bm||(Ur.WorkDoneProgressCreateRequest=bm={}));var wm;(function(r){r.method="window/workDoneProgress/cancel",r.messageDirection=Go.MessageDirection.clientToServer,r.type=new Go.ProtocolNotificationType(r.method)})(wm||(Ur.WorkDoneProgressCancelNotification=wm={}))});var Tm=I(Wr=>{"use strict";Object.defineProperty(Wr,"__esModule",{value:!0});Wr.CallHierarchyOutgoingCallsRequest=Wr.CallHierarchyIncomingCallsRequest=Wr.CallHierarchyPrepareRequest=void 0;var ji=ot(),Rm;(function(r){r.method="textDocument/prepareCallHierarchy",r.messageDirection=ji.MessageDirection.clientToServer,r.type=new ji.ProtocolRequestType(r.method)})(Rm||(Wr.CallHierarchyPrepareRequest=Rm={}));var Sm;(function(r){r.method="callHierarchy/incomingCalls",r.messageDirection=ji.MessageDirection.clientToServer,r.type=new ji.ProtocolRequestType(r.method)})(Sm||(Wr.CallHierarchyIncomingCallsRequest=Sm={}));var _m;(function(r){r.method="callHierarchy/outgoingCalls",r.messageDirection=ji.MessageDirection.clientToServer,r.type=new ji.ProtocolRequestType(r.method)})(_m||(Wr.CallHierarchyOutgoingCallsRequest=_m={}))});var Im=I(un=>{"use strict";Object.defineProperty(un,"__esModule",{value:!0});un.SemanticTokensRefreshRequest=un.SemanticTokensRangeRequest=un.SemanticTokensDeltaRequest=un.SemanticTokensRequest=un.SemanticTokensRegistrationType=un.TokenFormat=void 0;var Dr=ot(),Dm;(function(r){r.Relative="relative"})(Dm||(un.TokenFormat=Dm={}));var Ts;(function(r){r.method="textDocument/semanticTokens",r.type=new Dr.RegistrationType(r.method)})(Ts||(un.SemanticTokensRegistrationType=Ts={}));var Pm;(function(r){r.method="textDocument/semanticTokens/full",r.messageDirection=Dr.MessageDirection.clientToServer,r.type=new Dr.ProtocolRequestType(r.method),r.registrationMethod=Ts.method})(Pm||(un.SemanticTokensRequest=Pm={}));var km;(function(r){r.method="textDocument/semanticTokens/full/delta",r.messageDirection=Dr.MessageDirection.clientToServer,r.type=new Dr.ProtocolRequestType(r.method),r.registrationMethod=Ts.method})(km||(un.SemanticTokensDeltaRequest=km={}));var Em;(function(r){r.method="textDocument/semanticTokens/range",r.messageDirection=Dr.MessageDirection.clientToServer,r.type=new Dr.ProtocolRequestType(r.method),r.registrationMethod=Ts.method})(Em||(un.SemanticTokensRangeRequest=Em={}));var xm;(function(r){r.method="workspace/semanticTokens/refresh",r.messageDirection=Dr.MessageDirection.serverToClient,r.type=new Dr.ProtocolRequestType0(r.method)})(xm||(un.SemanticTokensRefreshRequest=xm={}))});var Fm=I(Jo=>{"use strict";Object.defineProperty(Jo,"__esModule",{value:!0});Jo.ShowDocumentRequest=void 0;var qm=ot(),Om;(function(r){r.method="window/showDocument",r.messageDirection=qm.MessageDirection.serverToClient,r.type=new qm.ProtocolRequestType(r.method)})(Om||(Jo.ShowDocumentRequest=Om={}))});var Nm=I(Xo=>{"use strict";Object.defineProperty(Xo,"__esModule",{value:!0});Xo.LinkedEditingRangeRequest=void 0;var Lm=ot(),Mm;(function(r){r.method="textDocument/linkedEditingRange",r.messageDirection=Lm.MessageDirection.clientToServer,r.type=new Lm.ProtocolRequestType(r.method)})(Mm||(Xo.LinkedEditingRangeRequest=Mm={}))});var zm=I(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.WillDeleteFilesRequest=Kt.DidDeleteFilesNotification=Kt.DidRenameFilesNotification=Kt.WillRenameFilesRequest=Kt.DidCreateFilesNotification=Kt.WillCreateFilesRequest=Kt.FileOperationPatternKind=void 0;var zn=ot(),Am;(function(r){r.file="file",r.folder="folder"})(Am||(Kt.FileOperationPatternKind=Am={}));var jm;(function(r){r.method="workspace/willCreateFiles",r.messageDirection=zn.MessageDirection.clientToServer,r.type=new zn.ProtocolRequestType(r.method)})(jm||(Kt.WillCreateFilesRequest=jm={}));var $m;(function(r){r.method="workspace/didCreateFiles",r.messageDirection=zn.MessageDirection.clientToServer,r.type=new zn.ProtocolNotificationType(r.method)})($m||(Kt.DidCreateFilesNotification=$m={}));var Um;(function(r){r.method="workspace/willRenameFiles",r.messageDirection=zn.MessageDirection.clientToServer,r.type=new zn.ProtocolRequestType(r.method)})(Um||(Kt.WillRenameFilesRequest=Um={}));var Wm;(function(r){r.method="workspace/didRenameFiles",r.messageDirection=zn.MessageDirection.clientToServer,r.type=new zn.ProtocolNotificationType(r.method)})(Wm||(Kt.DidRenameFilesNotification=Wm={}));var Hm;(function(r){r.method="workspace/didDeleteFiles",r.messageDirection=zn.MessageDirection.clientToServer,r.type=new zn.ProtocolNotificationType(r.method)})(Hm||(Kt.DidDeleteFilesNotification=Hm={}));var Vm;(function(r){r.method="workspace/willDeleteFiles",r.messageDirection=zn.MessageDirection.clientToServer,r.type=new zn.ProtocolRequestType(r.method)})(Vm||(Kt.WillDeleteFilesRequest=Vm={}))});var Xm=I(Hr=>{"use strict";Object.defineProperty(Hr,"__esModule",{value:!0});Hr.MonikerRequest=Hr.MonikerKind=Hr.UniquenessLevel=void 0;var Km=ot(),Bm;(function(r){r.document="document",r.project="project",r.group="group",r.scheme="scheme",r.global="global"})(Bm||(Hr.UniquenessLevel=Bm={}));var Gm;(function(r){r.$import="import",r.$export="export",r.local="local"})(Gm||(Hr.MonikerKind=Gm={}));var Jm;(function(r){r.method="textDocument/moniker",r.messageDirection=Km.MessageDirection.clientToServer,r.type=new Km.ProtocolRequestType(r.method)})(Jm||(Hr.MonikerRequest=Jm={}))});var ev=I(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.TypeHierarchySubtypesRequest=Vr.TypeHierarchySupertypesRequest=Vr.TypeHierarchyPrepareRequest=void 0;var $i=ot(),Qm;(function(r){r.method="textDocument/prepareTypeHierarchy",r.messageDirection=$i.MessageDirection.clientToServer,r.type=new $i.ProtocolRequestType(r.method)})(Qm||(Vr.TypeHierarchyPrepareRequest=Qm={}));var Ym;(function(r){r.method="typeHierarchy/supertypes",r.messageDirection=$i.MessageDirection.clientToServer,r.type=new $i.ProtocolRequestType(r.method)})(Ym||(Vr.TypeHierarchySupertypesRequest=Ym={}));var Zm;(function(r){r.method="typeHierarchy/subtypes",r.messageDirection=$i.MessageDirection.clientToServer,r.type=new $i.ProtocolRequestType(r.method)})(Zm||(Vr.TypeHierarchySubtypesRequest=Zm={}))});var rv=I(Ui=>{"use strict";Object.defineProperty(Ui,"__esModule",{value:!0});Ui.InlineValueRefreshRequest=Ui.InlineValueRequest=void 0;var Qo=ot(),tv;(function(r){r.method="textDocument/inlineValue",r.messageDirection=Qo.MessageDirection.clientToServer,r.type=new Qo.ProtocolRequestType(r.method)})(tv||(Ui.InlineValueRequest=tv={}));var nv;(function(r){r.method="workspace/inlineValue/refresh",r.messageDirection=Qo.MessageDirection.serverToClient,r.type=new Qo.ProtocolRequestType0(r.method)})(nv||(Ui.InlineValueRefreshRequest=nv={}))});var av=I(zr=>{"use strict";Object.defineProperty(zr,"__esModule",{value:!0});zr.InlayHintRefreshRequest=zr.InlayHintResolveRequest=zr.InlayHintRequest=void 0;var Wi=ot(),iv;(function(r){r.method="textDocument/inlayHint",r.messageDirection=Wi.MessageDirection.clientToServer,r.type=new Wi.ProtocolRequestType(r.method)})(iv||(zr.InlayHintRequest=iv={}));var sv;(function(r){r.method="inlayHint/resolve",r.messageDirection=Wi.MessageDirection.clientToServer,r.type=new Wi.ProtocolRequestType(r.method)})(sv||(zr.InlayHintResolveRequest=sv={}));var ov;(function(r){r.method="workspace/inlayHint/refresh",r.messageDirection=Wi.MessageDirection.serverToClient,r.type=new Wi.ProtocolRequestType0(r.method)})(ov||(zr.InlayHintRefreshRequest=ov={}))});var pv=I(Kn=>{"use strict";Object.defineProperty(Kn,"__esModule",{value:!0});Kn.DiagnosticRefreshRequest=Kn.WorkspaceDiagnosticRequest=Kn.DocumentDiagnosticRequest=Kn.DocumentDiagnosticReportKind=Kn.DiagnosticServerCancellationData=void 0;var hv=ui(),GS=jo(),Hi=ot(),cv;(function(r){function e(t){let n=t;return n&&GS.boolean(n.retriggerRequest)}r.is=e})(cv||(Kn.DiagnosticServerCancellationData=cv={}));var uv;(function(r){r.Full="full",r.Unchanged="unchanged"})(uv||(Kn.DocumentDiagnosticReportKind=uv={}));var dv;(function(r){r.method="textDocument/diagnostic",r.messageDirection=Hi.MessageDirection.clientToServer,r.type=new Hi.ProtocolRequestType(r.method),r.partialResult=new hv.ProgressType})(dv||(Kn.DocumentDiagnosticRequest=dv={}));var lv;(function(r){r.method="workspace/diagnostic",r.messageDirection=Hi.MessageDirection.clientToServer,r.type=new Hi.ProtocolRequestType(r.method),r.partialResult=new hv.ProgressType})(lv||(Kn.WorkspaceDiagnosticRequest=lv={}));var fv;(function(r){r.method="workspace/diagnostic/refresh",r.messageDirection=Hi.MessageDirection.serverToClient,r.type=new Hi.ProtocolRequestType0(r.method)})(fv||(Kn.DiagnosticRefreshRequest=fv={}))});var Cv=I(yt=>{"use strict";Object.defineProperty(yt,"__esModule",{value:!0});yt.DidCloseNotebookDocumentNotification=yt.DidSaveNotebookDocumentNotification=yt.DidChangeNotebookDocumentNotification=yt.NotebookCellArrayChange=yt.DidOpenNotebookDocumentNotification=yt.NotebookDocumentSyncRegistrationType=yt.NotebookDocument=yt.NotebookCell=yt.ExecutionSummary=yt.NotebookCellKind=void 0;var Ds=Ao(),rr=jo(),mr=ot(),vd;(function(r){r.Markup=1,r.Code=2;function e(t){return t===1||t===2}r.is=e})(vd||(yt.NotebookCellKind=vd={}));var yd;(function(r){function e(i,s){let o={executionOrder:i};return(s===!0||s===!1)&&(o.success=s),o}r.create=e;function t(i){let s=i;return rr.objectLiteral(s)&&Ds.uinteger.is(s.executionOrder)&&(s.success===void 0||rr.boolean(s.success))}r.is=t;function n(i,s){return i===s?!0:i==null||s===null||s===void 0?!1:i.executionOrder===s.executionOrder&&i.success===s.success}r.equals=n})(yd||(yt.ExecutionSummary=yd={}));var Yo;(function(r){function e(s,o){return{kind:s,document:o}}r.create=e;function t(s){let o=s;return rr.objectLiteral(o)&&vd.is(o.kind)&&Ds.DocumentUri.is(o.document)&&(o.metadata===void 0||rr.objectLiteral(o.metadata))}r.is=t;function n(s,o){let a=new Set;return s.document!==o.document&&a.add("document"),s.kind!==o.kind&&a.add("kind"),s.executionSummary!==o.executionSummary&&a.add("executionSummary"),(s.metadata!==void 0||o.metadata!==void 0)&&!i(s.metadata,o.metadata)&&a.add("metadata"),(s.executionSummary!==void 0||o.executionSummary!==void 0)&&!yd.equals(s.executionSummary,o.executionSummary)&&a.add("executionSummary"),a}r.diff=n;function i(s,o){if(s===o)return!0;if(s==null||o===null||o===void 0||typeof s!=typeof o||typeof s!="object")return!1;let a=Array.isArray(s),c=Array.isArray(o);if(a!==c)return!1;if(a&&c){if(s.length!==o.length)return!1;for(let d=0;d<s.length;d++)if(!i(s[d],o[d]))return!1}if(rr.objectLiteral(s)&&rr.objectLiteral(o)){let d=Object.keys(s),p=Object.keys(o);if(d.length!==p.length||(d.sort(),p.sort(),!i(d,p)))return!1;for(let v=0;v<d.length;v++){let m=d[v];if(!i(s[m],o[m]))return!1}}return!0}})(Yo||(yt.NotebookCell=Yo={}));var gv;(function(r){function e(n,i,s,o){return{uri:n,notebookType:i,version:s,cells:o}}r.create=e;function t(n){let i=n;return rr.objectLiteral(i)&&rr.string(i.uri)&&Ds.integer.is(i.version)&&rr.typedArray(i.cells,Yo.is)}r.is=t})(gv||(yt.NotebookDocument=gv={}));var Vi;(function(r){r.method="notebookDocument/sync",r.messageDirection=mr.MessageDirection.clientToServer,r.type=new mr.RegistrationType(r.method)})(Vi||(yt.NotebookDocumentSyncRegistrationType=Vi={}));var mv;(function(r){r.method="notebookDocument/didOpen",r.messageDirection=mr.MessageDirection.clientToServer,r.type=new mr.ProtocolNotificationType(r.method),r.registrationMethod=Vi.method})(mv||(yt.DidOpenNotebookDocumentNotification=mv={}));var vv;(function(r){function e(n){let i=n;return rr.objectLiteral(i)&&Ds.uinteger.is(i.start)&&Ds.uinteger.is(i.deleteCount)&&(i.cells===void 0||rr.typedArray(i.cells,Yo.is))}r.is=e;function t(n,i,s){let o={start:n,deleteCount:i};return s!==void 0&&(o.cells=s),o}r.create=t})(vv||(yt.NotebookCellArrayChange=vv={}));var yv;(function(r){r.method="notebookDocument/didChange",r.messageDirection=mr.MessageDirection.clientToServer,r.type=new mr.ProtocolNotificationType(r.method),r.registrationMethod=Vi.method})(yv||(yt.DidChangeNotebookDocumentNotification=yv={}));var bv;(function(r){r.method="notebookDocument/didSave",r.messageDirection=mr.MessageDirection.clientToServer,r.type=new mr.ProtocolNotificationType(r.method),r.registrationMethod=Vi.method})(bv||(yt.DidSaveNotebookDocumentNotification=bv={}));var wv;(function(r){r.method="notebookDocument/didClose",r.messageDirection=mr.MessageDirection.clientToServer,r.type=new mr.ProtocolNotificationType(r.method),r.registrationMethod=Vi.method})(wv||(yt.DidCloseNotebookDocumentNotification=wv={}))});var _v=I(Zo=>{"use strict";Object.defineProperty(Zo,"__esModule",{value:!0});Zo.InlineCompletionRequest=void 0;var Rv=ot(),Sv;(function(r){r.method="textDocument/inlineCompletion",r.messageDirection=Rv.MessageDirection.clientToServer,r.type=new Rv.ProtocolRequestType(r.method)})(Sv||(Zo.InlineCompletionRequest=Sv={}))});var Ny=I(w=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});w.WorkspaceSymbolRequest=w.CodeActionResolveRequest=w.CodeActionRequest=w.DocumentSymbolRequest=w.DocumentHighlightRequest=w.ReferencesRequest=w.DefinitionRequest=w.SignatureHelpRequest=w.SignatureHelpTriggerKind=w.HoverRequest=w.CompletionResolveRequest=w.CompletionRequest=w.CompletionTriggerKind=w.PublishDiagnosticsNotification=w.WatchKind=w.RelativePattern=w.FileChangeType=w.DidChangeWatchedFilesNotification=w.WillSaveTextDocumentWaitUntilRequest=w.WillSaveTextDocumentNotification=w.TextDocumentSaveReason=w.DidSaveTextDocumentNotification=w.DidCloseTextDocumentNotification=w.DidChangeTextDocumentNotification=w.TextDocumentContentChangeEvent=w.DidOpenTextDocumentNotification=w.TextDocumentSyncKind=w.TelemetryEventNotification=w.LogMessageNotification=w.ShowMessageRequest=w.ShowMessageNotification=w.MessageType=w.DidChangeConfigurationNotification=w.ExitNotification=w.ShutdownRequest=w.InitializedNotification=w.InitializeErrorCodes=w.InitializeRequest=w.WorkDoneProgressOptions=w.TextDocumentRegistrationOptions=w.StaticRegistrationOptions=w.PositionEncodingKind=w.FailureHandlingKind=w.ResourceOperationKind=w.UnregistrationRequest=w.RegistrationRequest=w.DocumentSelector=w.NotebookCellTextDocumentFilter=w.NotebookDocumentFilter=w.TextDocumentFilter=void 0;w.MonikerRequest=w.MonikerKind=w.UniquenessLevel=w.WillDeleteFilesRequest=w.DidDeleteFilesNotification=w.WillRenameFilesRequest=w.DidRenameFilesNotification=w.WillCreateFilesRequest=w.DidCreateFilesNotification=w.FileOperationPatternKind=w.LinkedEditingRangeRequest=w.ShowDocumentRequest=w.SemanticTokensRegistrationType=w.SemanticTokensRefreshRequest=w.SemanticTokensRangeRequest=w.SemanticTokensDeltaRequest=w.SemanticTokensRequest=w.TokenFormat=w.CallHierarchyPrepareRequest=w.CallHierarchyOutgoingCallsRequest=w.CallHierarchyIncomingCallsRequest=w.WorkDoneProgressCancelNotification=w.WorkDoneProgressCreateRequest=w.WorkDoneProgress=w.SelectionRangeRequest=w.DeclarationRequest=w.FoldingRangeRefreshRequest=w.FoldingRangeRequest=w.ColorPresentationRequest=w.DocumentColorRequest=w.ConfigurationRequest=w.DidChangeWorkspaceFoldersNotification=w.WorkspaceFoldersRequest=w.TypeDefinitionRequest=w.ImplementationRequest=w.ApplyWorkspaceEditRequest=w.ExecuteCommandRequest=w.PrepareRenameRequest=w.RenameRequest=w.PrepareSupportDefaultBehavior=w.DocumentOnTypeFormattingRequest=w.DocumentRangesFormattingRequest=w.DocumentRangeFormattingRequest=w.DocumentFormattingRequest=w.DocumentLinkResolveRequest=w.DocumentLinkRequest=w.CodeLensRefreshRequest=w.CodeLensResolveRequest=w.CodeLensRequest=w.WorkspaceSymbolResolveRequest=void 0;w.InlineCompletionRequest=w.DidCloseNotebookDocumentNotification=w.DidSaveNotebookDocumentNotification=w.DidChangeNotebookDocumentNotification=w.NotebookCellArrayChange=w.DidOpenNotebookDocumentNotification=w.NotebookDocumentSyncRegistrationType=w.NotebookDocument=w.NotebookCell=w.ExecutionSummary=w.NotebookCellKind=w.DiagnosticRefreshRequest=w.WorkspaceDiagnosticRequest=w.DocumentDiagnosticRequest=w.DocumentDiagnosticReportKind=w.DiagnosticServerCancellationData=w.InlayHintRefreshRequest=w.InlayHintResolveRequest=w.InlayHintRequest=w.InlineValueRefreshRequest=w.InlineValueRequest=w.TypeHierarchySupertypesRequest=w.TypeHierarchySubtypesRequest=w.TypeHierarchyPrepareRequest=void 0;var V=ot(),Tv=Ao(),Ft=jo(),JS=Xg();Object.defineProperty(w,"ImplementationRequest",{enumerable:!0,get:function(){return JS.ImplementationRequest}});var XS=Zg();Object.defineProperty(w,"TypeDefinitionRequest",{enumerable:!0,get:function(){return XS.TypeDefinitionRequest}});var Oy=nm();Object.defineProperty(w,"WorkspaceFoldersRequest",{enumerable:!0,get:function(){return Oy.WorkspaceFoldersRequest}});Object.defineProperty(w,"DidChangeWorkspaceFoldersNotification",{enumerable:!0,get:function(){return Oy.DidChangeWorkspaceFoldersNotification}});var QS=sm();Object.defineProperty(w,"ConfigurationRequest",{enumerable:!0,get:function(){return QS.ConfigurationRequest}});var Fy=cm();Object.defineProperty(w,"DocumentColorRequest",{enumerable:!0,get:function(){return Fy.DocumentColorRequest}});Object.defineProperty(w,"ColorPresentationRequest",{enumerable:!0,get:function(){return Fy.ColorPresentationRequest}});var Ly=lm();Object.defineProperty(w,"FoldingRangeRequest",{enumerable:!0,get:function(){return Ly.FoldingRangeRequest}});Object.defineProperty(w,"FoldingRangeRefreshRequest",{enumerable:!0,get:function(){return Ly.FoldingRangeRefreshRequest}});var YS=pm();Object.defineProperty(w,"DeclarationRequest",{enumerable:!0,get:function(){return YS.DeclarationRequest}});var ZS=vm();Object.defineProperty(w,"SelectionRangeRequest",{enumerable:!0,get:function(){return ZS.SelectionRangeRequest}});var Sd=Cm();Object.defineProperty(w,"WorkDoneProgress",{enumerable:!0,get:function(){return Sd.WorkDoneProgress}});Object.defineProperty(w,"WorkDoneProgressCreateRequest",{enumerable:!0,get:function(){return Sd.WorkDoneProgressCreateRequest}});Object.defineProperty(w,"WorkDoneProgressCancelNotification",{enumerable:!0,get:function(){return Sd.WorkDoneProgressCancelNotification}});var _d=Tm();Object.defineProperty(w,"CallHierarchyIncomingCallsRequest",{enumerable:!0,get:function(){return _d.CallHierarchyIncomingCallsRequest}});Object.defineProperty(w,"CallHierarchyOutgoingCallsRequest",{enumerable:!0,get:function(){return _d.CallHierarchyOutgoingCallsRequest}});Object.defineProperty(w,"CallHierarchyPrepareRequest",{enumerable:!0,get:function(){return _d.CallHierarchyPrepareRequest}});var zi=Im();Object.defineProperty(w,"TokenFormat",{enumerable:!0,get:function(){return zi.TokenFormat}});Object.defineProperty(w,"SemanticTokensRequest",{enumerable:!0,get:function(){return zi.SemanticTokensRequest}});Object.defineProperty(w,"SemanticTokensDeltaRequest",{enumerable:!0,get:function(){return zi.SemanticTokensDeltaRequest}});Object.defineProperty(w,"SemanticTokensRangeRequest",{enumerable:!0,get:function(){return zi.SemanticTokensRangeRequest}});Object.defineProperty(w,"SemanticTokensRefreshRequest",{enumerable:!0,get:function(){return zi.SemanticTokensRefreshRequest}});Object.defineProperty(w,"SemanticTokensRegistrationType",{enumerable:!0,get:function(){return zi.SemanticTokensRegistrationType}});var e_=Fm();Object.defineProperty(w,"ShowDocumentRequest",{enumerable:!0,get:function(){return e_.ShowDocumentRequest}});var t_=Nm();Object.defineProperty(w,"LinkedEditingRangeRequest",{enumerable:!0,get:function(){return t_.LinkedEditingRangeRequest}});var di=zm();Object.defineProperty(w,"FileOperationPatternKind",{enumerable:!0,get:function(){return di.FileOperationPatternKind}});Object.defineProperty(w,"DidCreateFilesNotification",{enumerable:!0,get:function(){return di.DidCreateFilesNotification}});Object.defineProperty(w,"WillCreateFilesRequest",{enumerable:!0,get:function(){return di.WillCreateFilesRequest}});Object.defineProperty(w,"DidRenameFilesNotification",{enumerable:!0,get:function(){return di.DidRenameFilesNotification}});Object.defineProperty(w,"WillRenameFilesRequest",{enumerable:!0,get:function(){return di.WillRenameFilesRequest}});Object.defineProperty(w,"DidDeleteFilesNotification",{enumerable:!0,get:function(){return di.DidDeleteFilesNotification}});Object.defineProperty(w,"WillDeleteFilesRequest",{enumerable:!0,get:function(){return di.WillDeleteFilesRequest}});var Td=Xm();Object.defineProperty(w,"UniquenessLevel",{enumerable:!0,get:function(){return Td.UniquenessLevel}});Object.defineProperty(w,"MonikerKind",{enumerable:!0,get:function(){return Td.MonikerKind}});Object.defineProperty(w,"MonikerRequest",{enumerable:!0,get:function(){return Td.MonikerRequest}});var Dd=ev();Object.defineProperty(w,"TypeHierarchyPrepareRequest",{enumerable:!0,get:function(){return Dd.TypeHierarchyPrepareRequest}});Object.defineProperty(w,"TypeHierarchySubtypesRequest",{enumerable:!0,get:function(){return Dd.TypeHierarchySubtypesRequest}});Object.defineProperty(w,"TypeHierarchySupertypesRequest",{enumerable:!0,get:function(){return Dd.TypeHierarchySupertypesRequest}});var My=rv();Object.defineProperty(w,"InlineValueRequest",{enumerable:!0,get:function(){return My.InlineValueRequest}});Object.defineProperty(w,"InlineValueRefreshRequest",{enumerable:!0,get:function(){return My.InlineValueRefreshRequest}});var Pd=av();Object.defineProperty(w,"InlayHintRequest",{enumerable:!0,get:function(){return Pd.InlayHintRequest}});Object.defineProperty(w,"InlayHintResolveRequest",{enumerable:!0,get:function(){return Pd.InlayHintResolveRequest}});Object.defineProperty(w,"InlayHintRefreshRequest",{enumerable:!0,get:function(){return Pd.InlayHintRefreshRequest}});var Ps=pv();Object.defineProperty(w,"DiagnosticServerCancellationData",{enumerable:!0,get:function(){return Ps.DiagnosticServerCancellationData}});Object.defineProperty(w,"DocumentDiagnosticReportKind",{enumerable:!0,get:function(){return Ps.DocumentDiagnosticReportKind}});Object.defineProperty(w,"DocumentDiagnosticRequest",{enumerable:!0,get:function(){return Ps.DocumentDiagnosticRequest}});Object.defineProperty(w,"WorkspaceDiagnosticRequest",{enumerable:!0,get:function(){return Ps.WorkspaceDiagnosticRequest}});Object.defineProperty(w,"DiagnosticRefreshRequest",{enumerable:!0,get:function(){return Ps.DiagnosticRefreshRequest}});var vr=Cv();Object.defineProperty(w,"NotebookCellKind",{enumerable:!0,get:function(){return vr.NotebookCellKind}});Object.defineProperty(w,"ExecutionSummary",{enumerable:!0,get:function(){return vr.ExecutionSummary}});Object.defineProperty(w,"NotebookCell",{enumerable:!0,get:function(){return vr.NotebookCell}});Object.defineProperty(w,"NotebookDocument",{enumerable:!0,get:function(){return vr.NotebookDocument}});Object.defineProperty(w,"NotebookDocumentSyncRegistrationType",{enumerable:!0,get:function(){return vr.NotebookDocumentSyncRegistrationType}});Object.defineProperty(w,"DidOpenNotebookDocumentNotification",{enumerable:!0,get:function(){return vr.DidOpenNotebookDocumentNotification}});Object.defineProperty(w,"NotebookCellArrayChange",{enumerable:!0,get:function(){return vr.NotebookCellArrayChange}});Object.defineProperty(w,"DidChangeNotebookDocumentNotification",{enumerable:!0,get:function(){return vr.DidChangeNotebookDocumentNotification}});Object.defineProperty(w,"DidSaveNotebookDocumentNotification",{enumerable:!0,get:function(){return vr.DidSaveNotebookDocumentNotification}});Object.defineProperty(w,"DidCloseNotebookDocumentNotification",{enumerable:!0,get:function(){return vr.DidCloseNotebookDocumentNotification}});var n_=_v();Object.defineProperty(w,"InlineCompletionRequest",{enumerable:!0,get:function(){return n_.InlineCompletionRequest}});var bd;(function(r){function e(t){let n=t;return Ft.string(n)||Ft.string(n.language)||Ft.string(n.scheme)||Ft.string(n.pattern)}r.is=e})(bd||(w.TextDocumentFilter=bd={}));var wd;(function(r){function e(t){let n=t;return Ft.objectLiteral(n)&&(Ft.string(n.notebookType)||Ft.string(n.scheme)||Ft.string(n.pattern))}r.is=e})(wd||(w.NotebookDocumentFilter=wd={}));var Cd;(function(r){function e(t){let n=t;return Ft.objectLiteral(n)&&(Ft.string(n.notebook)||wd.is(n.notebook))&&(n.language===void 0||Ft.string(n.language))}r.is=e})(Cd||(w.NotebookCellTextDocumentFilter=Cd={}));var Rd;(function(r){function e(t){if(!Array.isArray(t))return!1;for(let n of t)if(!Ft.string(n)&&!bd.is(n)&&!Cd.is(n))return!1;return!0}r.is=e})(Rd||(w.DocumentSelector=Rd={}));var Dv;(function(r){r.method="client/registerCapability",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolRequestType(r.method)})(Dv||(w.RegistrationRequest=Dv={}));var Pv;(function(r){r.method="client/unregisterCapability",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolRequestType(r.method)})(Pv||(w.UnregistrationRequest=Pv={}));var kv;(function(r){r.Create="create",r.Rename="rename",r.Delete="delete"})(kv||(w.ResourceOperationKind=kv={}));var Ev;(function(r){r.Abort="abort",r.Transactional="transactional",r.TextOnlyTransactional="textOnlyTransactional",r.Undo="undo"})(Ev||(w.FailureHandlingKind=Ev={}));var xv;(function(r){r.UTF8="utf-8",r.UTF16="utf-16",r.UTF32="utf-32"})(xv||(w.PositionEncodingKind=xv={}));var Iv;(function(r){function e(t){let n=t;return n&&Ft.string(n.id)&&n.id.length>0}r.hasId=e})(Iv||(w.StaticRegistrationOptions=Iv={}));var qv;(function(r){function e(t){let n=t;return n&&(n.documentSelector===null||Rd.is(n.documentSelector))}r.is=e})(qv||(w.TextDocumentRegistrationOptions=qv={}));var Ov;(function(r){function e(n){let i=n;return Ft.objectLiteral(i)&&(i.workDoneProgress===void 0||Ft.boolean(i.workDoneProgress))}r.is=e;function t(n){let i=n;return i&&Ft.boolean(i.workDoneProgress)}r.hasWorkDoneProgress=t})(Ov||(w.WorkDoneProgressOptions=Ov={}));var Fv;(function(r){r.method="initialize",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Fv||(w.InitializeRequest=Fv={}));var Lv;(function(r){r.unknownProtocolVersion=1})(Lv||(w.InitializeErrorCodes=Lv={}));var Mv;(function(r){r.method="initialized",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Mv||(w.InitializedNotification=Mv={}));var Nv;(function(r){r.method="shutdown",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType0(r.method)})(Nv||(w.ShutdownRequest=Nv={}));var Av;(function(r){r.method="exit",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType0(r.method)})(Av||(w.ExitNotification=Av={}));var jv;(function(r){r.method="workspace/didChangeConfiguration",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(jv||(w.DidChangeConfigurationNotification=jv={}));var $v;(function(r){r.Error=1,r.Warning=2,r.Info=3,r.Log=4,r.Debug=5})($v||(w.MessageType=$v={}));var Uv;(function(r){r.method="window/showMessage",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolNotificationType(r.method)})(Uv||(w.ShowMessageNotification=Uv={}));var Wv;(function(r){r.method="window/showMessageRequest",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolRequestType(r.method)})(Wv||(w.ShowMessageRequest=Wv={}));var Hv;(function(r){r.method="window/logMessage",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolNotificationType(r.method)})(Hv||(w.LogMessageNotification=Hv={}));var Vv;(function(r){r.method="telemetry/event",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolNotificationType(r.method)})(Vv||(w.TelemetryEventNotification=Vv={}));var zv;(function(r){r.None=0,r.Full=1,r.Incremental=2})(zv||(w.TextDocumentSyncKind=zv={}));var Kv;(function(r){r.method="textDocument/didOpen",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Kv||(w.DidOpenTextDocumentNotification=Kv={}));var Bv;(function(r){function e(n){let i=n;return i!=null&&typeof i.text=="string"&&i.range!==void 0&&(i.rangeLength===void 0||typeof i.rangeLength=="number")}r.isIncremental=e;function t(n){let i=n;return i!=null&&typeof i.text=="string"&&i.range===void 0&&i.rangeLength===void 0}r.isFull=t})(Bv||(w.TextDocumentContentChangeEvent=Bv={}));var Gv;(function(r){r.method="textDocument/didChange",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Gv||(w.DidChangeTextDocumentNotification=Gv={}));var Jv;(function(r){r.method="textDocument/didClose",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Jv||(w.DidCloseTextDocumentNotification=Jv={}));var Xv;(function(r){r.method="textDocument/didSave",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Xv||(w.DidSaveTextDocumentNotification=Xv={}));var Qv;(function(r){r.Manual=1,r.AfterDelay=2,r.FocusOut=3})(Qv||(w.TextDocumentSaveReason=Qv={}));var Yv;(function(r){r.method="textDocument/willSave",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(Yv||(w.WillSaveTextDocumentNotification=Yv={}));var Zv;(function(r){r.method="textDocument/willSaveWaitUntil",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Zv||(w.WillSaveTextDocumentWaitUntilRequest=Zv={}));var ey;(function(r){r.method="workspace/didChangeWatchedFiles",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolNotificationType(r.method)})(ey||(w.DidChangeWatchedFilesNotification=ey={}));var ty;(function(r){r.Created=1,r.Changed=2,r.Deleted=3})(ty||(w.FileChangeType=ty={}));var ny;(function(r){function e(t){let n=t;return Ft.objectLiteral(n)&&(Tv.URI.is(n.baseUri)||Tv.WorkspaceFolder.is(n.baseUri))&&Ft.string(n.pattern)}r.is=e})(ny||(w.RelativePattern=ny={}));var ry;(function(r){r.Create=1,r.Change=2,r.Delete=4})(ry||(w.WatchKind=ry={}));var iy;(function(r){r.method="textDocument/publishDiagnostics",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolNotificationType(r.method)})(iy||(w.PublishDiagnosticsNotification=iy={}));var sy;(function(r){r.Invoked=1,r.TriggerCharacter=2,r.TriggerForIncompleteCompletions=3})(sy||(w.CompletionTriggerKind=sy={}));var oy;(function(r){r.method="textDocument/completion",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(oy||(w.CompletionRequest=oy={}));var ay;(function(r){r.method="completionItem/resolve",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(ay||(w.CompletionResolveRequest=ay={}));var cy;(function(r){r.method="textDocument/hover",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(cy||(w.HoverRequest=cy={}));var uy;(function(r){r.Invoked=1,r.TriggerCharacter=2,r.ContentChange=3})(uy||(w.SignatureHelpTriggerKind=uy={}));var dy;(function(r){r.method="textDocument/signatureHelp",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(dy||(w.SignatureHelpRequest=dy={}));var ly;(function(r){r.method="textDocument/definition",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(ly||(w.DefinitionRequest=ly={}));var fy;(function(r){r.method="textDocument/references",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(fy||(w.ReferencesRequest=fy={}));var hy;(function(r){r.method="textDocument/documentHighlight",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(hy||(w.DocumentHighlightRequest=hy={}));var py;(function(r){r.method="textDocument/documentSymbol",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(py||(w.DocumentSymbolRequest=py={}));var gy;(function(r){r.method="textDocument/codeAction",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(gy||(w.CodeActionRequest=gy={}));var my;(function(r){r.method="codeAction/resolve",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(my||(w.CodeActionResolveRequest=my={}));var vy;(function(r){r.method="workspace/symbol",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(vy||(w.WorkspaceSymbolRequest=vy={}));var yy;(function(r){r.method="workspaceSymbol/resolve",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(yy||(w.WorkspaceSymbolResolveRequest=yy={}));var by;(function(r){r.method="textDocument/codeLens",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(by||(w.CodeLensRequest=by={}));var wy;(function(r){r.method="codeLens/resolve",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(wy||(w.CodeLensResolveRequest=wy={}));var Cy;(function(r){r.method="workspace/codeLens/refresh",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolRequestType0(r.method)})(Cy||(w.CodeLensRefreshRequest=Cy={}));var Ry;(function(r){r.method="textDocument/documentLink",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Ry||(w.DocumentLinkRequest=Ry={}));var Sy;(function(r){r.method="documentLink/resolve",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Sy||(w.DocumentLinkResolveRequest=Sy={}));var _y;(function(r){r.method="textDocument/formatting",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(_y||(w.DocumentFormattingRequest=_y={}));var Ty;(function(r){r.method="textDocument/rangeFormatting",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Ty||(w.DocumentRangeFormattingRequest=Ty={}));var Dy;(function(r){r.method="textDocument/rangesFormatting",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Dy||(w.DocumentRangesFormattingRequest=Dy={}));var Py;(function(r){r.method="textDocument/onTypeFormatting",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Py||(w.DocumentOnTypeFormattingRequest=Py={}));var ky;(function(r){r.Identifier=1})(ky||(w.PrepareSupportDefaultBehavior=ky={}));var Ey;(function(r){r.method="textDocument/rename",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Ey||(w.RenameRequest=Ey={}));var xy;(function(r){r.method="textDocument/prepareRename",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(xy||(w.PrepareRenameRequest=xy={}));var Iy;(function(r){r.method="workspace/executeCommand",r.messageDirection=V.MessageDirection.clientToServer,r.type=new V.ProtocolRequestType(r.method)})(Iy||(w.ExecuteCommandRequest=Iy={}));var qy;(function(r){r.method="workspace/applyEdit",r.messageDirection=V.MessageDirection.serverToClient,r.type=new V.ProtocolRequestType("workspace/applyEdit")})(qy||(w.ApplyWorkspaceEditRequest=qy={}))});var jy=I(ea=>{"use strict";Object.defineProperty(ea,"__esModule",{value:!0});ea.createProtocolConnection=void 0;var Ay=ui();function r_(r,e,t,n){return Ay.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,Ay.createMessageConnection)(r,e,t,n)}ea.createProtocolConnection=r_});var Uy=I(dn=>{"use strict";var i_=dn&&dn.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),ta=dn&&dn.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&i_(e,r,t)};Object.defineProperty(dn,"__esModule",{value:!0});dn.LSPErrorCodes=dn.createProtocolConnection=void 0;ta(ui(),dn);ta(Ao(),dn);ta(ot(),dn);ta(Ny(),dn);var s_=jy();Object.defineProperty(dn,"createProtocolConnection",{enumerable:!0,get:function(){return s_.createProtocolConnection}});var $y;(function(r){r.lspReservedErrorRangeStart=-32899,r.RequestFailed=-32803,r.ServerCancelled=-32802,r.ContentModified=-32801,r.RequestCancelled=-32800,r.lspReservedErrorRangeEnd=-32800})($y||(dn.LSPErrorCodes=$y={}))});var me=I(yr=>{"use strict";var o_=yr&&yr.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Wy=yr&&yr.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&o_(e,r,t)};Object.defineProperty(yr,"__esModule",{value:!0});yr.createProtocolConnection=void 0;var a_=ld();Wy(ld(),yr);Wy(Uy(),yr);function c_(r,e,t,n){return(0,a_.createMessageConnection)(r,e,t,n)}yr.createProtocolConnection=c_});var na=I(Bt=>{"use strict";Object.defineProperty(Bt,"__esModule",{value:!0});Bt.forEach=Bt.mapAsync=Bt.map=Bt.clearTestMode=Bt.setTestMode=Bt.Semaphore=Bt.Delayer=void 0;var Es=me(),kd=class{constructor(e){this.defaultDelay=e,this.timeout=void 0,this.completionPromise=void 0,this.onSuccess=void 0,this.task=void 0}trigger(e,t=this.defaultDelay){return this.task=e,t>=0&&this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise(n=>{this.onSuccess=n}).then(()=>{this.completionPromise=void 0,this.onSuccess=void 0;var n=this.task();return this.task=void 0,n})),(t>=0||this.timeout===void 0)&&(this.timeout=(0,Es.RAL)().timer.setTimeout(()=>{this.timeout=void 0,this.onSuccess(void 0)},t>=0?t:this.defaultDelay)),this.completionPromise}forceDelivery(){if(!this.completionPromise)return;this.cancelTimeout();let e=this.task();return this.completionPromise=void 0,this.onSuccess=void 0,this.task=void 0,e}isTriggered(){return this.timeout!==void 0}cancel(){this.cancelTimeout(),this.completionPromise=void 0}cancelTimeout(){this.timeout!==void 0&&(this.timeout.dispose(),this.timeout=void 0)}};Bt.Delayer=kd;var Ed=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,Es.RAL)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};Bt.Semaphore=Ed;var xd=!1;function u_(){xd=!0}Bt.setTestMode=u_;function d_(){xd=!1}Bt.clearTestMode=d_;var Hy=15,ks=class{constructor(e=Hy){this.yieldAfter=xd===!0?Math.max(e,2):Math.max(e,Hy),this.startTime=Date.now(),this.counter=0,this.total=0,this.counterInterval=1}start(){this.counter=0,this.total=0,this.counterInterval=1,this.startTime=Date.now()}shouldYield(){if(++this.counter>=this.counterInterval){let e=Date.now()-this.startTime,t=Math.max(0,this.yieldAfter-e);if(this.total+=this.counter,this.counter=0,e>=this.yieldAfter||t<=1)return this.counterInterval=1,this.total=0,!0;switch(e){case 0:case 1:this.counterInterval=this.total*2;break}}return!1}};async function l_(r,e,t,n){if(r.length===0)return[];let i=new Array(r.length),s=new ks(n?.yieldAfter);function o(c){s.start();for(let d=c;d<r.length;d++)if(i[d]=e(r[d]),s.shouldYield())return n?.yieldCallback&&n.yieldCallback(),d+1;return-1}let a=o(0);for(;a!==-1&&!(t!==void 0&&t.isCancellationRequested);)a=await new Promise(c=>{(0,Es.RAL)().timer.setImmediate(()=>{c(o(a))})});return i}Bt.map=l_;async function f_(r,e,t,n){if(r.length===0)return[];let i=new Array(r.length),s=new ks(n?.yieldAfter);async function o(c){s.start();for(let d=c;d<r.length;d++)if(i[d]=await e(r[d],t),s.shouldYield())return n?.yieldCallback&&n.yieldCallback(),d+1;return-1}let a=await o(0);for(;a!==-1&&!(t!==void 0&&t.isCancellationRequested);)a=await new Promise(c=>{(0,Es.RAL)().timer.setImmediate(()=>{c(o(a))})});return i}Bt.mapAsync=f_;async function h_(r,e,t,n){if(r.length===0)return;let i=new ks(n?.yieldAfter);function s(a){i.start();for(let c=a;c<r.length;c++)if(e(r[c]),i.shouldYield())return n?.yieldCallback&&n.yieldCallback(),c+1;return-1}let o=s(0);for(;o!==-1&&!(t!==void 0&&t.isCancellationRequested);)o=await new Promise(a=>{(0,Es.RAL)().timer.setImmediate(()=>{a(s(o))})})}Bt.forEach=h_});var Od=I(qd=>{"use strict";Object.defineProperty(qd,"__esModule",{value:!0});var p_=require("vscode"),Id=class extends p_.CompletionItem{constructor(e){super(e)}};qd.default=Id});var Md=I(Ld=>{"use strict";Object.defineProperty(Ld,"__esModule",{value:!0});var g_=require("vscode"),Fd=class extends g_.CodeLens{constructor(e){super(e)}};Ld.default=Fd});var jd=I(Ad=>{"use strict";Object.defineProperty(Ad,"__esModule",{value:!0});var m_=require("vscode"),Nd=class extends m_.DocumentLink{constructor(e,t){super(e,t)}};Ad.default=Nd});var Wd=I(Ud=>{"use strict";Object.defineProperty(Ud,"__esModule",{value:!0});var v_=require("vscode"),$d=class extends v_.CodeAction{constructor(e,t){super(e),this.data=t}};Ud.default=$d});var zd=I(Ki=>{"use strict";Object.defineProperty(Ki,"__esModule",{value:!0});Ki.ProtocolDiagnostic=Ki.DiagnosticCode=void 0;var y_=require("vscode"),Hd=Vn(),Vy;(function(r){function e(t){let n=t;return n!=null&&(Hd.number(n.value)||Hd.string(n.value))&&Hd.string(n.target)}r.is=e})(Vy||(Ki.DiagnosticCode=Vy={}));var Vd=class extends y_.Diagnostic{constructor(e,t,n,i){super(e,t,n),this.data=i,this.hasDiagnosticCode=!1}};Ki.ProtocolDiagnostic=Vd});var Gd=I(Bd=>{"use strict";Object.defineProperty(Bd,"__esModule",{value:!0});var b_=require("vscode"),Kd=class extends b_.CallHierarchyItem{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s,o),a!==void 0&&(this.data=a)}};Bd.default=Kd});var Qd=I(Xd=>{"use strict";Object.defineProperty(Xd,"__esModule",{value:!0});var w_=require("vscode"),Jd=class extends w_.TypeHierarchyItem{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s,o),a!==void 0&&(this.data=a)}};Xd.default=Jd});var el=I(Zd=>{"use strict";Object.defineProperty(Zd,"__esModule",{value:!0});var ra=require("vscode"),Yd=class extends ra.SymbolInformation{constructor(e,t,n,i,s){let o=!(i instanceof ra.Uri);super(e,t,n,o?i:new ra.Location(i,new ra.Range(0,0,0,0))),this.hasRange=o,s!==void 0&&(this.data=s)}};Zd.default=Yd});var rl=I(nl=>{"use strict";Object.defineProperty(nl,"__esModule",{value:!0});var C_=require("vscode"),tl=class extends C_.InlayHint{constructor(e,t,n){super(e,t,n)}};nl.default=tl});var Gy=I(ia=>{"use strict";Object.defineProperty(ia,"__esModule",{value:!0});ia.createConverter=void 0;var _t=require("vscode"),ve=me(),li=Vn(),zy=na(),R_=Od(),S_=Md(),__=jd(),Ky=Wd(),By=zd(),T_=Gd(),D_=Qd(),P_=el(),k_=rl(),il;(function(r){function e(t){let n=t;return n&&!!n.inserting&&!!n.replacing}r.is=e})(il||(il={}));function E_(r){let t=r||(h=>h.toString());function n(h){return t(h)}function i(h){return{uri:t(h.uri)}}function s(h){return{uri:t(h.uri),languageId:h.languageId,version:h.version,text:h.getText()}}function o(h){return{uri:t(h.uri),version:h.version}}function a(h){return{textDocument:s(h)}}function c(h){let q=h;return!!q.document&&!!q.contentChanges}function d(h){let q=h;return!!q.uri&&!!q.version}function p(h,q,Y){if(d(h))return{textDocument:{uri:t(h.uri),version:h.version},contentChanges:[{text:h.getText()}]};if(c(h)){let Oe=q,D=Y;return{textDocument:{uri:t(Oe),version:D},contentChanges:h.contentChanges.map(R=>{let _=R.range;return{range:{start:{line:_.start.line,character:_.start.character},end:{line:_.end.line,character:_.end.character}},rangeLength:R.rangeLength,text:R.text}})}}else throw Error("Unsupported text document change parameter")}function v(h){return{textDocument:i(h)}}function m(h,q=!1){let Y={textDocument:i(h)};return q&&(Y.text=h.getText()),Y}function S(h){switch(h){case _t.TextDocumentSaveReason.Manual:return ve.TextDocumentSaveReason.Manual;case _t.TextDocumentSaveReason.AfterDelay:return ve.TextDocumentSaveReason.AfterDelay;case _t.TextDocumentSaveReason.FocusOut:return ve.TextDocumentSaveReason.FocusOut}return ve.TextDocumentSaveReason.Manual}function b(h){return{textDocument:i(h.document),reason:S(h.reason)}}function E(h){return{files:h.files.map(q=>({uri:t(q)}))}}function x(h){return{files:h.files.map(q=>({oldUri:t(q.oldUri),newUri:t(q.newUri)}))}}function $(h){return{files:h.files.map(q=>({uri:t(q)}))}}function U(h){return{files:h.files.map(q=>({uri:t(q)}))}}function M(h){return{files:h.files.map(q=>({oldUri:t(q.oldUri),newUri:t(q.newUri)}))}}function z(h){return{files:h.files.map(q=>({uri:t(q)}))}}function B(h,q){return{textDocument:i(h),position:Pt(q)}}function pe(h){switch(h){case _t.CompletionTriggerKind.TriggerCharacter:return ve.CompletionTriggerKind.TriggerCharacter;case _t.CompletionTriggerKind.TriggerForIncompleteCompletions:return ve.CompletionTriggerKind.TriggerForIncompleteCompletions;default:return ve.CompletionTriggerKind.Invoked}}function J(h,q,Y){return{textDocument:i(h),position:Pt(q),context:{triggerKind:pe(Y.triggerKind),triggerCharacter:Y.triggerCharacter}}}function ce(h){switch(h){case _t.SignatureHelpTriggerKind.Invoke:return ve.SignatureHelpTriggerKind.Invoked;case _t.SignatureHelpTriggerKind.TriggerCharacter:return ve.SignatureHelpTriggerKind.TriggerCharacter;case _t.SignatureHelpTriggerKind.ContentChange:return ve.SignatureHelpTriggerKind.ContentChange}}function Re(h){return{label:h.label}}function it(h){return h.map(Re)}function Ze(h){return{label:h.label,parameters:it(h.parameters)}}function $e(h){return h.map(Ze)}function Yt(h){return h===void 0?h:{signatures:$e(h.signatures),activeSignature:h.activeSignature,activeParameter:h.activeParameter}}function At(h,q,Y){return{textDocument:i(h),position:Pt(q),context:{isRetrigger:Y.isRetrigger,triggerCharacter:Y.triggerCharacter,triggerKind:ce(Y.triggerKind),activeSignatureHelp:Yt(Y.activeSignatureHelp)}}}function Pt(h){return{line:h.line,character:h.character}}function kt(h){return h==null?h:{line:h.line>ve.uinteger.MAX_VALUE?ve.uinteger.MAX_VALUE:h.line,character:h.character>ve.uinteger.MAX_VALUE?ve.uinteger.MAX_VALUE:h.character}}function bn(h,q){return zy.map(h,kt,q)}function wn(h){return h.map(kt)}function Ue(h){return h==null?h:{start:kt(h.start),end:kt(h.end)}}function Ct(h){return h.map(Ue)}function qt(h){return h==null?h:ve.Location.create(n(h.uri),Ue(h.range))}function Et(h){switch(h){case _t.DiagnosticSeverity.Error:return ve.DiagnosticSeverity.Error;case _t.DiagnosticSeverity.Warning:return ve.DiagnosticSeverity.Warning;case _t.DiagnosticSeverity.Information:return ve.DiagnosticSeverity.Information;case _t.DiagnosticSeverity.Hint:return ve.DiagnosticSeverity.Hint}}function dr(h){if(!h)return;let q=[];for(let Y of h){let Oe=Cn(Y);Oe!==void 0&&q.push(Oe)}return q.length>0?q:void 0}function Cn(h){switch(h){case _t.DiagnosticTag.Unnecessary:return ve.DiagnosticTag.Unnecessary;case _t.DiagnosticTag.Deprecated:return ve.DiagnosticTag.Deprecated;default:return}}function Rn(h){return{message:h.message,location:qt(h.location)}}function Zn(h){return h.map(Rn)}function lr(h){if(h!=null)return li.number(h)||li.string(h)?h:{value:h.value,target:n(h.target)}}function jn(h){let q=ve.Diagnostic.create(Ue(h.range),h.message),Y=h instanceof By.ProtocolDiagnostic?h:void 0;Y!==void 0&&Y.data!==void 0&&(q.data=Y.data);let Oe=lr(h.code);return By.DiagnosticCode.is(Oe)?Y!==void 0&&Y.hasDiagnosticCode?q.code=Oe:(q.code=Oe.value,q.codeDescription={href:Oe.target}):q.code=Oe,li.number(h.severity)&&(q.severity=Et(h.severity)),Array.isArray(h.tags)&&(q.tags=dr(h.tags)),h.relatedInformation&&(q.relatedInformation=Zn(h.relatedInformation)),h.source&&(q.source=h.source),q}function Sn(h,q){return h==null?h:zy.map(h,jn,q)}function _n(h){return h==null?h:h.map(jn)}function $n(h,q){switch(h){case"$string":return q;case ve.MarkupKind.PlainText:return{kind:h,value:q};case ve.MarkupKind.Markdown:return{kind:h,value:q.value};default:return`Unsupported Markup content received. Kind is: ${h}`}}function We(h){switch(h){case _t.CompletionItemTag.Deprecated:return ve.CompletionItemTag.Deprecated}}function er(h){if(h===void 0)return h;let q=[];for(let Y of h){let Oe=We(Y);Oe!==void 0&&q.push(Oe)}return q}function Tn(h,q){return q!==void 0?q:h+1}function jt(h,q=!1){let Y,Oe;li.string(h.label)?Y=h.label:(Y=h.label.label,q&&(h.label.detail!==void 0||h.label.description!==void 0)&&(Oe={detail:h.label.detail,description:h.label.description}));let D={label:Y};Oe!==void 0&&(D.labelDetails=Oe);let g=h instanceof R_.default?h:void 0;h.detail&&(D.detail=h.detail),h.documentation&&(!g||g.documentationFormat==="$string"?D.documentation=h.documentation:D.documentation=$n(g.documentationFormat,h.documentation)),h.filterText&&(D.filterText=h.filterText),fr(D,h),li.number(h.kind)&&(D.kind=Tn(h.kind,g&&g.originalItemKind)),h.sortText&&(D.sortText=h.sortText),h.additionalTextEdits&&(D.additionalTextEdits=Ke(h.additionalTextEdits)),h.commitCharacters&&(D.commitCharacters=h.commitCharacters.slice()),h.command&&(D.command=O(h.command)),(h.preselect===!0||h.preselect===!1)&&(D.preselect=h.preselect);let R=er(h.tags);if(g){if(g.data!==void 0&&(D.data=g.data),g.deprecated===!0||g.deprecated===!1){if(g.deprecated===!0&&R!==void 0&&R.length>0){let _=R.indexOf(_t.CompletionItemTag.Deprecated);_!==-1&&R.splice(_,1)}D.deprecated=g.deprecated}g.insertTextMode!==void 0&&(D.insertTextMode=g.insertTextMode)}return R!==void 0&&R.length>0&&(D.tags=R),D.insertTextMode===void 0&&h.keepWhitespace===!0&&(D.insertTextMode=ve.InsertTextMode.adjustIndentation),D}function fr(h,q){let Y=ve.InsertTextFormat.PlainText,Oe,D;q.textEdit?(Oe=q.textEdit.newText,D=q.textEdit.range):q.insertText instanceof _t.SnippetString?(Y=ve.InsertTextFormat.Snippet,Oe=q.insertText.value):Oe=q.insertText,q.range&&(D=q.range),h.insertTextFormat=Y,q.fromEdit&&Oe!==void 0&&D!==void 0?h.textEdit=Ht(Oe,D):h.insertText=Oe}function Ht(h,q){return il.is(q)?ve.InsertReplaceEdit.create(h,Ue(q.inserting),Ue(q.replacing)):{newText:h,range:Ue(q)}}function Un(h){return{range:Ue(h.range),newText:h.newText}}function Ke(h){return h==null?h:h.map(Un)}function gt(h){return h<=_t.SymbolKind.TypeParameter?h+1:ve.SymbolKind.Property}function xt(h){return h}function Zt(h){return h.map(xt)}function Rt(h,q,Y){return{textDocument:i(h),position:Pt(q),context:{includeDeclaration:Y.includeDeclaration}}}async function Dn(h,q){let Y=ve.CodeAction.create(h.title);if(h instanceof Ky.default&&h.data!==void 0&&(Y.data=h.data),h.kind!==void 0&&(Y.kind=l(h.kind)),h.diagnostics!==void 0&&(Y.diagnostics=await Sn(h.diagnostics,q)),h.edit!==void 0)throw new Error("VS Code code actions can only be converted to a protocol code action without an edit.");return h.command!==void 0&&(Y.command=O(h.command)),h.isPreferred!==void 0&&(Y.isPreferred=h.isPreferred),h.disabled!==void 0&&(Y.disabled={reason:h.disabled.reason}),Y}function Wn(h){let q=ve.CodeAction.create(h.title);if(h instanceof Ky.default&&h.data!==void 0&&(q.data=h.data),h.kind!==void 0&&(q.kind=l(h.kind)),h.diagnostics!==void 0&&(q.diagnostics=_n(h.diagnostics)),h.edit!==void 0)throw new Error("VS Code code actions can only be converted to a protocol code action without an edit.");return h.command!==void 0&&(q.command=O(h.command)),h.isPreferred!==void 0&&(q.isPreferred=h.isPreferred),h.disabled!==void 0&&(q.disabled={reason:h.disabled.reason}),q}async function en(h,q){if(h==null)return h;let Y;return h.only&&li.string(h.only.value)&&(Y=[h.only.value]),ve.CodeActionContext.create(await Sn(h.diagnostics,q),Y,mt(h.triggerKind))}function Hn(h){if(h==null)return h;let q;return h.only&&li.string(h.only.value)&&(q=[h.only.value]),ve.CodeActionContext.create(_n(h.diagnostics),q,mt(h.triggerKind))}function mt(h){switch(h){case _t.CodeActionTriggerKind.Invoke:return ve.CodeActionTriggerKind.Invoked;case _t.CodeActionTriggerKind.Automatic:return ve.CodeActionTriggerKind.Automatic;default:return}}function l(h){if(h!=null)return h.value}function C(h){return h==null?h:ve.InlineValueContext.create(h.frameId,Ue(h.stoppedLocation))}function P(h,q,Y){return{context:ve.InlineCompletionContext.create(Y.triggerKind,Y.selectedCompletionInfo),textDocument:i(h),position:kt(q)}}function O(h){let q=ve.Command.create(h.title,h.command);return h.arguments&&(q.arguments=h.arguments),q}function ne(h){let q=ve.CodeLens.create(Ue(h.range));return h.command&&(q.command=O(h.command)),h instanceof S_.default&&h.data&&(q.data=h.data),q}function ee(h,q){let Y={tabSize:h.tabSize,insertSpaces:h.insertSpaces};return q.trimTrailingWhitespace&&(Y.trimTrailingWhitespace=!0),q.trimFinalNewlines&&(Y.trimFinalNewlines=!0),q.insertFinalNewline&&(Y.insertFinalNewline=!0),Y}function ae(h){return{textDocument:i(h)}}function ue(h){return{textDocument:i(h)}}function G(h){let q=ve.DocumentLink.create(Ue(h.range));h.target&&(q.target=n(h.target)),h.tooltip!==void 0&&(q.tooltip=h.tooltip);let Y=h instanceof __.default?h:void 0;return Y&&Y.data&&(q.data=Y.data),q}function ie(h){return{textDocument:i(h)}}function Z(h){let q={name:h.name,kind:gt(h.kind),uri:n(h.uri),range:Ue(h.range),selectionRange:Ue(h.selectionRange)};return h.detail!==void 0&&h.detail.length>0&&(q.detail=h.detail),h.tags!==void 0&&(q.tags=Zt(h.tags)),h instanceof T_.default&&h.data!==void 0&&(q.data=h.data),q}function he(h){let q={name:h.name,kind:gt(h.kind),uri:n(h.uri),range:Ue(h.range),selectionRange:Ue(h.selectionRange)};return h.detail!==void 0&&h.detail.length>0&&(q.detail=h.detail),h.tags!==void 0&&(q.tags=Zt(h.tags)),h instanceof D_.default&&h.data!==void 0&&(q.data=h.data),q}function _e(h){let q=h instanceof P_.default?{name:h.name,kind:gt(h.kind),location:h.hasRange?qt(h.location):{uri:t(h.location.uri)},data:h.data}:{name:h.name,kind:gt(h.kind),location:qt(h.location)};return h.tags!==void 0&&(q.tags=Zt(h.tags)),h.containerName!==""&&(q.containerName=h.containerName),q}function He(h){let q=typeof h.label=="string"?h.label:h.label.map(hr),Y=ve.InlayHint.create(kt(h.position),q);return h.kind!==void 0&&(Y.kind=h.kind),h.textEdits!==void 0&&(Y.textEdits=Ke(h.textEdits)),h.tooltip!==void 0&&(Y.tooltip=Mr(h.tooltip)),h.paddingLeft!==void 0&&(Y.paddingLeft=h.paddingLeft),h.paddingRight!==void 0&&(Y.paddingRight=h.paddingRight),h instanceof k_.default&&h.data!==void 0&&(Y.data=h.data),Y}function hr(h){let q=ve.InlayHintLabelPart.create(h.value);return h.location!==void 0&&(q.location=qt(h.location)),h.command!==void 0&&(q.command=O(h.command)),h.tooltip!==void 0&&(q.tooltip=Mr(h.tooltip)),q}function Mr(h){return typeof h=="string"?h:{kind:ve.MarkupKind.Markdown,value:h.value}}return{asUri:n,asTextDocumentIdentifier:i,asTextDocumentItem:s,asVersionedTextDocumentIdentifier:o,asOpenTextDocumentParams:a,asChangeTextDocumentParams:p,asCloseTextDocumentParams:v,asSaveTextDocumentParams:m,asWillSaveTextDocumentParams:b,asDidCreateFilesParams:E,asDidRenameFilesParams:x,asDidDeleteFilesParams:$,asWillCreateFilesParams:U,asWillRenameFilesParams:M,asWillDeleteFilesParams:z,asTextDocumentPositionParams:B,asCompletionParams:J,asSignatureHelpParams:At,asWorkerPosition:Pt,asRange:Ue,asRanges:Ct,asPosition:kt,asPositions:bn,asPositionsSync:wn,asLocation:qt,asDiagnosticSeverity:Et,asDiagnosticTag:Cn,asDiagnostic:jn,asDiagnostics:Sn,asDiagnosticsSync:_n,asCompletionItem:jt,asTextEdit:Un,asSymbolKind:gt,asSymbolTag:xt,asSymbolTags:Zt,asReferenceParams:Rt,asCodeAction:Dn,asCodeActionSync:Wn,asCodeActionContext:en,asCodeActionContextSync:Hn,asInlineValueContext:C,asCommand:O,asCodeLens:ne,asFormattingOptions:ee,asDocumentSymbolParams:ae,asCodeLensParams:ue,asDocumentLink:G,asDocumentLinkParams:ie,asCallHierarchyItem:Z,asTypeHierarchyItem:he,asInlayHint:He,asWorkspaceSymbol:_e,asInlineCompletionParams:P}}ia.createConverter=E_});var Qy=I(oa=>{"use strict";Object.defineProperty(oa,"__esModule",{value:!0});oa.createConverter=void 0;var K=require("vscode"),le=me(),Bn=Vn(),qe=na(),x_=Od(),I_=Md(),q_=jd(),O_=Wd(),Jy=zd(),F_=Gd(),L_=Qd(),M_=el(),N_=rl(),Xy=me(),sa;(function(r){function e(t){let n=t;return n&&Bn.string(n.language)&&Bn.string(n.value)}r.is=e})(sa||(sa={}));function A_(r,e,t){let i=r||(u=>K.Uri.parse(u));function s(u){return i(u)}function o(u){let T=[];for(let j of u)if(typeof j=="string")T.push(j);else if(Xy.NotebookCellTextDocumentFilter.is(j))if(typeof j.notebook=="string")T.push({notebookType:j.notebook,language:j.language});else{let te=j.notebook.notebookType??"*";T.push({notebookType:te,scheme:j.notebook.scheme,pattern:j.notebook.pattern,language:j.language})}else Xy.TextDocumentFilter.is(j)&&T.push({language:j.language,scheme:j.scheme,pattern:j.pattern});return T}async function a(u,T){return qe.map(u,d,T)}function c(u){let T=new Array(u.length);for(let j=0;j<u.length;j++)T[j]=d(u[j]);return T}function d(u){let T=new Jy.ProtocolDiagnostic(b(u.range),u.message,x(u.severity),u.data);if(u.code!==void 0){if(typeof u.code=="string"||typeof u.code=="number")le.CodeDescription.is(u.codeDescription)?T.code={value:u.code,target:s(u.codeDescription.href)}:T.code=u.code;else if(Jy.DiagnosticCode.is(u.code)){T.hasDiagnosticCode=!0;let j=u.code;T.code={value:j.value,target:s(j.target)}}}return u.source&&(T.source=u.source),u.relatedInformation&&(T.relatedInformation=p(u.relatedInformation)),Array.isArray(u.tags)&&(T.tags=v(u.tags)),T}function p(u){let T=new Array(u.length);for(let j=0;j<u.length;j++){let te=u[j];T[j]=new K.DiagnosticRelatedInformation(Et(te.location),te.message)}return T}function v(u){if(!u)return;let T=[];for(let j of u){let te=m(j);te!==void 0&&T.push(te)}return T.length>0?T:void 0}function m(u){switch(u){case le.DiagnosticTag.Unnecessary:return K.DiagnosticTag.Unnecessary;case le.DiagnosticTag.Deprecated:return K.DiagnosticTag.Deprecated;default:return}}function S(u){return u?new K.Position(u.line,u.character):void 0}function b(u){return u?new K.Range(u.start.line,u.start.character,u.end.line,u.end.character):void 0}async function E(u,T){return qe.map(u,j=>new K.Range(j.start.line,j.start.character,j.end.line,j.end.character),T)}function x(u){if(u==null)return K.DiagnosticSeverity.Error;switch(u){case le.DiagnosticSeverity.Error:return K.DiagnosticSeverity.Error;case le.DiagnosticSeverity.Warning:return K.DiagnosticSeverity.Warning;case le.DiagnosticSeverity.Information:return K.DiagnosticSeverity.Information;case le.DiagnosticSeverity.Hint:return K.DiagnosticSeverity.Hint}return K.DiagnosticSeverity.Error}function $(u){if(Bn.string(u))return M(u);if(sa.is(u))return M().appendCodeblock(u.value,u.language);if(Array.isArray(u)){let T=[];for(let j of u){let te=M();sa.is(j)?te.appendCodeblock(j.value,j.language):te.appendMarkdown(j),T.push(te)}return T}else return M(u)}function U(u){if(Bn.string(u))return u;switch(u.kind){case le.MarkupKind.Markdown:return M(u.value);case le.MarkupKind.PlainText:return u.value;default:return`Unsupported Markup content received. Kind is: ${u.kind}`}}function M(u){let T;if(u===void 0||typeof u=="string")T=new K.MarkdownString(u);else switch(u.kind){case le.MarkupKind.Markdown:T=new K.MarkdownString(u.value);break;case le.MarkupKind.PlainText:T=new K.MarkdownString,T.appendText(u.value);break;default:T=new K.MarkdownString,T.appendText(`Unsupported Markup content received. Kind is: ${u.kind}`);break}return T.isTrusted=e,T.supportHtml=t,T}function z(u){if(u)return new K.Hover($(u.contents),b(u.range))}async function B(u,T,j){if(!u)return;if(Array.isArray(u))return qe.map(u,gr=>it(gr,T),j);let te=u,{defaultRange:Ot,commitCharacters:$t}=pe(te,T),Ve=await qe.map(te.items,gr=>it(gr,$t,Ot,te.itemDefaults?.insertTextMode,te.itemDefaults?.insertTextFormat,te.itemDefaults?.data),j);return new K.CompletionList(Ve,te.isIncomplete)}function pe(u,T){let j=u.itemDefaults?.editRange,te=u.itemDefaults?.commitCharacters??T;return le.Range.is(j)?{defaultRange:b(j),commitCharacters:te}:j!==void 0?{defaultRange:{inserting:b(j.insert),replacing:b(j.replace)},commitCharacters:te}:{defaultRange:void 0,commitCharacters:te}}function J(u){return le.CompletionItemKind.Text<=u&&u<=le.CompletionItemKind.TypeParameter?[u-1,void 0]:[K.CompletionItemKind.Text,u]}function ce(u){switch(u){case le.CompletionItemTag.Deprecated:return K.CompletionItemTag.Deprecated}}function Re(u){if(u==null)return[];let T=[];for(let j of u){let te=ce(j);te!==void 0&&T.push(te)}return T}function it(u,T,j,te,Ot,$t){let Ve=Re(u.tags),gr=Ze(u),Ge=new x_.default(gr);u.detail&&(Ge.detail=u.detail),u.documentation&&(Ge.documentation=U(u.documentation),Ge.documentationFormat=Bn.string(u.documentation)?"$string":u.documentation.kind),u.filterText&&(Ge.filterText=u.filterText);let po=$e(u,j,Ot);if(po&&(Ge.insertText=po.text,Ge.range=po.range,Ge.fromEdit=po.fromEdit),Bn.number(u.kind)){let[KR,cg]=J(u.kind);Ge.kind=KR,cg&&(Ge.originalItemKind=cg)}u.sortText&&(Ge.sortText=u.sortText),u.additionalTextEdits&&(Ge.additionalTextEdits=kt(u.additionalTextEdits));let og=u.commitCharacters!==void 0?Bn.stringArray(u.commitCharacters)?u.commitCharacters:void 0:T;og&&(Ge.commitCharacters=og.slice()),u.command&&(Ge.command=Ke(u.command)),(u.deprecated===!0||u.deprecated===!1)&&(Ge.deprecated=u.deprecated,u.deprecated===!0&&Ve.push(K.CompletionItemTag.Deprecated)),(u.preselect===!0||u.preselect===!1)&&(Ge.preselect=u.preselect);let ag=u.data??$t;ag!==void 0&&(Ge.data=ag),Ve.length>0&&(Ge.tags=Ve);let eu=u.insertTextMode??te;return eu!==void 0&&(Ge.insertTextMode=eu,eu===le.InsertTextMode.asIs&&(Ge.keepWhitespace=!0)),Ge}function Ze(u){return le.CompletionItemLabelDetails.is(u.labelDetails)?{label:u.label,detail:u.labelDetails.detail,description:u.labelDetails.description}:u.label}function $e(u,T,j){let te=u.insertTextFormat??j;if(u.textEdit!==void 0||T!==void 0){let[Ot,$t]=u.textEdit!==void 0?Yt(u.textEdit):[T,u.textEditText??u.label];return te===le.InsertTextFormat.Snippet?{text:new K.SnippetString($t),range:Ot,fromEdit:!0}:{text:$t,range:Ot,fromEdit:!0}}else return u.insertText?te===le.InsertTextFormat.Snippet?{text:new K.SnippetString(u.insertText),fromEdit:!1}:{text:u.insertText,fromEdit:!1}:void 0}function Yt(u){return le.InsertReplaceEdit.is(u)?[{inserting:b(u.insert),replacing:b(u.replace)},u.newText]:[b(u.range),u.newText]}function At(u){if(u)return new K.TextEdit(b(u.range),u.newText)}async function Pt(u,T){if(u)return qe.map(u,At,T)}function kt(u){if(!u)return;let T=new Array(u.length);for(let j=0;j<u.length;j++)T[j]=At(u[j]);return T}async function bn(u,T){if(!u)return;let j=new K.SignatureHelp;return Bn.number(u.activeSignature)?j.activeSignature=u.activeSignature:j.activeSignature=0,Bn.number(u.activeParameter)?j.activeParameter=u.activeParameter:j.activeParameter=0,u.signatures&&(j.signatures=await wn(u.signatures,T)),j}async function wn(u,T){return qe.mapAsync(u,Ue,T)}async function Ue(u,T){let j=new K.SignatureInformation(u.label);return u.documentation!==void 0&&(j.documentation=U(u.documentation)),u.parameters!==void 0&&(j.parameters=await Ct(u.parameters,T)),u.activeParameter!==void 0&&(j.activeParameter=u.activeParameter),j}function Ct(u,T){return qe.map(u,qt,T)}function qt(u){let T=new K.ParameterInformation(u.label);return u.documentation&&(T.documentation=U(u.documentation)),T}function Et(u){return u?new K.Location(i(u.uri),b(u.range)):void 0}async function dr(u,T){if(u)return Zn(u,T)}async function Cn(u,T){if(u)return Zn(u,T)}function Rn(u){if(!u)return;let T={targetUri:i(u.targetUri),targetRange:b(u.targetRange),originSelectionRange:b(u.originSelectionRange),targetSelectionRange:b(u.targetSelectionRange)};if(!T.targetSelectionRange)throw new Error("targetSelectionRange must not be undefined or null");return T}async function Zn(u,T){if(u)if(Bn.array(u)){if(u.length===0)return[];if(le.LocationLink.is(u[0])){let j=u;return qe.map(j,Rn,T)}else{let j=u;return qe.map(j,Et,T)}}else return le.LocationLink.is(u)?[Rn(u)]:Et(u)}async function lr(u,T){if(u)return qe.map(u,Et,T)}async function jn(u,T){if(u)return qe.map(u,Sn,T)}function Sn(u){let T=new K.DocumentHighlight(b(u.range));return Bn.number(u.kind)&&(T.kind=_n(u.kind)),T}function _n(u){switch(u){case le.DocumentHighlightKind.Text:return K.DocumentHighlightKind.Text;case le.DocumentHighlightKind.Read:return K.DocumentHighlightKind.Read;case le.DocumentHighlightKind.Write:return K.DocumentHighlightKind.Write}return K.DocumentHighlightKind.Text}async function $n(u,T){if(u)return qe.map(u,jt,T)}function We(u){return u<=le.SymbolKind.TypeParameter?u-1:K.SymbolKind.Property}function er(u){switch(u){case le.SymbolTag.Deprecated:return K.SymbolTag.Deprecated;default:return}}function Tn(u){if(u==null)return;let T=[];for(let j of u){let te=er(j);te!==void 0&&T.push(te)}return T.length===0?void 0:T}function jt(u){let T=u.data,j=u.location,te=j.range===void 0||T!==void 0?new M_.default(u.name,We(u.kind),u.containerName??"",j.range===void 0?i(j.uri):new K.Location(i(u.location.uri),b(j.range)),T):new K.SymbolInformation(u.name,We(u.kind),u.containerName??"",new K.Location(i(u.location.uri),b(j.range)));return Un(te,u),te}async function fr(u,T){if(u!=null)return qe.map(u,Ht,T)}function Ht(u){let T=new K.DocumentSymbol(u.name,u.detail||"",We(u.kind),b(u.range),b(u.selectionRange));if(Un(T,u),u.children!==void 0&&u.children.length>0){let j=[];for(let te of u.children)j.push(Ht(te));T.children=j}return T}function Un(u,T){u.tags=Tn(T.tags),T.deprecated&&(u.tags?u.tags.includes(K.SymbolTag.Deprecated)||(u.tags=u.tags.concat(K.SymbolTag.Deprecated)):u.tags=[K.SymbolTag.Deprecated])}function Ke(u){let T={title:u.title,command:u.command};return u.arguments&&(T.arguments=u.arguments),T}async function gt(u,T){if(u)return qe.map(u,Ke,T)}let xt=new Map;xt.set(le.CodeActionKind.Empty,K.CodeActionKind.Empty),xt.set(le.CodeActionKind.QuickFix,K.CodeActionKind.QuickFix),xt.set(le.CodeActionKind.Refactor,K.CodeActionKind.Refactor),xt.set(le.CodeActionKind.RefactorExtract,K.CodeActionKind.RefactorExtract),xt.set(le.CodeActionKind.RefactorInline,K.CodeActionKind.RefactorInline),xt.set(le.CodeActionKind.RefactorRewrite,K.CodeActionKind.RefactorRewrite),xt.set(le.CodeActionKind.Source,K.CodeActionKind.Source),xt.set(le.CodeActionKind.SourceOrganizeImports,K.CodeActionKind.SourceOrganizeImports);function Zt(u){if(u==null)return;let T=xt.get(u);if(T)return T;let j=u.split(".");T=K.CodeActionKind.Empty;for(let te of j)T=T.append(te);return T}function Rt(u){if(u!=null)return u.map(T=>Zt(T))}async function Dn(u,T){if(u==null)return;let j=new O_.default(u.title,u.data);return u.kind!==void 0&&(j.kind=Zt(u.kind)),u.diagnostics!==void 0&&(j.diagnostics=c(u.diagnostics)),u.edit!==void 0&&(j.edit=await mt(u.edit,T)),u.command!==void 0&&(j.command=Ke(u.command)),u.isPreferred!==void 0&&(j.isPreferred=u.isPreferred),u.disabled!==void 0&&(j.disabled={reason:u.disabled.reason}),j}function Wn(u,T){return qe.mapAsync(u,async j=>le.Command.is(j)?Ke(j):Dn(j,T),T)}function en(u){if(!u)return;let T=new I_.default(b(u.range));return u.command&&(T.command=Ke(u.command)),u.data!==void 0&&u.data!==null&&(T.data=u.data),T}async function Hn(u,T){if(u)return qe.map(u,en,T)}async function mt(u,T){if(!u)return;let j=new Map;if(u.changeAnnotations!==void 0){let $t=u.changeAnnotations;await qe.forEach(Object.keys($t),Ve=>{let gr=l($t[Ve]);j.set(Ve,gr)},T)}let te=$t=>{if($t!==void 0)return j.get($t)},Ot=new K.WorkspaceEdit;if(u.documentChanges){let $t=u.documentChanges;await qe.forEach($t,Ve=>{if(le.CreateFile.is(Ve))Ot.createFile(i(Ve.uri),Ve.options,te(Ve.annotationId));else if(le.RenameFile.is(Ve))Ot.renameFile(i(Ve.oldUri),i(Ve.newUri),Ve.options,te(Ve.annotationId));else if(le.DeleteFile.is(Ve))Ot.deleteFile(i(Ve.uri),Ve.options,te(Ve.annotationId));else if(le.TextDocumentEdit.is(Ve)){let gr=i(Ve.textDocument.uri);for(let Ge of Ve.edits)le.AnnotatedTextEdit.is(Ge)?Ot.replace(gr,b(Ge.range),Ge.newText,te(Ge.annotationId)):Ot.replace(gr,b(Ge.range),Ge.newText)}else throw new Error(`Unknown workspace edit change received:
${JSON.stringify(Ve,void 0,4)}`)},T)}else if(u.changes){let $t=u.changes;await qe.forEach(Object.keys($t),Ve=>{Ot.set(i(Ve),kt($t[Ve]))},T)}return Ot}function l(u){if(u!==void 0)return{label:u.label,needsConfirmation:!!u.needsConfirmation,description:u.description}}function C(u){let T=b(u.range),j=u.target?s(u.target):void 0,te=new q_.default(T,j);return u.tooltip!==void 0&&(te.tooltip=u.tooltip),u.data!==void 0&&u.data!==null&&(te.data=u.data),te}async function P(u,T){if(u)return qe.map(u,C,T)}function O(u){return new K.Color(u.red,u.green,u.blue,u.alpha)}function ne(u){return new K.ColorInformation(b(u.range),O(u.color))}async function ee(u,T){if(u)return qe.map(u,ne,T)}function ae(u){let T=new K.ColorPresentation(u.label);return T.additionalTextEdits=kt(u.additionalTextEdits),u.textEdit&&(T.textEdit=At(u.textEdit)),T}async function ue(u,T){if(u)return qe.map(u,ae,T)}function G(u){if(u)switch(u){case le.FoldingRangeKind.Comment:return K.FoldingRangeKind.Comment;case le.FoldingRangeKind.Imports:return K.FoldingRangeKind.Imports;case le.FoldingRangeKind.Region:return K.FoldingRangeKind.Region}}function ie(u){return new K.FoldingRange(u.startLine,u.endLine,G(u.kind))}async function Z(u,T){if(u)return qe.map(u,ie,T)}function he(u){return new K.SelectionRange(b(u.range),u.parent?he(u.parent):void 0)}async function _e(u,T){return Array.isArray(u)?qe.map(u,he,T):[]}function He(u){return le.InlineValueText.is(u)?new K.InlineValueText(b(u.range),u.text):le.InlineValueVariableLookup.is(u)?new K.InlineValueVariableLookup(b(u.range),u.variableName,u.caseSensitiveLookup):new K.InlineValueEvaluatableExpression(b(u.range),u.expression)}async function hr(u,T){return Array.isArray(u)?qe.map(u,He,T):[]}async function Mr(u,T){let j=typeof u.label=="string"?u.label:await qe.map(u.label,h,T),te=new N_.default(S(u.position),j);return u.kind!==void 0&&(te.kind=u.kind),u.textEdits!==void 0&&(te.textEdits=await Pt(u.textEdits,T)),u.tooltip!==void 0&&(te.tooltip=q(u.tooltip)),u.paddingLeft!==void 0&&(te.paddingLeft=u.paddingLeft),u.paddingRight!==void 0&&(te.paddingRight=u.paddingRight),u.data!==void 0&&(te.data=u.data),te}function h(u){let T=new K.InlayHintLabelPart(u.value);return u.location!==void 0&&(T.location=Et(u.location)),u.tooltip!==void 0&&(T.tooltip=q(u.tooltip)),u.command!==void 0&&(T.command=Ke(u.command)),T}function q(u){return typeof u=="string"?u:M(u)}async function Y(u,T){if(Array.isArray(u))return qe.mapAsync(u,Mr,T)}function Oe(u){if(u===null)return;let T=new F_.default(We(u.kind),u.name,u.detail||"",s(u.uri),b(u.range),b(u.selectionRange),u.data);return u.tags!==void 0&&(T.tags=Tn(u.tags)),T}async function D(u,T){if(u!==null)return qe.map(u,Oe,T)}async function g(u,T){return new K.CallHierarchyIncomingCall(Oe(u.from),await E(u.fromRanges,T))}async function R(u,T){if(u!==null)return qe.mapAsync(u,g,T)}async function _(u,T){return new K.CallHierarchyOutgoingCall(Oe(u.to),await E(u.fromRanges,T))}async function y(u,T){if(u!==null)return qe.mapAsync(u,_,T)}async function f(u,T){if(u!=null)return new K.SemanticTokens(new Uint32Array(u.data),u.resultId)}function k(u){return new K.SemanticTokensEdit(u.start,u.deleteCount,u.data!==void 0?new Uint32Array(u.data):void 0)}async function A(u,T){if(u!=null)return new K.SemanticTokensEdits(u.edits.map(k),u.resultId)}function ge(u){return u}async function st(u,T){if(u!=null)return new K.LinkedEditingRanges(await E(u.ranges,T),Be(u.wordPattern))}function Be(u){if(u!=null)return new RegExp(u)}function on(u){if(u===null)return;let T=new L_.default(We(u.kind),u.name,u.detail||"",s(u.uri),b(u.range),b(u.selectionRange),u.data);return u.tags!==void 0&&(T.tags=Tn(u.tags)),T}async function Pn(u,T){if(u!==null)return qe.map(u,on,T)}function tr(u){if(Bn.string(u))return u;if(le.RelativePattern.is(u)){if(le.URI.is(u.baseUri))return new K.RelativePattern(s(u.baseUri),u.pattern);if(le.WorkspaceFolder.is(u.baseUri)){let T=K.workspace.getWorkspaceFolder(s(u.baseUri.uri));return T!==void 0?new K.RelativePattern(T,u.pattern):void 0}}}async function De(u,T){if(!u)return;if(Array.isArray(u))return qe.map(u,Ot=>pr(Ot),T);let j=u,te=await qe.map(j.items,Ot=>pr(Ot),T);return new K.InlineCompletionList(te)}function pr(u){let T;typeof u.insertText=="string"?T=u.insertText:T=new K.SnippetString(u.insertText.value);let j;u.command&&(j=Ke(u.command));let te=new K.InlineCompletionItem(T,b(u.range),j);return u.filterText&&(te.filterText=u.filterText),te}return{asUri:s,asDocumentSelector:o,asDiagnostics:a,asDiagnostic:d,asRange:b,asRanges:E,asPosition:S,asDiagnosticSeverity:x,asDiagnosticTag:m,asHover:z,asCompletionResult:B,asCompletionItem:it,asTextEdit:At,asTextEdits:Pt,asSignatureHelp:bn,asSignatureInformations:wn,asSignatureInformation:Ue,asParameterInformations:Ct,asParameterInformation:qt,asDeclarationResult:dr,asDefinitionResult:Cn,asLocation:Et,asReferences:lr,asDocumentHighlights:jn,asDocumentHighlight:Sn,asDocumentHighlightKind:_n,asSymbolKind:We,asSymbolTag:er,asSymbolTags:Tn,asSymbolInformations:$n,asSymbolInformation:jt,asDocumentSymbols:fr,asDocumentSymbol:Ht,asCommand:Ke,asCommands:gt,asCodeAction:Dn,asCodeActionKind:Zt,asCodeActionKinds:Rt,asCodeActionResult:Wn,asCodeLens:en,asCodeLenses:Hn,asWorkspaceEdit:mt,asDocumentLink:C,asDocumentLinks:P,asFoldingRangeKind:G,asFoldingRange:ie,asFoldingRanges:Z,asColor:O,asColorInformation:ne,asColorInformations:ee,asColorPresentation:ae,asColorPresentations:ue,asSelectionRange:he,asSelectionRanges:_e,asInlineValue:He,asInlineValues:hr,asInlayHint:Mr,asInlayHints:Y,asSemanticTokensLegend:ge,asSemanticTokens:f,asSemanticTokensEdit:k,asSemanticTokensEdits:A,asCallHierarchyItem:Oe,asCallHierarchyItems:D,asCallHierarchyIncomingCall:g,asCallHierarchyIncomingCalls:R,asCallHierarchyOutgoingCall:_,asCallHierarchyOutgoingCalls:y,asLinkedEditingRanges:st,asTypeHierarchyItem:on,asTypeHierarchyItems:Pn,asGlobPattern:tr,asInlineCompletionResult:De,asInlineCompletionItem:pr}}oa.createConverter=A_});var at=I(Gn=>{"use strict";Object.defineProperty(Gn,"__esModule",{value:!0});Gn.generateUuid=Gn.parse=Gn.isUUID=Gn.v4=Gn.empty=void 0;var xs=class{constructor(e){this._value=e}asHex(){return this._value}equals(e){return this.asHex()===e.asHex()}},Is=class r extends xs{static _oneOf(e){return e[Math.floor(e.length*Math.random())]}static _randomHex(){return r._oneOf(r._chars)}constructor(){super([r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),"-",r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),"-","4",r._randomHex(),r._randomHex(),r._randomHex(),"-",r._oneOf(r._timeHighBits),r._randomHex(),r._randomHex(),r._randomHex(),"-",r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex()].join(""))}};Is._chars=["0","1","2","3","4","5","6","6","7","8","9","a","b","c","d","e","f"];Is._timeHighBits=["8","9","a","b"];Gn.empty=new xs("00000000-0000-0000-0000-000000000000");function Yy(){return new Is}Gn.v4=Yy;var j_=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function Zy(r){return j_.test(r)}Gn.isUUID=Zy;function $_(r){if(!Zy(r))throw new Error("invalid uuid");return new xs(r)}Gn.parse=$_;function U_(){return Yy().asHex()}Gn.generateUuid=U_});var ol=I(aa=>{"use strict";Object.defineProperty(aa,"__esModule",{value:!0});aa.ProgressPart=void 0;var eb=require("vscode"),tb=me(),nb=Vn(),sl=class{constructor(e,t,n){this._client=e,this._token=t,this._reported=0,this._infinite=!1,this._lspProgressDisposable=this._client.onProgress(tb.WorkDoneProgress.type,this._token,i=>{switch(i.kind){case"begin":this.begin(i);break;case"report":this.report(i);break;case"end":this.done(),n&&n(this);break}})}begin(e){this._infinite=e.percentage===void 0,this._lspProgressDisposable!==void 0&&eb.window.withProgress({location:eb.ProgressLocation.Window,cancellable:e.cancellable,title:e.title},async(t,n)=>{if(this._lspProgressDisposable!==void 0)return this._progress=t,this._cancellationToken=n,this._tokenDisposable=this._cancellationToken.onCancellationRequested(()=>{this._client.sendNotification(tb.WorkDoneProgressCancelNotification.type,{token:this._token})}),this.report(e),new Promise((i,s)=>{this._resolve=i,this._reject=s})})}report(e){if(this._infinite&&nb.string(e.message))this._progress!==void 0&&this._progress.report({message:e.message});else if(nb.number(e.percentage)){let t=Math.max(0,Math.min(e.percentage,100)),n=Math.max(0,t-this._reported);this._reported+=n,this._progress!==void 0&&this._progress.report({message:e.message,increment:n})}}cancel(){this.cleanup(),this._reject!==void 0&&(this._reject(),this._resolve=void 0,this._reject=void 0)}done(){this.cleanup(),this._resolve!==void 0&&(this._resolve(),this._resolve=void 0,this._reject=void 0)}cleanup(){this._lspProgressDisposable!==void 0&&(this._lspProgressDisposable.dispose(),this._lspProgressDisposable=void 0),this._tokenDisposable!==void 0&&(this._tokenDisposable.dispose(),this._tokenDisposable=void 0),this._progress=void 0,this._cancellationToken=void 0}};aa.ProgressPart=sl});var Ie=I(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});Lt.WorkspaceFeature=Lt.TextDocumentLanguageFeature=Lt.TextDocumentEventFeature=Lt.DynamicDocumentFeature=Lt.DynamicFeature=Lt.StaticFeature=Lt.ensure=Lt.LSPCancellationError=void 0;var fi=require("vscode"),al=me(),tn=Vn(),rb=at(),cl=class extends fi.CancellationError{constructor(e){super(),this.data=e}};Lt.LSPCancellationError=cl;function W_(r,e){return r[e]===void 0&&(r[e]={}),r[e]}Lt.ensure=W_;var ib;(function(r){function e(t){let n=t;return n!=null&&tn.func(n.fillClientCapabilities)&&tn.func(n.initialize)&&tn.func(n.getState)&&tn.func(n.clear)&&(n.fillInitializeParams===void 0||tn.func(n.fillInitializeParams))}r.is=e})(ib||(Lt.StaticFeature=ib={}));var sb;(function(r){function e(t){let n=t;return n!=null&&tn.func(n.fillClientCapabilities)&&tn.func(n.initialize)&&tn.func(n.getState)&&tn.func(n.clear)&&(n.fillInitializeParams===void 0||tn.func(n.fillInitializeParams))&&tn.func(n.register)&&tn.func(n.unregister)&&n.registrationType!==void 0}r.is=e})(sb||(Lt.DynamicFeature=sb={}));var qs=class{constructor(e){this._client=e}getState(){let e=this.getDocumentSelectors(),t=0;for(let i of e){t++;for(let s of fi.workspace.textDocuments)if(fi.languages.match(i,s)>0)return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!0}}let n=t>0;return{kind:"document",id:this.registrationType.method,registrations:n,matches:!1}}};Lt.DynamicDocumentFeature=qs;var ul=class extends qs{static textDocumentFilter(e,t){for(let n of e)if(fi.languages.match(n,t)>0)return!0;return!1}constructor(e,t,n,i,s,o,a){super(e),this._event=t,this._type=n,this._middleware=i,this._createParams=s,this._textDocument=o,this._selectorFilter=a,this._selectors=new Map,this._onNotificationSent=new fi.EventEmitter}getStateInfo(){return[this._selectors.values(),!1]}getDocumentSelectors(){return this._selectors.values()}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=this._event(t=>{this.callback(t).catch(n=>{this._client.error(`Sending document notification ${this._type.method} failed.`,n)})})),this._selectors.set(e.id,this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)))}async callback(e){let t=async n=>{let i=this._createParams(n);await this._client.sendNotification(this._type,i),this.notificationSent(this.getTextDocument(n),this._type,i)};if(this.matches(e)){let n=this._middleware();return n?n(e,i=>t(i)):t(e)}}matches(e){return this._client.hasDedicatedTextSynchronizationFeature(this._textDocument(e))?!1:!this._selectorFilter||this._selectorFilter(this._selectors.values(),e)}get onNotificationSent(){return this._onNotificationSent.event}notificationSent(e,t,n){this._onNotificationSent.fire({textDocument:e,type:t,params:n})}unregister(e){this._selectors.delete(e),this._selectors.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}clear(){this._selectors.clear(),this._onNotificationSent.dispose(),this._listener&&(this._listener.dispose(),this._listener=void 0)}getProvider(e){for(let t of this._selectors.values())if(fi.languages.match(t,e)>0)return{send:n=>this.callback(n)}}};Lt.TextDocumentEventFeature=ul;var dl=class extends qs{constructor(e,t){super(e),this._registrationType=t,this._registrations=new Map}*getDocumentSelectors(){for(let e of this._registrations.values()){let t=e.data.registerOptions.documentSelector;t!==null&&(yield this._client.protocol2CodeConverter.asDocumentSelector(t))}}get registrationType(){return this._registrationType}register(e){if(!e.registerOptions.documentSelector)return;let t=this.registerLanguageProvider(e.registerOptions,e.id);this._registrations.set(e.id,{disposable:t[0],data:e,provider:t[1]})}unregister(e){let t=this._registrations.get(e);t!==void 0&&t.disposable.dispose()}clear(){this._registrations.forEach(e=>{e.disposable.dispose()}),this._registrations.clear()}getRegistration(e,t){if(t){if(al.TextDocumentRegistrationOptions.is(t)){let n=al.StaticRegistrationOptions.hasId(t)?t.id:rb.generateUuid(),i=t.documentSelector??e;if(i)return[n,Object.assign({},t,{documentSelector:i})]}else if(tn.boolean(t)&&t===!0||al.WorkDoneProgressOptions.is(t)){if(!e)return[void 0,void 0];let n=tn.boolean(t)&&t===!0?{documentSelector:e}:Object.assign({},t,{documentSelector:e});return[rb.generateUuid(),n]}}else return[void 0,void 0];return[void 0,void 0]}getRegistrationOptions(e,t){if(!(!e||!t))return tn.boolean(t)&&t===!0?{documentSelector:e}:Object.assign({},t,{documentSelector:e})}getProvider(e){for(let t of this._registrations.values()){let n=t.data.registerOptions.documentSelector;if(n!==null&&fi.languages.match(this._client.protocol2CodeConverter.asDocumentSelector(n),e)>0)return t.provider}}getAllProviders(){let e=[];for(let t of this._registrations.values())e.push(t.provider);return e}};Lt.TextDocumentLanguageFeature=dl;var ll=class{constructor(e,t){this._client=e,this._registrationType=t,this._registrations=new Map}getState(){let e=this._registrations.size>0;return{kind:"workspace",id:this._registrationType.method,registrations:e}}get registrationType(){return this._registrationType}register(e){let t=this.registerLanguageProvider(e.registerOptions);this._registrations.set(e.id,{disposable:t[0],provider:t[1]})}unregister(e){let t=this._registrations.get(e);t!==void 0&&t.disposable.dispose()}clear(){this._registrations.forEach(e=>{e.disposable.dispose()}),this._registrations.clear()}getProviders(){let e=[];for(let t of this._registrations.values())e.push(t.provider);return e}};Lt.WorkspaceFeature=ll});var ab=I((ix,ob)=>{var H_=typeof process=="object"&&process&&process.platform==="win32";ob.exports=H_?{sep:"\\"}:{sep:"/"}});var fb=I((sx,lb)=>{"use strict";lb.exports=ub;function ub(r,e,t){r instanceof RegExp&&(r=cb(r,t)),e instanceof RegExp&&(e=cb(e,t));var n=db(r,e,t);return n&&{start:n[0],end:n[1],pre:t.slice(0,n[0]),body:t.slice(n[0]+r.length,n[1]),post:t.slice(n[1]+e.length)}}function cb(r,e){var t=e.match(r);return t?t[0]:null}ub.range=db;function db(r,e,t){var n,i,s,o,a,c=t.indexOf(r),d=t.indexOf(e,c+1),p=c;if(c>=0&&d>0){if(r===e)return[c,d];for(n=[],s=t.length;p>=0&&!a;)p==c?(n.push(p),c=t.indexOf(r,p+1)):n.length==1?a=[n.pop(),d]:(i=n.pop(),i<s&&(s=i,o=d),d=t.indexOf(e,p+1)),p=c<d&&c>=0?c:d;n.length&&(a=[s,o])}return a}});var wb=I((ox,bb)=>{var hb=fb();bb.exports=K_;var pb="\0SLASH"+Math.random()+"\0",gb="\0OPEN"+Math.random()+"\0",hl="\0CLOSE"+Math.random()+"\0",mb="\0COMMA"+Math.random()+"\0",vb="\0PERIOD"+Math.random()+"\0";function fl(r){return parseInt(r,10)==r?parseInt(r,10):r.charCodeAt(0)}function V_(r){return r.split("\\\\").join(pb).split("\\{").join(gb).split("\\}").join(hl).split("\\,").join(mb).split("\\.").join(vb)}function z_(r){return r.split(pb).join("\\").split(gb).join("{").split(hl).join("}").split(mb).join(",").split(vb).join(".")}function yb(r){if(!r)return[""];var e=[],t=hb("{","}",r);if(!t)return r.split(",");var n=t.pre,i=t.body,s=t.post,o=n.split(",");o[o.length-1]+="{"+i+"}";var a=yb(s);return s.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),e.push.apply(e,o),e}function K_(r){return r?(r.substr(0,2)==="{}"&&(r="\\{\\}"+r.substr(2)),Os(V_(r),!0).map(z_)):[]}function B_(r){return"{"+r+"}"}function G_(r){return/^-?0\d/.test(r)}function J_(r,e){return r<=e}function X_(r,e){return r>=e}function Os(r,e){var t=[],n=hb("{","}",r);if(!n)return[r];var i=n.pre,s=n.post.length?Os(n.post,!1):[""];if(/\$$/.test(n.pre))for(var o=0;o<s.length;o++){var a=i+"{"+n.body+"}"+s[o];t.push(a)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),d=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),p=c||d,v=n.body.indexOf(",")>=0;if(!p&&!v)return n.post.match(/,.*\}/)?(r=n.pre+"{"+n.body+hl+n.post,Os(r)):[r];var m;if(p)m=n.body.split(/\.\./);else if(m=yb(n.body),m.length===1&&(m=Os(m[0],!1).map(B_),m.length===1))return s.map(function(it){return n.pre+m[0]+it});var S;if(p){var b=fl(m[0]),E=fl(m[1]),x=Math.max(m[0].length,m[1].length),$=m.length==3?Math.abs(fl(m[2])):1,U=J_,M=E<b;M&&($*=-1,U=X_);var z=m.some(G_);S=[];for(var B=b;U(B,E);B+=$){var pe;if(d)pe=String.fromCharCode(B),pe==="\\"&&(pe="");else if(pe=String(B),z){var J=x-pe.length;if(J>0){var ce=new Array(J+1).join("0");B<0?pe="-"+ce+pe.slice(1):pe=ce+pe}}S.push(pe)}}else{S=[];for(var Re=0;Re<m.length;Re++)S.push.apply(S,Os(m[Re],!1))}for(var Re=0;Re<S.length;Re++)for(var o=0;o<s.length;o++){var a=i+S[Re]+s[o];(!e||p||a)&&t.push(a)}}return t}});var ua=I((cx,yl)=>{var xn=yl.exports=(r,e,t={})=>(ca(e),!t.nocomment&&e.charAt(0)==="#"?!1:new Bi(e,t).match(r));yl.exports=xn;var ml=ab();xn.sep=ml.sep;var ir=Symbol("globstar **");xn.GLOBSTAR=ir;var Q_=wb(),Cb={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},vl="[^/]",pl=vl+"*?",Y_="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Z_="(?:(?!(?:\\/|^)\\.).)*?",_b=r=>r.split("").reduce((e,t)=>(e[t]=!0,e),{}),Rb=_b("().*{}+?[]^$\\!"),eT=_b("[.("),Sb=/\/+/;xn.filter=(r,e={})=>(t,n,i)=>xn(t,r,e);var Kr=(r,e={})=>{let t={};return Object.keys(r).forEach(n=>t[n]=r[n]),Object.keys(e).forEach(n=>t[n]=e[n]),t};xn.defaults=r=>{if(!r||typeof r!="object"||!Object.keys(r).length)return xn;let e=xn,t=(n,i,s)=>e(n,i,Kr(r,s));return t.Minimatch=class extends e.Minimatch{constructor(i,s){super(i,Kr(r,s))}},t.Minimatch.defaults=n=>e.defaults(Kr(r,n)).Minimatch,t.filter=(n,i)=>e.filter(n,Kr(r,i)),t.defaults=n=>e.defaults(Kr(r,n)),t.makeRe=(n,i)=>e.makeRe(n,Kr(r,i)),t.braceExpand=(n,i)=>e.braceExpand(n,Kr(r,i)),t.match=(n,i,s)=>e.match(n,i,Kr(r,s)),t};xn.braceExpand=(r,e)=>Tb(r,e);var Tb=(r,e={})=>(ca(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:Q_(r)),tT=1024*64,ca=r=>{if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>tT)throw new TypeError("pattern is too long")},gl=Symbol("subparse");xn.makeRe=(r,e)=>new Bi(r,e||{}).makeRe();xn.match=(r,e,t={})=>{let n=new Bi(e,t);return r=r.filter(i=>n.match(i)),n.options.nonull&&!r.length&&r.push(e),r};var nT=r=>r.replace(/\\(.)/g,"$1"),rT=r=>r.replace(/\\([^-\]])/g,"$1"),iT=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),sT=r=>r.replace(/[[\]\\]/g,"\\$&"),Bi=class{constructor(e,t){ca(e),t||(t={}),this.options=t,this.set=[],this.pattern=e,this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.make()}debug(){}make(){let e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate();let n=this.globSet=this.braceExpand();t.debug&&(this.debug=(...i)=>console.error(...i)),this.debug(this.pattern,n),n=this.globParts=n.map(i=>i.split(Sb)),this.debug(this.pattern,n),n=n.map((i,s,o)=>i.map(this.parse,this)),this.debug(this.pattern,n),n=n.filter(i=>i.indexOf(!1)===-1),this.debug(this.pattern,n),this.set=n}parseNegate(){if(this.options.nonegate)return;let e=this.pattern,t=!1,n=0;for(let i=0;i<e.length&&e.charAt(i)==="!";i++)t=!t,n++;n&&(this.pattern=e.slice(n)),this.negate=t}matchOne(e,t,n){var i=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var s=0,o=0,a=e.length,c=t.length;s<a&&o<c;s++,o++){this.debug("matchOne loop");var d=t[o],p=e[s];if(this.debug(t,d,p),d===!1)return!1;if(d===ir){this.debug("GLOBSTAR",[t,d,p]);var v=s,m=o+1;if(m===c){for(this.debug("** at the end");s<a;s++)if(e[s]==="."||e[s]===".."||!i.dot&&e[s].charAt(0)===".")return!1;return!0}for(;v<a;){var S=e[v];if(this.debug(`
globstar while`,e,v,t,m,S),this.matchOne(e.slice(v),t.slice(m),n))return this.debug("globstar found match!",v,a,S),!0;if(S==="."||S===".."||!i.dot&&S.charAt(0)==="."){this.debug("dot detected!",e,v,t,m);break}this.debug("globstar swallow a segment, and continue"),v++}return!!(n&&(this.debug(`
>>> no match, partial?`,e,v,t,m),v===a))}var b;if(typeof d=="string"?(b=p===d,this.debug("string match",d,p,b)):(b=p.match(d),this.debug("pattern match",d,p,b)),!b)return!1}if(s===a&&o===c)return!0;if(s===a)return n;if(o===c)return s===a-1&&e[s]==="";throw new Error("wtf?")}braceExpand(){return Tb(this.pattern,this.options)}parse(e,t){ca(e);let n=this.options;if(e==="**")if(n.noglobstar)e="*";else return ir;if(e==="")return"";let i="",s=!1,o=!1,a=[],c=[],d,p=!1,v=-1,m=-1,S,b,E,x=e.charAt(0)===".",$=n.dot||x,U=()=>x?"":$?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",M=J=>J.charAt(0)==="."?"":n.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",z=()=>{if(d){switch(d){case"*":i+=pl,s=!0;break;case"?":i+=vl,s=!0;break;default:i+="\\"+d;break}this.debug("clearStateChar %j %j",d,i),d=!1}};for(let J=0,ce;J<e.length&&(ce=e.charAt(J));J++){if(this.debug("%s	%s %s %j",e,J,i,ce),o){if(ce==="/")return!1;Rb[ce]&&(i+="\\"),i+=ce,o=!1;continue}switch(ce){case"/":return!1;case"\\":if(p&&e.charAt(J+1)==="-"){i+=ce;continue}z(),o=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",e,J,i,ce),p){this.debug("  in class"),ce==="!"&&J===m+1&&(ce="^"),i+=ce;continue}this.debug("call clearStateChar %j",d),z(),d=ce,n.noext&&z();continue;case"(":{if(p){i+="(";continue}if(!d){i+="\\(";continue}let Re={type:d,start:J-1,reStart:i.length,open:Cb[d].open,close:Cb[d].close};this.debug(this.pattern,"	",Re),a.push(Re),i+=Re.open,Re.start===0&&Re.type!=="!"&&(x=!0,i+=M(e.slice(J+1))),this.debug("plType %j %j",d,i),d=!1;continue}case")":{let Re=a[a.length-1];if(p||!Re){i+="\\)";continue}a.pop(),z(),s=!0,b=Re,i+=b.close,b.type==="!"&&c.push(Object.assign(b,{reEnd:i.length}));continue}case"|":{let Re=a[a.length-1];if(p||!Re){i+="\\|";continue}z(),i+="|",Re.start===0&&Re.type!=="!"&&(x=!0,i+=M(e.slice(J+1)));continue}case"[":if(z(),p){i+="\\"+ce;continue}p=!0,m=J,v=i.length,i+=ce;continue;case"]":if(J===m+1||!p){i+="\\"+ce;continue}S=e.substring(m+1,J);try{RegExp("["+sT(rT(S))+"]"),i+=ce}catch{i=i.substring(0,v)+"(?:$.)"}s=!0,p=!1;continue;default:z(),Rb[ce]&&!(ce==="^"&&p)&&(i+="\\"),i+=ce;break}}for(p&&(S=e.slice(m+1),E=this.parse(S,gl),i=i.substring(0,v)+"\\["+E[0],s=s||E[1]),b=a.pop();b;b=a.pop()){let J;J=i.slice(b.reStart+b.open.length),this.debug("setting tail",i,b),J=J.replace(/((?:\\{2}){0,64})(\\?)\|/g,(Re,it,Ze)=>(Ze||(Ze="\\"),it+it+Ze+"|")),this.debug(`tail=%j
   %s`,J,J,b,i);let ce=b.type==="*"?pl:b.type==="?"?vl:"\\"+b.type;s=!0,i=i.slice(0,b.reStart)+ce+"\\("+J}z(),o&&(i+="\\\\");let B=eT[i.charAt(0)];for(let J=c.length-1;J>-1;J--){let ce=c[J],Re=i.slice(0,ce.reStart),it=i.slice(ce.reStart,ce.reEnd-8),Ze=i.slice(ce.reEnd),$e=i.slice(ce.reEnd-8,ce.reEnd)+Ze,Yt=Re.split(")").length,At=Re.split("(").length-Yt,Pt=Ze;for(let bn=0;bn<At;bn++)Pt=Pt.replace(/\)[+*?]?/,"");Ze=Pt;let kt=Ze===""&&t!==gl?"(?:$|\\/)":"";i=Re+it+Ze+kt+$e}if(i!==""&&s&&(i="(?=.)"+i),B&&(i=U()+i),t===gl)return[i,s];if(n.nocase&&!s&&(s=e.toUpperCase()!==e.toLowerCase()),!s)return nT(e);let pe=n.nocase?"i":"";try{return Object.assign(new RegExp("^"+i+"$",pe),{_glob:e,_src:i})}catch{return new RegExp("$.")}}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let e=this.set;if(!e.length)return this.regexp=!1,this.regexp;let t=this.options,n=t.noglobstar?pl:t.dot?Y_:Z_,i=t.nocase?"i":"",s=e.map(o=>(o=o.map(a=>typeof a=="string"?iT(a):a===ir?ir:a._src).reduce((a,c)=>(a[a.length-1]===ir&&c===ir||a.push(c),a),[]),o.forEach((a,c)=>{a!==ir||o[c-1]===ir||(c===0?o.length>1?o[c+1]="(?:\\/|"+n+"\\/)?"+o[c+1]:o[c]=n:c===o.length-1?o[c-1]+="(?:\\/|"+n+")?":(o[c-1]+="(?:\\/|\\/"+n+"\\/)"+o[c+1],o[c+1]=ir))}),o.filter(a=>a!==ir).join("/"))).join("|");s="^(?:"+s+")$",this.negate&&(s="^(?!"+s+").*$");try{this.regexp=new RegExp(s,i)}catch{this.regexp=!1}return this.regexp}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;let n=this.options;ml.sep!=="/"&&(e=e.split(ml.sep).join("/")),e=e.split(Sb),this.debug(this.pattern,"split",e);let i=this.set;this.debug(this.pattern,"set",i);let s;for(let o=e.length-1;o>=0&&(s=e[o],!s);o--);for(let o=0;o<i.length;o++){let a=i[o],c=e;if(n.matchBase&&a.length===1&&(c=[s]),this.matchOne(c,a,t))return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate}static defaults(e){return xn.defaults(e).Minimatch}};xn.Minimatch=Bi});var Dl=I(Br=>{"use strict";Object.defineProperty(Br,"__esModule",{value:!0});Br.DiagnosticFeature=Br.DiagnosticPullMode=Br.vsdiag=void 0;var oT=ua(),Pe=require("vscode"),bt=me(),aT=at(),bl=Ie();function da(r,e){return r[e]===void 0&&(r[e]={}),r[e]}var Jn;(function(r){let e;(function(t){t.full="full",t.unChanged="unChanged"})(e=r.DocumentDiagnosticReportKind||(r.DocumentDiagnosticReportKind={}))})(Jn||(Br.vsdiag=Jn={}));var la;(function(r){r.onType="onType",r.onSave="onSave"})(la||(Br.DiagnosticPullMode=la={}));var Gt;(function(r){r.active="open",r.reschedule="reschedule",r.outDated="drop"})(Gt||(Gt={}));var wl=class r{constructor(){this.open=new Set,this._onOpen=new Pe.EventEmitter,this._onClose=new Pe.EventEmitter,r.fillTabResources(this.open);let e=t=>{if(t.closed.length===0&&t.opened.length===0)return;let n=this.open,i=new Set;r.fillTabResources(i);let s=new Set,o=new Set(i);for(let a of n.values())i.has(a)?o.delete(a):s.add(a);if(this.open=i,s.size>0){let a=new Set;for(let c of s)a.add(Pe.Uri.parse(c));this._onClose.fire(a)}if(o.size>0){let a=new Set;for(let c of o)a.add(Pe.Uri.parse(c));this._onOpen.fire(a)}};Pe.window.tabGroups.onDidChangeTabs!==void 0?this.disposable=Pe.window.tabGroups.onDidChangeTabs(e):this.disposable={dispose:()=>{}}}get onClose(){return this._onClose.event}get onOpen(){return this._onOpen.event}dispose(){this.disposable.dispose()}isActive(e){return e instanceof Pe.Uri?Pe.window.activeTextEditor?.document.uri===e:Pe.window.activeTextEditor?.document===e}isVisible(e){let t=e instanceof Pe.Uri?e:e.uri;return this.open.has(t.toString())}getTabResources(){let e=new Set;return r.fillTabResources(new Set,e),e}static fillTabResources(e,t){let n=e??new Set;for(let i of Pe.window.tabGroups.all)for(let s of i.tabs){let o=s.input,a;o instanceof Pe.TabInputText?a=o.uri:o instanceof Pe.TabInputTextDiff?a=o.modified:o instanceof Pe.TabInputCustom&&(a=o.uri),a!==void 0&&!n.has(a.toString())&&(n.add(a.toString()),t!==void 0&&t.add(a))}}},It;(function(r){r[r.document=1]="document",r[r.workspace=2]="workspace"})(It||(It={}));var Pr;(function(r){function e(t){return t instanceof Pe.Uri?t.toString():t.uri.toString()}r.asKey=e})(Pr||(Pr={}));var Cl=class{constructor(){this.documentPullStates=new Map,this.workspacePullStates=new Map}track(e,t,n){let i=e===It.document?this.documentPullStates:this.workspacePullStates,[s,o,a]=t instanceof Pe.Uri?[t.toString(),t,n]:[t.uri.toString(),t.uri,t.version],c=i.get(s);return c===void 0&&(c={document:o,pulledVersion:a,resultId:void 0},i.set(s,c)),c}update(e,t,n,i){let s=e===It.document?this.documentPullStates:this.workspacePullStates,[o,a,c,d]=t instanceof Pe.Uri?[t.toString(),t,n,i]:[t.uri.toString(),t.uri,t.version,n],p=s.get(o);p===void 0?(p={document:a,pulledVersion:c,resultId:d},s.set(o,p)):(p.pulledVersion=c,p.resultId=d)}unTrack(e,t){let n=Pr.asKey(t);(e===It.document?this.documentPullStates:this.workspacePullStates).delete(n)}tracks(e,t){let n=Pr.asKey(t);return(e===It.document?this.documentPullStates:this.workspacePullStates).has(n)}getResultId(e,t){let n=Pr.asKey(t);return(e===It.document?this.documentPullStates:this.workspacePullStates).get(n)?.resultId}getAllResultIds(){let e=[];for(let[t,n]of this.workspacePullStates)this.documentPullStates.has(t)&&(n=this.documentPullStates.get(t)),n.resultId!==void 0&&e.push({uri:t,value:n.resultId});return e}},Rl=class{constructor(e,t,n){this.client=e,this.tabs=t,this.options=n,this.isDisposed=!1,this.onDidChangeDiagnosticsEmitter=new Pe.EventEmitter,this.provider=this.createProvider(),this.diagnostics=Pe.languages.createDiagnosticCollection(n.identifier),this.openRequests=new Map,this.documentStates=new Cl,this.workspaceErrorCounter=0}knows(e,t){let n=t instanceof Pe.Uri?t:t.uri;return this.documentStates.tracks(e,t)||this.openRequests.has(n.toString())}forget(e,t){this.documentStates.unTrack(e,t)}pull(e,t){if(this.isDisposed)return;let n=e instanceof Pe.Uri?e:e.uri;this.pullAsync(e).then(()=>{t&&t()},i=>{this.client.error(`Document pull failed for text document ${n.toString()}`,i,!1)})}async pullAsync(e,t){if(this.isDisposed)return;let n=e instanceof Pe.Uri,i=n?e:e.uri,s=i.toString();t=n?t:e.version;let o=this.openRequests.get(s),a=n?this.documentStates.track(It.document,e,t):this.documentStates.track(It.document,e);if(o===void 0){let c=new Pe.CancellationTokenSource;this.openRequests.set(s,{state:Gt.active,document:e,version:t,tokenSource:c});let d,p;try{d=await this.provider.provideDiagnostics(e,a.resultId,c.token)??{kind:Jn.DocumentDiagnosticReportKind.full,items:[]}}catch(v){if(v instanceof bl.LSPCancellationError&&bt.DiagnosticServerCancellationData.is(v.data)&&v.data.retriggerRequest===!1&&(p={state:Gt.outDated,document:e}),p===void 0&&v instanceof Pe.CancellationError)p={state:Gt.reschedule,document:e};else throw v}if(p=p??this.openRequests.get(s),p===void 0){this.client.error(`Lost request state in diagnostic pull model. Clearing diagnostics for ${s}`),this.diagnostics.delete(i);return}if(this.openRequests.delete(s),!this.tabs.isVisible(e)){this.documentStates.unTrack(It.document,e);return}if(p.state===Gt.outDated)return;d!==void 0&&(d.kind===Jn.DocumentDiagnosticReportKind.full&&this.diagnostics.set(i,d.items),a.pulledVersion=t,a.resultId=d.resultId),p.state===Gt.reschedule&&this.pull(e)}else o.state===Gt.active?(o.tokenSource.cancel(),this.openRequests.set(s,{state:Gt.reschedule,document:o.document})):o.state===Gt.outDated&&this.openRequests.set(s,{state:Gt.reschedule,document:o.document})}forgetDocument(e){let t=e instanceof Pe.Uri?e:e.uri,n=t.toString(),i=this.openRequests.get(n);this.options.workspaceDiagnostics?i!==void 0?this.openRequests.set(n,{state:Gt.reschedule,document:e}):this.pull(e,()=>{this.forget(It.document,e)}):(i!==void 0&&(i.state===Gt.active&&i.tokenSource.cancel(),this.openRequests.set(n,{state:Gt.outDated,document:e})),this.diagnostics.delete(t),this.forget(It.document,e))}pullWorkspace(){this.isDisposed||this.pullWorkspaceAsync().then(()=>{this.workspaceTimeout=(0,bt.RAL)().timer.setTimeout(()=>{this.pullWorkspace()},2e3)},e=>{!(e instanceof bl.LSPCancellationError)&&!bt.DiagnosticServerCancellationData.is(e.data)&&(this.client.error("Workspace diagnostic pull failed.",e,!1),this.workspaceErrorCounter++),this.workspaceErrorCounter<=5&&(this.workspaceTimeout=(0,bt.RAL)().timer.setTimeout(()=>{this.pullWorkspace()},2e3))})}async pullWorkspaceAsync(){if(!this.provider.provideWorkspaceDiagnostics||this.isDisposed)return;this.workspaceCancellation!==void 0&&(this.workspaceCancellation.cancel(),this.workspaceCancellation=void 0),this.workspaceCancellation=new Pe.CancellationTokenSource;let e=this.documentStates.getAllResultIds().map(t=>({uri:this.client.protocol2CodeConverter.asUri(t.uri),value:t.value}));await this.provider.provideWorkspaceDiagnostics(e,this.workspaceCancellation.token,t=>{if(!(!t||this.isDisposed))for(let n of t.items)n.kind===Jn.DocumentDiagnosticReportKind.full&&(this.documentStates.tracks(It.document,n.uri)||this.diagnostics.set(n.uri,n.items)),this.documentStates.update(It.workspace,n.uri,n.version??void 0,n.resultId)})}createProvider(){let e={onDidChangeDiagnostics:this.onDidChangeDiagnosticsEmitter.event,provideDiagnostics:(t,n,i)=>{let s=(a,c,d)=>{let p={identifier:this.options.identifier,textDocument:{uri:this.client.code2ProtocolConverter.asUri(a instanceof Pe.Uri?a:a.uri)},previousResultId:c};return this.isDisposed===!0||!this.client.isRunning()?{kind:Jn.DocumentDiagnosticReportKind.full,items:[]}:this.client.sendRequest(bt.DocumentDiagnosticRequest.type,p,d).then(async v=>v==null||this.isDisposed||d.isCancellationRequested?{kind:Jn.DocumentDiagnosticReportKind.full,items:[]}:v.kind===bt.DocumentDiagnosticReportKind.Full?{kind:Jn.DocumentDiagnosticReportKind.full,resultId:v.resultId,items:await this.client.protocol2CodeConverter.asDiagnostics(v.items,d)}:{kind:Jn.DocumentDiagnosticReportKind.unChanged,resultId:v.resultId},v=>this.client.handleFailedRequest(bt.DocumentDiagnosticRequest.type,d,v,{kind:Jn.DocumentDiagnosticReportKind.full,items:[]}))},o=this.client.middleware;return o.provideDiagnostics?o.provideDiagnostics(t,n,i,s):s(t,n,i)}};return this.options.workspaceDiagnostics&&(e.provideWorkspaceDiagnostics=(t,n,i)=>{let s=async d=>d.kind===bt.DocumentDiagnosticReportKind.Full?{kind:Jn.DocumentDiagnosticReportKind.full,uri:this.client.protocol2CodeConverter.asUri(d.uri),resultId:d.resultId,version:d.version,items:await this.client.protocol2CodeConverter.asDiagnostics(d.items,n)}:{kind:Jn.DocumentDiagnosticReportKind.unChanged,uri:this.client.protocol2CodeConverter.asUri(d.uri),resultId:d.resultId,version:d.version},o=d=>{let p=[];for(let v of d)p.push({uri:this.client.code2ProtocolConverter.asUri(v.uri),value:v.value});return p},a=(d,p)=>{let v=(0,aT.generateUuid)(),m=this.client.onProgress(bt.WorkspaceDiagnosticRequest.partialResult,v,async b=>{if(b==null){i(null);return}let E={items:[]};for(let x of b.items)try{E.items.push(await s(x))}catch($){this.client.error("Converting workspace diagnostics failed.",$)}i(E)}),S={identifier:this.options.identifier,previousResultIds:o(d),partialResultToken:v};return this.isDisposed===!0||!this.client.isRunning()?{items:[]}:this.client.sendRequest(bt.WorkspaceDiagnosticRequest.type,S,p).then(async b=>{if(p.isCancellationRequested)return{items:[]};let E={items:[]};for(let x of b.items)E.items.push(await s(x));return m.dispose(),i(E),{items:[]}},b=>(m.dispose(),this.client.handleFailedRequest(bt.DocumentDiagnosticRequest.type,p,b,{items:[]})))},c=this.client.middleware;return c.provideWorkspaceDiagnostics?c.provideWorkspaceDiagnostics(t,n,i,a):a(t,n,i)}),e}dispose(){this.isDisposed=!0,this.workspaceCancellation?.cancel(),this.workspaceTimeout?.dispose();for(let[e,t]of this.openRequests)t.state===Gt.active&&t.tokenSource.cancel(),this.openRequests.set(e,{state:Gt.outDated,document:t.document});this.diagnostics.dispose()}},Sl=class{constructor(e){this.diagnosticRequestor=e,this.documents=new bt.LinkedMap,this.isDisposed=!1}add(e){if(this.isDisposed===!0)return;let t=Pr.asKey(e);this.documents.has(t)||(this.documents.set(t,e,bt.Touch.Last),this.trigger())}remove(e){let t=Pr.asKey(e);this.documents.delete(t),this.documents.size===0?this.stop():t===this.endDocumentKey()&&(this.endDocument=this.documents.last)}trigger(){if(this.isDisposed!==!0){if(this.intervalHandle!==void 0){this.endDocument=this.documents.last;return}this.endDocument=this.documents.last,this.intervalHandle=(0,bt.RAL)().timer.setInterval(()=>{let e=this.documents.first;if(e!==void 0){let t=Pr.asKey(e);this.diagnosticRequestor.pull(e),this.documents.set(t,e,bt.Touch.Last),t===this.endDocumentKey()&&this.stop()}},200)}}dispose(){this.isDisposed=!0,this.stop(),this.documents.clear()}stop(){this.intervalHandle?.dispose(),this.intervalHandle=void 0,this.endDocument=void 0}endDocumentKey(){return this.endDocument!==void 0?Pr.asKey(this.endDocument):void 0}},_l=class{constructor(e,t,n){let i=e.clientOptions.diagnosticPullOptions??{onChange:!0,onSave:!1},s=e.protocol2CodeConverter.asDocumentSelector(n.documentSelector),o=[],a=b=>{let E=n.documentSelector;if(i.match!==void 0)return i.match(E,b);for(let x of E)if(bt.TextDocumentFilter.is(x)){if(typeof x=="string"||x.language!==void 0&&x.language!=="*"||x.scheme!==void 0&&x.scheme!=="*"&&x.scheme!==b.scheme)return!1;if(x.pattern!==void 0){let $=new oT.Minimatch(x.pattern,{noext:!0});if(!$.makeRe()||!$.match(b.fsPath))return!1}}return!0},c=b=>b instanceof Pe.Uri?a(b):Pe.languages.match(s,b)>0&&t.isVisible(b),d=b=>b instanceof Pe.Uri?this.activeTextDocument?.uri.toString()===b.toString():this.activeTextDocument===b;this.diagnosticRequestor=new Rl(e,t,n),this.backgroundScheduler=new Sl(this.diagnosticRequestor);let p=b=>{!c(b)||!n.interFileDependencies||d(b)||this.backgroundScheduler.add(b)};this.activeTextDocument=Pe.window.activeTextEditor?.document,Pe.window.onDidChangeActiveTextEditor(b=>{let E=this.activeTextDocument;this.activeTextDocument=b?.document,E!==void 0&&p(E),this.activeTextDocument!==void 0&&this.backgroundScheduler.remove(this.activeTextDocument)});let v=e.getFeature(bt.DidOpenTextDocumentNotification.method);o.push(v.onNotificationSent(b=>{let E=b.textDocument;this.diagnosticRequestor.knows(It.document,E)||c(E)&&this.diagnosticRequestor.pull(E,()=>{p(E)})})),o.push(t.onOpen(b=>{for(let E of b){if(this.diagnosticRequestor.knows(It.document,E))continue;let x=E.toString(),$;for(let U of Pe.workspace.textDocuments)if(x===U.uri.toString()){$=U;break}$!==void 0&&c($)&&this.diagnosticRequestor.pull($,()=>{p($)})}}));let m=new Set;for(let b of Pe.workspace.textDocuments)c(b)&&(this.diagnosticRequestor.pull(b,()=>{p(b)}),m.add(b.uri.toString()));if(i.onTabs===!0)for(let b of t.getTabResources())!m.has(b.toString())&&c(b)&&this.diagnosticRequestor.pull(b,()=>{p(b)});if(i.onChange===!0){let b=e.getFeature(bt.DidChangeTextDocumentNotification.method);o.push(b.onNotificationSent(async E=>{let x=E.textDocument;(i.filter===void 0||!i.filter(x,la.onType))&&this.diagnosticRequestor.knows(It.document,x)&&this.diagnosticRequestor.pull(x,()=>{this.backgroundScheduler.trigger()})}))}if(i.onSave===!0){let b=e.getFeature(bt.DidSaveTextDocumentNotification.method);o.push(b.onNotificationSent(E=>{let x=E.textDocument;(i.filter===void 0||!i.filter(x,la.onSave))&&this.diagnosticRequestor.knows(It.document,x)&&this.diagnosticRequestor.pull(E.textDocument,()=>{this.backgroundScheduler.trigger()})}))}let S=e.getFeature(bt.DidCloseTextDocumentNotification.method);o.push(S.onNotificationSent(b=>{this.cleanUpDocument(b.textDocument)})),t.onClose(b=>{for(let E of b)this.cleanUpDocument(E)}),this.diagnosticRequestor.onDidChangeDiagnosticsEmitter.event(()=>{for(let b of Pe.workspace.textDocuments)c(b)&&this.diagnosticRequestor.pull(b)}),n.workspaceDiagnostics===!0&&n.identifier!=="da348dc5-c30a-4515-9d98-31ff3be38d14"&&this.diagnosticRequestor.pullWorkspace(),this.disposable=Pe.Disposable.from(...o,this.backgroundScheduler,this.diagnosticRequestor)}get onDidChangeDiagnosticsEmitter(){return this.diagnosticRequestor.onDidChangeDiagnosticsEmitter}get diagnostics(){return this.diagnosticRequestor.provider}cleanUpDocument(e){this.diagnosticRequestor.knows(It.document,e)&&(this.diagnosticRequestor.forgetDocument(e),this.backgroundScheduler.remove(e))}},Tl=class extends bl.TextDocumentLanguageFeature{constructor(e){super(e,bt.DocumentDiagnosticRequest.type)}fillClientCapabilities(e){let t=da(da(e,"textDocument"),"diagnostic");t.dynamicRegistration=!0,t.relatedDocumentSupport=!1,da(da(e,"workspace"),"diagnostics").refreshSupport=!0}initialize(e,t){this._client.onRequest(bt.DiagnosticRefreshRequest.type,async()=>{for(let o of this.getAllProviders())o.onDidChangeDiagnosticsEmitter.fire()});let[i,s]=this.getRegistration(t,e.diagnosticProvider);!i||!s||this.register({id:i,registerOptions:s})}clear(){this.tabs!==void 0&&(this.tabs.dispose(),this.tabs=void 0),super.clear()}registerLanguageProvider(e){this.tabs===void 0&&(this.tabs=new wl);let t=new _l(this._client,this.tabs,e);return[t.disposable,t]}};Br.DiagnosticFeature=Tl});var kb=I(ga=>{"use strict";Object.defineProperty(ga,"__esModule",{value:!0});ga.NotebookDocumentSyncFeature=void 0;var Jt=require("vscode"),cT=ua(),kr=me(),uT=at(),Db=Vn();function Pb(r,e){return r[e]===void 0&&(r[e]={}),r[e]}var Gi;(function(r){let e;(function(t){function n(m,S){return{version:m.version,uri:S.asUri(m.uri)}}t.asVersionedNotebookDocumentIdentifier=n;function i(m,S,b){let E=kr.NotebookDocument.create(b.asUri(m.uri),m.notebookType,m.version,s(S,b));return Object.keys(m.metadata).length>0&&(E.metadata=o(m.metadata)),E}t.asNotebookDocument=i;function s(m,S){return m.map(b=>a(b,S))}t.asNotebookCells=s;function o(m){return d(new Set,m)}t.asMetadata=o;function a(m,S){let b=kr.NotebookCell.create(c(m.kind),S.asUri(m.document.uri));return Object.keys(m.metadata).length>0&&(b.metadata=o(m.metadata)),m.executionSummary!==void 0&&Db.number(m.executionSummary.executionOrder)&&Db.boolean(m.executionSummary.success)&&(b.executionSummary={executionOrder:m.executionSummary.executionOrder,success:m.executionSummary.success}),b}t.asNotebookCell=a;function c(m){switch(m){case Jt.NotebookCellKind.Markup:return kr.NotebookCellKind.Markup;case Jt.NotebookCellKind.Code:return kr.NotebookCellKind.Code}}function d(m,S){if(m.has(S))throw new Error("Can't deep copy cyclic structures.");if(Array.isArray(S)){let b=[];for(let E of S)if(E!==null&&typeof E=="object"||Array.isArray(E))b.push(d(m,E));else{if(E instanceof RegExp)throw new Error("Can't transfer regular expressions to the server");b.push(E)}return b}else{let b=Object.keys(S),E=Object.create(null);for(let x of b){let $=S[x];if($!==null&&typeof $=="object"||Array.isArray($))E[x]=d(m,$);else{if($ instanceof RegExp)throw new Error("Can't transfer regular expressions to the server");E[x]=$}}return E}}function p(m,S){let b=S.asChangeTextDocumentParams(m,m.document.uri,m.document.version);return{document:b.textDocument,changes:b.contentChanges}}t.asTextContentChange=p;function v(m,S){let b=Object.create(null);if(m.metadata&&(b.metadata=r.c2p.asMetadata(m.metadata)),m.cells!==void 0){let E=Object.create(null),x=m.cells;x.structure&&(E.structure={array:{start:x.structure.array.start,deleteCount:x.structure.array.deleteCount,cells:x.structure.array.cells!==void 0?x.structure.array.cells.map($=>r.c2p.asNotebookCell($,S)):void 0},didOpen:x.structure.didOpen!==void 0?x.structure.didOpen.map($=>S.asOpenTextDocumentParams($.document).textDocument):void 0,didClose:x.structure.didClose!==void 0?x.structure.didClose.map($=>S.asCloseTextDocumentParams($.document).textDocument):void 0}),x.data!==void 0&&(E.data=x.data.map($=>r.c2p.asNotebookCell($,S))),x.textContent!==void 0&&(E.textContent=x.textContent.map($=>r.c2p.asTextContentChange($,S))),Object.keys(E).length>0&&(b.cells=E)}return b}t.asNotebookDocumentChangeEvent=v})(e=r.c2p||(r.c2p={}))})(Gi||(Gi={}));var Pl;(function(r){function e(a,c,d){let p=a.length,v=c.length,m=0;for(;m<v&&m<p&&t(a[m],c[m],d);)m++;if(m<v&&m<p){let S=p-1,b=v-1;for(;S>=0&&b>=0&&t(a[S],c[b],d);)S--,b--;let E=S+1-m,x=m===b+1?void 0:c.slice(m,b+1);return x!==void 0?{start:m,deleteCount:E,cells:x}:{start:m,deleteCount:E}}else return m<v?{start:m,deleteCount:0,cells:c.slice(m)}:m<p?{start:m,deleteCount:p-m}:void 0}r.computeDiff=e;function t(a,c,d=!0){return a.kind!==c.kind||a.document.uri.toString()!==c.document.uri.toString()||a.document.languageId!==c.document.languageId||!n(a.executionSummary,c.executionSummary)?!1:!d||d&&s(a.metadata,c.metadata)}function n(a,c){return a===c?!0:a===void 0||c===void 0?!1:a.executionOrder===c.executionOrder&&a.success===c.success&&i(a.timing,c.timing)}function i(a,c){return a===c?!0:a===void 0||c===void 0?!1:a.startTime===c.startTime&&a.endTime===c.endTime}function s(a,c){if(a===c)return!0;if(a==null||c===null||c===void 0||typeof a!=typeof c||typeof a!="object")return!1;let d=Array.isArray(a),p=Array.isArray(c);if(d!==p)return!1;if(d&&p){if(a.length!==c.length)return!1;for(let v=0;v<a.length;v++)if(!s(a[v],c[v]))return!1}if(o(a)&&o(c)){let v=Object.keys(a),m=Object.keys(c);if(v.length!==m.length||(v.sort(),m.sort(),!s(v,m)))return!1;for(let S=0;S<v.length;S++){let b=v[S];if(!s(a[b],c[b]))return!1}return!0}return!1}function o(a){return a!==null&&typeof a=="object"}r.isObjectLiteral=o})(Pl||(Pl={}));var kl;(function(r){function e(t,n){if(typeof t=="string")return t==="*"||n.notebookType===t;if(t.notebookType!==void 0&&t.notebookType!=="*"&&n.notebookType!==t.notebookType)return!1;let i=n.uri;if(t.scheme!==void 0&&t.scheme!=="*"&&i.scheme!==t.scheme)return!1;if(t.pattern!==void 0){let s=new cT.Minimatch(t.pattern,{noext:!0});if(!s.makeRe()||!s.match(i.fsPath))return!1}return!0}r.matchNotebook=e})(kl||(kl={}));var fa;(function(r){function e(n){let i=n.notebookSelector,s=[];for(let o of i){let a=(typeof o.notebook=="string"?o.notebook:o.notebook?.notebookType)??"*",c=typeof o.notebook=="string"?void 0:o.notebook?.scheme,d=typeof o.notebook=="string"?void 0:o.notebook?.pattern;if(o.cells!==void 0)for(let p of o.cells)s.push(t(a,c,d,p.language));else s.push(t(a,c,d,void 0))}return s}r.asDocumentSelector=e;function t(n,i,s,o){return i===void 0&&s===void 0?{notebook:n,language:o}:{notebook:{notebookType:n,scheme:i,pattern:s},language:o}}})(fa||(fa={}));var ha;(function(r){function e(t){return{cells:t,uris:new Set(t.map(n=>n.document.uri.toString()))}}r.create=e})(ha||(ha={}));var Ji=class{constructor(e,t){this.client=e,this.options=t,this.notebookSyncInfo=new Map,this.notebookDidOpen=new Set,this.disposables=[],this.selector=e.protocol2CodeConverter.asDocumentSelector(fa.asDocumentSelector(t)),Jt.workspace.onDidOpenNotebookDocument(n=>{this.notebookDidOpen.add(n.uri.toString()),this.didOpen(n)},void 0,this.disposables);for(let n of Jt.workspace.notebookDocuments)this.notebookDidOpen.add(n.uri.toString()),this.didOpen(n);Jt.workspace.onDidChangeNotebookDocument(n=>this.didChangeNotebookDocument(n),void 0,this.disposables),this.options.save===!0&&Jt.workspace.onDidSaveNotebookDocument(n=>this.didSave(n),void 0,this.disposables),Jt.workspace.onDidCloseNotebookDocument(n=>{this.didClose(n),this.notebookDidOpen.delete(n.uri.toString())},void 0,this.disposables)}getState(){for(let e of Jt.workspace.notebookDocuments)if(this.getMatchingCells(e)!==void 0)return{kind:"document",id:"$internal",registrations:!0,matches:!0};return{kind:"document",id:"$internal",registrations:!0,matches:!1}}get mode(){return"notebook"}handles(e){return Jt.languages.match(this.selector,e)>0}didOpenNotebookCellTextDocument(e,t){if(Jt.languages.match(this.selector,t.document)===0||!this.notebookDidOpen.has(e.uri.toString()))return;let n=this.notebookSyncInfo.get(e.uri.toString()),i=this.cellMatches(e,t);if(n!==void 0){let s=n.uris.has(t.document.uri.toString());if(i&&s||!i&&!s)return;if(i){let o=this.getMatchingCells(e);if(o!==void 0){let a=this.asNotebookDocumentChangeEvent(e,void 0,n,o);a!==void 0&&this.doSendChange(a,o).catch(()=>{})}}}else i&&this.doSendOpen(e,[t]).catch(()=>{})}didChangeNotebookCellTextDocument(e,t){Jt.languages.match(this.selector,t.document)!==0&&this.doSendChange({notebook:e,cells:{textContent:[t]}},void 0).catch(()=>{})}didCloseNotebookCellTextDocument(e,t){let n=this.notebookSyncInfo.get(e.uri.toString());if(n===void 0)return;let i=t.document.uri,s=n.cells.findIndex(o=>o.document.uri.toString()===i.toString());if(s!==-1)if(s===0&&n.cells.length===1)this.doSendClose(e,n.cells).catch(()=>{});else{let o=n.cells.slice(),a=o.splice(s,1);this.doSendChange({notebook:e,cells:{structure:{array:{start:s,deleteCount:1},didClose:a}}},o).catch(()=>{})}}dispose(){for(let e of this.disposables)e.dispose()}didOpen(e,t=this.getMatchingCells(e),n=this.notebookSyncInfo.get(e.uri.toString())){if(n!==void 0)if(t!==void 0){let i=this.asNotebookDocumentChangeEvent(e,void 0,n,t);i!==void 0&&this.doSendChange(i,t).catch(()=>{})}else this.doSendClose(e,[]).catch(()=>{});else{if(t===void 0)return;this.doSendOpen(e,t).catch(()=>{})}}didChangeNotebookDocument(e){let t=e.notebook,n=this.notebookSyncInfo.get(t.uri.toString());if(n===void 0){if(e.contentChanges.length===0)return;let i=this.getMatchingCells(t);if(i===void 0)return;this.didOpen(t,i,n)}else{let i=this.getMatchingCells(t);if(i===void 0){this.didClose(t,n);return}let s=this.asNotebookDocumentChangeEvent(e.notebook,e,n,i);s!==void 0&&this.doSendChange(s,i).catch(()=>{})}}didSave(e){this.notebookSyncInfo.get(e.uri.toString())!==void 0&&this.doSendSave(e).catch(()=>{})}didClose(e,t=this.notebookSyncInfo.get(e.uri.toString())){if(t===void 0)return;let n=e.getCells().filter(i=>t.uris.has(i.document.uri.toString()));this.doSendClose(e,n).catch(()=>{})}async sendDidOpenNotebookDocument(e){let t=this.getMatchingCells(e);if(t!==void 0)return this.doSendOpen(e,t)}async doSendOpen(e,t){let n=async(s,o)=>{let a=Gi.c2p.asNotebookDocument(s,o,this.client.code2ProtocolConverter),c=o.map(d=>this.client.code2ProtocolConverter.asTextDocumentItem(d.document));try{await this.client.sendNotification(kr.DidOpenNotebookDocumentNotification.type,{notebookDocument:a,cellTextDocuments:c})}catch(d){throw this.client.error("Sending DidOpenNotebookDocumentNotification failed",d),d}},i=this.client.middleware?.notebooks;return this.notebookSyncInfo.set(e.uri.toString(),ha.create(t)),i?.didOpen!==void 0?i.didOpen(e,t,n):n(e,t)}async sendDidChangeNotebookDocument(e){return this.doSendChange(e,void 0)}async doSendChange(e,t=this.getMatchingCells(e.notebook)){let n=async s=>{try{await this.client.sendNotification(kr.DidChangeNotebookDocumentNotification.type,{notebookDocument:Gi.c2p.asVersionedNotebookDocumentIdentifier(s.notebook,this.client.code2ProtocolConverter),change:Gi.c2p.asNotebookDocumentChangeEvent(s,this.client.code2ProtocolConverter)})}catch(o){throw this.client.error("Sending DidChangeNotebookDocumentNotification failed",o),o}},i=this.client.middleware?.notebooks;return e.cells?.structure!==void 0&&this.notebookSyncInfo.set(e.notebook.uri.toString(),ha.create(t??[])),i?.didChange!==void 0?i?.didChange(e,n):n(e)}async sendDidSaveNotebookDocument(e){return this.doSendSave(e)}async doSendSave(e){let t=async i=>{try{await this.client.sendNotification(kr.DidSaveNotebookDocumentNotification.type,{notebookDocument:{uri:this.client.code2ProtocolConverter.asUri(i.uri)}})}catch(s){throw this.client.error("Sending DidSaveNotebookDocumentNotification failed",s),s}},n=this.client.middleware?.notebooks;return n?.didSave!==void 0?n.didSave(e,t):t(e)}async sendDidCloseNotebookDocument(e){return this.doSendClose(e,this.getMatchingCells(e)??[])}async doSendClose(e,t){let n=async(s,o)=>{try{await this.client.sendNotification(kr.DidCloseNotebookDocumentNotification.type,{notebookDocument:{uri:this.client.code2ProtocolConverter.asUri(s.uri)},cellTextDocuments:o.map(a=>this.client.code2ProtocolConverter.asTextDocumentIdentifier(a.document))})}catch(a){throw this.client.error("Sending DidCloseNotebookDocumentNotification failed",a),a}},i=this.client.middleware?.notebooks;return this.notebookSyncInfo.delete(e.uri.toString()),i?.didClose!==void 0?i.didClose(e,t,n):n(e,t)}asNotebookDocumentChangeEvent(e,t,n,i){if(t!==void 0&&t.notebook!==e)throw new Error("Notebook must be identical");let s={notebook:e};t?.metadata!==void 0&&(s.metadata=Gi.c2p.asMetadata(t.metadata));let o;if(t?.cellChanges!==void 0&&t.cellChanges.length>0){let a=[];o=new Set(i.map(c=>c.document.uri.toString()));for(let c of t.cellChanges)o.has(c.cell.document.uri.toString())&&(c.executionSummary!==void 0||c.metadata!==void 0)&&a.push(c.cell);a.length>0&&(s.cells=s.cells??{},s.cells.data=a)}if((t?.contentChanges!==void 0&&t.contentChanges.length>0||t===void 0)&&n!==void 0&&i!==void 0){let a=n.cells,c=i,d=Pl.computeDiff(a,c,!1),p,v;if(d!==void 0){p=d.cells===void 0?new Map:new Map(d.cells.map(b=>[b.document.uri.toString(),b])),v=d.deleteCount===0?new Map:new Map(a.slice(d.start,d.start+d.deleteCount).map(b=>[b.document.uri.toString(),b]));for(let b of Array.from(v.keys()))p.has(b)&&(v.delete(b),p.delete(b));s.cells=s.cells??{};let m=[],S=[];if(p.size>0||v.size>0){for(let b of p.values())m.push(b);for(let b of v.values())S.push(b)}s.cells.structure={array:d,didOpen:m,didClose:S}}}return Object.keys(s).length>1?s:void 0}getMatchingCells(e,t=e.getCells()){if(this.options.notebookSelector!==void 0){for(let n of this.options.notebookSelector)if(n.notebook===void 0||kl.matchNotebook(n.notebook,e)){let i=this.filterCells(e,t,n.cells);return i.length===0?void 0:i}}}cellMatches(e,t){let n=this.getMatchingCells(e,[t]);return n!==void 0&&n[0]===t}filterCells(e,t,n){let i=n!==void 0?t.filter(s=>{let o=s.document.languageId;return n.some(a=>a.language==="*"||o===a.language)}):t;return typeof this.client.clientOptions.notebookDocumentOptions?.filterCells=="function"?this.client.clientOptions.notebookDocumentOptions.filterCells(e,i):i}},pa=class r{constructor(e){this.client=e,this.registrations=new Map,this.registrationType=kr.NotebookDocumentSyncRegistrationType.type,Jt.workspace.onDidOpenTextDocument(t=>{if(t.uri.scheme!==r.CellScheme)return;let[n,i]=this.findNotebookDocumentAndCell(t);if(!(n===void 0||i===void 0))for(let s of this.registrations.values())s instanceof Ji&&s.didOpenNotebookCellTextDocument(n,i)}),Jt.workspace.onDidChangeTextDocument(t=>{if(t.contentChanges.length===0)return;let n=t.document;if(n.uri.scheme!==r.CellScheme)return;let[i]=this.findNotebookDocumentAndCell(n);if(i!==void 0)for(let s of this.registrations.values())s instanceof Ji&&s.didChangeNotebookCellTextDocument(i,t)}),Jt.workspace.onDidCloseTextDocument(t=>{if(t.uri.scheme!==r.CellScheme)return;let[n,i]=this.findNotebookDocumentAndCell(t);if(!(n===void 0||i===void 0))for(let s of this.registrations.values())s instanceof Ji&&s.didCloseNotebookCellTextDocument(n,i)})}getState(){if(this.registrations.size===0)return{kind:"document",id:this.registrationType.method,registrations:!1,matches:!1};for(let e of this.registrations.values()){let t=e.getState();if(t.kind==="document"&&t.registrations===!0&&t.matches===!0)return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!0}}return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!1}}fillClientCapabilities(e){let t=Pb(Pb(e,"notebookDocument"),"synchronization");t.dynamicRegistration=!0,t.executionSummarySupport=!0}preInitialize(e){let t=e.notebookDocumentSync;t!==void 0&&(this.dedicatedChannel=this.client.protocol2CodeConverter.asDocumentSelector(fa.asDocumentSelector(t)))}initialize(e){let t=e.notebookDocumentSync;if(t===void 0)return;let n=t.id??uT.generateUuid();this.register({id:n,registerOptions:t})}register(e){let t=new Ji(this.client,e.registerOptions);this.registrations.set(e.id,t)}unregister(e){let t=this.registrations.get(e);t&&t.dispose()}clear(){for(let e of this.registrations.values())e.dispose();this.registrations.clear()}handles(e){if(e.uri.scheme!==r.CellScheme)return!1;if(this.dedicatedChannel!==void 0&&Jt.languages.match(this.dedicatedChannel,e)>0)return!0;for(let t of this.registrations.values())if(t.handles(e))return!0;return!1}getProvider(e){for(let t of this.registrations.values())if(t.handles(e.document))return t}findNotebookDocumentAndCell(e){let t=e.uri.toString();for(let n of Jt.workspace.notebookDocuments)for(let i of n.getCells())if(i.document.uri.toString()===t)return[n,i];return[void 0,void 0]}};ga.NotebookDocumentSyncFeature=pa;pa.CellScheme="vscode-notebook-cell"});var xb=I(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.SyncConfigurationFeature=Gr.toJSONObject=Gr.ConfigurationFeature=void 0;var Xi=require("vscode"),Fs=me(),dT=Vn(),lT=at(),Eb=Ie(),El=class{constructor(e){this._client=e}getState(){return{kind:"static"}}fillClientCapabilities(e){e.workspace=e.workspace||{},e.workspace.configuration=!0}initialize(){let e=this._client;e.onRequest(Fs.ConfigurationRequest.type,(t,n)=>{let i=o=>{let a=[];for(let c of o.items){let d=c.scopeUri!==void 0&&c.scopeUri!==null?this._client.protocol2CodeConverter.asUri(c.scopeUri):void 0;a.push(this.getConfiguration(d,c.section!==null?c.section:void 0))}return a},s=e.middleware.workspace;return s&&s.configuration?s.configuration(t,n,i):i(t,n)})}getConfiguration(e,t){let n=null;if(t){let i=t.lastIndexOf(".");if(i===-1)n=hi(Xi.workspace.getConfiguration(void 0,e).get(t));else{let s=Xi.workspace.getConfiguration(t.substr(0,i),e);s&&(n=hi(s.get(t.substr(i+1))))}}else{let i=Xi.workspace.getConfiguration(void 0,e);n={};for(let s of Object.keys(i))i.has(s)&&(n[s]=hi(i.get(s)))}return n===void 0&&(n=null),n}clear(){}};Gr.ConfigurationFeature=El;function hi(r){if(r){if(Array.isArray(r))return r.map(hi);if(typeof r=="object"){let e=Object.create(null);for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=hi(r[t]));return e}}return r}Gr.toJSONObject=hi;var xl=class{constructor(e){this._client=e,this.isCleared=!1,this._listeners=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._listeners.size>0}}get registrationType(){return Fs.DidChangeConfigurationNotification.type}fillClientCapabilities(e){(0,Eb.ensure)((0,Eb.ensure)(e,"workspace"),"didChangeConfiguration").dynamicRegistration=!0}initialize(){this.isCleared=!1;let e=this._client.clientOptions.synchronize?.configurationSection;e!==void 0&&this.register({id:lT.generateUuid(),registerOptions:{section:e}})}register(e){let t=Xi.workspace.onDidChangeConfiguration(n=>{this.onDidChangeConfiguration(e.registerOptions.section,n)});this._listeners.set(e.id,t),e.registerOptions.section!==void 0&&this.onDidChangeConfiguration(e.registerOptions.section,void 0)}unregister(e){let t=this._listeners.get(e);t&&(this._listeners.delete(e),t.dispose())}clear(){for(let e of this._listeners.values())e.dispose();this._listeners.clear(),this.isCleared=!0}onDidChangeConfiguration(e,t){if(this.isCleared)return;let n;if(dT.string(e)?n=[e]:n=e,n!==void 0&&t!==void 0&&!n.some(a=>t.affectsConfiguration(a)))return;let i=async o=>o===void 0?this._client.sendNotification(Fs.DidChangeConfigurationNotification.type,{settings:null}):this._client.sendNotification(Fs.DidChangeConfigurationNotification.type,{settings:this.extractSettingsInformation(o)}),s=this._client.middleware.workspace?.didChangeConfiguration;(s?s(n,i):i(n)).catch(o=>{this._client.error(`Sending notification ${Fs.DidChangeConfigurationNotification.type.method} failed`,o)})}extractSettingsInformation(e){function t(s,o){let a=s;for(let c=0;c<o.length-1;c++){let d=a[o[c]];d||(d=Object.create(null),a[o[c]]=d),a=d}return a}let n=this._client.clientOptions.workspaceFolder?this._client.clientOptions.workspaceFolder.uri:void 0,i=Object.create(null);for(let s=0;s<e.length;s++){let o=e[s],a=o.indexOf("."),c=null;if(a>=0?c=Xi.workspace.getConfiguration(o.substr(0,a),n).get(o.substr(a+1)):c=Xi.workspace.getConfiguration(void 0,n).get(o),c){let d=e[s].split(".");t(i,d)[d[d.length-1]]=hi(c)}}return i}};Gr.SyncConfigurationFeature=xl});var Ib=I(ln=>{"use strict";Object.defineProperty(ln,"__esModule",{value:!0});ln.DidSaveTextDocumentFeature=ln.WillSaveWaitUntilFeature=ln.WillSaveFeature=ln.DidChangeTextDocumentFeature=ln.DidCloseTextDocumentFeature=ln.DidOpenTextDocumentFeature=void 0;var In=require("vscode"),Je=me(),lt=Ie(),Qi=at(),Il=class extends lt.TextDocumentEventFeature{constructor(e,t){super(e,In.workspace.onDidOpenTextDocument,Je.DidOpenTextDocumentNotification.type,()=>e.middleware.didOpen,n=>e.code2ProtocolConverter.asOpenTextDocumentParams(n),n=>n,lt.TextDocumentEventFeature.textDocumentFilter),this._syncedDocuments=t}get openDocuments(){return this._syncedDocuments.values()}fillClientCapabilities(e){(0,lt.ensure)((0,lt.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.openClose&&this.register({id:Qi.generateUuid(),registerOptions:{documentSelector:t}})}get registrationType(){return Je.DidOpenTextDocumentNotification.type}register(e){if(super.register(e),!e.registerOptions.documentSelector)return;let t=this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector);In.workspace.textDocuments.forEach(n=>{let i=n.uri.toString();if(!this._syncedDocuments.has(i)&&In.languages.match(t,n)>0&&!this._client.hasDedicatedTextSynchronizationFeature(n)){let s=this._client.middleware,o=a=>this._client.sendNotification(this._type,this._createParams(a));(s.didOpen?s.didOpen(n,o):o(n)).catch(a=>{this._client.error(`Sending document notification ${this._type.method} failed`,a)}),this._syncedDocuments.set(i,n)}})}getTextDocument(e){return e}notificationSent(e,t,n){this._syncedDocuments.set(e.uri.toString(),e),super.notificationSent(e,t,n)}};ln.DidOpenTextDocumentFeature=Il;var ql=class extends lt.TextDocumentEventFeature{constructor(e,t,n){super(e,In.workspace.onDidCloseTextDocument,Je.DidCloseTextDocumentNotification.type,()=>e.middleware.didClose,i=>e.code2ProtocolConverter.asCloseTextDocumentParams(i),i=>i,lt.TextDocumentEventFeature.textDocumentFilter),this._syncedDocuments=t,this._pendingTextDocumentChanges=n}get registrationType(){return Je.DidCloseTextDocumentNotification.type}fillClientCapabilities(e){(0,lt.ensure)((0,lt.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.openClose&&this.register({id:Qi.generateUuid(),registerOptions:{documentSelector:t}})}async callback(e){await super.callback(e),this._pendingTextDocumentChanges.delete(e.uri.toString())}getTextDocument(e){return e}notificationSent(e,t,n){this._syncedDocuments.delete(e.uri.toString()),super.notificationSent(e,t,n)}unregister(e){let t=this._selectors.get(e);super.unregister(e);let n=this._selectors.values();this._syncedDocuments.forEach(i=>{if(In.languages.match(t,i)>0&&!this._selectorFilter(n,i)&&!this._client.hasDedicatedTextSynchronizationFeature(i)){let s=this._client.middleware,o=a=>this._client.sendNotification(this._type,this._createParams(a));this._syncedDocuments.delete(i.uri.toString()),(s.didClose?s.didClose(i,o):o(i)).catch(a=>{this._client.error(`Sending document notification ${this._type.method} failed`,a)})}})}};ln.DidCloseTextDocumentFeature=ql;var Ol=class extends lt.DynamicDocumentFeature{constructor(e,t){super(e),this._changeData=new Map,this._onNotificationSent=new In.EventEmitter,this._onPendingChangeAdded=new In.EventEmitter,this._pendingTextDocumentChanges=t,this._syncKind=Je.TextDocumentSyncKind.None}get onNotificationSent(){return this._onNotificationSent.event}get onPendingChangeAdded(){return this._onPendingChangeAdded.event}get syncKind(){return this._syncKind}get registrationType(){return Je.DidChangeTextDocumentNotification.type}fillClientCapabilities(e){(0,lt.ensure)((0,lt.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.change!==void 0&&n.change!==Je.TextDocumentSyncKind.None&&this.register({id:Qi.generateUuid(),registerOptions:Object.assign({},{documentSelector:t},{syncKind:n.change})})}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=In.workspace.onDidChangeTextDocument(this.callback,this)),this._changeData.set(e.id,{syncKind:e.registerOptions.syncKind,documentSelector:this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)}),this.updateSyncKind(e.registerOptions.syncKind))}*getDocumentSelectors(){for(let e of this._changeData.values())yield e.documentSelector}async callback(e){if(e.contentChanges.length===0)return;let t=e.document.uri,n=e.document.version,i=[];for(let s of this._changeData.values())if(In.languages.match(s.documentSelector,e.document)>0&&!this._client.hasDedicatedTextSynchronizationFeature(e.document)){let o=this._client.middleware;if(s.syncKind===Je.TextDocumentSyncKind.Incremental){let a=async c=>{let d=this._client.code2ProtocolConverter.asChangeTextDocumentParams(c,t,n);await this._client.sendNotification(Je.DidChangeTextDocumentNotification.type,d),this.notificationSent(c.document,Je.DidChangeTextDocumentNotification.type,d)};i.push(o.didChange?o.didChange(e,c=>a(c)):a(e))}else if(s.syncKind===Je.TextDocumentSyncKind.Full){let a=async c=>{let d=c.document.uri.toString();this._pendingTextDocumentChanges.set(d,c.document),this._onPendingChangeAdded.fire()};i.push(o.didChange?o.didChange(e,c=>a(c)):a(e))}}return Promise.all(i).then(void 0,s=>{throw this._client.error(`Sending document notification ${Je.DidChangeTextDocumentNotification.type.method} failed`,s),s})}notificationSent(e,t,n){this._onNotificationSent.fire({textDocument:e,type:t,params:n})}unregister(e){if(this._changeData.delete(e),this._changeData.size===0)this._listener&&(this._listener.dispose(),this._listener=void 0),this._syncKind=Je.TextDocumentSyncKind.None;else{this._syncKind=Je.TextDocumentSyncKind.None;for(let t of this._changeData.values())if(this.updateSyncKind(t.syncKind),this._syncKind===Je.TextDocumentSyncKind.Full)break}}clear(){this._pendingTextDocumentChanges.clear(),this._changeData.clear(),this._syncKind=Je.TextDocumentSyncKind.None,this._listener&&(this._listener.dispose(),this._listener=void 0)}getPendingDocumentChanges(e){if(this._pendingTextDocumentChanges.size===0)return[];let t;if(e.size===0)t=Array.from(this._pendingTextDocumentChanges.values()),this._pendingTextDocumentChanges.clear();else{t=[];for(let n of this._pendingTextDocumentChanges)e.has(n[0])||(t.push(n[1]),this._pendingTextDocumentChanges.delete(n[0]))}return t}getProvider(e){for(let t of this._changeData.values())if(In.languages.match(t.documentSelector,e)>0)return{send:n=>this.callback(n)}}updateSyncKind(e){if(this._syncKind!==Je.TextDocumentSyncKind.Full)switch(e){case Je.TextDocumentSyncKind.Full:this._syncKind=e;break;case Je.TextDocumentSyncKind.Incremental:this._syncKind===Je.TextDocumentSyncKind.None&&(this._syncKind=Je.TextDocumentSyncKind.Incremental);break}}};ln.DidChangeTextDocumentFeature=Ol;var Fl=class extends lt.TextDocumentEventFeature{constructor(e){super(e,In.workspace.onWillSaveTextDocument,Je.WillSaveTextDocumentNotification.type,()=>e.middleware.willSave,t=>e.code2ProtocolConverter.asWillSaveTextDocumentParams(t),t=>t.document,(t,n)=>lt.TextDocumentEventFeature.textDocumentFilter(t,n.document))}get registrationType(){return Je.WillSaveTextDocumentNotification.type}fillClientCapabilities(e){let t=(0,lt.ensure)((0,lt.ensure)(e,"textDocument"),"synchronization");t.willSave=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.willSave&&this.register({id:Qi.generateUuid(),registerOptions:{documentSelector:t}})}getTextDocument(e){return e.document}};ln.WillSaveFeature=Fl;var Ll=class extends lt.DynamicDocumentFeature{constructor(e){super(e),this._selectors=new Map}getDocumentSelectors(){return this._selectors.values()}get registrationType(){return Je.WillSaveTextDocumentWaitUntilRequest.type}fillClientCapabilities(e){let t=(0,lt.ensure)((0,lt.ensure)(e,"textDocument"),"synchronization");t.willSaveWaitUntil=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.willSaveWaitUntil&&this.register({id:Qi.generateUuid(),registerOptions:{documentSelector:t}})}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=In.workspace.onWillSaveTextDocument(this.callback,this)),this._selectors.set(e.id,this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)))}callback(e){if(lt.TextDocumentEventFeature.textDocumentFilter(this._selectors.values(),e.document)&&!this._client.hasDedicatedTextSynchronizationFeature(e.document)){let t=this._client.middleware,n=i=>this._client.sendRequest(Je.WillSaveTextDocumentWaitUntilRequest.type,this._client.code2ProtocolConverter.asWillSaveTextDocumentParams(i)).then(async s=>{let o=await this._client.protocol2CodeConverter.asTextEdits(s);return o===void 0?[]:o});e.waitUntil(t.willSaveWaitUntil?t.willSaveWaitUntil(e,n):n(e))}}unregister(e){this._selectors.delete(e),this._selectors.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}clear(){this._selectors.clear(),this._listener&&(this._listener.dispose(),this._listener=void 0)}};ln.WillSaveWaitUntilFeature=Ll;var Ml=class extends lt.TextDocumentEventFeature{constructor(e){super(e,In.workspace.onDidSaveTextDocument,Je.DidSaveTextDocumentNotification.type,()=>e.middleware.didSave,t=>e.code2ProtocolConverter.asSaveTextDocumentParams(t,this._includeText),t=>t,lt.TextDocumentEventFeature.textDocumentFilter),this._includeText=!1}get registrationType(){return Je.DidSaveTextDocumentNotification.type}fillClientCapabilities(e){(0,lt.ensure)((0,lt.ensure)(e,"textDocument"),"synchronization").didSave=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;if(t&&n&&n.save){let i=typeof n.save=="boolean"?{includeText:!1}:{includeText:!!n.save.includeText};this.register({id:Qi.generateUuid(),registerOptions:Object.assign({},{documentSelector:t},i)})}}register(e){this._includeText=!!e.registerOptions.includeText,super.register(e)}getTextDocument(e){return e}};ln.DidSaveTextDocumentFeature=Ml});var qb=I(ma=>{"use strict";Object.defineProperty(ma,"__esModule",{value:!0});ma.CompletionItemFeature=void 0;var fT=require("vscode"),ke=me(),Nl=Ie(),hT=at(),pT=[ke.CompletionItemKind.Text,ke.CompletionItemKind.Method,ke.CompletionItemKind.Function,ke.CompletionItemKind.Constructor,ke.CompletionItemKind.Field,ke.CompletionItemKind.Variable,ke.CompletionItemKind.Class,ke.CompletionItemKind.Interface,ke.CompletionItemKind.Module,ke.CompletionItemKind.Property,ke.CompletionItemKind.Unit,ke.CompletionItemKind.Value,ke.CompletionItemKind.Enum,ke.CompletionItemKind.Keyword,ke.CompletionItemKind.Snippet,ke.CompletionItemKind.Color,ke.CompletionItemKind.File,ke.CompletionItemKind.Reference,ke.CompletionItemKind.Folder,ke.CompletionItemKind.EnumMember,ke.CompletionItemKind.Constant,ke.CompletionItemKind.Struct,ke.CompletionItemKind.Event,ke.CompletionItemKind.Operator,ke.CompletionItemKind.TypeParameter],Al=class extends Nl.TextDocumentLanguageFeature{constructor(e){super(e,ke.CompletionRequest.type),this.labelDetailsSupport=new Map}fillClientCapabilities(e){let t=(0,Nl.ensure)((0,Nl.ensure)(e,"textDocument"),"completion");t.dynamicRegistration=!0,t.contextSupport=!0,t.completionItem={snippetSupport:!0,commitCharactersSupport:!0,documentationFormat:[ke.MarkupKind.Markdown,ke.MarkupKind.PlainText],deprecatedSupport:!0,preselectSupport:!0,tagSupport:{valueSet:[ke.CompletionItemTag.Deprecated]},insertReplaceSupport:!0,resolveSupport:{properties:["documentation","detail","additionalTextEdits"]},insertTextModeSupport:{valueSet:[ke.InsertTextMode.asIs,ke.InsertTextMode.adjustIndentation]},labelDetailsSupport:!0},t.insertTextMode=ke.InsertTextMode.adjustIndentation,t.completionItemKind={valueSet:pT},t.completionList={itemDefaults:["commitCharacters","editRange","insertTextFormat","insertTextMode","data"]}}initialize(e,t){let n=this.getRegistrationOptions(t,e.completionProvider);n&&this.register({id:hT.generateUuid(),registerOptions:n})}registerLanguageProvider(e,t){this.labelDetailsSupport.set(t,!!e.completionItem?.labelDetailsSupport);let n=e.triggerCharacters??[],i=e.allCommitCharacters,s=e.documentSelector,o={provideCompletionItems:(a,c,d,p)=>{let v=this._client,m=this._client.middleware,S=(b,E,x,$)=>v.sendRequest(ke.CompletionRequest.type,v.code2ProtocolConverter.asCompletionParams(b,E,x),$).then(U=>$.isCancellationRequested?null:v.protocol2CodeConverter.asCompletionResult(U,i,$),U=>v.handleFailedRequest(ke.CompletionRequest.type,$,U,null));return m.provideCompletionItem?m.provideCompletionItem(a,c,p,d,S):S(a,c,p,d)},resolveCompletionItem:e.resolveProvider?(a,c)=>{let d=this._client,p=this._client.middleware,v=(m,S)=>d.sendRequest(ke.CompletionResolveRequest.type,d.code2ProtocolConverter.asCompletionItem(m,!!this.labelDetailsSupport.get(t)),S).then(b=>S.isCancellationRequested?null:d.protocol2CodeConverter.asCompletionItem(b),b=>d.handleFailedRequest(ke.CompletionResolveRequest.type,S,b,m));return p.resolveCompletionItem?p.resolveCompletionItem(a,c,v):v(a,c)}:void 0};return[fT.languages.registerCompletionItemProvider(this._client.protocol2CodeConverter.asDocumentSelector(s),o,...n),o]}};ma.CompletionItemFeature=Al});var Ob=I(va=>{"use strict";Object.defineProperty(va,"__esModule",{value:!0});va.HoverFeature=void 0;var gT=require("vscode"),Ls=me(),jl=Ie(),mT=at(),$l=class extends jl.TextDocumentLanguageFeature{constructor(e){super(e,Ls.HoverRequest.type)}fillClientCapabilities(e){let t=(0,jl.ensure)((0,jl.ensure)(e,"textDocument"),"hover");t.dynamicRegistration=!0,t.contentFormat=[Ls.MarkupKind.Markdown,Ls.MarkupKind.PlainText]}initialize(e,t){let n=this.getRegistrationOptions(t,e.hoverProvider);n&&this.register({id:mT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideHover:(i,s,o)=>{let a=this._client,c=(p,v,m)=>a.sendRequest(Ls.HoverRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,v),m).then(S=>m.isCancellationRequested?null:a.protocol2CodeConverter.asHover(S),S=>a.handleFailedRequest(Ls.HoverRequest.type,m,S,null)),d=a.middleware;return d.provideHover?d.provideHover(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return gT.languages.registerHoverProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};va.HoverFeature=$l});var Fb=I(ya=>{"use strict";Object.defineProperty(ya,"__esModule",{value:!0});ya.DefinitionFeature=void 0;var vT=require("vscode"),Ul=me(),Wl=Ie(),yT=at(),Hl=class extends Wl.TextDocumentLanguageFeature{constructor(e){super(e,Ul.DefinitionRequest.type)}fillClientCapabilities(e){let t=(0,Wl.ensure)((0,Wl.ensure)(e,"textDocument"),"definition");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.definitionProvider);n&&this.register({id:yT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDefinition:(i,s,o)=>{let a=this._client,c=(p,v,m)=>a.sendRequest(Ul.DefinitionRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,v),m).then(S=>m.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(S,m),S=>a.handleFailedRequest(Ul.DefinitionRequest.type,m,S,null)),d=a.middleware;return d.provideDefinition?d.provideDefinition(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return vT.languages.registerDefinitionProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};ya.DefinitionFeature=Hl});var Mb=I(ba=>{"use strict";Object.defineProperty(ba,"__esModule",{value:!0});ba.SignatureHelpFeature=void 0;var Lb=require("vscode"),Ms=me(),Vl=Ie(),bT=at(),zl=class extends Vl.TextDocumentLanguageFeature{constructor(e){super(e,Ms.SignatureHelpRequest.type)}fillClientCapabilities(e){let t=(0,Vl.ensure)((0,Vl.ensure)(e,"textDocument"),"signatureHelp");t.dynamicRegistration=!0,t.signatureInformation={documentationFormat:[Ms.MarkupKind.Markdown,Ms.MarkupKind.PlainText]},t.signatureInformation.parameterInformation={labelOffsetSupport:!0},t.signatureInformation.activeParameterSupport=!0,t.contextSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.signatureHelpProvider);n&&this.register({id:bT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t={provideSignatureHelp:(n,i,s,o)=>{let a=this._client,c=(p,v,m,S)=>a.sendRequest(Ms.SignatureHelpRequest.type,a.code2ProtocolConverter.asSignatureHelpParams(p,v,m),S).then(b=>S.isCancellationRequested?null:a.protocol2CodeConverter.asSignatureHelp(b,S),b=>a.handleFailedRequest(Ms.SignatureHelpRequest.type,S,b,null)),d=a.middleware;return d.provideSignatureHelp?d.provideSignatureHelp(n,i,o,s,c):c(n,i,o,s)}};return[this.registerProvider(e,t),t]}registerProvider(e,t){let n=this._client.protocol2CodeConverter.asDocumentSelector(e.documentSelector);if(e.retriggerCharacters===void 0){let i=e.triggerCharacters||[];return Lb.languages.registerSignatureHelpProvider(n,t,...i)}else{let i={triggerCharacters:e.triggerCharacters||[],retriggerCharacters:e.retriggerCharacters||[]};return Lb.languages.registerSignatureHelpProvider(n,t,i)}}};ba.SignatureHelpFeature=zl});var Nb=I(wa=>{"use strict";Object.defineProperty(wa,"__esModule",{value:!0});wa.DocumentHighlightFeature=void 0;var wT=require("vscode"),Kl=me(),Bl=Ie(),CT=at(),Gl=class extends Bl.TextDocumentLanguageFeature{constructor(e){super(e,Kl.DocumentHighlightRequest.type)}fillClientCapabilities(e){(0,Bl.ensure)((0,Bl.ensure)(e,"textDocument"),"documentHighlight").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentHighlightProvider);n&&this.register({id:CT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentHighlights:(i,s,o)=>{let a=this._client,c=(p,v,m)=>a.sendRequest(Kl.DocumentHighlightRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,v),m).then(S=>m.isCancellationRequested?null:a.protocol2CodeConverter.asDocumentHighlights(S,m),S=>a.handleFailedRequest(Kl.DocumentHighlightRequest.type,m,S,null)),d=a.middleware;return d.provideDocumentHighlights?d.provideDocumentHighlights(i,s,o,c):c(i,s,o)}};return[wT.languages.registerDocumentHighlightProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};wa.DocumentHighlightFeature=Gl});var Ql=I(br=>{"use strict";Object.defineProperty(br,"__esModule",{value:!0});br.DocumentSymbolFeature=br.SupportedSymbolTags=br.SupportedSymbolKinds=void 0;var RT=require("vscode"),Le=me(),Jl=Ie(),ST=at();br.SupportedSymbolKinds=[Le.SymbolKind.File,Le.SymbolKind.Module,Le.SymbolKind.Namespace,Le.SymbolKind.Package,Le.SymbolKind.Class,Le.SymbolKind.Method,Le.SymbolKind.Property,Le.SymbolKind.Field,Le.SymbolKind.Constructor,Le.SymbolKind.Enum,Le.SymbolKind.Interface,Le.SymbolKind.Function,Le.SymbolKind.Variable,Le.SymbolKind.Constant,Le.SymbolKind.String,Le.SymbolKind.Number,Le.SymbolKind.Boolean,Le.SymbolKind.Array,Le.SymbolKind.Object,Le.SymbolKind.Key,Le.SymbolKind.Null,Le.SymbolKind.EnumMember,Le.SymbolKind.Struct,Le.SymbolKind.Event,Le.SymbolKind.Operator,Le.SymbolKind.TypeParameter];br.SupportedSymbolTags=[Le.SymbolTag.Deprecated];var Xl=class extends Jl.TextDocumentLanguageFeature{constructor(e){super(e,Le.DocumentSymbolRequest.type)}fillClientCapabilities(e){let t=(0,Jl.ensure)((0,Jl.ensure)(e,"textDocument"),"documentSymbol");t.dynamicRegistration=!0,t.symbolKind={valueSet:br.SupportedSymbolKinds},t.hierarchicalDocumentSymbolSupport=!0,t.tagSupport={valueSet:br.SupportedSymbolTags},t.labelSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentSymbolProvider);n&&this.register({id:ST.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentSymbols:(s,o)=>{let a=this._client,c=async(p,v)=>{try{let m=await a.sendRequest(Le.DocumentSymbolRequest.type,a.code2ProtocolConverter.asDocumentSymbolParams(p),v);if(v.isCancellationRequested||m===void 0||m===null)return null;if(m.length===0)return[];{let S=m[0];return Le.DocumentSymbol.is(S)?await a.protocol2CodeConverter.asDocumentSymbols(m,v):await a.protocol2CodeConverter.asSymbolInformations(m,v)}}catch(m){return a.handleFailedRequest(Le.DocumentSymbolRequest.type,v,m,null)}},d=a.middleware;return d.provideDocumentSymbols?d.provideDocumentSymbols(s,o,c):c(s,o)}},i=e.label!==void 0?{label:e.label}:void 0;return[RT.languages.registerDocumentSymbolProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,i),n]}};br.DocumentSymbolFeature=Xl});var jb=I(Ca=>{"use strict";Object.defineProperty(Ca,"__esModule",{value:!0});Ca.WorkspaceSymbolFeature=void 0;var _T=require("vscode"),Ns=me(),Yl=Ie(),Ab=Ql(),TT=at(),Zl=class extends Yl.WorkspaceFeature{constructor(e){super(e,Ns.WorkspaceSymbolRequest.type)}fillClientCapabilities(e){let t=(0,Yl.ensure)((0,Yl.ensure)(e,"workspace"),"symbol");t.dynamicRegistration=!0,t.symbolKind={valueSet:Ab.SupportedSymbolKinds},t.tagSupport={valueSet:Ab.SupportedSymbolTags},t.resolveSupport={properties:["location.range"]}}initialize(e){e.workspaceSymbolProvider&&this.register({id:TT.generateUuid(),registerOptions:e.workspaceSymbolProvider===!0?{workDoneProgress:!1}:e.workspaceSymbolProvider})}registerLanguageProvider(e){let t={provideWorkspaceSymbols:(n,i)=>{let s=this._client,o=(c,d)=>s.sendRequest(Ns.WorkspaceSymbolRequest.type,{query:c},d).then(p=>d.isCancellationRequested?null:s.protocol2CodeConverter.asSymbolInformations(p,d),p=>s.handleFailedRequest(Ns.WorkspaceSymbolRequest.type,d,p,null)),a=s.middleware;return a.provideWorkspaceSymbols?a.provideWorkspaceSymbols(n,i,o):o(n,i)},resolveWorkspaceSymbol:e.resolveProvider===!0?(n,i)=>{let s=this._client,o=(c,d)=>s.sendRequest(Ns.WorkspaceSymbolResolveRequest.type,s.code2ProtocolConverter.asWorkspaceSymbol(c),d).then(p=>d.isCancellationRequested?null:s.protocol2CodeConverter.asSymbolInformation(p),p=>s.handleFailedRequest(Ns.WorkspaceSymbolResolveRequest.type,d,p,null)),a=s.middleware;return a.resolveWorkspaceSymbol?a.resolveWorkspaceSymbol(n,i,o):o(n,i)}:void 0};return[_T.languages.registerWorkspaceSymbolProvider(t),t]}};Ca.WorkspaceSymbolFeature=Zl});var $b=I(Ra=>{"use strict";Object.defineProperty(Ra,"__esModule",{value:!0});Ra.ReferencesFeature=void 0;var DT=require("vscode"),ef=me(),tf=Ie(),PT=at(),nf=class extends tf.TextDocumentLanguageFeature{constructor(e){super(e,ef.ReferencesRequest.type)}fillClientCapabilities(e){(0,tf.ensure)((0,tf.ensure)(e,"textDocument"),"references").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.referencesProvider);n&&this.register({id:PT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideReferences:(i,s,o,a)=>{let c=this._client,d=(v,m,S,b)=>c.sendRequest(ef.ReferencesRequest.type,c.code2ProtocolConverter.asReferenceParams(v,m,S),b).then(E=>b.isCancellationRequested?null:c.protocol2CodeConverter.asReferences(E,b),E=>c.handleFailedRequest(ef.ReferencesRequest.type,b,E,null)),p=c.middleware;return p.provideReferences?p.provideReferences(i,s,o,a,d):d(i,s,o,a)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return DT.languages.registerReferenceProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Ra.ReferencesFeature=nf});var Ub=I(Sa=>{"use strict";Object.defineProperty(Sa,"__esModule",{value:!0});Sa.CodeActionFeature=void 0;var kT=require("vscode"),qn=me(),ET=at(),rf=Ie(),sf=class extends rf.TextDocumentLanguageFeature{constructor(e){super(e,qn.CodeActionRequest.type)}fillClientCapabilities(e){let t=(0,rf.ensure)((0,rf.ensure)(e,"textDocument"),"codeAction");t.dynamicRegistration=!0,t.isPreferredSupport=!0,t.disabledSupport=!0,t.dataSupport=!0,t.resolveSupport={properties:["edit"]},t.codeActionLiteralSupport={codeActionKind:{valueSet:[qn.CodeActionKind.Empty,qn.CodeActionKind.QuickFix,qn.CodeActionKind.Refactor,qn.CodeActionKind.RefactorExtract,qn.CodeActionKind.RefactorInline,qn.CodeActionKind.RefactorRewrite,qn.CodeActionKind.Source,qn.CodeActionKind.SourceOrganizeImports]}},t.honorsChangeAnnotations=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.codeActionProvider);n&&this.register({id:ET.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideCodeActions:(i,s,o,a)=>{let c=this._client,d=async(v,m,S,b)=>{let E={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(v),range:c.code2ProtocolConverter.asRange(m),context:c.code2ProtocolConverter.asCodeActionContextSync(S)};return c.sendRequest(qn.CodeActionRequest.type,E,b).then(x=>b.isCancellationRequested||x===null||x===void 0?null:c.protocol2CodeConverter.asCodeActionResult(x,b),x=>c.handleFailedRequest(qn.CodeActionRequest.type,b,x,null))},p=c.middleware;return p.provideCodeActions?p.provideCodeActions(i,s,o,a,d):d(i,s,o,a)},resolveCodeAction:e.resolveProvider?(i,s)=>{let o=this._client,a=this._client.middleware,c=async(d,p)=>o.sendRequest(qn.CodeActionResolveRequest.type,o.code2ProtocolConverter.asCodeActionSync(d),p).then(v=>p.isCancellationRequested?d:o.protocol2CodeConverter.asCodeAction(v,p),v=>o.handleFailedRequest(qn.CodeActionResolveRequest.type,p,v,d));return a.resolveCodeAction?a.resolveCodeAction(i,s,c):c(i,s)}:void 0};return[kT.languages.registerCodeActionsProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,e.codeActionKinds?{providedCodeActionKinds:this._client.protocol2CodeConverter.asCodeActionKinds(e.codeActionKinds)}:void 0),n]}};Sa.CodeActionFeature=sf});var Hb=I(_a=>{"use strict";Object.defineProperty(_a,"__esModule",{value:!0});_a.CodeLensFeature=void 0;var Wb=require("vscode"),Yi=me(),xT=at(),As=Ie(),of=class extends As.TextDocumentLanguageFeature{constructor(e){super(e,Yi.CodeLensRequest.type)}fillClientCapabilities(e){(0,As.ensure)((0,As.ensure)(e,"textDocument"),"codeLens").dynamicRegistration=!0,(0,As.ensure)((0,As.ensure)(e,"workspace"),"codeLens").refreshSupport=!0}initialize(e,t){this._client.onRequest(Yi.CodeLensRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeCodeLensEmitter.fire()});let i=this.getRegistrationOptions(t,e.codeLensProvider);i&&this.register({id:xT.generateUuid(),registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new Wb.EventEmitter,i={onDidChangeCodeLenses:n.event,provideCodeLenses:(s,o)=>{let a=this._client,c=(p,v)=>a.sendRequest(Yi.CodeLensRequest.type,a.code2ProtocolConverter.asCodeLensParams(p),v).then(m=>v.isCancellationRequested?null:a.protocol2CodeConverter.asCodeLenses(m,v),m=>a.handleFailedRequest(Yi.CodeLensRequest.type,v,m,null)),d=a.middleware;return d.provideCodeLenses?d.provideCodeLenses(s,o,c):c(s,o)},resolveCodeLens:e.resolveProvider?(s,o)=>{let a=this._client,c=(p,v)=>a.sendRequest(Yi.CodeLensResolveRequest.type,a.code2ProtocolConverter.asCodeLens(p),v).then(m=>v.isCancellationRequested?p:a.protocol2CodeConverter.asCodeLens(m),m=>a.handleFailedRequest(Yi.CodeLensResolveRequest.type,v,m,p)),d=a.middleware;return d.resolveCodeLens?d.resolveCodeLens(s,o,c):c(s,o)}:void 0};return[Wb.languages.registerCodeLensProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i),{provider:i,onDidChangeCodeLensEmitter:n}]}};_a.CodeLensFeature=of});var Vb=I(Jr=>{"use strict";Object.defineProperty(Jr,"__esModule",{value:!0});Jr.DocumentOnTypeFormattingFeature=Jr.DocumentRangeFormattingFeature=Jr.DocumentFormattingFeature=void 0;var Ta=require("vscode"),sr=me(),df=at(),Er=Ie(),Zi;(function(r){function e(t){let n=Ta.workspace.getConfiguration("files",t);return{trimTrailingWhitespace:n.get("trimTrailingWhitespace"),trimFinalNewlines:n.get("trimFinalNewlines"),insertFinalNewline:n.get("insertFinalNewline")}}r.fromConfiguration=e})(Zi||(Zi={}));var af=class extends Er.TextDocumentLanguageFeature{constructor(e){super(e,sr.DocumentFormattingRequest.type)}fillClientCapabilities(e){(0,Er.ensure)((0,Er.ensure)(e,"textDocument"),"formatting").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentFormattingProvider);n&&this.register({id:df.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentFormattingEdits:(i,s,o)=>{let a=this._client,c=(p,v,m)=>{let S={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(p),options:a.code2ProtocolConverter.asFormattingOptions(v,Zi.fromConfiguration(p))};return a.sendRequest(sr.DocumentFormattingRequest.type,S,m).then(b=>m.isCancellationRequested?null:a.protocol2CodeConverter.asTextEdits(b,m),b=>a.handleFailedRequest(sr.DocumentFormattingRequest.type,m,b,null))},d=a.middleware;return d.provideDocumentFormattingEdits?d.provideDocumentFormattingEdits(i,s,o,c):c(i,s,o)}};return[Ta.languages.registerDocumentFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Jr.DocumentFormattingFeature=af;var cf=class extends Er.TextDocumentLanguageFeature{constructor(e){super(e,sr.DocumentRangeFormattingRequest.type)}fillClientCapabilities(e){let t=(0,Er.ensure)((0,Er.ensure)(e,"textDocument"),"rangeFormatting");t.dynamicRegistration=!0,t.rangesSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentRangeFormattingProvider);n&&this.register({id:df.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentRangeFormattingEdits:(i,s,o,a)=>{let c=this._client,d=(v,m,S,b)=>{let E={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(v),range:c.code2ProtocolConverter.asRange(m),options:c.code2ProtocolConverter.asFormattingOptions(S,Zi.fromConfiguration(v))};return c.sendRequest(sr.DocumentRangeFormattingRequest.type,E,b).then(x=>b.isCancellationRequested?null:c.protocol2CodeConverter.asTextEdits(x,b),x=>c.handleFailedRequest(sr.DocumentRangeFormattingRequest.type,b,x,null))},p=c.middleware;return p.provideDocumentRangeFormattingEdits?p.provideDocumentRangeFormattingEdits(i,s,o,a,d):d(i,s,o,a)}};return e.rangesSupport&&(n.provideDocumentRangesFormattingEdits=(i,s,o,a)=>{let c=this._client,d=(v,m,S,b)=>{let E={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(v),ranges:c.code2ProtocolConverter.asRanges(m),options:c.code2ProtocolConverter.asFormattingOptions(S,Zi.fromConfiguration(v))};return c.sendRequest(sr.DocumentRangesFormattingRequest.type,E,b).then(x=>b.isCancellationRequested?null:c.protocol2CodeConverter.asTextEdits(x,b),x=>c.handleFailedRequest(sr.DocumentRangesFormattingRequest.type,b,x,null))},p=c.middleware;return p.provideDocumentRangesFormattingEdits?p.provideDocumentRangesFormattingEdits(i,s,o,a,d):d(i,s,o,a)}),[Ta.languages.registerDocumentRangeFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Jr.DocumentRangeFormattingFeature=cf;var uf=class extends Er.TextDocumentLanguageFeature{constructor(e){super(e,sr.DocumentOnTypeFormattingRequest.type)}fillClientCapabilities(e){(0,Er.ensure)((0,Er.ensure)(e,"textDocument"),"onTypeFormatting").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentOnTypeFormattingProvider);n&&this.register({id:df.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideOnTypeFormattingEdits:(s,o,a,c,d)=>{let p=this._client,v=(S,b,E,x,$)=>{let U={textDocument:p.code2ProtocolConverter.asTextDocumentIdentifier(S),position:p.code2ProtocolConverter.asPosition(b),ch:E,options:p.code2ProtocolConverter.asFormattingOptions(x,Zi.fromConfiguration(S))};return p.sendRequest(sr.DocumentOnTypeFormattingRequest.type,U,$).then(M=>$.isCancellationRequested?null:p.protocol2CodeConverter.asTextEdits(M,$),M=>p.handleFailedRequest(sr.DocumentOnTypeFormattingRequest.type,$,M,null))},m=p.middleware;return m.provideOnTypeFormattingEdits?m.provideOnTypeFormattingEdits(s,o,a,c,d,v):v(s,o,a,c,d)}},i=e.moreTriggerCharacter||[];return[Ta.languages.registerOnTypeFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,e.firstTriggerCharacter,...i),n]}};Jr.DocumentOnTypeFormattingFeature=uf});var Kb=I(Da=>{"use strict";Object.defineProperty(Da,"__esModule",{value:!0});Da.RenameFeature=void 0;var IT=require("vscode"),pi=me(),qT=at(),zb=Vn(),lf=Ie(),ff=class extends lf.TextDocumentLanguageFeature{constructor(e){super(e,pi.RenameRequest.type)}fillClientCapabilities(e){let t=(0,lf.ensure)((0,lf.ensure)(e,"textDocument"),"rename");t.dynamicRegistration=!0,t.prepareSupport=!0,t.prepareSupportDefaultBehavior=pi.PrepareSupportDefaultBehavior.Identifier,t.honorsChangeAnnotations=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.renameProvider);n&&(zb.boolean(e.renameProvider)&&(n.prepareProvider=!1),this.register({id:qT.generateUuid(),registerOptions:n}))}registerLanguageProvider(e){let t=e.documentSelector,n={provideRenameEdits:(i,s,o,a)=>{let c=this._client,d=(v,m,S,b)=>{let E={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(v),position:c.code2ProtocolConverter.asPosition(m),newName:S};return c.sendRequest(pi.RenameRequest.type,E,b).then(x=>b.isCancellationRequested?null:c.protocol2CodeConverter.asWorkspaceEdit(x,b),x=>c.handleFailedRequest(pi.RenameRequest.type,b,x,null,!1))},p=c.middleware;return p.provideRenameEdits?p.provideRenameEdits(i,s,o,a,d):d(i,s,o,a)},prepareRename:e.prepareProvider?(i,s,o)=>{let a=this._client,c=(p,v,m)=>{let S={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(p),position:a.code2ProtocolConverter.asPosition(v)};return a.sendRequest(pi.PrepareRenameRequest.type,S,m).then(b=>m.isCancellationRequested?null:pi.Range.is(b)?a.protocol2CodeConverter.asRange(b):this.isDefaultBehavior(b)?b.defaultBehavior===!0?null:Promise.reject(new Error("The element can't be renamed.")):b&&pi.Range.is(b.range)?{range:a.protocol2CodeConverter.asRange(b.range),placeholder:b.placeholder}:Promise.reject(new Error("The element can't be renamed.")),b=>{throw typeof b.message=="string"?new Error(b.message):new Error("The element can't be renamed.")})},d=a.middleware;return d.prepareRename?d.prepareRename(i,s,o,c):c(i,s,o)}:void 0};return[this.registerProvider(t,n),n]}registerProvider(e,t){return IT.languages.registerRenameProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}isDefaultBehavior(e){let t=e;return t&&zb.boolean(t.defaultBehavior)}};Da.RenameFeature=ff});var Bb=I(Pa=>{"use strict";Object.defineProperty(Pa,"__esModule",{value:!0});Pa.DocumentLinkFeature=void 0;var OT=require("vscode"),js=me(),hf=Ie(),FT=at(),pf=class extends hf.TextDocumentLanguageFeature{constructor(e){super(e,js.DocumentLinkRequest.type)}fillClientCapabilities(e){let t=(0,hf.ensure)((0,hf.ensure)(e,"textDocument"),"documentLink");t.dynamicRegistration=!0,t.tooltipSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentLinkProvider);n&&this.register({id:FT.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentLinks:(i,s)=>{let o=this._client,a=(d,p)=>o.sendRequest(js.DocumentLinkRequest.type,o.code2ProtocolConverter.asDocumentLinkParams(d),p).then(v=>p.isCancellationRequested?null:o.protocol2CodeConverter.asDocumentLinks(v,p),v=>o.handleFailedRequest(js.DocumentLinkRequest.type,p,v,null)),c=o.middleware;return c.provideDocumentLinks?c.provideDocumentLinks(i,s,a):a(i,s)},resolveDocumentLink:e.resolveProvider?(i,s)=>{let o=this._client,a=(d,p)=>o.sendRequest(js.DocumentLinkResolveRequest.type,o.code2ProtocolConverter.asDocumentLink(d),p).then(v=>p.isCancellationRequested?d:o.protocol2CodeConverter.asDocumentLink(v),v=>o.handleFailedRequest(js.DocumentLinkResolveRequest.type,p,v,d)),c=o.middleware;return c.resolveDocumentLink?c.resolveDocumentLink(i,s,a):a(i,s)}:void 0};return[OT.languages.registerDocumentLinkProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Pa.DocumentLinkFeature=pf});var Jb=I(ka=>{"use strict";Object.defineProperty(ka,"__esModule",{value:!0});ka.ExecuteCommandFeature=void 0;var LT=require("vscode"),gf=me(),MT=at(),Gb=Ie(),mf=class{constructor(e){this._client=e,this._commands=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._commands.size>0}}get registrationType(){return gf.ExecuteCommandRequest.type}fillClientCapabilities(e){(0,Gb.ensure)((0,Gb.ensure)(e,"workspace"),"executeCommand").dynamicRegistration=!0}initialize(e){e.executeCommandProvider&&this.register({id:MT.generateUuid(),registerOptions:Object.assign({},e.executeCommandProvider)})}register(e){let t=this._client,n=t.middleware,i=(s,o)=>{let a={command:s,arguments:o};return t.sendRequest(gf.ExecuteCommandRequest.type,a).then(void 0,c=>t.handleFailedRequest(gf.ExecuteCommandRequest.type,void 0,c,void 0))};if(e.registerOptions.commands){let s=[];for(let o of e.registerOptions.commands)s.push(LT.commands.registerCommand(o,(...a)=>n.executeCommand?n.executeCommand(o,a,i):i(o,a)));this._commands.set(e.id,s)}}unregister(e){let t=this._commands.get(e);t&&t.forEach(n=>n.dispose())}clear(){this._commands.forEach(e=>{e.forEach(t=>t.dispose())}),this._commands.clear()}};ka.ExecuteCommandFeature=mf});var Xb=I(xa=>{"use strict";Object.defineProperty(xa,"__esModule",{value:!0});xa.FileSystemWatcherFeature=void 0;var NT=require("vscode"),gi=me(),Ea=Ie(),vf=class{constructor(e,t){this._client=e,this._notifyFileEvent=t,this._watchers=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._watchers.size>0}}get registrationType(){return gi.DidChangeWatchedFilesNotification.type}fillClientCapabilities(e){(0,Ea.ensure)((0,Ea.ensure)(e,"workspace"),"didChangeWatchedFiles").dynamicRegistration=!0,(0,Ea.ensure)((0,Ea.ensure)(e,"workspace"),"didChangeWatchedFiles").relativePatternSupport=!0}initialize(e,t){}register(e){if(!Array.isArray(e.registerOptions.watchers))return;let t=[];for(let n of e.registerOptions.watchers){let i=this._client.protocol2CodeConverter.asGlobPattern(n.globPattern);if(i===void 0)continue;let s=!0,o=!0,a=!0;n.kind!==void 0&&n.kind!==null&&(s=(n.kind&gi.WatchKind.Create)!==0,o=(n.kind&gi.WatchKind.Change)!==0,a=(n.kind&gi.WatchKind.Delete)!==0);let c=NT.workspace.createFileSystemWatcher(i,!s,!o,!a);this.hookListeners(c,s,o,a,t),t.push(c)}this._watchers.set(e.id,t)}registerRaw(e,t){let n=[];for(let i of t)this.hookListeners(i,!0,!0,!0,n);this._watchers.set(e,n)}hookListeners(e,t,n,i,s){t&&e.onDidCreate(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:gi.FileChangeType.Created}),null,s),n&&e.onDidChange(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:gi.FileChangeType.Changed}),null,s),i&&e.onDidDelete(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:gi.FileChangeType.Deleted}),null,s)}unregister(e){let t=this._watchers.get(e);if(t)for(let n of t)n.dispose()}clear(){this._watchers.forEach(e=>{for(let t of e)t.dispose()}),this._watchers.clear()}};xa.FileSystemWatcherFeature=vf});var Qb=I(Ia=>{"use strict";Object.defineProperty(Ia,"__esModule",{value:!0});Ia.ColorProviderFeature=void 0;var AT=require("vscode"),$s=me(),yf=Ie(),bf=class extends yf.TextDocumentLanguageFeature{constructor(e){super(e,$s.DocumentColorRequest.type)}fillClientCapabilities(e){(0,yf.ensure)((0,yf.ensure)(e,"textDocument"),"colorProvider").dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.colorProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideColorPresentations:(i,s,o)=>{let a=this._client,c=(p,v,m)=>{let S={color:p,textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(v.document),range:a.code2ProtocolConverter.asRange(v.range)};return a.sendRequest($s.ColorPresentationRequest.type,S,m).then(b=>m.isCancellationRequested?null:this._client.protocol2CodeConverter.asColorPresentations(b,m),b=>a.handleFailedRequest($s.ColorPresentationRequest.type,m,b,null))},d=a.middleware;return d.provideColorPresentations?d.provideColorPresentations(i,s,o,c):c(i,s,o)},provideDocumentColors:(i,s)=>{let o=this._client,a=(d,p)=>{let v={textDocument:o.code2ProtocolConverter.asTextDocumentIdentifier(d)};return o.sendRequest($s.DocumentColorRequest.type,v,p).then(m=>p.isCancellationRequested?null:this._client.protocol2CodeConverter.asColorInformations(m,p),m=>o.handleFailedRequest($s.DocumentColorRequest.type,p,m,null))},c=o.middleware;return c.provideDocumentColors?c.provideDocumentColors(i,s,a):a(i,s)}};return[AT.languages.registerColorProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Ia.ColorProviderFeature=bf});var Yb=I(qa=>{"use strict";Object.defineProperty(qa,"__esModule",{value:!0});qa.ImplementationFeature=void 0;var jT=require("vscode"),wf=me(),Cf=Ie(),Rf=class extends Cf.TextDocumentLanguageFeature{constructor(e){super(e,wf.ImplementationRequest.type)}fillClientCapabilities(e){let t=(0,Cf.ensure)((0,Cf.ensure)(e,"textDocument"),"implementation");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.implementationProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideImplementation:(i,s,o)=>{let a=this._client,c=(p,v,m)=>a.sendRequest(wf.ImplementationRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,v),m).then(S=>m.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(S,m),S=>a.handleFailedRequest(wf.ImplementationRequest.type,m,S,null)),d=a.middleware;return d.provideImplementation?d.provideImplementation(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return jT.languages.registerImplementationProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};qa.ImplementationFeature=Rf});var Zb=I(Oa=>{"use strict";Object.defineProperty(Oa,"__esModule",{value:!0});Oa.TypeDefinitionFeature=void 0;var $T=require("vscode"),Sf=me(),Us=Ie(),_f=class extends Us.TextDocumentLanguageFeature{constructor(e){super(e,Sf.TypeDefinitionRequest.type)}fillClientCapabilities(e){(0,Us.ensure)((0,Us.ensure)(e,"textDocument"),"typeDefinition").dynamicRegistration=!0;let t=(0,Us.ensure)((0,Us.ensure)(e,"textDocument"),"typeDefinition");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.typeDefinitionProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideTypeDefinition:(i,s,o)=>{let a=this._client,c=(p,v,m)=>a.sendRequest(Sf.TypeDefinitionRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,v),m).then(S=>m.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(S,m),S=>a.handleFailedRequest(Sf.TypeDefinitionRequest.type,m,S,null)),d=a.middleware;return d.provideTypeDefinition?d.provideTypeDefinition(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return $T.languages.registerTypeDefinitionProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Oa.TypeDefinitionFeature=_f});var ew=I(es=>{"use strict";Object.defineProperty(es,"__esModule",{value:!0});es.WorkspaceFoldersFeature=es.arrayDiff=void 0;var UT=at(),Fa=require("vscode"),Ws=me();function Tf(r,e){if(r!=null)return r[e]}function Df(r,e){return r.filter(t=>e.indexOf(t)<0)}es.arrayDiff=Df;var Pf=class{constructor(e){this._client=e,this._listeners=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._listeners.size>0}}get registrationType(){return Ws.DidChangeWorkspaceFoldersNotification.type}fillInitializeParams(e){let t=Fa.workspace.workspaceFolders;this.initializeWithFolders(t),t===void 0?e.workspaceFolders=null:e.workspaceFolders=t.map(n=>this.asProtocol(n))}initializeWithFolders(e){this._initialFolders=e}fillClientCapabilities(e){e.workspace=e.workspace||{},e.workspace.workspaceFolders=!0}initialize(e){let t=this._client;t.onRequest(Ws.WorkspaceFoldersRequest.type,s=>{let o=()=>{let c=Fa.workspace.workspaceFolders;return c===void 0?null:c.map(p=>this.asProtocol(p))},a=t.middleware.workspace;return a&&a.workspaceFolders?a.workspaceFolders(s,o):o(s)});let n=Tf(Tf(Tf(e,"workspace"),"workspaceFolders"),"changeNotifications"),i;typeof n=="string"?i=n:n===!0&&(i=UT.generateUuid()),i&&this.register({id:i,registerOptions:void 0})}sendInitialEvent(e){let t;if(this._initialFolders&&e){let n=Df(this._initialFolders,e),i=Df(e,this._initialFolders);(i.length>0||n.length>0)&&(t=this.doSendEvent(i,n))}else this._initialFolders?t=this.doSendEvent([],this._initialFolders):e&&(t=this.doSendEvent(e,[]));t!==void 0&&t.catch(n=>{this._client.error(`Sending notification ${Ws.DidChangeWorkspaceFoldersNotification.type.method} failed`,n)})}doSendEvent(e,t){let n={event:{added:e.map(i=>this.asProtocol(i)),removed:t.map(i=>this.asProtocol(i))}};return this._client.sendNotification(Ws.DidChangeWorkspaceFoldersNotification.type,n)}register(e){let t=e.id,n=this._client,i=Fa.workspace.onDidChangeWorkspaceFolders(s=>{let o=d=>this.doSendEvent(d.added,d.removed),a=n.middleware.workspace;(a&&a.didChangeWorkspaceFolders?a.didChangeWorkspaceFolders(s,o):o(s)).catch(d=>{this._client.error(`Sending notification ${Ws.DidChangeWorkspaceFoldersNotification.type.method} failed`,d)})});this._listeners.set(t,i),this.sendInitialEvent(Fa.workspace.workspaceFolders)}unregister(e){let t=this._listeners.get(e);t!==void 0&&(this._listeners.delete(e),t.dispose())}clear(){for(let e of this._listeners.values())e.dispose();this._listeners.clear()}asProtocol(e){return e===void 0?null:{uri:this._client.code2ProtocolConverter.asUri(e.uri),name:e.name}}};es.WorkspaceFoldersFeature=Pf});var nw=I(La=>{"use strict";Object.defineProperty(La,"__esModule",{value:!0});La.FoldingRangeFeature=void 0;var tw=require("vscode"),mi=me(),Hs=Ie(),kf=class extends Hs.TextDocumentLanguageFeature{constructor(e){super(e,mi.FoldingRangeRequest.type)}fillClientCapabilities(e){let t=(0,Hs.ensure)((0,Hs.ensure)(e,"textDocument"),"foldingRange");t.dynamicRegistration=!0,t.rangeLimit=5e3,t.lineFoldingOnly=!0,t.foldingRangeKind={valueSet:[mi.FoldingRangeKind.Comment,mi.FoldingRangeKind.Imports,mi.FoldingRangeKind.Region]},t.foldingRange={collapsedText:!1},(0,Hs.ensure)((0,Hs.ensure)(e,"workspace"),"foldingRange").refreshSupport=!0}initialize(e,t){this._client.onRequest(mi.FoldingRangeRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeFoldingRange.fire()});let[n,i]=this.getRegistration(t,e.foldingRangeProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new tw.EventEmitter,i={onDidChangeFoldingRanges:n.event,provideFoldingRanges:(s,o,a)=>{let c=this._client,d=(v,m,S)=>{let b={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(v)};return c.sendRequest(mi.FoldingRangeRequest.type,b,S).then(E=>S.isCancellationRequested?null:c.protocol2CodeConverter.asFoldingRanges(E,S),E=>c.handleFailedRequest(mi.FoldingRangeRequest.type,S,E,null))},p=c.middleware;return p.provideFoldingRanges?p.provideFoldingRanges(s,o,a,d):d(s,o,a)}};return[tw.languages.registerFoldingRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i),{provider:i,onDidChangeFoldingRange:n}]}};La.FoldingRangeFeature=kf});var rw=I(Ma=>{"use strict";Object.defineProperty(Ma,"__esModule",{value:!0});Ma.DeclarationFeature=void 0;var WT=require("vscode"),Ef=me(),xf=Ie(),If=class extends xf.TextDocumentLanguageFeature{constructor(e){super(e,Ef.DeclarationRequest.type)}fillClientCapabilities(e){let t=(0,xf.ensure)((0,xf.ensure)(e,"textDocument"),"declaration");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.declarationProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDeclaration:(i,s,o)=>{let a=this._client,c=(p,v,m)=>a.sendRequest(Ef.DeclarationRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,v),m).then(S=>m.isCancellationRequested?null:a.protocol2CodeConverter.asDeclarationResult(S,m),S=>a.handleFailedRequest(Ef.DeclarationRequest.type,m,S,null)),d=a.middleware;return d.provideDeclaration?d.provideDeclaration(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return WT.languages.registerDeclarationProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Ma.DeclarationFeature=If});var iw=I(Na=>{"use strict";Object.defineProperty(Na,"__esModule",{value:!0});Na.SelectionRangeFeature=void 0;var HT=require("vscode"),qf=me(),Of=Ie(),Ff=class extends Of.TextDocumentLanguageFeature{constructor(e){super(e,qf.SelectionRangeRequest.type)}fillClientCapabilities(e){let t=(0,Of.ensure)((0,Of.ensure)(e,"textDocument"),"selectionRange");t.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.selectionRangeProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideSelectionRanges:(i,s,o)=>{let a=this._client,c=async(p,v,m)=>{let S={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(p),positions:a.code2ProtocolConverter.asPositionsSync(v,m)};return a.sendRequest(qf.SelectionRangeRequest.type,S,m).then(b=>m.isCancellationRequested?null:a.protocol2CodeConverter.asSelectionRanges(b,m),b=>a.handleFailedRequest(qf.SelectionRangeRequest.type,m,b,null))},d=a.middleware;return d.provideSelectionRanges?d.provideSelectionRanges(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return HT.languages.registerSelectionRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Na.SelectionRangeFeature=Ff});var ow=I(Aa=>{"use strict";Object.defineProperty(Aa,"__esModule",{value:!0});Aa.ProgressFeature=void 0;var sw=me(),VT=ol();function zT(r,e){return r[e]===void 0&&(r[e]=Object.create(null)),r[e]}var Lf=class{constructor(e){this._client=e,this.activeParts=new Set}getState(){return{kind:"window",id:sw.WorkDoneProgressCreateRequest.method,registrations:this.activeParts.size>0}}fillClientCapabilities(e){zT(e,"window").workDoneProgress=!0}initialize(){let e=this._client,t=i=>{this.activeParts.delete(i)},n=i=>{this.activeParts.add(new VT.ProgressPart(this._client,i.token,t))};e.onRequest(sw.WorkDoneProgressCreateRequest.type,n)}clear(){for(let e of this.activeParts)e.done();this.activeParts.clear()}};Aa.ProgressFeature=Lf});var aw=I(ja=>{"use strict";Object.defineProperty(ja,"__esModule",{value:!0});ja.CallHierarchyFeature=void 0;var KT=require("vscode"),vi=me(),Mf=Ie(),Nf=class{constructor(e){this.client=e,this.middleware=e.middleware}prepareCallHierarchy(e,t,n){let i=this.client,s=this.middleware,o=(a,c,d)=>{let p=i.code2ProtocolConverter.asTextDocumentPositionParams(a,c);return i.sendRequest(vi.CallHierarchyPrepareRequest.type,p,d).then(v=>d.isCancellationRequested?null:i.protocol2CodeConverter.asCallHierarchyItems(v,d),v=>i.handleFailedRequest(vi.CallHierarchyPrepareRequest.type,d,v,null))};return s.prepareCallHierarchy?s.prepareCallHierarchy(e,t,n,o):o(e,t,n)}provideCallHierarchyIncomingCalls(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asCallHierarchyItem(o)};return n.sendRequest(vi.CallHierarchyIncomingCallsRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asCallHierarchyIncomingCalls(d,a),d=>n.handleFailedRequest(vi.CallHierarchyIncomingCallsRequest.type,a,d,null))};return i.provideCallHierarchyIncomingCalls?i.provideCallHierarchyIncomingCalls(e,t,s):s(e,t)}provideCallHierarchyOutgoingCalls(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asCallHierarchyItem(o)};return n.sendRequest(vi.CallHierarchyOutgoingCallsRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asCallHierarchyOutgoingCalls(d,a),d=>n.handleFailedRequest(vi.CallHierarchyOutgoingCallsRequest.type,a,d,null))};return i.provideCallHierarchyOutgoingCalls?i.provideCallHierarchyOutgoingCalls(e,t,s):s(e,t)}},Af=class extends Mf.TextDocumentLanguageFeature{constructor(e){super(e,vi.CallHierarchyPrepareRequest.type)}fillClientCapabilities(e){let t=e,n=(0,Mf.ensure)((0,Mf.ensure)(t,"textDocument"),"callHierarchy");n.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.callHierarchyProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=this._client,n=new Nf(t);return[KT.languages.registerCallHierarchyProvider(this._client.protocol2CodeConverter.asDocumentSelector(e.documentSelector),n),n]}};ja.CallHierarchyFeature=Af});var cw=I(Ua=>{"use strict";Object.defineProperty(Ua,"__esModule",{value:!0});Ua.SemanticTokensFeature=void 0;var $a=require("vscode"),be=me(),Vs=Ie(),BT=Vn(),jf=class extends Vs.TextDocumentLanguageFeature{constructor(e){super(e,be.SemanticTokensRegistrationType.type)}fillClientCapabilities(e){let t=(0,Vs.ensure)((0,Vs.ensure)(e,"textDocument"),"semanticTokens");t.dynamicRegistration=!0,t.tokenTypes=[be.SemanticTokenTypes.namespace,be.SemanticTokenTypes.type,be.SemanticTokenTypes.class,be.SemanticTokenTypes.enum,be.SemanticTokenTypes.interface,be.SemanticTokenTypes.struct,be.SemanticTokenTypes.typeParameter,be.SemanticTokenTypes.parameter,be.SemanticTokenTypes.variable,be.SemanticTokenTypes.property,be.SemanticTokenTypes.enumMember,be.SemanticTokenTypes.event,be.SemanticTokenTypes.function,be.SemanticTokenTypes.method,be.SemanticTokenTypes.macro,be.SemanticTokenTypes.keyword,be.SemanticTokenTypes.modifier,be.SemanticTokenTypes.comment,be.SemanticTokenTypes.string,be.SemanticTokenTypes.number,be.SemanticTokenTypes.regexp,be.SemanticTokenTypes.operator,be.SemanticTokenTypes.decorator],t.tokenModifiers=[be.SemanticTokenModifiers.declaration,be.SemanticTokenModifiers.definition,be.SemanticTokenModifiers.readonly,be.SemanticTokenModifiers.static,be.SemanticTokenModifiers.deprecated,be.SemanticTokenModifiers.abstract,be.SemanticTokenModifiers.async,be.SemanticTokenModifiers.modification,be.SemanticTokenModifiers.documentation,be.SemanticTokenModifiers.defaultLibrary],t.formats=[be.TokenFormat.Relative],t.requests={range:!0,full:{delta:!0}},t.multilineTokenSupport=!1,t.overlappingTokenSupport=!1,t.serverCancelSupport=!0,t.augmentsSyntaxTokens=!0,(0,Vs.ensure)((0,Vs.ensure)(e,"workspace"),"semanticTokens").refreshSupport=!0}initialize(e,t){this._client.onRequest(be.SemanticTokensRefreshRequest.type,async()=>{for(let o of this.getAllProviders())o.onDidChangeSemanticTokensEmitter.fire()});let[i,s]=this.getRegistration(t,e.semanticTokensProvider);!i||!s||this.register({id:i,registerOptions:s})}registerLanguageProvider(e){let t=e.documentSelector,n=BT.boolean(e.full)?e.full:e.full!==void 0,i=e.full!==void 0&&typeof e.full!="boolean"&&e.full.delta===!0,s=new $a.EventEmitter,o=n?{onDidChangeSemanticTokens:s.event,provideDocumentSemanticTokens:(S,b)=>{let E=this._client,x=E.middleware,$=(U,M)=>{let z={textDocument:E.code2ProtocolConverter.asTextDocumentIdentifier(U)};return E.sendRequest(be.SemanticTokensRequest.type,z,M).then(B=>M.isCancellationRequested?null:E.protocol2CodeConverter.asSemanticTokens(B,M),B=>E.handleFailedRequest(be.SemanticTokensRequest.type,M,B,null))};return x.provideDocumentSemanticTokens?x.provideDocumentSemanticTokens(S,b,$):$(S,b)},provideDocumentSemanticTokensEdits:i?(S,b,E)=>{let x=this._client,$=x.middleware,U=(M,z,B)=>{let pe={textDocument:x.code2ProtocolConverter.asTextDocumentIdentifier(M),previousResultId:z};return x.sendRequest(be.SemanticTokensDeltaRequest.type,pe,B).then(async J=>B.isCancellationRequested?null:be.SemanticTokens.is(J)?await x.protocol2CodeConverter.asSemanticTokens(J,B):await x.protocol2CodeConverter.asSemanticTokensEdits(J,B),J=>x.handleFailedRequest(be.SemanticTokensDeltaRequest.type,B,J,null))};return $.provideDocumentSemanticTokensEdits?$.provideDocumentSemanticTokensEdits(S,b,E,U):U(S,b,E)}:void 0}:void 0,c=e.range===!0?{provideDocumentRangeSemanticTokens:(S,b,E)=>{let x=this._client,$=x.middleware,U=(M,z,B)=>{let pe={textDocument:x.code2ProtocolConverter.asTextDocumentIdentifier(M),range:x.code2ProtocolConverter.asRange(z)};return x.sendRequest(be.SemanticTokensRangeRequest.type,pe,B).then(J=>B.isCancellationRequested?null:x.protocol2CodeConverter.asSemanticTokens(J,B),J=>x.handleFailedRequest(be.SemanticTokensRangeRequest.type,B,J,null))};return $.provideDocumentRangeSemanticTokens?$.provideDocumentRangeSemanticTokens(S,b,E,U):U(S,b,E)}}:void 0,d=[],p=this._client,v=p.protocol2CodeConverter.asSemanticTokensLegend(e.legend),m=p.protocol2CodeConverter.asDocumentSelector(t);return o!==void 0&&d.push($a.languages.registerDocumentSemanticTokensProvider(m,o,v)),c!==void 0&&d.push($a.languages.registerDocumentRangeSemanticTokensProvider(m,c,v)),[new $a.Disposable(()=>d.forEach(S=>S.dispose())),{range:c,full:o,onDidChangeSemanticTokensEmitter:s}]}};Ua.SemanticTokensFeature=jf});var lw=I(fn=>{"use strict";Object.defineProperty(fn,"__esModule",{value:!0});fn.WillDeleteFilesFeature=fn.WillRenameFilesFeature=fn.WillCreateFilesFeature=fn.DidDeleteFilesFeature=fn.DidRenameFilesFeature=fn.DidCreateFilesFeature=void 0;var Xn=require("vscode"),GT=ua(),xr=me(),JT=at();function uw(r,e){return r[e]===void 0&&(r[e]={}),r[e]}function XT(r,e){return r[e]}function dw(r,e,t){r[e]=t}var zs=class r{constructor(e,t,n,i,s){this._client=e,this._event=t,this._registrationType=n,this._clientCapability=i,this._serverCapability=s,this._filters=new Map}getState(){return{kind:"workspace",id:this._registrationType.method,registrations:this._filters.size>0}}filterSize(){return this._filters.size}get registrationType(){return this._registrationType}fillClientCapabilities(e){let t=uw(uw(e,"workspace"),"fileOperations");dw(t,"dynamicRegistration",!0),dw(t,this._clientCapability,!0)}initialize(e){let t=e.workspace?.fileOperations,n=t!==void 0?XT(t,this._serverCapability):void 0;if(n?.filters!==void 0)try{this.register({id:JT.generateUuid(),registerOptions:{filters:n.filters}})}catch(i){this._client.warn(`Ignoring invalid glob pattern for ${this._serverCapability} registration: ${i}`)}}register(e){this._listener||(this._listener=this._event(this.send,this));let t=e.registerOptions.filters.map(n=>{let i=new GT.Minimatch(n.pattern.glob,r.asMinimatchOptions(n.pattern.options));if(!i.makeRe())throw new Error(`Invalid pattern ${n.pattern.glob}!`);return{scheme:n.scheme,matcher:i,kind:n.pattern.matches}});this._filters.set(e.id,t)}unregister(e){this._filters.delete(e),this._filters.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}clear(){this._filters.clear(),this._listener&&(this._listener.dispose(),this._listener=void 0)}getFileType(e){return r.getFileType(e)}async filter(e,t){let n=await Promise.all(e.files.map(async s=>{let o=t(s),a=o.fsPath.replace(/\\/g,"/");for(let c of this._filters.values())for(let d of c)if(!(d.scheme!==void 0&&d.scheme!==o.scheme)){if(d.matcher.match(a)){if(d.kind===void 0)return!0;let p=await this.getFileType(o);if(p===void 0)return this._client.error(`Failed to determine file type for ${o.toString()}.`),!0;if(p===Xn.FileType.File&&d.kind===xr.FileOperationPatternKind.file||p===Xn.FileType.Directory&&d.kind===xr.FileOperationPatternKind.folder)return!0}else if(d.kind===xr.FileOperationPatternKind.folder&&await r.getFileType(o)===Xn.FileType.Directory&&d.matcher.match(`${a}/`))return!0}return!1})),i=e.files.filter((s,o)=>n[o]);return{...e,files:i}}static async getFileType(e){try{return(await Xn.workspace.fs.stat(e)).type}catch{return}}static asMinimatchOptions(e){let t={dot:!0};return e?.ignoreCase===!0&&(t.nocase=!0),t}},Wa=class extends zs{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s),this._notificationType=n,this._accessUri=o,this._createParams=a}async send(e){let t=await this.filter(e,this._accessUri);if(t.files.length){let n=async i=>this._client.sendNotification(this._notificationType,this._createParams(i));return this.doSend(t,n)}}},Ha=class extends Wa{constructor(){super(...arguments),this._fsPathFileTypes=new Map}async getFileType(e){let t=e.fsPath;if(this._fsPathFileTypes.has(t))return this._fsPathFileTypes.get(t);let n=await zs.getFileType(e);return n&&this._fsPathFileTypes.set(t,n),n}async cacheFileTypes(e,t){await this.filter(e,t)}clearFileTypeCache(){this._fsPathFileTypes.clear()}unregister(e){super.unregister(e),this.filterSize()===0&&this._willListener&&(this._willListener.dispose(),this._willListener=void 0)}clear(){super.clear(),this._willListener&&(this._willListener.dispose(),this._willListener=void 0)}},$f=class extends Wa{constructor(e){super(e,Xn.workspace.onDidCreateFiles,xr.DidCreateFilesNotification.type,"didCreate","didCreate",t=>t,e.code2ProtocolConverter.asDidCreateFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.didCreateFiles?n.didCreateFiles(e,t):t(e)}};fn.DidCreateFilesFeature=$f;var Uf=class extends Ha{constructor(e){super(e,Xn.workspace.onDidRenameFiles,xr.DidRenameFilesNotification.type,"didRename","didRename",t=>t.oldUri,e.code2ProtocolConverter.asDidRenameFilesParams)}register(e){this._willListener||(this._willListener=Xn.workspace.onWillRenameFiles(this.willRename,this)),super.register(e)}willRename(e){e.waitUntil(this.cacheFileTypes(e,t=>t.oldUri))}doSend(e,t){this.clearFileTypeCache();let n=this._client.middleware.workspace;return n?.didRenameFiles?n.didRenameFiles(e,t):t(e)}};fn.DidRenameFilesFeature=Uf;var Wf=class extends Ha{constructor(e){super(e,Xn.workspace.onDidDeleteFiles,xr.DidDeleteFilesNotification.type,"didDelete","didDelete",t=>t,e.code2ProtocolConverter.asDidDeleteFilesParams)}register(e){this._willListener||(this._willListener=Xn.workspace.onWillDeleteFiles(this.willDelete,this)),super.register(e)}willDelete(e){e.waitUntil(this.cacheFileTypes(e,t=>t))}doSend(e,t){this.clearFileTypeCache();let n=this._client.middleware.workspace;return n?.didDeleteFiles?n.didDeleteFiles(e,t):t(e)}};fn.DidDeleteFilesFeature=Wf;var Ks=class extends zs{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s),this._requestType=n,this._accessUri=o,this._createParams=a}async send(e){let t=this.waitUntil(e);e.waitUntil(t)}async waitUntil(e){let t=await this.filter(e,this._accessUri);if(t.files.length){let n=i=>this._client.sendRequest(this._requestType,this._createParams(i),i.token).then(this._client.protocol2CodeConverter.asWorkspaceEdit);return this.doSend(t,n)}else return}},Hf=class extends Ks{constructor(e){super(e,Xn.workspace.onWillCreateFiles,xr.WillCreateFilesRequest.type,"willCreate","willCreate",t=>t,e.code2ProtocolConverter.asWillCreateFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willCreateFiles?n.willCreateFiles(e,t):t(e)}};fn.WillCreateFilesFeature=Hf;var Vf=class extends Ks{constructor(e){super(e,Xn.workspace.onWillRenameFiles,xr.WillRenameFilesRequest.type,"willRename","willRename",t=>t.oldUri,e.code2ProtocolConverter.asWillRenameFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willRenameFiles?n.willRenameFiles(e,t):t(e)}};fn.WillRenameFilesFeature=Vf;var zf=class extends Ks{constructor(e){super(e,Xn.workspace.onWillDeleteFiles,xr.WillDeleteFilesRequest.type,"willDelete","willDelete",t=>t,e.code2ProtocolConverter.asWillDeleteFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willDeleteFiles?n.willDeleteFiles(e,t):t(e)}};fn.WillDeleteFilesFeature=zf});var fw=I(Va=>{"use strict";Object.defineProperty(Va,"__esModule",{value:!0});Va.LinkedEditingFeature=void 0;var QT=require("vscode"),Kf=me(),Bf=Ie(),Gf=class extends Bf.TextDocumentLanguageFeature{constructor(e){super(e,Kf.LinkedEditingRangeRequest.type)}fillClientCapabilities(e){let t=(0,Bf.ensure)((0,Bf.ensure)(e,"textDocument"),"linkedEditingRange");t.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.linkedEditingRangeProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideLinkedEditingRanges:(i,s,o)=>{let a=this._client,c=(p,v,m)=>a.sendRequest(Kf.LinkedEditingRangeRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,v),m).then(S=>m.isCancellationRequested?null:a.protocol2CodeConverter.asLinkedEditingRanges(S,m),S=>a.handleFailedRequest(Kf.LinkedEditingRangeRequest.type,m,S,null)),d=a.middleware;return d.provideLinkedEditingRange?d.provideLinkedEditingRange(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return QT.languages.registerLinkedEditingRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Va.LinkedEditingFeature=Gf});var hw=I(za=>{"use strict";Object.defineProperty(za,"__esModule",{value:!0});za.TypeHierarchyFeature=void 0;var YT=require("vscode"),yi=me(),Jf=Ie(),Xf=class{constructor(e){this.client=e,this.middleware=e.middleware}prepareTypeHierarchy(e,t,n){let i=this.client,s=this.middleware,o=(a,c,d)=>{let p=i.code2ProtocolConverter.asTextDocumentPositionParams(a,c);return i.sendRequest(yi.TypeHierarchyPrepareRequest.type,p,d).then(v=>d.isCancellationRequested?null:i.protocol2CodeConverter.asTypeHierarchyItems(v,d),v=>i.handleFailedRequest(yi.TypeHierarchyPrepareRequest.type,d,v,null))};return s.prepareTypeHierarchy?s.prepareTypeHierarchy(e,t,n,o):o(e,t,n)}provideTypeHierarchySupertypes(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asTypeHierarchyItem(o)};return n.sendRequest(yi.TypeHierarchySupertypesRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asTypeHierarchyItems(d,a),d=>n.handleFailedRequest(yi.TypeHierarchySupertypesRequest.type,a,d,null))};return i.provideTypeHierarchySupertypes?i.provideTypeHierarchySupertypes(e,t,s):s(e,t)}provideTypeHierarchySubtypes(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asTypeHierarchyItem(o)};return n.sendRequest(yi.TypeHierarchySubtypesRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asTypeHierarchyItems(d,a),d=>n.handleFailedRequest(yi.TypeHierarchySubtypesRequest.type,a,d,null))};return i.provideTypeHierarchySubtypes?i.provideTypeHierarchySubtypes(e,t,s):s(e,t)}},Qf=class extends Jf.TextDocumentLanguageFeature{constructor(e){super(e,yi.TypeHierarchyPrepareRequest.type)}fillClientCapabilities(e){let t=(0,Jf.ensure)((0,Jf.ensure)(e,"textDocument"),"typeHierarchy");t.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.typeHierarchyProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=this._client,n=new Xf(t);return[YT.languages.registerTypeHierarchyProvider(t.protocol2CodeConverter.asDocumentSelector(e.documentSelector),n),n]}};za.TypeHierarchyFeature=Qf});var gw=I(Ba=>{"use strict";Object.defineProperty(Ba,"__esModule",{value:!0});Ba.InlineValueFeature=void 0;var pw=require("vscode"),Ka=me(),Bs=Ie(),Yf=class extends Bs.TextDocumentLanguageFeature{constructor(e){super(e,Ka.InlineValueRequest.type)}fillClientCapabilities(e){(0,Bs.ensure)((0,Bs.ensure)(e,"textDocument"),"inlineValue").dynamicRegistration=!0,(0,Bs.ensure)((0,Bs.ensure)(e,"workspace"),"inlineValue").refreshSupport=!0}initialize(e,t){this._client.onRequest(Ka.InlineValueRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeInlineValues.fire()});let[n,i]=this.getRegistration(t,e.inlineValueProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new pw.EventEmitter,i={onDidChangeInlineValues:n.event,provideInlineValues:(s,o,a,c)=>{let d=this._client,p=(m,S,b,E)=>{let x={textDocument:d.code2ProtocolConverter.asTextDocumentIdentifier(m),range:d.code2ProtocolConverter.asRange(S),context:d.code2ProtocolConverter.asInlineValueContext(b)};return d.sendRequest(Ka.InlineValueRequest.type,x,E).then($=>E.isCancellationRequested?null:d.protocol2CodeConverter.asInlineValues($,E),$=>d.handleFailedRequest(Ka.InlineValueRequest.type,E,$,null))},v=d.middleware;return v.provideInlineValues?v.provideInlineValues(s,o,a,c,p):p(s,o,a,c)}};return[this.registerProvider(t,i),{provider:i,onDidChangeInlineValues:n}]}registerProvider(e,t){return pw.languages.registerInlineValuesProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Ba.InlineValueFeature=Yf});var vw=I(Ga=>{"use strict";Object.defineProperty(Ga,"__esModule",{value:!0});Ga.InlayHintsFeature=void 0;var mw=require("vscode"),ts=me(),Gs=Ie(),Zf=class extends Gs.TextDocumentLanguageFeature{constructor(e){super(e,ts.InlayHintRequest.type)}fillClientCapabilities(e){let t=(0,Gs.ensure)((0,Gs.ensure)(e,"textDocument"),"inlayHint");t.dynamicRegistration=!0,t.resolveSupport={properties:["tooltip","textEdits","label.tooltip","label.location","label.command"]},(0,Gs.ensure)((0,Gs.ensure)(e,"workspace"),"inlayHint").refreshSupport=!0}initialize(e,t){this._client.onRequest(ts.InlayHintRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeInlayHints.fire()});let[n,i]=this.getRegistration(t,e.inlayHintProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new mw.EventEmitter,i={onDidChangeInlayHints:n.event,provideInlayHints:(s,o,a)=>{let c=this._client,d=async(v,m,S)=>{let b={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(v),range:c.code2ProtocolConverter.asRange(m)};try{let E=await c.sendRequest(ts.InlayHintRequest.type,b,S);return S.isCancellationRequested?null:c.protocol2CodeConverter.asInlayHints(E,S)}catch(E){return c.handleFailedRequest(ts.InlayHintRequest.type,S,E,null)}},p=c.middleware;return p.provideInlayHints?p.provideInlayHints(s,o,a,d):d(s,o,a)}};return i.resolveInlayHint=e.resolveProvider===!0?(s,o)=>{let a=this._client,c=async(p,v)=>{try{let m=await a.sendRequest(ts.InlayHintResolveRequest.type,a.code2ProtocolConverter.asInlayHint(p),v);if(v.isCancellationRequested)return null;let S=a.protocol2CodeConverter.asInlayHint(m,v);return v.isCancellationRequested?null:S}catch(m){return a.handleFailedRequest(ts.InlayHintResolveRequest.type,v,m,null)}},d=a.middleware;return d.resolveInlayHint?d.resolveInlayHint(s,o,c):c(s,o)}:void 0,[this.registerProvider(t,i),{provider:i,onDidChangeInlayHints:n}]}registerProvider(e,t){return mw.languages.registerInlayHintsProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Ga.InlayHintsFeature=Zf});var yw=I(Ja=>{"use strict";Object.defineProperty(Ja,"__esModule",{value:!0});Ja.InlineCompletionItemFeature=void 0;var ZT=require("vscode"),eh=me(),th=Ie(),eD=at(),nh=class extends th.TextDocumentLanguageFeature{constructor(e){super(e,eh.InlineCompletionRequest.type)}fillClientCapabilities(e){let t=(0,th.ensure)((0,th.ensure)(e,"textDocument"),"inlineCompletion");t.dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.inlineCompletionProvider);n&&this.register({id:eD.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideInlineCompletionItems:(i,s,o,a)=>{let c=this._client,d=this._client.middleware,p=(v,m,S,b)=>c.sendRequest(eh.InlineCompletionRequest.type,c.code2ProtocolConverter.asInlineCompletionParams(v,m,S),b).then(E=>b.isCancellationRequested?null:c.protocol2CodeConverter.asInlineCompletionResult(E,b),E=>c.handleFailedRequest(eh.InlineCompletionRequest.type,b,E,null));return d.provideInlineCompletionItems?d.provideInlineCompletionItems(i,s,o,a,p):p(i,s,o,a)}};return[ZT.languages.registerInlineCompletionItemProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Ja.InlineCompletionItemFeature=nh});var ch=I(Mt=>{"use strict";Object.defineProperty(Mt,"__esModule",{value:!0});Mt.ProposedFeatures=Mt.BaseLanguageClient=Mt.MessageTransports=Mt.SuspendMode=Mt.State=Mt.CloseAction=Mt.ErrorAction=Mt.RevealOutputChannelOn=void 0;var je=require("vscode"),H=me(),tD=Gy(),nD=Qy(),ar=Vn(),Xa=na(),bw=at(),rD=ol(),or=Ie(),iD=Dl(),ww=kb(),Cw=xb(),ns=Ib(),sD=qb(),oD=Ob(),aD=Fb(),cD=Mb(),uD=Nb(),dD=Ql(),lD=jb(),fD=$b(),hD=Ub(),pD=Hb(),rh=Vb(),gD=Kb(),mD=Bb(),vD=Jb(),yD=Xb(),bD=Qb(),wD=Yb(),CD=Zb(),RD=ew(),SD=nw(),_D=rw(),TD=iw(),DD=ow(),PD=aw(),kD=cw(),rs=lw(),ED=fw(),xD=hw(),ID=gw(),qD=vw(),OD=yw(),bi;(function(r){r[r.Debug=0]="Debug",r[r.Info=1]="Info",r[r.Warn=2]="Warn",r[r.Error=3]="Error",r[r.Never=4]="Never"})(bi||(Mt.RevealOutputChannelOn=bi={}));var Xs;(function(r){r[r.Continue=1]="Continue",r[r.Shutdown=2]="Shutdown"})(Xs||(Mt.ErrorAction=Xs={}));var Xr;(function(r){r[r.DoNotRestart=1]="DoNotRestart",r[r.Restart=2]="Restart"})(Xr||(Mt.CloseAction=Xr={}));var Js;(function(r){r[r.Stopped=1]="Stopped",r[r.Starting=3]="Starting",r[r.Running=2]="Running"})(Js||(Mt.State=Js={}));var Rw;(function(r){r.off="off",r.on="on"})(Rw||(Mt.SuspendMode=Rw={}));var ih;(function(r){function e(t){return t==null?!1:typeof t=="boolean"||typeof t=="object"&&t!==null&&ar.stringArray(t.enabledCommands)?t:!1}r.sanitizeIsTrusted=e})(ih||(ih={}));var sh=class{constructor(e,t){this.client=e,this.maxRestartCount=t,this.restarts=[]}error(e,t,n){return n&&n<=3?{action:Xs.Continue}:{action:Xs.Shutdown}}closed(){return this.restarts.push(Date.now()),this.restarts.length<=this.maxRestartCount?{action:Xr.Restart}:this.restarts[this.restarts.length-1]-this.restarts[0]<=180*1e3?{action:Xr.DoNotRestart,message:`The ${this.client.name} server crashed ${this.maxRestartCount+1} times in the last 3 minutes. The server will not be restarted. See the output for more information.`}:(this.restarts.shift(),{action:Xr.Restart})}},Te;(function(r){r.Initial="initial",r.Starting="starting",r.StartFailed="startFailed",r.Running="running",r.Stopping="stopping",r.Stopped="stopped"})(Te||(Te={}));var Sw;(function(r){function e(t){return t&&H.MessageReader.is(t.reader)&&H.MessageWriter.is(t.writer)}r.is=e})(Sw||(Mt.MessageTransports=Sw={}));var Qs=class r{constructor(e,t,n){this._traceFormat=H.TraceFormat.Text,this._diagnosticQueue=new Map,this._diagnosticQueueState={state:"idle"},this._features=[],this._dynamicFeatures=new Map,this.workspaceEditLock=new Xa.Semaphore(1),this._id=e,this._name=t,n=n||{};let i={isTrusted:!1,supportHtml:!1};n.markdown!==void 0&&(i.isTrusted=ih.sanitizeIsTrusted(n.markdown.isTrusted),i.supportHtml=n.markdown.supportHtml===!0),this._clientOptions={documentSelector:n.documentSelector??[],synchronize:n.synchronize??{},diagnosticCollectionName:n.diagnosticCollectionName,outputChannelName:n.outputChannelName??this._name,revealOutputChannelOn:n.revealOutputChannelOn??bi.Error,stdioEncoding:n.stdioEncoding??"utf8",initializationOptions:n.initializationOptions,initializationFailedHandler:n.initializationFailedHandler,progressOnInitialization:!!n.progressOnInitialization,errorHandler:n.errorHandler??this.createDefaultErrorHandler(n.connectionOptions?.maxRestartCount),middleware:n.middleware??{},uriConverters:n.uriConverters,workspaceFolder:n.workspaceFolder,connectionOptions:n.connectionOptions,markdown:i,diagnosticPullOptions:n.diagnosticPullOptions??{onChange:!0,onSave:!1},notebookDocumentOptions:n.notebookDocumentOptions??{}},this._clientOptions.synchronize=this._clientOptions.synchronize||{},this._state=Te.Initial,this._ignoredRegistrations=new Set,this._listeners=[],this._notificationHandlers=new Map,this._pendingNotificationHandlers=new Map,this._notificationDisposables=new Map,this._requestHandlers=new Map,this._pendingRequestHandlers=new Map,this._requestDisposables=new Map,this._progressHandlers=new Map,this._pendingProgressHandlers=new Map,this._progressDisposables=new Map,this._connection=void 0,this._initializeResult=void 0,n.outputChannel?(this._outputChannel=n.outputChannel,this._disposeOutputChannel=!1):(this._outputChannel=void 0,this._disposeOutputChannel=!0),this._traceOutputChannel=n.traceOutputChannel,this._diagnostics=void 0,this._pendingOpenNotifications=new Set,this._pendingChangeSemaphore=new Xa.Semaphore(1),this._pendingChangeDelayer=new Xa.Delayer(250),this._fileEvents=[],this._fileEventDelayer=new Xa.Delayer(250),this._onStop=void 0,this._telemetryEmitter=new H.Emitter,this._stateChangeEmitter=new H.Emitter,this._trace=H.Trace.Off,this._tracer={log:(s,o)=>{ar.string(s)?this.logTrace(s,o):this.logObjectTrace(s)}},this._c2p=tD.createConverter(n.uriConverters?n.uriConverters.code2Protocol:void 0),this._p2c=nD.createConverter(n.uriConverters?n.uriConverters.protocol2Code:void 0,this._clientOptions.markdown.isTrusted,this._clientOptions.markdown.supportHtml),this._syncedDocuments=new Map,this.registerBuiltinFeatures()}get name(){return this._name}get middleware(){return this._clientOptions.middleware??Object.create(null)}get clientOptions(){return this._clientOptions}get protocol2CodeConverter(){return this._p2c}get code2ProtocolConverter(){return this._c2p}get onTelemetry(){return this._telemetryEmitter.event}get onDidChangeState(){return this._stateChangeEmitter.event}get outputChannel(){return this._outputChannel||(this._outputChannel=je.window.createOutputChannel(this._clientOptions.outputChannelName?this._clientOptions.outputChannelName:this._name)),this._outputChannel}get traceOutputChannel(){return this._traceOutputChannel?this._traceOutputChannel:this.outputChannel}get diagnostics(){return this._diagnostics}get state(){return this.getPublicState()}get $state(){return this._state}set $state(e){let t=this.getPublicState();this._state=e;let n=this.getPublicState();n!==t&&this._stateChangeEmitter.fire({oldState:t,newState:n})}getPublicState(){switch(this.$state){case Te.Starting:return Js.Starting;case Te.Running:return Js.Running;default:return Js.Stopped}}get initializeResult(){return this._initializeResult}async sendRequest(e,...t){if(this.$state===Te.StartFailed||this.$state===Te.Stopping||this.$state===Te.Stopped)return Promise.reject(new H.ResponseError(H.ErrorCodes.ConnectionInactive,"Client is not running"));let n=await this.$start();this._didChangeTextDocumentFeature.syncKind===H.TextDocumentSyncKind.Full&&await this.sendPendingFullTextDocumentChanges(n);let i=this._clientOptions.middleware?.sendRequest;if(i!==void 0){let s,o;return t.length===1?H.CancellationToken.is(t[0])?o=t[0]:s=t[0]:t.length===2&&(s=t[0],o=t[1]),i(e,s,o,(a,c,d)=>{let p=[];return c!==void 0&&p.push(c),d!==void 0&&p.push(d),n.sendRequest(a,...p)})}else return n.sendRequest(e,...t)}onRequest(e,t){let n=typeof e=="string"?e:e.method;this._requestHandlers.set(n,t);let i=this.activeConnection(),s;return i!==void 0?(this._requestDisposables.set(n,i.onRequest(e,t)),s={dispose:()=>{let o=this._requestDisposables.get(n);o!==void 0&&(o.dispose(),this._requestDisposables.delete(n))}}):(this._pendingRequestHandlers.set(n,t),s={dispose:()=>{this._pendingRequestHandlers.delete(n);let o=this._requestDisposables.get(n);o!==void 0&&(o.dispose(),this._requestDisposables.delete(n))}}),{dispose:()=>{this._requestHandlers.delete(n),s.dispose()}}}async sendNotification(e,t){if(this.$state===Te.StartFailed||this.$state===Te.Stopping||this.$state===Te.Stopped)return Promise.reject(new H.ResponseError(H.ErrorCodes.ConnectionInactive,"Client is not running"));let n=this._didChangeTextDocumentFeature.syncKind===H.TextDocumentSyncKind.Full,i;n&&typeof e!="string"&&e.method===H.DidOpenTextDocumentNotification.method&&(i=t?.textDocument.uri,this._pendingOpenNotifications.add(i));let s=await this.$start();n&&await this.sendPendingFullTextDocumentChanges(s),i!==void 0&&this._pendingOpenNotifications.delete(i);let o=this._clientOptions.middleware?.sendNotification;return o?o(e,s.sendNotification.bind(s),t):s.sendNotification(e,t)}onNotification(e,t){let n=typeof e=="string"?e:e.method;this._notificationHandlers.set(n,t);let i=this.activeConnection(),s;return i!==void 0?(this._notificationDisposables.set(n,i.onNotification(e,t)),s={dispose:()=>{let o=this._notificationDisposables.get(n);o!==void 0&&(o.dispose(),this._notificationDisposables.delete(n))}}):(this._pendingNotificationHandlers.set(n,t),s={dispose:()=>{this._pendingNotificationHandlers.delete(n);let o=this._notificationDisposables.get(n);o!==void 0&&(o.dispose(),this._notificationDisposables.delete(n))}}),{dispose:()=>{this._notificationHandlers.delete(n),s.dispose()}}}async sendProgress(e,t,n){if(this.$state===Te.StartFailed||this.$state===Te.Stopping||this.$state===Te.Stopped)return Promise.reject(new H.ResponseError(H.ErrorCodes.ConnectionInactive,"Client is not running"));try{return(await this.$start()).sendProgress(e,t,n)}catch(i){throw this.error(`Sending progress for token ${t} failed.`,i),i}}onProgress(e,t,n){this._progressHandlers.set(t,{type:e,handler:n});let i=this.activeConnection(),s,o=this._clientOptions.middleware?.handleWorkDoneProgress,a=H.WorkDoneProgress.is(e)&&o!==void 0?c=>{o(t,c,()=>n(c))}:n;return i!==void 0?(this._progressDisposables.set(t,i.onProgress(e,t,a)),s={dispose:()=>{let c=this._progressDisposables.get(t);c!==void 0&&(c.dispose(),this._progressDisposables.delete(t))}}):(this._pendingProgressHandlers.set(t,{type:e,handler:n}),s={dispose:()=>{this._pendingProgressHandlers.delete(t);let c=this._progressDisposables.get(t);c!==void 0&&(c.dispose(),this._progressDisposables.delete(t))}}),{dispose:()=>{this._progressHandlers.delete(t),s.dispose()}}}createDefaultErrorHandler(e){if(e!==void 0&&e<0)throw new Error(`Invalid maxRestartCount: ${e}`);return new sh(this,e??4)}async setTrace(e){this._trace=e;let t=this.activeConnection();t!==void 0&&await t.trace(this._trace,this._tracer,{sendNotification:!1,traceFormat:this._traceFormat})}data2String(e){if(e instanceof H.ResponseError){let t=e;return`  Message: ${t.message}
  Code: ${t.code} ${t.data?`
`+t.data.toString():""}`}return e instanceof Error?ar.string(e.stack)?e.stack:e.message:ar.string(e)?e:e.toString()}debug(e,t,n=!0){this.logOutputMessage(H.MessageType.Debug,bi.Debug,"Debug",e,t,n)}info(e,t,n=!0){this.logOutputMessage(H.MessageType.Info,bi.Info,"Info",e,t,n)}warn(e,t,n=!0){this.logOutputMessage(H.MessageType.Warning,bi.Warn,"Warn",e,t,n)}error(e,t,n=!0){this.logOutputMessage(H.MessageType.Error,bi.Error,"Error",e,t,n)}logOutputMessage(e,t,n,i,s,o){this.outputChannel.appendLine(`[${n.padEnd(5)} - ${new Date().toLocaleTimeString()}] ${i}`),s!=null&&this.outputChannel.appendLine(this.data2String(s)),(o==="force"||o&&this._clientOptions.revealOutputChannelOn<=t)&&this.showNotificationMessage(e,i)}showNotificationMessage(e,t){t=t??"A request has failed. See the output for more information.",(e===H.MessageType.Error?je.window.showErrorMessage:e===H.MessageType.Warning?je.window.showWarningMessage:je.window.showInformationMessage)(t,"Go to output").then(i=>{i!==void 0&&this.outputChannel.show(!0)})}logTrace(e,t){this.traceOutputChannel.appendLine(`[Trace - ${new Date().toLocaleTimeString()}] ${e}`),t&&this.traceOutputChannel.appendLine(this.data2String(t))}logObjectTrace(e){e.isLSPMessage&&e.type?this.traceOutputChannel.append(`[LSP   - ${new Date().toLocaleTimeString()}] `):this.traceOutputChannel.append(`[Trace - ${new Date().toLocaleTimeString()}] `),e&&this.traceOutputChannel.appendLine(`${JSON.stringify(e)}`)}needsStart(){return this.$state===Te.Initial||this.$state===Te.Stopping||this.$state===Te.Stopped}needsStop(){return this.$state===Te.Starting||this.$state===Te.Running}activeConnection(){return this.$state===Te.Running&&this._connection!==void 0?this._connection:void 0}isRunning(){return this.$state===Te.Running}async start(){if(this._disposed==="disposing"||this._disposed==="disposed")throw new Error("Client got disposed and can't be restarted.");if(this.$state===Te.Stopping)throw new Error("Client is currently stopping. Can only restart a full stopped client");if(this._onStart!==void 0)return this._onStart;let[e,t,n]=this.createOnStartPromise();this._onStart=e,this._diagnostics===void 0&&(this._diagnostics=this._clientOptions.diagnosticCollectionName?je.languages.createDiagnosticCollection(this._clientOptions.diagnosticCollectionName):je.languages.createDiagnosticCollection());for(let[i,s]of this._notificationHandlers)this._pendingNotificationHandlers.has(i)||this._pendingNotificationHandlers.set(i,s);for(let[i,s]of this._requestHandlers)this._pendingRequestHandlers.has(i)||this._pendingRequestHandlers.set(i,s);for(let[i,s]of this._progressHandlers)this._pendingProgressHandlers.has(i)||this._pendingProgressHandlers.set(i,s);this.$state=Te.Starting;try{let i=await this.createConnection();i.onNotification(H.LogMessageNotification.type,s=>{switch(s.type){case H.MessageType.Error:this.error(s.message,void 0,!1);break;case H.MessageType.Warning:this.warn(s.message,void 0,!1);break;case H.MessageType.Info:this.info(s.message,void 0,!1);break;case H.MessageType.Debug:this.debug(s.message,void 0,!1);break;default:this.outputChannel.appendLine(s.message)}}),i.onNotification(H.ShowMessageNotification.type,s=>{switch(s.type){case H.MessageType.Error:je.window.showErrorMessage(s.message);break;case H.MessageType.Warning:je.window.showWarningMessage(s.message);break;case H.MessageType.Info:je.window.showInformationMessage(s.message);break;default:je.window.showInformationMessage(s.message)}}),i.onRequest(H.ShowMessageRequest.type,s=>{let o;switch(s.type){case H.MessageType.Error:o=je.window.showErrorMessage;break;case H.MessageType.Warning:o=je.window.showWarningMessage;break;case H.MessageType.Info:o=je.window.showInformationMessage;break;default:o=je.window.showInformationMessage}let a=s.actions||[];return o(s.message,...a)}),i.onNotification(H.TelemetryEventNotification.type,s=>{this._telemetryEmitter.fire(s)}),i.onRequest(H.ShowDocumentRequest.type,async s=>{let o=async c=>{let d=this.protocol2CodeConverter.asUri(c.uri);try{if(c.external===!0)return{success:await je.env.openExternal(d)};{let p={};return c.selection!==void 0&&(p.selection=this.protocol2CodeConverter.asRange(c.selection)),c.takeFocus===void 0||c.takeFocus===!1?p.preserveFocus=!0:c.takeFocus===!0&&(p.preserveFocus=!1),await je.window.showTextDocument(d,p),{success:!0}}}catch{return{success:!1}}},a=this._clientOptions.middleware.window?.showDocument;return a!==void 0?a(s,o):o(s)}),i.listen(),await this.initialize(i),t()}catch(i){this.$state=Te.StartFailed,this.error(`${this._name} client: couldn't create connection to server.`,i,"force"),n(i)}return this._onStart}createOnStartPromise(){let e,t;return[new Promise((i,s)=>{e=i,t=s}),e,t]}async initialize(e){this.refreshTrace(e,!1);let t=this._clientOptions.initializationOptions,[n,i]=this._clientOptions.workspaceFolder!==void 0?[this._clientOptions.workspaceFolder.uri.fsPath,[{uri:this._c2p.asUri(this._clientOptions.workspaceFolder.uri),name:this._clientOptions.workspaceFolder.name}]]:[this._clientGetRootPath(),null],s={processId:null,clientInfo:{name:je.env.appName,version:je.version},locale:this.getLocale(),rootPath:n||null,rootUri:n?this._c2p.asUri(je.Uri.file(n)):null,capabilities:this.computeClientCapabilities(),initializationOptions:ar.func(t)?t():t,trace:H.Trace.toString(this._trace),workspaceFolders:i};if(this.fillInitializeParams(s),this._clientOptions.progressOnInitialization){let o=bw.generateUuid(),a=new rD.ProgressPart(e,o);s.workDoneToken=o;try{let c=await this.doInitialize(e,s);return a.done(),c}catch(c){throw a.cancel(),c}}else return this.doInitialize(e,s)}async doInitialize(e,t){try{let n=await e.initialize(t);if(n.capabilities.positionEncoding!==void 0&&n.capabilities.positionEncoding!==H.PositionEncodingKind.UTF16)throw new Error(`Unsupported position encoding (${n.capabilities.positionEncoding}) received from server ${this.name}`);this._initializeResult=n,this.$state=Te.Running;let i;ar.number(n.capabilities.textDocumentSync)?n.capabilities.textDocumentSync===H.TextDocumentSyncKind.None?i={openClose:!1,change:H.TextDocumentSyncKind.None,save:void 0}:i={openClose:!0,change:n.capabilities.textDocumentSync,save:{includeText:!1}}:n.capabilities.textDocumentSync!==void 0&&n.capabilities.textDocumentSync!==null&&(i=n.capabilities.textDocumentSync),this._capabilities=Object.assign({},n.capabilities,{resolvedTextDocumentSync:i}),e.onNotification(H.PublishDiagnosticsNotification.type,s=>this.handleDiagnostics(s)),e.onRequest(H.RegistrationRequest.type,s=>this.handleRegistrationRequest(s)),e.onRequest("client/registerFeature",s=>this.handleRegistrationRequest(s)),e.onRequest(H.UnregistrationRequest.type,s=>this.handleUnregistrationRequest(s)),e.onRequest("client/unregisterFeature",s=>this.handleUnregistrationRequest(s)),e.onRequest(H.ApplyWorkspaceEditRequest.type,s=>this.handleApplyWorkspaceEdit(s));for(let[s,o]of this._pendingNotificationHandlers)this._notificationDisposables.set(s,e.onNotification(s,o));this._pendingNotificationHandlers.clear();for(let[s,o]of this._pendingRequestHandlers)this._requestDisposables.set(s,e.onRequest(s,o));this._pendingRequestHandlers.clear();for(let[s,o]of this._pendingProgressHandlers)this._progressDisposables.set(s,e.onProgress(o.type,s,o.handler));return this._pendingProgressHandlers.clear(),await e.sendNotification(H.InitializedNotification.type,{}),this.hookFileEvents(e),this.hookConfigurationChanged(e),this.initializeFeatures(e),n}catch(n){throw this._clientOptions.initializationFailedHandler?this._clientOptions.initializationFailedHandler(n)?this.initialize(e):this.stop():n instanceof H.ResponseError&&n.data&&n.data.retry?je.window.showErrorMessage(n.message,{title:"Retry",id:"retry"}).then(i=>{i&&i.id==="retry"?this.initialize(e):this.stop()}):(n&&n.message&&je.window.showErrorMessage(n.message),this.error("Server initialization failed.",n),this.stop()),n}}_clientGetRootPath(){let e=je.workspace.workspaceFolders;if(!e||e.length===0)return;let t=e[0];if(t.uri.scheme==="file")return t.uri.fsPath}stop(e=2e3){return this.shutdown("stop",e)}dispose(e=2e3){try{return this._disposed="disposing",this.stop(e)}finally{this._disposed="disposed"}}async shutdown(e,t){if(this.$state===Te.Stopped||this.$state===Te.Initial)return;if(this.$state===Te.Stopping){if(this._onStop!==void 0)return this._onStop;throw new Error("Client is stopping but no stop promise available.")}let n=this.activeConnection();if(n===void 0||this.$state!==Te.Running)throw new Error(`Client is not running and can't be stopped. It's current state is: ${this.$state}`);this._initializeResult=void 0,this.$state=Te.Stopping,this.cleanUp(e);let i=new Promise(o=>{(0,H.RAL)().timer.setTimeout(o,t)}),s=(async o=>(await o.shutdown(),await o.exit(),o))(n);return this._onStop=Promise.race([i,s]).then(o=>{if(o!==void 0)o.end(),o.dispose();else throw this.error("Stopping server timed out",void 0,!1),new Error("Stopping the server timed out")},o=>{throw this.error("Stopping server failed",o,!1),o}).finally(()=>{this.$state=Te.Stopped,e==="stop"&&this.cleanUpChannel(),this._onStart=void 0,this._onStop=void 0,this._connection=void 0,this._ignoredRegistrations.clear()})}cleanUp(e){this._fileEvents=[],this._fileEventDelayer.cancel();let t=this._listeners.splice(0,this._listeners.length);for(let n of t)n.dispose();this._syncedDocuments&&this._syncedDocuments.clear();for(let n of Array.from(this._features.entries()).map(i=>i[1]).reverse())n.clear();e==="stop"&&this._diagnostics!==void 0&&(this._diagnostics.dispose(),this._diagnostics=void 0),this._idleInterval!==void 0&&(this._idleInterval.dispose(),this._idleInterval=void 0)}cleanUpChannel(){this._outputChannel!==void 0&&this._disposeOutputChannel&&(this._outputChannel.dispose(),this._outputChannel=void 0)}notifyFileEvent(e){let t=this;async function n(s){return t._fileEvents.push(s),t._fileEventDelayer.trigger(async()=>{await t.sendNotification(H.DidChangeWatchedFilesNotification.type,{changes:t._fileEvents}),t._fileEvents=[]})}let i=this.clientOptions.middleware?.workspace;(i?.didChangeWatchedFile?i.didChangeWatchedFile(e,n):n(e)).catch(s=>{t.error("Notify file events failed.",s)})}async sendPendingFullTextDocumentChanges(e){return this._pendingChangeSemaphore.lock(async()=>{try{let t=this._didChangeTextDocumentFeature.getPendingDocumentChanges(this._pendingOpenNotifications);if(t.length===0)return;for(let n of t){let i=this.code2ProtocolConverter.asChangeTextDocumentParams(n);await e.sendNotification(H.DidChangeTextDocumentNotification.type,i),this._didChangeTextDocumentFeature.notificationSent(n,H.DidChangeTextDocumentNotification.type,i)}}catch(t){throw this.error("Sending pending changes failed",t,!1),t}})}triggerPendingChangeDelivery(){this._pendingChangeDelayer.trigger(async()=>{let e=this.activeConnection();if(e===void 0){this.triggerPendingChangeDelivery();return}await this.sendPendingFullTextDocumentChanges(e)}).catch(e=>this.error("Delivering pending changes failed",e,!1))}handleDiagnostics(e){if(!this._diagnostics)return;let t=e.uri;this._diagnosticQueueState.state==="busy"&&this._diagnosticQueueState.document===t&&this._diagnosticQueueState.tokenSource.cancel(),this._diagnosticQueue.set(e.uri,e.diagnostics),this.triggerDiagnosticQueue()}triggerDiagnosticQueue(){(0,H.RAL)().timer.setImmediate(()=>{this.workDiagnosticQueue()})}workDiagnosticQueue(){if(this._diagnosticQueueState.state==="busy")return;let e=this._diagnosticQueue.entries().next();if(e.done===!0)return;let[t,n]=e.value;this._diagnosticQueue.delete(t);let i=new je.CancellationTokenSource;this._diagnosticQueueState={state:"busy",document:t,tokenSource:i},this._p2c.asDiagnostics(n,i.token).then(s=>{if(!i.token.isCancellationRequested){let o=this._p2c.asUri(t),a=this.clientOptions.middleware;a.handleDiagnostics?a.handleDiagnostics(o,s,(c,d)=>this.setDiagnostics(c,d)):this.setDiagnostics(o,s)}}).finally(()=>{this._diagnosticQueueState={state:"idle"},this.triggerDiagnosticQueue()})}setDiagnostics(e,t){this._diagnostics&&this._diagnostics.set(e,t)}getLocale(){return je.env.language}async $start(){if(this.$state===Te.StartFailed)throw new Error("Previous start failed. Can't restart server.");await this.start();let e=this.activeConnection();if(e===void 0)throw new Error("Starting server failed");return e}async createConnection(){let e=(i,s,o)=>{this.handleConnectionError(i,s,o).catch(a=>this.error("Handling connection error failed",a))},t=()=>{this.handleConnectionClosed().catch(i=>this.error("Handling connection close failed",i))},n=await this.createMessageTransports(this._clientOptions.stdioEncoding||"utf8");return this._connection=FD(n.reader,n.writer,e,t,this._clientOptions.connectionOptions),this._connection}async handleConnectionClosed(){if(this.$state===Te.Stopped)return;try{this._connection!==void 0&&this._connection.dispose()}catch{}let e={action:Xr.DoNotRestart};if(this.$state!==Te.Stopping)try{e=await this._clientOptions.errorHandler.closed()}catch{}this._connection=void 0,e.action===Xr.DoNotRestart?(this.error(e.message??"Connection to server got closed. Server will not be restarted.",void 0,e.handled===!0?!1:"force"),this.cleanUp("stop"),this.$state===Te.Starting?this.$state=Te.StartFailed:this.$state=Te.Stopped,this._onStop=Promise.resolve(),this._onStart=void 0):e.action===Xr.Restart&&(this.info(e.message??"Connection to server got closed. Server will restart.",!e.handled),this.cleanUp("restart"),this.$state=Te.Initial,this._onStop=Promise.resolve(),this._onStart=void 0,this.start().catch(t=>this.error("Restarting server failed",t,"force")))}async handleConnectionError(e,t,n){let i=await this._clientOptions.errorHandler.error(e,t,n);i.action===Xs.Shutdown?(this.error(i.message??`Client ${this._name}: connection to server is erroring.
${e.message}
Shutting down server.`,void 0,i.handled===!0?!1:"force"),this.stop().catch(s=>{this.error("Stopping server failed",s,!1)})):this.error(i.message??`Client ${this._name}: connection to server is erroring.
${e.message}`,void 0,i.handled===!0?!1:"force")}hookConfigurationChanged(e){this._listeners.push(je.workspace.onDidChangeConfiguration(()=>{this.refreshTrace(e,!0)}))}refreshTrace(e,t=!1){let n=je.workspace.getConfiguration(this._id),i=H.Trace.Off,s=H.TraceFormat.Text;if(n){let o=n.get("trace.server","off");typeof o=="string"?i=H.Trace.fromString(o):(i=H.Trace.fromString(n.get("trace.server.verbosity","off")),s=H.TraceFormat.fromString(n.get("trace.server.format","text")))}this._trace=i,this._traceFormat=s,e.trace(this._trace,this._tracer,{sendNotification:t,traceFormat:this._traceFormat}).catch(o=>{this.error("Updating trace failed with error",o,!1)})}hookFileEvents(e){let t=this._clientOptions.synchronize.fileEvents;if(!t)return;let n;ar.array(t)?n=t:n=[t],n&&this._dynamicFeatures.get(H.DidChangeWatchedFilesNotification.type.method).registerRaw(bw.generateUuid(),n)}registerFeatures(e){for(let t of e)this.registerFeature(t)}registerFeature(e){if(this._features.push(e),or.DynamicFeature.is(e)){let t=e.registrationType;this._dynamicFeatures.set(t.method,e)}}getFeature(e){return this._dynamicFeatures.get(e)}hasDedicatedTextSynchronizationFeature(e){let t=this.getFeature(H.NotebookDocumentSyncRegistrationType.method);return t===void 0||!(t instanceof ww.NotebookDocumentSyncFeature)?!1:t.handles(e)}registerBuiltinFeatures(){let e=new Map;this.registerFeature(new Cw.ConfigurationFeature(this)),this.registerFeature(new ns.DidOpenTextDocumentFeature(this,this._syncedDocuments)),this._didChangeTextDocumentFeature=new ns.DidChangeTextDocumentFeature(this,e),this._didChangeTextDocumentFeature.onPendingChangeAdded(()=>{this.triggerPendingChangeDelivery()}),this.registerFeature(this._didChangeTextDocumentFeature),this.registerFeature(new ns.WillSaveFeature(this)),this.registerFeature(new ns.WillSaveWaitUntilFeature(this)),this.registerFeature(new ns.DidSaveTextDocumentFeature(this)),this.registerFeature(new ns.DidCloseTextDocumentFeature(this,this._syncedDocuments,e)),this.registerFeature(new yD.FileSystemWatcherFeature(this,t=>this.notifyFileEvent(t))),this.registerFeature(new sD.CompletionItemFeature(this)),this.registerFeature(new oD.HoverFeature(this)),this.registerFeature(new cD.SignatureHelpFeature(this)),this.registerFeature(new aD.DefinitionFeature(this)),this.registerFeature(new fD.ReferencesFeature(this)),this.registerFeature(new uD.DocumentHighlightFeature(this)),this.registerFeature(new dD.DocumentSymbolFeature(this)),this.registerFeature(new lD.WorkspaceSymbolFeature(this)),this.registerFeature(new hD.CodeActionFeature(this)),this.registerFeature(new pD.CodeLensFeature(this)),this.registerFeature(new rh.DocumentFormattingFeature(this)),this.registerFeature(new rh.DocumentRangeFormattingFeature(this)),this.registerFeature(new rh.DocumentOnTypeFormattingFeature(this)),this.registerFeature(new gD.RenameFeature(this)),this.registerFeature(new mD.DocumentLinkFeature(this)),this.registerFeature(new vD.ExecuteCommandFeature(this)),this.registerFeature(new Cw.SyncConfigurationFeature(this)),this.registerFeature(new CD.TypeDefinitionFeature(this)),this.registerFeature(new wD.ImplementationFeature(this)),this.registerFeature(new bD.ColorProviderFeature(this)),this.clientOptions.workspaceFolder===void 0&&this.registerFeature(new RD.WorkspaceFoldersFeature(this)),this.registerFeature(new SD.FoldingRangeFeature(this)),this.registerFeature(new _D.DeclarationFeature(this)),this.registerFeature(new TD.SelectionRangeFeature(this)),this.registerFeature(new DD.ProgressFeature(this)),this.registerFeature(new PD.CallHierarchyFeature(this)),this.registerFeature(new kD.SemanticTokensFeature(this)),this.registerFeature(new ED.LinkedEditingFeature(this)),this.registerFeature(new rs.DidCreateFilesFeature(this)),this.registerFeature(new rs.DidRenameFilesFeature(this)),this.registerFeature(new rs.DidDeleteFilesFeature(this)),this.registerFeature(new rs.WillCreateFilesFeature(this)),this.registerFeature(new rs.WillRenameFilesFeature(this)),this.registerFeature(new rs.WillDeleteFilesFeature(this)),this.registerFeature(new xD.TypeHierarchyFeature(this)),this.registerFeature(new ID.InlineValueFeature(this)),this.registerFeature(new qD.InlayHintsFeature(this)),this.registerFeature(new iD.DiagnosticFeature(this)),this.registerFeature(new ww.NotebookDocumentSyncFeature(this))}registerProposedFeatures(){this.registerFeatures(ah.createAll(this))}fillInitializeParams(e){for(let t of this._features)ar.func(t.fillInitializeParams)&&t.fillInitializeParams(e)}computeClientCapabilities(){let e={};(0,or.ensure)(e,"workspace").applyEdit=!0;let t=(0,or.ensure)((0,or.ensure)(e,"workspace"),"workspaceEdit");t.documentChanges=!0,t.resourceOperations=[H.ResourceOperationKind.Create,H.ResourceOperationKind.Rename,H.ResourceOperationKind.Delete],t.failureHandling=H.FailureHandlingKind.TextOnlyTransactional,t.normalizesLineEndings=!0,t.changeAnnotationSupport={groupsOnLabel:!0};let n=(0,or.ensure)((0,or.ensure)(e,"textDocument"),"publishDiagnostics");n.relatedInformation=!0,n.versionSupport=!1,n.tagSupport={valueSet:[H.DiagnosticTag.Unnecessary,H.DiagnosticTag.Deprecated]},n.codeDescriptionSupport=!0,n.dataSupport=!0;let i=(0,or.ensure)(e,"window"),s=(0,or.ensure)(i,"showMessage");s.messageActionItem={additionalPropertiesSupport:!0};let o=(0,or.ensure)(i,"showDocument");o.support=!0;let a=(0,or.ensure)(e,"general");a.staleRequestSupport={cancel:!0,retryOnContentModified:Array.from(r.RequestsToCancelOnContentModified)},a.regularExpressions={engine:"ECMAScript",version:"ES2020"},a.markdown={parser:"marked",version:"1.1.0"},a.positionEncodings=["utf-16"],this._clientOptions.markdown.supportHtml&&(a.markdown.allowedTags=["ul","li","p","code","blockquote","ol","h1","h2","h3","h4","h5","h6","hr","em","pre","table","thead","tbody","tr","th","td","div","del","a","strong","br","img","span"]);for(let c of this._features)c.fillClientCapabilities(e);return e}initializeFeatures(e){let t=this._clientOptions.documentSelector;for(let n of this._features)ar.func(n.preInitialize)&&n.preInitialize(this._capabilities,t);for(let n of this._features)n.initialize(this._capabilities,t)}async handleRegistrationRequest(e){let t=this.clientOptions.middleware?.handleRegisterCapability;return t?t(e,n=>this.doRegisterCapability(n)):this.doRegisterCapability(e)}async doRegisterCapability(e){if(!this.isRunning()){for(let t of e.registrations)this._ignoredRegistrations.add(t.id);return}for(let t of e.registrations){let n=this._dynamicFeatures.get(t.method);if(n===void 0)return Promise.reject(new Error(`No feature implementation for ${t.method} found. Registration failed.`));let i=t.registerOptions??{};i.documentSelector=i.documentSelector??this._clientOptions.documentSelector;let s={id:t.id,registerOptions:i};try{n.register(s)}catch(o){return Promise.reject(o)}}}async handleUnregistrationRequest(e){let t=this.clientOptions.middleware?.handleUnregisterCapability;return t?t(e,n=>this.doUnregisterCapability(n)):this.doUnregisterCapability(e)}async doUnregisterCapability(e){for(let t of e.unregisterations){if(this._ignoredRegistrations.has(t.id))continue;let n=this._dynamicFeatures.get(t.method);if(!n)return Promise.reject(new Error(`No feature implementation for ${t.method} found. Unregistration failed.`));n.unregister(t.id)}}async handleApplyWorkspaceEdit(e){let t=e.edit,n=await this.workspaceEditLock.lock(()=>this._p2c.asWorkspaceEdit(t)),i=new Map;je.workspace.textDocuments.forEach(o=>i.set(o.uri.toString(),o));let s=!1;if(t.documentChanges){for(let o of t.documentChanges)if(H.TextDocumentEdit.is(o)&&o.textDocument.version&&o.textDocument.version>=0){let a=this._p2c.asUri(o.textDocument.uri).toString(),c=i.get(a);if(c&&c.version!==o.textDocument.version){s=!0;break}}}return s?Promise.resolve({applied:!1}):ar.asPromise(je.workspace.applyEdit(n).then(o=>({applied:o})))}handleFailedRequest(e,t,n,i,s=!0){if(n instanceof H.ResponseError){if(n.code===H.ErrorCodes.PendingResponseRejected||n.code===H.ErrorCodes.ConnectionInactive)return i;if(n.code===H.LSPErrorCodes.RequestCancelled||n.code===H.LSPErrorCodes.ServerCancelled){if(t!==void 0&&t.isCancellationRequested)return i;throw n.data!==void 0?new or.LSPCancellationError(n.data):new je.CancellationError}else if(n.code===H.LSPErrorCodes.ContentModified){if(r.RequestsToCancelOnContentModified.has(e.method)||r.CancellableResolveCalls.has(e.method))throw new je.CancellationError;return i}}throw this.error(`Request ${e.method} failed.`,n,s),n}};Mt.BaseLanguageClient=Qs;Qs.RequestsToCancelOnContentModified=new Set([H.SemanticTokensRequest.method,H.SemanticTokensRangeRequest.method,H.SemanticTokensDeltaRequest.method]);Qs.CancellableResolveCalls=new Set([H.CompletionResolveRequest.method,H.CodeLensResolveRequest.method,H.CodeActionResolveRequest.method,H.InlayHintResolveRequest.method,H.DocumentLinkResolveRequest.method,H.WorkspaceSymbolResolveRequest.method]);var oh=class{error(e){(0,H.RAL)().console.error(e)}warn(e){(0,H.RAL)().console.warn(e)}info(e){(0,H.RAL)().console.info(e)}log(e){(0,H.RAL)().console.log(e)}};function FD(r,e,t,n,i){let s=new oh,o=(0,H.createProtocolConnection)(r,e,s,i);return o.onError(c=>{t(c[0],c[1],c[2])}),o.onClose(n),{listen:()=>o.listen(),sendRequest:o.sendRequest,onRequest:o.onRequest,hasPendingResponse:o.hasPendingResponse,sendNotification:o.sendNotification,onNotification:o.onNotification,onProgress:o.onProgress,sendProgress:o.sendProgress,trace:(c,d,p)=>{let v={sendNotification:!1,traceFormat:H.TraceFormat.Text};return p===void 0?o.trace(c,d,v):(ar.boolean(p),o.trace(c,d,p))},initialize:c=>o.sendRequest(H.InitializeRequest.type,c),shutdown:()=>o.sendRequest(H.ShutdownRequest.type,void 0),exit:()=>o.sendNotification(H.ExitNotification.type),end:()=>o.end(),dispose:()=>o.dispose()}}var ah;(function(r){function e(t){return[new OD.InlineCompletionItemFeature(t)]}r.createAll=e})(ah||(Mt.ProposedFeatures=ah={}))});var Tw=I(Qa=>{"use strict";Object.defineProperty(Qa,"__esModule",{value:!0});Qa.terminate=void 0;var _w=require("child_process"),LD=require("path"),MD=process.platform==="win32",ND=process.platform==="darwin",AD=process.platform==="linux";function jD(r,e){if(MD)try{let i={stdio:["pipe","pipe","ignore"]};return e&&(i.cwd=e),_w.execFileSync("taskkill",["/T","/F","/PID",r.pid.toString()],i),!0}catch{return!1}else if(AD||ND)try{var t=(0,LD.join)(__dirname,"terminateProcess.sh"),n=_w.spawnSync(t,[r.pid.toString()]);return!n.error}catch{return!1}else return r.kill("SIGKILL"),!0}Qa.terminate=jD});var uh=I((Kx,Dw)=>{"use strict";Dw.exports=me()});var Ys=I((Bx,Pw)=>{var $D=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};Pw.exports=$D});var Ya=I((Gx,kw)=>{var UD="2.0.0",WD=Number.MAX_SAFE_INTEGER||9007199254740991,HD=16,VD=250,zD=["major","premajor","minor","preminor","patch","prepatch","prerelease"];kw.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:HD,MAX_SAFE_BUILD_LENGTH:VD,MAX_SAFE_INTEGER:WD,RELEASE_TYPES:zD,SEMVER_SPEC_VERSION:UD,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Za=I((wr,Ew)=>{var{MAX_SAFE_COMPONENT_LENGTH:dh,MAX_SAFE_BUILD_LENGTH:KD,MAX_LENGTH:BD}=Ya(),GD=Ys();wr=Ew.exports={};var JD=wr.re=[],XD=wr.safeRe=[],X=wr.src=[],QD=wr.safeSrc=[],Q=wr.t={},YD=0,lh="[a-zA-Z0-9-]",ZD=[["\\s",1],["\\d",BD],[lh,KD]],eP=r=>{for(let[e,t]of ZD)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},we=(r,e,t)=>{let n=eP(e),i=YD++;GD(r,i,e),Q[r]=i,X[i]=e,QD[i]=n,JD[i]=new RegExp(e,t?"g":void 0),XD[i]=new RegExp(n,t?"g":void 0)};we("NUMERICIDENTIFIER","0|[1-9]\\d*");we("NUMERICIDENTIFIERLOOSE","\\d+");we("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${lh}*`);we("MAINVERSION",`(${X[Q.NUMERICIDENTIFIER]})\\.(${X[Q.NUMERICIDENTIFIER]})\\.(${X[Q.NUMERICIDENTIFIER]})`);we("MAINVERSIONLOOSE",`(${X[Q.NUMERICIDENTIFIERLOOSE]})\\.(${X[Q.NUMERICIDENTIFIERLOOSE]})\\.(${X[Q.NUMERICIDENTIFIERLOOSE]})`);we("PRERELEASEIDENTIFIER",`(?:${X[Q.NUMERICIDENTIFIER]}|${X[Q.NONNUMERICIDENTIFIER]})`);we("PRERELEASEIDENTIFIERLOOSE",`(?:${X[Q.NUMERICIDENTIFIERLOOSE]}|${X[Q.NONNUMERICIDENTIFIER]})`);we("PRERELEASE",`(?:-(${X[Q.PRERELEASEIDENTIFIER]}(?:\\.${X[Q.PRERELEASEIDENTIFIER]})*))`);we("PRERELEASELOOSE",`(?:-?(${X[Q.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${X[Q.PRERELEASEIDENTIFIERLOOSE]})*))`);we("BUILDIDENTIFIER",`${lh}+`);we("BUILD",`(?:\\+(${X[Q.BUILDIDENTIFIER]}(?:\\.${X[Q.BUILDIDENTIFIER]})*))`);we("FULLPLAIN",`v?${X[Q.MAINVERSION]}${X[Q.PRERELEASE]}?${X[Q.BUILD]}?`);we("FULL",`^${X[Q.FULLPLAIN]}$`);we("LOOSEPLAIN",`[v=\\s]*${X[Q.MAINVERSIONLOOSE]}${X[Q.PRERELEASELOOSE]}?${X[Q.BUILD]}?`);we("LOOSE",`^${X[Q.LOOSEPLAIN]}$`);we("GTLT","((?:<|>)?=?)");we("XRANGEIDENTIFIERLOOSE",`${X[Q.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);we("XRANGEIDENTIFIER",`${X[Q.NUMERICIDENTIFIER]}|x|X|\\*`);we("XRANGEPLAIN",`[v=\\s]*(${X[Q.XRANGEIDENTIFIER]})(?:\\.(${X[Q.XRANGEIDENTIFIER]})(?:\\.(${X[Q.XRANGEIDENTIFIER]})(?:${X[Q.PRERELEASE]})?${X[Q.BUILD]}?)?)?`);we("XRANGEPLAINLOOSE",`[v=\\s]*(${X[Q.XRANGEIDENTIFIERLOOSE]})(?:\\.(${X[Q.XRANGEIDENTIFIERLOOSE]})(?:\\.(${X[Q.XRANGEIDENTIFIERLOOSE]})(?:${X[Q.PRERELEASELOOSE]})?${X[Q.BUILD]}?)?)?`);we("XRANGE",`^${X[Q.GTLT]}\\s*${X[Q.XRANGEPLAIN]}$`);we("XRANGELOOSE",`^${X[Q.GTLT]}\\s*${X[Q.XRANGEPLAINLOOSE]}$`);we("COERCEPLAIN",`(^|[^\\d])(\\d{1,${dh}})(?:\\.(\\d{1,${dh}}))?(?:\\.(\\d{1,${dh}}))?`);we("COERCE",`${X[Q.COERCEPLAIN]}(?:$|[^\\d])`);we("COERCEFULL",X[Q.COERCEPLAIN]+`(?:${X[Q.PRERELEASE]})?(?:${X[Q.BUILD]})?(?:$|[^\\d])`);we("COERCERTL",X[Q.COERCE],!0);we("COERCERTLFULL",X[Q.COERCEFULL],!0);we("LONETILDE","(?:~>?)");we("TILDETRIM",`(\\s*)${X[Q.LONETILDE]}\\s+`,!0);wr.tildeTrimReplace="$1~";we("TILDE",`^${X[Q.LONETILDE]}${X[Q.XRANGEPLAIN]}$`);we("TILDELOOSE",`^${X[Q.LONETILDE]}${X[Q.XRANGEPLAINLOOSE]}$`);we("LONECARET","(?:\\^)");we("CARETTRIM",`(\\s*)${X[Q.LONECARET]}\\s+`,!0);wr.caretTrimReplace="$1^";we("CARET",`^${X[Q.LONECARET]}${X[Q.XRANGEPLAIN]}$`);we("CARETLOOSE",`^${X[Q.LONECARET]}${X[Q.XRANGEPLAINLOOSE]}$`);we("COMPARATORLOOSE",`^${X[Q.GTLT]}\\s*(${X[Q.LOOSEPLAIN]})$|^$`);we("COMPARATOR",`^${X[Q.GTLT]}\\s*(${X[Q.FULLPLAIN]})$|^$`);we("COMPARATORTRIM",`(\\s*)${X[Q.GTLT]}\\s*(${X[Q.LOOSEPLAIN]}|${X[Q.XRANGEPLAIN]})`,!0);wr.comparatorTrimReplace="$1$2$3";we("HYPHENRANGE",`^\\s*(${X[Q.XRANGEPLAIN]})\\s+-\\s+(${X[Q.XRANGEPLAIN]})\\s*$`);we("HYPHENRANGELOOSE",`^\\s*(${X[Q.XRANGEPLAINLOOSE]})\\s+-\\s+(${X[Q.XRANGEPLAINLOOSE]})\\s*$`);we("STAR","(<|>)?=?\\s*\\*");we("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");we("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var ec=I((Jx,xw)=>{var tP=Object.freeze({loose:!0}),nP=Object.freeze({}),rP=r=>r?typeof r!="object"?tP:r:nP;xw.exports=rP});var Fw=I((Xx,Ow)=>{var Iw=/^[0-9]+$/,qw=(r,e)=>{let t=Iw.test(r),n=Iw.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1},iP=(r,e)=>qw(e,r);Ow.exports={compareIdentifiers:qw,rcompareIdentifiers:iP}});var Zs=I((Qx,Aw)=>{var tc=Ys(),{MAX_LENGTH:Lw,MAX_SAFE_INTEGER:nc}=Ya(),{safeRe:Mw,safeSrc:Nw,t:rc}=Za(),sP=ec(),{compareIdentifiers:is}=Fw(),fh=class r{constructor(e,t){if(t=sP(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Lw)throw new TypeError(`version is longer than ${Lw} characters`);tc("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let n=e.trim().match(t.loose?Mw[rc.LOOSE]:Mw[rc.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>nc||this.major<0)throw new TypeError("Invalid major version");if(this.minor>nc||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>nc||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let s=+i;if(s>=0&&s<nc)return s}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(tc("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),is(this.major,e.major)||is(this.minor,e.minor)||is(this.patch,e.patch)}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let n=this.prerelease[t],i=e.prerelease[t];if(tc("prerelease compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return is(n,i)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let n=this.build[t],i=e.build[t];if(tc("build compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return is(n,i)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let i=new RegExp(`^${this.options.loose?Nw[rc.PRERELEASELOOSE]:Nw[rc.PRERELEASE]}$`),s=`-${t}`.match(i);if(!s||s[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(t){let s=[t,i];n===!1&&(s=[t]),is(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Aw.exports=fh});var Uw=I((Yx,$w)=>{var jw=Zs(),oP=(r,e,t=!1)=>{if(r instanceof jw)return r;try{return new jw(r,e)}catch(n){if(!t)return null;throw n}};$w.exports=oP});var Hw=I((Zx,Ww)=>{var hh=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let i=this.map.keys().next().value;this.delete(i)}this.map.set(e,t)}return this}};Ww.exports=hh});var wi=I((eI,zw)=>{var Vw=Zs(),aP=(r,e,t)=>new Vw(r,t).compare(new Vw(e,t));zw.exports=aP});var Bw=I((tI,Kw)=>{var cP=wi(),uP=(r,e,t)=>cP(r,e,t)===0;Kw.exports=uP});var Jw=I((nI,Gw)=>{var dP=wi(),lP=(r,e,t)=>dP(r,e,t)!==0;Gw.exports=lP});var Qw=I((rI,Xw)=>{var fP=wi(),hP=(r,e,t)=>fP(r,e,t)>0;Xw.exports=hP});var Zw=I((iI,Yw)=>{var pP=wi(),gP=(r,e,t)=>pP(r,e,t)>=0;Yw.exports=gP});var tC=I((sI,eC)=>{var mP=wi(),vP=(r,e,t)=>mP(r,e,t)<0;eC.exports=vP});var rC=I((oI,nC)=>{var yP=wi(),bP=(r,e,t)=>yP(r,e,t)<=0;nC.exports=bP});var sC=I((aI,iC)=>{var wP=Bw(),CP=Jw(),RP=Qw(),SP=Zw(),_P=tC(),TP=rC(),DP=(r,e,t,n)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return wP(r,t,n);case"!=":return CP(r,t,n);case">":return RP(r,t,n);case">=":return SP(r,t,n);case"<":return _P(r,t,n);case"<=":return TP(r,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};iC.exports=DP});var fC=I((cI,lC)=>{var eo=Symbol("SemVer ANY"),mh=class r{static get ANY(){return eo}constructor(e,t){if(t=oC(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),gh("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===eo?this.value="":this.value=this.operator+this.semver.version,gh("comp",this)}parse(e){let t=this.options.loose?aC[cC.COMPARATORLOOSE]:aC[cC.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new uC(n[2],this.options.loose):this.semver=eo}toString(){return this.value}test(e){if(gh("Comparator.test",e,this.options.loose),this.semver===eo||e===eo)return!0;if(typeof e=="string")try{e=new uC(e,this.options)}catch{return!1}return ph(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new dC(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new dC(this.value,t).test(e.semver):(t=oC(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||ph(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||ph(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};lC.exports=mh;var oC=ec(),{safeRe:aC,t:cC}=Za(),ph=sC(),gh=Ys(),uC=Zs(),dC=vh()});var vh=I((uI,mC)=>{var PP=/\s+/g,yh=class r{constructor(e,t){if(t=EP(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof bh)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(PP," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(i=>!pC(i[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let i of this.set)if(i.length===1&&MP(i[0])){this.set=[i];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let n=0;n<t.length;n++)n>0&&(this.formatted+=" "),this.formatted+=t[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&FP)|(this.options.loose&&LP))+":"+e,i=hC.get(n);if(i)return i;let s=this.options.loose,o=s?hn[nn.HYPHENRANGELOOSE]:hn[nn.HYPHENRANGE];e=e.replace(o,KP(this.options.includePrerelease)),tt("hyphen replace",e),e=e.replace(hn[nn.COMPARATORTRIM],IP),tt("comparator trim",e),e=e.replace(hn[nn.TILDETRIM],qP),tt("tilde trim",e),e=e.replace(hn[nn.CARETTRIM],OP),tt("caret trim",e);let a=e.split(" ").map(v=>NP(v,this.options)).join(" ").split(/\s+/).map(v=>zP(v,this.options));s&&(a=a.filter(v=>(tt("loose invalid filter",v,this.options),!!v.match(hn[nn.COMPARATORLOOSE])))),tt("range list",a);let c=new Map,d=a.map(v=>new bh(v,this.options));for(let v of d){if(pC(v))return[v];c.set(v.value,v)}c.size>1&&c.has("")&&c.delete("");let p=[...c.values()];return hC.set(n,p),p}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(n=>gC(n,t)&&e.set.some(i=>gC(i,t)&&n.every(s=>i.every(o=>s.intersects(o,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new xP(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(BP(this.set[t],e,this.options))return!0;return!1}};mC.exports=yh;var kP=Hw(),hC=new kP,EP=ec(),bh=fC(),tt=Ys(),xP=Zs(),{safeRe:hn,t:nn,comparatorTrimReplace:IP,tildeTrimReplace:qP,caretTrimReplace:OP}=Za(),{FLAG_INCLUDE_PRERELEASE:FP,FLAG_LOOSE:LP}=Ya(),pC=r=>r.value==="<0.0.0-0",MP=r=>r.value==="",gC=(r,e)=>{let t=!0,n=r.slice(),i=n.pop();for(;t&&n.length;)t=n.every(s=>i.intersects(s,e)),i=n.pop();return t},NP=(r,e)=>(tt("comp",r,e),r=$P(r,e),tt("caret",r),r=AP(r,e),tt("tildes",r),r=WP(r,e),tt("xrange",r),r=VP(r,e),tt("stars",r),r),rn=r=>!r||r.toLowerCase()==="x"||r==="*",AP=(r,e)=>r.trim().split(/\s+/).map(t=>jP(t,e)).join(" "),jP=(r,e)=>{let t=e.loose?hn[nn.TILDELOOSE]:hn[nn.TILDE];return r.replace(t,(n,i,s,o,a)=>{tt("tilde",r,n,i,s,o,a);let c;return rn(i)?c="":rn(s)?c=`>=${i}.0.0 <${+i+1}.0.0-0`:rn(o)?c=`>=${i}.${s}.0 <${i}.${+s+1}.0-0`:a?(tt("replaceTilde pr",a),c=`>=${i}.${s}.${o}-${a} <${i}.${+s+1}.0-0`):c=`>=${i}.${s}.${o} <${i}.${+s+1}.0-0`,tt("tilde return",c),c})},$P=(r,e)=>r.trim().split(/\s+/).map(t=>UP(t,e)).join(" "),UP=(r,e)=>{tt("caret",r,e);let t=e.loose?hn[nn.CARETLOOSE]:hn[nn.CARET],n=e.includePrerelease?"-0":"";return r.replace(t,(i,s,o,a,c)=>{tt("caret",r,i,s,o,a,c);let d;return rn(s)?d="":rn(o)?d=`>=${s}.0.0${n} <${+s+1}.0.0-0`:rn(a)?s==="0"?d=`>=${s}.${o}.0${n} <${s}.${+o+1}.0-0`:d=`>=${s}.${o}.0${n} <${+s+1}.0.0-0`:c?(tt("replaceCaret pr",c),s==="0"?o==="0"?d=`>=${s}.${o}.${a}-${c} <${s}.${o}.${+a+1}-0`:d=`>=${s}.${o}.${a}-${c} <${s}.${+o+1}.0-0`:d=`>=${s}.${o}.${a}-${c} <${+s+1}.0.0-0`):(tt("no pr"),s==="0"?o==="0"?d=`>=${s}.${o}.${a}${n} <${s}.${o}.${+a+1}-0`:d=`>=${s}.${o}.${a}${n} <${s}.${+o+1}.0-0`:d=`>=${s}.${o}.${a} <${+s+1}.0.0-0`),tt("caret return",d),d})},WP=(r,e)=>(tt("replaceXRanges",r,e),r.split(/\s+/).map(t=>HP(t,e)).join(" ")),HP=(r,e)=>{r=r.trim();let t=e.loose?hn[nn.XRANGELOOSE]:hn[nn.XRANGE];return r.replace(t,(n,i,s,o,a,c)=>{tt("xRange",r,n,i,s,o,a,c);let d=rn(s),p=d||rn(o),v=p||rn(a),m=v;return i==="="&&m&&(i=""),c=e.includePrerelease?"-0":"",d?i===">"||i==="<"?n="<0.0.0-0":n="*":i&&m?(p&&(o=0),a=0,i===">"?(i=">=",p?(s=+s+1,o=0,a=0):(o=+o+1,a=0)):i==="<="&&(i="<",p?s=+s+1:o=+o+1),i==="<"&&(c="-0"),n=`${i+s}.${o}.${a}${c}`):p?n=`>=${s}.0.0${c} <${+s+1}.0.0-0`:v&&(n=`>=${s}.${o}.0${c} <${s}.${+o+1}.0-0`),tt("xRange return",n),n})},VP=(r,e)=>(tt("replaceStars",r,e),r.trim().replace(hn[nn.STAR],"")),zP=(r,e)=>(tt("replaceGTE0",r,e),r.trim().replace(hn[e.includePrerelease?nn.GTE0PRE:nn.GTE0],"")),KP=r=>(e,t,n,i,s,o,a,c,d,p,v,m)=>(rn(n)?t="":rn(i)?t=`>=${n}.0.0${r?"-0":""}`:rn(s)?t=`>=${n}.${i}.0${r?"-0":""}`:o?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,rn(d)?c="":rn(p)?c=`<${+d+1}.0.0-0`:rn(v)?c=`<${d}.${+p+1}.0-0`:m?c=`<=${d}.${p}.${v}-${m}`:r?c=`<${d}.${p}.${+v+1}-0`:c=`<=${c}`,`${t} ${c}`.trim()),BP=(r,e,t)=>{for(let n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let n=0;n<r.length;n++)if(tt(r[n].semver),r[n].semver!==bh.ANY&&r[n].semver.prerelease.length>0){let i=r[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}});var yC=I((dI,vC)=>{var GP=vh(),JP=(r,e,t)=>{try{e=new GP(e,t)}catch{return!1}return e.test(r)};vC.exports=JP});var wC=I(On=>{"use strict";var XP=On&&On.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),wh=On&&On.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&XP(e,r,t)};Object.defineProperty(On,"__esModule",{value:!0});On.DiagnosticPullMode=On.vsdiag=void 0;wh(me(),On);wh(Ie(),On);var bC=Dl();Object.defineProperty(On,"vsdiag",{enumerable:!0,get:function(){return bC.vsdiag}});Object.defineProperty(On,"DiagnosticPullMode",{enumerable:!0,get:function(){return bC.DiagnosticPullMode}});wh(ch(),On)});var ic=I(pn=>{"use strict";var QP=pn&&pn.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),SC=pn&&pn.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&QP(e,r,t)};Object.defineProperty(pn,"__esModule",{value:!0});pn.SettingMonitor=pn.LanguageClient=pn.TransportKind=void 0;var Ir=require("child_process"),Ch=require("fs"),Rh=require("path"),Yr=require("vscode"),ct=Vn(),CC=ch(),YP=Tw(),ft=uh(),ZP=Uw(),ek=yC();SC(uh(),pn);SC(wC(),pn);var RC="^1.82.0",ht;(function(r){r[r.stdio=0]="stdio",r[r.ipc=1]="ipc",r[r.pipe=2]="pipe",r[r.socket=3]="socket"})(ht||(pn.TransportKind=ht={}));var Qr;(function(r){function e(t){let n=t;return n&&n.kind===ht.socket&&ct.number(n.port)}r.isSocket=e})(Qr||(Qr={}));var Sh;(function(r){function e(t){return ct.string(t.command)}r.is=e})(Sh||(Sh={}));var _h;(function(r){function e(t){return ct.string(t.module)}r.is=e})(_h||(_h={}));var Th;(function(r){function e(t){let n=t;return n&&n.writer!==void 0&&n.reader!==void 0}r.is=e})(Th||(Th={}));var Dh;(function(r){function e(t){let n=t;return n&&n.process!==void 0&&typeof n.detached=="boolean"}r.is=e})(Dh||(Dh={}));var Ph=class extends CC.BaseLanguageClient{constructor(e,t,n,i,s){let o,a,c,d,p;ct.string(t)?(o=e,a=t,c=n,d=i,p=!!s):(o=e.toLowerCase(),a=e,c=t,d=n,p=i),p===void 0&&(p=!1),super(o,a,d),this._serverOptions=c,this._forceDebug=p,this._isInDebugMode=p;try{this.checkVersion()}catch(v){throw ct.string(v.message)&&this.outputChannel.appendLine(v.message),v}}checkVersion(){let e=ZP(Yr.version);if(!e)throw new Error(`No valid VS Code version detected. Version string is: ${Yr.version}`);if(e.prerelease&&e.prerelease.length>0&&(e.prerelease=[]),!ek(e,RC))throw new Error(`The language client requires VS Code version ${RC} but received version ${Yr.version}`)}get isInDebugMode(){return this._isInDebugMode}async restart(){await this.stop(),this.isInDebugMode?(await new Promise(e=>setTimeout(e,1e3)),await this.start()):await this.start()}stop(e=2e3){return super.stop(e).finally(()=>{if(this._serverProcess){let t=this._serverProcess;this._serverProcess=void 0,(this._isDetached===void 0||!this._isDetached)&&this.checkProcessDied(t),this._isDetached=void 0}})}checkProcessDied(e){!e||e.pid===void 0||setTimeout(()=>{try{e.pid!==void 0&&(process.kill(e.pid,0),(0,YP.terminate)(e))}catch{}},2e3)}handleConnectionClosed(){return this._serverProcess=void 0,super.handleConnectionClosed()}fillInitializeParams(e){super.fillInitializeParams(e),e.processId===null&&(e.processId=process.pid)}createMessageTransports(e){function t(p,v){if(!p&&!v)return;let m=Object.create(null);return Object.keys(process.env).forEach(S=>m[S]=process.env[S]),v&&(m.ELECTRON_RUN_AS_NODE="1",m.ELECTRON_NO_ASAR="1"),p&&Object.keys(p).forEach(S=>m[S]=p[S]),m}let n=["--debug=","--debug-brk=","--inspect=","--inspect-brk="],i=["--debug","--debug-brk","--inspect","--inspect-brk"];function s(){let p=process.execArgv;return p?p.some(v=>n.some(m=>v.startsWith(m))||i.some(m=>v===m)):!1}function o(p){if(p.stdin===null||p.stdout===null||p.stderr===null)throw new Error("Process created without stdio streams")}let a=this._serverOptions;if(ct.func(a))return a().then(p=>{if(CC.MessageTransports.is(p))return this._isDetached=!!p.detached,p;if(Th.is(p))return this._isDetached=!!p.detached,{reader:new ft.StreamMessageReader(p.reader),writer:new ft.StreamMessageWriter(p.writer)};{let v;return Dh.is(p)?(v=p.process,this._isDetached=p.detached):(v=p,this._isDetached=!1),v.stderr.on("data",m=>this.outputChannel.append(ct.string(m)?m:m.toString(e))),{reader:new ft.StreamMessageReader(v.stdout),writer:new ft.StreamMessageWriter(v.stdin)}}});let c,d=a;return d.run||d.debug?this._forceDebug||s()?(c=d.debug,this._isInDebugMode=!0):(c=d.run,this._isInDebugMode=!1):c=a,this._getServerWorkingDir(c.options).then(p=>{if(_h.is(c)&&c.module){let v=c,m=v.transport||ht.stdio;if(v.runtime){let S=[],b=v.options??Object.create(null);b.execArgv&&b.execArgv.forEach(U=>S.push(U)),S.push(v.module),v.args&&v.args.forEach(U=>S.push(U));let E=Object.create(null);E.cwd=p,E.env=t(b.env,!1);let x=this._getRuntimePath(v.runtime,p),$;if(m===ht.ipc?(E.stdio=[null,null,null,"ipc"],S.push("--node-ipc")):m===ht.stdio?S.push("--stdio"):m===ht.pipe?($=(0,ft.generateRandomPipeName)(),S.push(`--pipe=${$}`)):Qr.isSocket(m)&&S.push(`--socket=${m.port}`),S.push(`--clientProcessId=${process.pid.toString()}`),m===ht.ipc||m===ht.stdio){let U=Ir.spawn(x,S,E);return!U||!U.pid?ss(U,`Launching server using runtime ${x} failed.`):(this._serverProcess=U,U.stderr.on("data",M=>this.outputChannel.append(ct.string(M)?M:M.toString(e))),m===ht.ipc?(U.stdout.on("data",M=>this.outputChannel.append(ct.string(M)?M:M.toString(e))),Promise.resolve({reader:new ft.IPCMessageReader(U),writer:new ft.IPCMessageWriter(U)})):Promise.resolve({reader:new ft.StreamMessageReader(U.stdout),writer:new ft.StreamMessageWriter(U.stdin)}))}else{if(m===ht.pipe)return(0,ft.createClientPipeTransport)($).then(U=>{let M=Ir.spawn(x,S,E);return!M||!M.pid?ss(M,`Launching server using runtime ${x} failed.`):(this._serverProcess=M,M.stderr.on("data",z=>this.outputChannel.append(ct.string(z)?z:z.toString(e))),M.stdout.on("data",z=>this.outputChannel.append(ct.string(z)?z:z.toString(e))),U.onConnected().then(z=>({reader:z[0],writer:z[1]})))});if(Qr.isSocket(m))return(0,ft.createClientSocketTransport)(m.port).then(U=>{let M=Ir.spawn(x,S,E);return!M||!M.pid?ss(M,`Launching server using runtime ${x} failed.`):(this._serverProcess=M,M.stderr.on("data",z=>this.outputChannel.append(ct.string(z)?z:z.toString(e))),M.stdout.on("data",z=>this.outputChannel.append(ct.string(z)?z:z.toString(e))),U.onConnected().then(z=>({reader:z[0],writer:z[1]})))})}}else{let S;return new Promise((b,E)=>{let x=(v.args&&v.args.slice())??[];m===ht.ipc?x.push("--node-ipc"):m===ht.stdio?x.push("--stdio"):m===ht.pipe?(S=(0,ft.generateRandomPipeName)(),x.push(`--pipe=${S}`)):Qr.isSocket(m)&&x.push(`--socket=${m.port}`),x.push(`--clientProcessId=${process.pid.toString()}`);let $=v.options??Object.create(null);if($.env=t($.env,!0),$.execArgv=$.execArgv||[],$.cwd=p,$.silent=!0,m===ht.ipc||m===ht.stdio){let U=Ir.fork(v.module,x||[],$);o(U),this._serverProcess=U,U.stderr.on("data",M=>this.outputChannel.append(ct.string(M)?M:M.toString(e))),m===ht.ipc?(U.stdout.on("data",M=>this.outputChannel.append(ct.string(M)?M:M.toString(e))),b({reader:new ft.IPCMessageReader(this._serverProcess),writer:new ft.IPCMessageWriter(this._serverProcess)})):b({reader:new ft.StreamMessageReader(U.stdout),writer:new ft.StreamMessageWriter(U.stdin)})}else m===ht.pipe?(0,ft.createClientPipeTransport)(S).then(U=>{let M=Ir.fork(v.module,x||[],$);o(M),this._serverProcess=M,M.stderr.on("data",z=>this.outputChannel.append(ct.string(z)?z:z.toString(e))),M.stdout.on("data",z=>this.outputChannel.append(ct.string(z)?z:z.toString(e))),U.onConnected().then(z=>{b({reader:z[0],writer:z[1]})},E)},E):Qr.isSocket(m)&&(0,ft.createClientSocketTransport)(m.port).then(U=>{let M=Ir.fork(v.module,x||[],$);o(M),this._serverProcess=M,M.stderr.on("data",z=>this.outputChannel.append(ct.string(z)?z:z.toString(e))),M.stdout.on("data",z=>this.outputChannel.append(ct.string(z)?z:z.toString(e))),U.onConnected().then(z=>{b({reader:z[0],writer:z[1]})},E)},E)})}}else if(Sh.is(c)&&c.command){let v=c,m=c.args!==void 0?c.args.slice(0):[],S,b=c.transport;if(b===ht.stdio)m.push("--stdio");else if(b===ht.pipe)S=(0,ft.generateRandomPipeName)(),m.push(`--pipe=${S}`);else if(Qr.isSocket(b))m.push(`--socket=${b.port}`);else if(b===ht.ipc)throw new Error("Transport kind ipc is not support for command executable");let E=Object.assign({},v.options);if(E.cwd=E.cwd||p,b===void 0||b===ht.stdio){let x=Ir.spawn(v.command,m,E);return!x||!x.pid?ss(x,`Launching server using command ${v.command} failed.`):(x.stderr.on("data",$=>this.outputChannel.append(ct.string($)?$:$.toString(e))),this._serverProcess=x,this._isDetached=!!E.detached,Promise.resolve({reader:new ft.StreamMessageReader(x.stdout),writer:new ft.StreamMessageWriter(x.stdin)}))}else{if(b===ht.pipe)return(0,ft.createClientPipeTransport)(S).then(x=>{let $=Ir.spawn(v.command,m,E);return!$||!$.pid?ss($,`Launching server using command ${v.command} failed.`):(this._serverProcess=$,this._isDetached=!!E.detached,$.stderr.on("data",U=>this.outputChannel.append(ct.string(U)?U:U.toString(e))),$.stdout.on("data",U=>this.outputChannel.append(ct.string(U)?U:U.toString(e))),x.onConnected().then(U=>({reader:U[0],writer:U[1]})))});if(Qr.isSocket(b))return(0,ft.createClientSocketTransport)(b.port).then(x=>{let $=Ir.spawn(v.command,m,E);return!$||!$.pid?ss($,`Launching server using command ${v.command} failed.`):(this._serverProcess=$,this._isDetached=!!E.detached,$.stderr.on("data",U=>this.outputChannel.append(ct.string(U)?U:U.toString(e))),$.stdout.on("data",U=>this.outputChannel.append(ct.string(U)?U:U.toString(e))),x.onConnected().then(U=>({reader:U[0],writer:U[1]})))})}}return Promise.reject(new Error("Unsupported server configuration "+JSON.stringify(a,null,4)))}).finally(()=>{this._serverProcess!==void 0&&this._serverProcess.on("exit",(p,v)=>{p!==null&&this.error(`Server process exited with code ${p}.`,void 0,!1),v!==null&&this.error(`Server process exited with signal ${v}.`,void 0,!1)})})}_getRuntimePath(e,t){if(Rh.isAbsolute(e))return e;let n=this._mainGetRootPath();if(n!==void 0){let i=Rh.join(n,e);if(Ch.existsSync(i))return i}if(t!==void 0){let i=Rh.join(t,e);if(Ch.existsSync(i))return i}return e}_mainGetRootPath(){let e=Yr.workspace.workspaceFolders;if(!e||e.length===0)return;let t=e[0];if(t.uri.scheme==="file")return t.uri.fsPath}_getServerWorkingDir(e){let t=e&&e.cwd;return t||(t=this.clientOptions.workspaceFolder?this.clientOptions.workspaceFolder.uri.fsPath:this._mainGetRootPath()),t?new Promise(n=>{Ch.lstat(t,(i,s)=>{n(!i&&s.isDirectory()?t:void 0)})}):Promise.resolve(void 0)}};pn.LanguageClient=Ph;var kh=class{constructor(e,t){this._client=e,this._setting=t,this._listeners=[]}start(){return Yr.workspace.onDidChangeConfiguration(this.onDidChangeConfiguration,this,this._listeners),this.onDidChangeConfiguration(),new Yr.Disposable(()=>{this._client.needsStop()&&this._client.stop()})}onDidChangeConfiguration(){let e=this._setting.indexOf("."),t=e>=0?this._setting.substr(0,e):this._setting,n=e>=0?this._setting.substr(e+1):void 0,i=n?Yr.workspace.getConfiguration(t).get(n,!1):Yr.workspace.getConfiguration(t);i&&this._client.needsStart()?this._client.start().catch(s=>this._client.error("Start failed after configuration change",s,"force")):!i&&this._client.needsStop()&&this._client.stop().catch(s=>this._client.error("Stop failed after configuration change",s,"force"))}};pn.SettingMonitor=kh;function ss(r,e){return r===null?Promise.reject(e):new Promise((t,n)=>{r.on("error",i=>{n(`${e} ${i}`)}),setImmediate(()=>n(e))})}});var sc=I((hI,_C)=>{"use strict";_C.exports=ic()});var us=I(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.stringArray=Xt.array=Xt.func=Xt.error=Xt.number=Xt.string=Xt.boolean=void 0;function ak(r){return r===!0||r===!1}Xt.boolean=ak;function jC(r){return typeof r=="string"||r instanceof String}Xt.string=jC;function ck(r){return typeof r=="number"||r instanceof Number}Xt.number=ck;function uk(r){return r instanceof Error}Xt.error=uk;function dk(r){return typeof r=="function"}Xt.func=dk;function $C(r){return Array.isArray(r)}Xt.array=$C;function lk(r){return $C(r)&&r.every(e=>jC(e))}Xt.stringArray=lk});var hp=I(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.Message=oe.NotificationType9=oe.NotificationType8=oe.NotificationType7=oe.NotificationType6=oe.NotificationType5=oe.NotificationType4=oe.NotificationType3=oe.NotificationType2=oe.NotificationType1=oe.NotificationType0=oe.NotificationType=oe.RequestType9=oe.RequestType8=oe.RequestType7=oe.RequestType6=oe.RequestType5=oe.RequestType4=oe.RequestType3=oe.RequestType2=oe.RequestType1=oe.RequestType=oe.RequestType0=oe.AbstractMessageSignature=oe.ParameterStructures=oe.ResponseError=oe.ErrorCodes=void 0;var _i=us(),Hh;(function(r){r.ParseError=-32700,r.InvalidRequest=-32600,r.MethodNotFound=-32601,r.InvalidParams=-32602,r.InternalError=-32603,r.jsonrpcReservedErrorRangeStart=-32099,r.serverErrorStart=-32099,r.MessageWriteError=-32099,r.MessageReadError=-32098,r.PendingResponseRejected=-32097,r.ConnectionInactive=-32096,r.ServerNotInitialized=-32002,r.UnknownErrorCode=-32001,r.jsonrpcReservedErrorRangeEnd=-32e3,r.serverErrorEnd=-32e3})(Hh||(oe.ErrorCodes=Hh={}));var Vh=class r extends Error{constructor(e,t,n){super(t),this.code=_i.number(e)?e:Hh.UnknownErrorCode,this.data=n,Object.setPrototypeOf(this,r.prototype)}toJson(){let e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),e}};oe.ResponseError=Vh;var vn=class r{constructor(e){this.kind=e}static is(e){return e===r.auto||e===r.byName||e===r.byPosition}toString(){return this.kind}};oe.ParameterStructures=vn;vn.auto=new vn("auto");vn.byPosition=new vn("byPosition");vn.byName=new vn("byName");var nt=class{constructor(e,t){this.method=e,this.numberOfParams=t}get parameterStructures(){return vn.auto}};oe.AbstractMessageSignature=nt;var zh=class extends nt{constructor(e){super(e,0)}};oe.RequestType0=zh;var Kh=class extends nt{constructor(e,t=vn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};oe.RequestType=Kh;var Bh=class extends nt{constructor(e,t=vn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};oe.RequestType1=Bh;var Gh=class extends nt{constructor(e){super(e,2)}};oe.RequestType2=Gh;var Jh=class extends nt{constructor(e){super(e,3)}};oe.RequestType3=Jh;var Xh=class extends nt{constructor(e){super(e,4)}};oe.RequestType4=Xh;var Qh=class extends nt{constructor(e){super(e,5)}};oe.RequestType5=Qh;var Yh=class extends nt{constructor(e){super(e,6)}};oe.RequestType6=Yh;var Zh=class extends nt{constructor(e){super(e,7)}};oe.RequestType7=Zh;var ep=class extends nt{constructor(e){super(e,8)}};oe.RequestType8=ep;var tp=class extends nt{constructor(e){super(e,9)}};oe.RequestType9=tp;var np=class extends nt{constructor(e,t=vn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};oe.NotificationType=np;var rp=class extends nt{constructor(e){super(e,0)}};oe.NotificationType0=rp;var ip=class extends nt{constructor(e,t=vn.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};oe.NotificationType1=ip;var sp=class extends nt{constructor(e){super(e,2)}};oe.NotificationType2=sp;var op=class extends nt{constructor(e){super(e,3)}};oe.NotificationType3=op;var ap=class extends nt{constructor(e){super(e,4)}};oe.NotificationType4=ap;var cp=class extends nt{constructor(e){super(e,5)}};oe.NotificationType5=cp;var up=class extends nt{constructor(e){super(e,6)}};oe.NotificationType6=up;var dp=class extends nt{constructor(e){super(e,7)}};oe.NotificationType7=dp;var lp=class extends nt{constructor(e){super(e,8)}};oe.NotificationType8=lp;var fp=class extends nt{constructor(e){super(e,9)}};oe.NotificationType9=fp;var UC;(function(r){function e(i){let s=i;return s&&_i.string(s.method)&&(_i.string(s.id)||_i.number(s.id))}r.isRequest=e;function t(i){let s=i;return s&&_i.string(s.method)&&i.id===void 0}r.isNotification=t;function n(i){let s=i;return s&&(s.result!==void 0||!!s.error)&&(_i.string(s.id)||_i.number(s.id)||s.id===null)}r.isResponse=n})(UC||(oe.Message=UC={}))});var gp=I(ni=>{"use strict";var WC;Object.defineProperty(ni,"__esModule",{value:!0});ni.LRUCache=ni.LinkedMap=ni.Touch=void 0;var Qt;(function(r){r.None=0,r.First=1,r.AsOld=r.First,r.Last=2,r.AsNew=r.Last})(Qt||(ni.Touch=Qt={}));var Tc=class{constructor(){this[WC]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=Qt.None){let n=this._map.get(e);if(n)return t!==Qt.None&&this.touch(n,t),n.value}set(e,t,n=Qt.None){let i=this._map.get(e);if(i)i.value=t,n!==Qt.None&&this.touch(i,n);else{switch(i={key:e,value:t,next:void 0,previous:void 0},n){case Qt.None:this.addItemLast(i);break;case Qt.First:this.addItemFirst(i);break;case Qt.Last:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let n=this._state,i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.key,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}values(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.value,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}entries(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:[t.key,t.value],done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}[(WC=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,n=this.size;for(;t&&n>e;)this._map.delete(t.key),t=t.next,n--;this._head=t,this._size=n,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==Qt.First&&t!==Qt.Last)){if(t===Qt.First){if(e===this._head)return;let n=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===Qt.Last){if(e===this._tail)return;let n=e.next,i=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,n)=>{e.push([n,t])}),e}fromJSON(e){this.clear();for(let[t,n]of e)this.set(t,n)}};ni.LinkedMap=Tc;var pp=class extends Tc{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=Qt.AsNew){return super.get(e,t)}peek(e){return super.get(e,Qt.None)}set(e,t){return super.set(e,t,Qt.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}};ni.LRUCache=pp});var VC=I(Dc=>{"use strict";Object.defineProperty(Dc,"__esModule",{value:!0});Dc.Disposable=void 0;var HC;(function(r){function e(t){return{dispose:t}}r.create=e})(HC||(Dc.Disposable=HC={}))});var ri=I(yp=>{"use strict";Object.defineProperty(yp,"__esModule",{value:!0});var mp;function vp(){if(mp===void 0)throw new Error("No runtime abstraction layer installed");return mp}(function(r){function e(t){if(t===void 0)throw new Error("No runtime abstraction layer provided");mp=t}r.install=e})(vp||(vp={}));yp.default=vp});var ls=I(ds=>{"use strict";Object.defineProperty(ds,"__esModule",{value:!0});ds.Emitter=ds.Event=void 0;var fk=ri(),zC;(function(r){let e={dispose(){}};r.None=function(){return e}})(zC||(ds.Event=zC={}));var bp=class{add(e,t=null,n){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(n)&&n.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(!this._callbacks)return;let n=!1;for(let i=0,s=this._callbacks.length;i<s;i++)if(this._callbacks[i]===e)if(this._contexts[i]===t){this._callbacks.splice(i,1),this._contexts.splice(i,1);return}else n=!0;if(n)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];let t=[],n=this._callbacks.slice(0),i=this._contexts.slice(0);for(let s=0,o=n.length;s<o;s++)try{t.push(n[s].apply(i[s],e))}catch(a){(0,fk.default)().console.error(a)}return t}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},Pc=class r{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,n)=>{this._callbacks||(this._callbacks=new bp),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t);let i={dispose:()=>{this._callbacks&&(this._callbacks.remove(e,t),i.dispose=r._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(n)&&n.push(i),i}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}};ds.Emitter=Pc;Pc._noop=function(){}});var xc=I(fs=>{"use strict";Object.defineProperty(fs,"__esModule",{value:!0});fs.CancellationTokenSource=fs.CancellationToken=void 0;var hk=ri(),pk=us(),wp=ls(),kc;(function(r){r.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:wp.Event.None}),r.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:wp.Event.None});function e(t){let n=t;return n&&(n===r.None||n===r.Cancelled||pk.boolean(n.isCancellationRequested)&&!!n.onCancellationRequested)}r.is=e})(kc||(fs.CancellationToken=kc={}));var gk=Object.freeze(function(r,e){let t=(0,hk.default)().timer.setTimeout(r.bind(e),0);return{dispose(){t.dispose()}}}),Ec=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?gk:(this._emitter||(this._emitter=new wp.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},Cp=class{get token(){return this._token||(this._token=new Ec),this._token}cancel(){this._token?this._token.cancel():this._token=kc.Cancelled}dispose(){this._token?this._token instanceof Ec&&this._token.dispose():this._token=kc.None}};fs.CancellationTokenSource=Cp});var KC=I(hs=>{"use strict";Object.defineProperty(hs,"__esModule",{value:!0});hs.SharedArrayReceiverStrategy=hs.SharedArraySenderStrategy=void 0;var mk=xc(),oo;(function(r){r.Continue=0,r.Cancelled=1})(oo||(oo={}));var Rp=class{constructor(){this.buffers=new Map}enableCancellation(e){if(e.id===null)return;let t=new SharedArrayBuffer(4),n=new Int32Array(t,0,1);n[0]=oo.Continue,this.buffers.set(e.id,t),e.$cancellationData=t}async sendCancellation(e,t){let n=this.buffers.get(t);if(n===void 0)return;let i=new Int32Array(n,0,1);Atomics.store(i,0,oo.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}};hs.SharedArraySenderStrategy=Rp;var Sp=class{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===oo.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}},_p=class{constructor(e){this.token=new Sp(e)}cancel(){}dispose(){}},Tp=class{constructor(){this.kind="request"}createCancellationTokenSource(e){let t=e.$cancellationData;return t===void 0?new mk.CancellationTokenSource:new _p(t)}};hs.SharedArrayReceiverStrategy=Tp});var Pp=I(Ic=>{"use strict";Object.defineProperty(Ic,"__esModule",{value:!0});Ic.Semaphore=void 0;var vk=ri(),Dp=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,vk.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};Ic.Semaphore=Dp});var GC=I(ii=>{"use strict";Object.defineProperty(ii,"__esModule",{value:!0});ii.ReadableStreamMessageReader=ii.AbstractMessageReader=ii.MessageReader=void 0;var Ep=ri(),ps=us(),kp=ls(),yk=Pp(),BC;(function(r){function e(t){let n=t;return n&&ps.func(n.listen)&&ps.func(n.dispose)&&ps.func(n.onError)&&ps.func(n.onClose)&&ps.func(n.onPartialMessage)}r.is=e})(BC||(ii.MessageReader=BC={}));var qc=class{constructor(){this.errorEmitter=new kp.Emitter,this.closeEmitter=new kp.Emitter,this.partialMessageEmitter=new kp.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${ps.string(e.message)?e.message:"unknown"}`)}};ii.AbstractMessageReader=qc;var xp;(function(r){function e(t){let n,i,s,o=new Map,a,c=new Map;if(t===void 0||typeof t=="string")n=t??"utf-8";else{if(n=t.charset??"utf-8",t.contentDecoder!==void 0&&(s=t.contentDecoder,o.set(s.name,s)),t.contentDecoders!==void 0)for(let d of t.contentDecoders)o.set(d.name,d);if(t.contentTypeDecoder!==void 0&&(a=t.contentTypeDecoder,c.set(a.name,a)),t.contentTypeDecoders!==void 0)for(let d of t.contentTypeDecoders)c.set(d.name,d)}return a===void 0&&(a=(0,Ep.default)().applicationJson.decoder,c.set(a.name,a)),{charset:n,contentDecoder:s,contentDecoders:o,contentTypeDecoder:a,contentTypeDecoders:c}}r.fromOptions=e})(xp||(xp={}));var Ip=class extends qc{constructor(e,t){super(),this.readable=e,this.options=xp.fromOptions(t),this.buffer=(0,Ep.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new yk.Semaphore(1)}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;let t=this.readable.onData(n=>{this.onData(n)});return this.readable.onError(n=>this.fireError(n)),this.readable.onClose(()=>this.fireClose()),t}onData(e){try{for(this.buffer.append(e);;){if(this.nextMessageLength===-1){let n=this.buffer.tryReadHeaders(!0);if(!n)return;let i=n.get("content-length");if(!i){this.fireError(new Error(`Header must provide a Content-Length property.
${JSON.stringify(Object.fromEntries(n))}`));return}let s=parseInt(i);if(isNaN(s)){this.fireError(new Error(`Content-Length value must be a number. Got ${i}`));return}this.nextMessageLength=s}let t=this.buffer.tryReadBody(this.nextMessageLength);if(t===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{let n=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(t):t,i=await this.options.contentTypeDecoder.decode(n,this.options);this.callback(i)}).catch(n=>{this.fireError(n)})}}catch(t){this.fireError(t)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,Ep.default)().timer.setTimeout((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}};ii.ReadableStreamMessageReader=Ip});var ZC=I(si=>{"use strict";Object.defineProperty(si,"__esModule",{value:!0});si.WriteableStreamMessageWriter=si.AbstractMessageWriter=si.MessageWriter=void 0;var JC=ri(),ao=us(),bk=Pp(),XC=ls(),wk="Content-Length: ",QC=`\r
`,YC;(function(r){function e(t){let n=t;return n&&ao.func(n.dispose)&&ao.func(n.onClose)&&ao.func(n.onError)&&ao.func(n.write)}r.is=e})(YC||(si.MessageWriter=YC={}));var Oc=class{constructor(){this.errorEmitter=new XC.Emitter,this.closeEmitter=new XC.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,n){this.errorEmitter.fire([this.asError(e),t,n])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${ao.string(e.message)?e.message:"unknown"}`)}};si.AbstractMessageWriter=Oc;var qp;(function(r){function e(t){return t===void 0||typeof t=="string"?{charset:t??"utf-8",contentTypeEncoder:(0,JC.default)().applicationJson.encoder}:{charset:t.charset??"utf-8",contentEncoder:t.contentEncoder,contentTypeEncoder:t.contentTypeEncoder??(0,JC.default)().applicationJson.encoder}}r.fromOptions=e})(qp||(qp={}));var Op=class extends Oc{constructor(e,t){super(),this.writable=e,this.options=qp.fromOptions(t),this.errorCount=0,this.writeSemaphore=new bk.Semaphore(1),this.writable.onError(n=>this.fireError(n)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(n=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(n):n).then(n=>{let i=[];return i.push(wk,n.byteLength.toString(),QC),i.push(QC),this.doWrite(e,i,n)},n=>{throw this.fireError(n),n}))}async doWrite(e,t,n){try{return await this.writable.write(t.join(""),"ascii"),this.writable.write(n)}catch(i){return this.handleError(i,e),Promise.reject(i)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){this.writable.end()}};si.WriteableStreamMessageWriter=Op});var eR=I(Fc=>{"use strict";Object.defineProperty(Fc,"__esModule",{value:!0});Fc.AbstractMessageBuffer=void 0;var Ck=13,Rk=10,Sk=`\r
`,Fp=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){let t=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(t),this._totalLength+=t.byteLength}tryReadHeaders(e=!1){if(this._chunks.length===0)return;let t=0,n=0,i=0,s=0;e:for(;n<this._chunks.length;){let d=this._chunks[n];for(i=0;i<d.length;){switch(d[i]){case Ck:switch(t){case 0:t=1;break;case 2:t=3;break;default:t=0}break;case Rk:switch(t){case 1:t=2;break;case 3:t=4,i++;break e;default:t=0}break;default:t=0}i++}s+=d.byteLength,n++}if(t!==4)return;let o=this._read(s+i),a=new Map,c=this.toString(o,"ascii").split(Sk);if(c.length<2)return a;for(let d=0;d<c.length-2;d++){let p=c[d],v=p.indexOf(":");if(v===-1)throw new Error(`Message header must separate key and value using ':'
${p}`);let m=p.substr(0,v),S=p.substr(v+1).trim();a.set(e?m.toLowerCase():m,S)}return a}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){let s=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(s)}if(this._chunks[0].byteLength>e){let s=this._chunks[0],o=this.asNative(s,e);return this._chunks[0]=s.slice(e),this._totalLength-=e,o}let t=this.allocNative(e),n=0,i=0;for(;e>0;){let s=this._chunks[i];if(s.byteLength>e){let o=s.slice(0,e);t.set(o,n),n+=e,this._chunks[i]=s.slice(e),this._totalLength-=e,e-=e}else t.set(s,n),n+=s.byteLength,this._chunks.shift(),this._totalLength-=s.byteLength,e-=s.byteLength}return t}};Fc.AbstractMessageBuffer=Fp});var sR=I(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.createMessageConnection=Ce.ConnectionOptions=Ce.MessageStrategy=Ce.CancellationStrategy=Ce.CancellationSenderStrategy=Ce.CancellationReceiverStrategy=Ce.RequestCancellationReceiverStrategy=Ce.IdCancellationReceiverStrategy=Ce.ConnectionStrategy=Ce.ConnectionError=Ce.ConnectionErrors=Ce.LogTraceNotification=Ce.SetTraceNotification=Ce.TraceFormat=Ce.TraceValues=Ce.Trace=Ce.NullLogger=Ce.ProgressType=Ce.ProgressToken=void 0;var tR=ri(),pt=us(),fe=hp(),nR=gp(),co=ls(),Lp=xc(),fo;(function(r){r.type=new fe.NotificationType("$/cancelRequest")})(fo||(fo={}));var Mp;(function(r){function e(t){return typeof t=="string"||typeof t=="number"}r.is=e})(Mp||(Ce.ProgressToken=Mp={}));var uo;(function(r){r.type=new fe.NotificationType("$/progress")})(uo||(uo={}));var Np=class{constructor(){}};Ce.ProgressType=Np;var Ap;(function(r){function e(t){return pt.func(t)}r.is=e})(Ap||(Ap={}));Ce.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var Ae;(function(r){r[r.Off=0]="Off",r[r.Messages=1]="Messages",r[r.Compact=2]="Compact",r[r.Verbose=3]="Verbose"})(Ae||(Ce.Trace=Ae={}));var rR;(function(r){r.Off="off",r.Messages="messages",r.Compact="compact",r.Verbose="verbose"})(rR||(Ce.TraceValues=rR={}));(function(r){function e(n){if(!pt.string(n))return r.Off;switch(n=n.toLowerCase(),n){case"off":return r.Off;case"messages":return r.Messages;case"compact":return r.Compact;case"verbose":return r.Verbose;default:return r.Off}}r.fromString=e;function t(n){switch(n){case r.Off:return"off";case r.Messages:return"messages";case r.Compact:return"compact";case r.Verbose:return"verbose";default:return"off"}}r.toString=t})(Ae||(Ce.Trace=Ae={}));var Ln;(function(r){r.Text="text",r.JSON="json"})(Ln||(Ce.TraceFormat=Ln={}));(function(r){function e(t){return pt.string(t)?(t=t.toLowerCase(),t==="json"?r.JSON:r.Text):r.Text}r.fromString=e})(Ln||(Ce.TraceFormat=Ln={}));var jp;(function(r){r.type=new fe.NotificationType("$/setTrace")})(jp||(Ce.SetTraceNotification=jp={}));var Lc;(function(r){r.type=new fe.NotificationType("$/logTrace")})(Lc||(Ce.LogTraceNotification=Lc={}));var lo;(function(r){r[r.Closed=1]="Closed",r[r.Disposed=2]="Disposed",r[r.AlreadyListening=3]="AlreadyListening"})(lo||(Ce.ConnectionErrors=lo={}));var gs=class r extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,r.prototype)}};Ce.ConnectionError=gs;var $p;(function(r){function e(t){let n=t;return n&&pt.func(n.cancelUndispatched)}r.is=e})($p||(Ce.ConnectionStrategy=$p={}));var Mc;(function(r){function e(t){let n=t;return n&&(n.kind===void 0||n.kind==="id")&&pt.func(n.createCancellationTokenSource)&&(n.dispose===void 0||pt.func(n.dispose))}r.is=e})(Mc||(Ce.IdCancellationReceiverStrategy=Mc={}));var Up;(function(r){function e(t){let n=t;return n&&n.kind==="request"&&pt.func(n.createCancellationTokenSource)&&(n.dispose===void 0||pt.func(n.dispose))}r.is=e})(Up||(Ce.RequestCancellationReceiverStrategy=Up={}));var Nc;(function(r){r.Message=Object.freeze({createCancellationTokenSource(t){return new Lp.CancellationTokenSource}});function e(t){return Mc.is(t)||Up.is(t)}r.is=e})(Nc||(Ce.CancellationReceiverStrategy=Nc={}));var Ac;(function(r){r.Message=Object.freeze({sendCancellation(t,n){return t.sendNotification(fo.type,{id:n})},cleanup(t){}});function e(t){let n=t;return n&&pt.func(n.sendCancellation)&&pt.func(n.cleanup)}r.is=e})(Ac||(Ce.CancellationSenderStrategy=Ac={}));var jc;(function(r){r.Message=Object.freeze({receiver:Nc.Message,sender:Ac.Message});function e(t){let n=t;return n&&Nc.is(n.receiver)&&Ac.is(n.sender)}r.is=e})(jc||(Ce.CancellationStrategy=jc={}));var $c;(function(r){function e(t){let n=t;return n&&pt.func(n.handleMessage)}r.is=e})($c||(Ce.MessageStrategy=$c={}));var iR;(function(r){function e(t){let n=t;return n&&(jc.is(n.cancellationStrategy)||$p.is(n.connectionStrategy)||$c.is(n.messageStrategy))}r.is=e})(iR||(Ce.ConnectionOptions=iR={}));var cr;(function(r){r[r.New=1]="New",r[r.Listening=2]="Listening",r[r.Closed=3]="Closed",r[r.Disposed=4]="Disposed"})(cr||(cr={}));function _k(r,e,t,n){let i=t!==void 0?t:Ce.NullLogger,s=0,o=0,a=0,c="2.0",d,p=new Map,v,m=new Map,S=new Map,b,E=new nR.LinkedMap,x=new Map,$=new Set,U=new Map,M=Ae.Off,z=Ln.Text,B,pe=cr.New,J=new co.Emitter,ce=new co.Emitter,Re=new co.Emitter,it=new co.Emitter,Ze=new co.Emitter,$e=n&&n.cancellationStrategy?n.cancellationStrategy:jc.Message;function Yt(l){if(l===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+l.toString()}function At(l){return l===null?"res-unknown-"+(++a).toString():"res-"+l.toString()}function Pt(){return"not-"+(++o).toString()}function kt(l,C){fe.Message.isRequest(C)?l.set(Yt(C.id),C):fe.Message.isResponse(C)?l.set(At(C.id),C):l.set(Pt(),C)}function bn(l){}function wn(){return pe===cr.Listening}function Ue(){return pe===cr.Closed}function Ct(){return pe===cr.Disposed}function qt(){(pe===cr.New||pe===cr.Listening)&&(pe=cr.Closed,ce.fire(void 0))}function Et(l){J.fire([l,void 0,void 0])}function dr(l){J.fire(l)}r.onClose(qt),r.onError(Et),e.onClose(qt),e.onError(dr);function Cn(){b||E.size===0||(b=(0,tR.default)().timer.setImmediate(()=>{b=void 0,Zn()}))}function Rn(l){fe.Message.isRequest(l)?jn(l):fe.Message.isNotification(l)?_n(l):fe.Message.isResponse(l)?Sn(l):$n(l)}function Zn(){if(E.size===0)return;let l=E.shift();try{let C=n?.messageStrategy;$c.is(C)?C.handleMessage(l,Rn):Rn(l)}finally{Cn()}}let lr=l=>{try{if(fe.Message.isNotification(l)&&l.method===fo.type.method){let C=l.params.id,P=Yt(C),O=E.get(P);if(fe.Message.isRequest(O)){let ee=n?.connectionStrategy,ae=ee&&ee.cancelUndispatched?ee.cancelUndispatched(O,bn):void 0;if(ae&&(ae.error!==void 0||ae.result!==void 0)){E.delete(P),U.delete(C),ae.id=O.id,jt(ae,l.method,Date.now()),e.write(ae).catch(()=>i.error("Sending response for canceled message failed."));return}}let ne=U.get(C);if(ne!==void 0){ne.cancel(),Ht(l);return}else $.add(C)}kt(E,l)}finally{Cn()}};function jn(l){if(Ct())return;function C(G,ie,Z){let he={jsonrpc:c,id:l.id};G instanceof fe.ResponseError?he.error=G.toJson():he.result=G===void 0?null:G,jt(he,ie,Z),e.write(he).catch(()=>i.error("Sending response failed."))}function P(G,ie,Z){let he={jsonrpc:c,id:l.id,error:G.toJson()};jt(he,ie,Z),e.write(he).catch(()=>i.error("Sending response failed."))}function O(G,ie,Z){G===void 0&&(G=null);let he={jsonrpc:c,id:l.id,result:G};jt(he,ie,Z),e.write(he).catch(()=>i.error("Sending response failed."))}fr(l);let ne=p.get(l.method),ee,ae;ne&&(ee=ne.type,ae=ne.handler);let ue=Date.now();if(ae||d){let G=l.id??String(Date.now()),ie=Mc.is($e.receiver)?$e.receiver.createCancellationTokenSource(G):$e.receiver.createCancellationTokenSource(l);l.id!==null&&$.has(l.id)&&ie.cancel(),l.id!==null&&U.set(G,ie);try{let Z;if(ae)if(l.params===void 0){if(ee!==void 0&&ee.numberOfParams!==0){P(new fe.ResponseError(fe.ErrorCodes.InvalidParams,`Request ${l.method} defines ${ee.numberOfParams} params but received none.`),l.method,ue);return}Z=ae(ie.token)}else if(Array.isArray(l.params)){if(ee!==void 0&&ee.parameterStructures===fe.ParameterStructures.byName){P(new fe.ResponseError(fe.ErrorCodes.InvalidParams,`Request ${l.method} defines parameters by name but received parameters by position`),l.method,ue);return}Z=ae(...l.params,ie.token)}else{if(ee!==void 0&&ee.parameterStructures===fe.ParameterStructures.byPosition){P(new fe.ResponseError(fe.ErrorCodes.InvalidParams,`Request ${l.method} defines parameters by position but received parameters by name`),l.method,ue);return}Z=ae(l.params,ie.token)}else d&&(Z=d(l.method,l.params,ie.token));let he=Z;Z?he.then?he.then(_e=>{U.delete(G),C(_e,l.method,ue)},_e=>{U.delete(G),_e instanceof fe.ResponseError?P(_e,l.method,ue):_e&&pt.string(_e.message)?P(new fe.ResponseError(fe.ErrorCodes.InternalError,`Request ${l.method} failed with message: ${_e.message}`),l.method,ue):P(new fe.ResponseError(fe.ErrorCodes.InternalError,`Request ${l.method} failed unexpectedly without providing any details.`),l.method,ue)}):(U.delete(G),C(Z,l.method,ue)):(U.delete(G),O(Z,l.method,ue))}catch(Z){U.delete(G),Z instanceof fe.ResponseError?C(Z,l.method,ue):Z&&pt.string(Z.message)?P(new fe.ResponseError(fe.ErrorCodes.InternalError,`Request ${l.method} failed with message: ${Z.message}`),l.method,ue):P(new fe.ResponseError(fe.ErrorCodes.InternalError,`Request ${l.method} failed unexpectedly without providing any details.`),l.method,ue)}}else P(new fe.ResponseError(fe.ErrorCodes.MethodNotFound,`Unhandled method ${l.method}`),l.method,ue)}function Sn(l){if(!Ct())if(l.id===null)l.error?i.error(`Received response message without id: Error is: 
${JSON.stringify(l.error,void 0,4)}`):i.error("Received response message without id. No further error information provided.");else{let C=l.id,P=x.get(C);if(Un(l,P),P!==void 0){x.delete(C);try{if(l.error){let O=l.error;P.reject(new fe.ResponseError(O.code,O.message,O.data))}else if(l.result!==void 0)P.resolve(l.result);else throw new Error("Should never happen.")}catch(O){O.message?i.error(`Response handler '${P.method}' failed with message: ${O.message}`):i.error(`Response handler '${P.method}' failed unexpectedly.`)}}}}function _n(l){if(Ct())return;let C,P;if(l.method===fo.type.method){let O=l.params.id;$.delete(O),Ht(l);return}else{let O=m.get(l.method);O&&(P=O.handler,C=O.type)}if(P||v)try{if(Ht(l),P)if(l.params===void 0)C!==void 0&&C.numberOfParams!==0&&C.parameterStructures!==fe.ParameterStructures.byName&&i.error(`Notification ${l.method} defines ${C.numberOfParams} params but received none.`),P();else if(Array.isArray(l.params)){let O=l.params;l.method===uo.type.method&&O.length===2&&Mp.is(O[0])?P({token:O[0],value:O[1]}):(C!==void 0&&(C.parameterStructures===fe.ParameterStructures.byName&&i.error(`Notification ${l.method} defines parameters by name but received parameters by position`),C.numberOfParams!==l.params.length&&i.error(`Notification ${l.method} defines ${C.numberOfParams} params but received ${O.length} arguments`)),P(...O))}else C!==void 0&&C.parameterStructures===fe.ParameterStructures.byPosition&&i.error(`Notification ${l.method} defines parameters by position but received parameters by name`),P(l.params);else v&&v(l.method,l.params)}catch(O){O.message?i.error(`Notification handler '${l.method}' failed with message: ${O.message}`):i.error(`Notification handler '${l.method}' failed unexpectedly.`)}else Re.fire(l)}function $n(l){if(!l){i.error("Received empty message.");return}i.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(l,null,4)}`);let C=l;if(pt.string(C.id)||pt.number(C.id)){let P=C.id,O=x.get(P);O&&O.reject(new Error("The received response has neither a result nor an error property."))}}function We(l){if(l!=null)switch(M){case Ae.Verbose:return JSON.stringify(l,null,4);case Ae.Compact:return JSON.stringify(l);default:return}}function er(l){if(!(M===Ae.Off||!B))if(z===Ln.Text){let C;(M===Ae.Verbose||M===Ae.Compact)&&l.params&&(C=`Params: ${We(l.params)}

`),B.log(`Sending request '${l.method} - (${l.id})'.`,C)}else Ke("send-request",l)}function Tn(l){if(!(M===Ae.Off||!B))if(z===Ln.Text){let C;(M===Ae.Verbose||M===Ae.Compact)&&(l.params?C=`Params: ${We(l.params)}

`:C=`No parameters provided.

`),B.log(`Sending notification '${l.method}'.`,C)}else Ke("send-notification",l)}function jt(l,C,P){if(!(M===Ae.Off||!B))if(z===Ln.Text){let O;(M===Ae.Verbose||M===Ae.Compact)&&(l.error&&l.error.data?O=`Error data: ${We(l.error.data)}

`:l.result?O=`Result: ${We(l.result)}

`:l.error===void 0&&(O=`No result returned.

`)),B.log(`Sending response '${C} - (${l.id})'. Processing request took ${Date.now()-P}ms`,O)}else Ke("send-response",l)}function fr(l){if(!(M===Ae.Off||!B))if(z===Ln.Text){let C;(M===Ae.Verbose||M===Ae.Compact)&&l.params&&(C=`Params: ${We(l.params)}

`),B.log(`Received request '${l.method} - (${l.id})'.`,C)}else Ke("receive-request",l)}function Ht(l){if(!(M===Ae.Off||!B||l.method===Lc.type.method))if(z===Ln.Text){let C;(M===Ae.Verbose||M===Ae.Compact)&&(l.params?C=`Params: ${We(l.params)}

`:C=`No parameters provided.

`),B.log(`Received notification '${l.method}'.`,C)}else Ke("receive-notification",l)}function Un(l,C){if(!(M===Ae.Off||!B))if(z===Ln.Text){let P;if((M===Ae.Verbose||M===Ae.Compact)&&(l.error&&l.error.data?P=`Error data: ${We(l.error.data)}

`:l.result?P=`Result: ${We(l.result)}

`:l.error===void 0&&(P=`No result returned.

`)),C){let O=l.error?` Request failed: ${l.error.message} (${l.error.code}).`:"";B.log(`Received response '${C.method} - (${l.id})' in ${Date.now()-C.timerStart}ms.${O}`,P)}else B.log(`Received response ${l.id} without active response promise.`,P)}else Ke("receive-response",l)}function Ke(l,C){if(!B||M===Ae.Off)return;let P={isLSPMessage:!0,type:l,message:C,timestamp:Date.now()};B.log(P)}function gt(){if(Ue())throw new gs(lo.Closed,"Connection is closed.");if(Ct())throw new gs(lo.Disposed,"Connection is disposed.")}function xt(){if(wn())throw new gs(lo.AlreadyListening,"Connection is already listening")}function Zt(){if(!wn())throw new Error("Call listen() first.")}function Rt(l){return l===void 0?null:l}function Dn(l){if(l!==null)return l}function Wn(l){return l!=null&&!Array.isArray(l)&&typeof l=="object"}function en(l,C){switch(l){case fe.ParameterStructures.auto:return Wn(C)?Dn(C):[Rt(C)];case fe.ParameterStructures.byName:if(!Wn(C))throw new Error("Received parameters by name but param is not an object literal.");return Dn(C);case fe.ParameterStructures.byPosition:return[Rt(C)];default:throw new Error(`Unknown parameter structure ${l.toString()}`)}}function Hn(l,C){let P,O=l.numberOfParams;switch(O){case 0:P=void 0;break;case 1:P=en(l.parameterStructures,C[0]);break;default:P=[];for(let ne=0;ne<C.length&&ne<O;ne++)P.push(Rt(C[ne]));if(C.length<O)for(let ne=C.length;ne<O;ne++)P.push(null);break}return P}let mt={sendNotification:(l,...C)=>{gt();let P,O;if(pt.string(l)){P=l;let ee=C[0],ae=0,ue=fe.ParameterStructures.auto;fe.ParameterStructures.is(ee)&&(ae=1,ue=ee);let G=C.length,ie=G-ae;switch(ie){case 0:O=void 0;break;case 1:O=en(ue,C[ae]);break;default:if(ue===fe.ParameterStructures.byName)throw new Error(`Received ${ie} parameters for 'by Name' notification parameter structure.`);O=C.slice(ae,G).map(Z=>Rt(Z));break}}else{let ee=C;P=l.method,O=Hn(l,ee)}let ne={jsonrpc:c,method:P,params:O};return Tn(ne),e.write(ne).catch(ee=>{throw i.error("Sending notification failed."),ee})},onNotification:(l,C)=>{gt();let P;return pt.func(l)?v=l:C&&(pt.string(l)?(P=l,m.set(l,{type:void 0,handler:C})):(P=l.method,m.set(l.method,{type:l,handler:C}))),{dispose:()=>{P!==void 0?m.delete(P):v=void 0}}},onProgress:(l,C,P)=>{if(S.has(C))throw new Error(`Progress handler for token ${C} already registered`);return S.set(C,P),{dispose:()=>{S.delete(C)}}},sendProgress:(l,C,P)=>mt.sendNotification(uo.type,{token:C,value:P}),onUnhandledProgress:it.event,sendRequest:(l,...C)=>{gt(),Zt();let P,O,ne;if(pt.string(l)){P=l;let G=C[0],ie=C[C.length-1],Z=0,he=fe.ParameterStructures.auto;fe.ParameterStructures.is(G)&&(Z=1,he=G);let _e=C.length;Lp.CancellationToken.is(ie)&&(_e=_e-1,ne=ie);let He=_e-Z;switch(He){case 0:O=void 0;break;case 1:O=en(he,C[Z]);break;default:if(he===fe.ParameterStructures.byName)throw new Error(`Received ${He} parameters for 'by Name' request parameter structure.`);O=C.slice(Z,_e).map(hr=>Rt(hr));break}}else{let G=C;P=l.method,O=Hn(l,G);let ie=l.numberOfParams;ne=Lp.CancellationToken.is(G[ie])?G[ie]:void 0}let ee=s++,ae;ne&&(ae=ne.onCancellationRequested(()=>{let G=$e.sender.sendCancellation(mt,ee);return G===void 0?(i.log(`Received no promise from cancellation strategy when cancelling id ${ee}`),Promise.resolve()):G.catch(()=>{i.log(`Sending cancellation messages for id ${ee} failed`)})}));let ue={jsonrpc:c,id:ee,method:P,params:O};return er(ue),typeof $e.sender.enableCancellation=="function"&&$e.sender.enableCancellation(ue),new Promise(async(G,ie)=>{let Z=He=>{G(He),$e.sender.cleanup(ee),ae?.dispose()},he=He=>{ie(He),$e.sender.cleanup(ee),ae?.dispose()},_e={method:P,timerStart:Date.now(),resolve:Z,reject:he};try{x.set(ee,_e),await e.write(ue)}catch(He){throw x.delete(ee),_e.reject(new fe.ResponseError(fe.ErrorCodes.MessageWriteError,He.message?He.message:"Unknown reason")),i.error("Sending request failed."),He}})},onRequest:(l,C)=>{gt();let P=null;return Ap.is(l)?(P=void 0,d=l):pt.string(l)?(P=null,C!==void 0&&(P=l,p.set(l,{handler:C,type:void 0}))):C!==void 0&&(P=l.method,p.set(l.method,{type:l,handler:C})),{dispose:()=>{P!==null&&(P!==void 0?p.delete(P):d=void 0)}}},hasPendingResponse:()=>x.size>0,trace:async(l,C,P)=>{let O=!1,ne=Ln.Text;P!==void 0&&(pt.boolean(P)?O=P:(O=P.sendNotification||!1,ne=P.traceFormat||Ln.Text)),M=l,z=ne,M===Ae.Off?B=void 0:B=C,O&&!Ue()&&!Ct()&&await mt.sendNotification(jp.type,{value:Ae.toString(l)})},onError:J.event,onClose:ce.event,onUnhandledNotification:Re.event,onDispose:Ze.event,end:()=>{e.end()},dispose:()=>{if(Ct())return;pe=cr.Disposed,Ze.fire(void 0);let l=new fe.ResponseError(fe.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(let C of x.values())C.reject(l);x=new Map,U=new Map,$=new Set,E=new nR.LinkedMap,pt.func(e.dispose)&&e.dispose(),pt.func(r.dispose)&&r.dispose()},listen:()=>{gt(),xt(),pe=cr.Listening,r.listen(lr)},inspect:()=>{(0,tR.default)().console.log("inspect")}};return mt.onNotification(Lc.type,l=>{if(M===Ae.Off||!B)return;let C=M===Ae.Verbose||M===Ae.Compact;B.log(l.message,C?l.verbose:void 0)}),mt.onNotification(uo.type,l=>{let C=S.get(l.token);C?C(l.value):it.fire(l)}),mt}Ce.createMessageConnection=_k});var Uc=I(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.ProgressType=L.ProgressToken=L.createMessageConnection=L.NullLogger=L.ConnectionOptions=L.ConnectionStrategy=L.AbstractMessageBuffer=L.WriteableStreamMessageWriter=L.AbstractMessageWriter=L.MessageWriter=L.ReadableStreamMessageReader=L.AbstractMessageReader=L.MessageReader=L.SharedArrayReceiverStrategy=L.SharedArraySenderStrategy=L.CancellationToken=L.CancellationTokenSource=L.Emitter=L.Event=L.Disposable=L.LRUCache=L.Touch=L.LinkedMap=L.ParameterStructures=L.NotificationType9=L.NotificationType8=L.NotificationType7=L.NotificationType6=L.NotificationType5=L.NotificationType4=L.NotificationType3=L.NotificationType2=L.NotificationType1=L.NotificationType0=L.NotificationType=L.ErrorCodes=L.ResponseError=L.RequestType9=L.RequestType8=L.RequestType7=L.RequestType6=L.RequestType5=L.RequestType4=L.RequestType3=L.RequestType2=L.RequestType1=L.RequestType0=L.RequestType=L.Message=L.RAL=void 0;L.MessageStrategy=L.CancellationStrategy=L.CancellationSenderStrategy=L.CancellationReceiverStrategy=L.ConnectionError=L.ConnectionErrors=L.LogTraceNotification=L.SetTraceNotification=L.TraceFormat=L.TraceValues=L.Trace=void 0;var Qe=hp();Object.defineProperty(L,"Message",{enumerable:!0,get:function(){return Qe.Message}});Object.defineProperty(L,"RequestType",{enumerable:!0,get:function(){return Qe.RequestType}});Object.defineProperty(L,"RequestType0",{enumerable:!0,get:function(){return Qe.RequestType0}});Object.defineProperty(L,"RequestType1",{enumerable:!0,get:function(){return Qe.RequestType1}});Object.defineProperty(L,"RequestType2",{enumerable:!0,get:function(){return Qe.RequestType2}});Object.defineProperty(L,"RequestType3",{enumerable:!0,get:function(){return Qe.RequestType3}});Object.defineProperty(L,"RequestType4",{enumerable:!0,get:function(){return Qe.RequestType4}});Object.defineProperty(L,"RequestType5",{enumerable:!0,get:function(){return Qe.RequestType5}});Object.defineProperty(L,"RequestType6",{enumerable:!0,get:function(){return Qe.RequestType6}});Object.defineProperty(L,"RequestType7",{enumerable:!0,get:function(){return Qe.RequestType7}});Object.defineProperty(L,"RequestType8",{enumerable:!0,get:function(){return Qe.RequestType8}});Object.defineProperty(L,"RequestType9",{enumerable:!0,get:function(){return Qe.RequestType9}});Object.defineProperty(L,"ResponseError",{enumerable:!0,get:function(){return Qe.ResponseError}});Object.defineProperty(L,"ErrorCodes",{enumerable:!0,get:function(){return Qe.ErrorCodes}});Object.defineProperty(L,"NotificationType",{enumerable:!0,get:function(){return Qe.NotificationType}});Object.defineProperty(L,"NotificationType0",{enumerable:!0,get:function(){return Qe.NotificationType0}});Object.defineProperty(L,"NotificationType1",{enumerable:!0,get:function(){return Qe.NotificationType1}});Object.defineProperty(L,"NotificationType2",{enumerable:!0,get:function(){return Qe.NotificationType2}});Object.defineProperty(L,"NotificationType3",{enumerable:!0,get:function(){return Qe.NotificationType3}});Object.defineProperty(L,"NotificationType4",{enumerable:!0,get:function(){return Qe.NotificationType4}});Object.defineProperty(L,"NotificationType5",{enumerable:!0,get:function(){return Qe.NotificationType5}});Object.defineProperty(L,"NotificationType6",{enumerable:!0,get:function(){return Qe.NotificationType6}});Object.defineProperty(L,"NotificationType7",{enumerable:!0,get:function(){return Qe.NotificationType7}});Object.defineProperty(L,"NotificationType8",{enumerable:!0,get:function(){return Qe.NotificationType8}});Object.defineProperty(L,"NotificationType9",{enumerable:!0,get:function(){return Qe.NotificationType9}});Object.defineProperty(L,"ParameterStructures",{enumerable:!0,get:function(){return Qe.ParameterStructures}});var Wp=gp();Object.defineProperty(L,"LinkedMap",{enumerable:!0,get:function(){return Wp.LinkedMap}});Object.defineProperty(L,"LRUCache",{enumerable:!0,get:function(){return Wp.LRUCache}});Object.defineProperty(L,"Touch",{enumerable:!0,get:function(){return Wp.Touch}});var Tk=VC();Object.defineProperty(L,"Disposable",{enumerable:!0,get:function(){return Tk.Disposable}});var oR=ls();Object.defineProperty(L,"Event",{enumerable:!0,get:function(){return oR.Event}});Object.defineProperty(L,"Emitter",{enumerable:!0,get:function(){return oR.Emitter}});var aR=xc();Object.defineProperty(L,"CancellationTokenSource",{enumerable:!0,get:function(){return aR.CancellationTokenSource}});Object.defineProperty(L,"CancellationToken",{enumerable:!0,get:function(){return aR.CancellationToken}});var cR=KC();Object.defineProperty(L,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return cR.SharedArraySenderStrategy}});Object.defineProperty(L,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return cR.SharedArrayReceiverStrategy}});var Hp=GC();Object.defineProperty(L,"MessageReader",{enumerable:!0,get:function(){return Hp.MessageReader}});Object.defineProperty(L,"AbstractMessageReader",{enumerable:!0,get:function(){return Hp.AbstractMessageReader}});Object.defineProperty(L,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return Hp.ReadableStreamMessageReader}});var Vp=ZC();Object.defineProperty(L,"MessageWriter",{enumerable:!0,get:function(){return Vp.MessageWriter}});Object.defineProperty(L,"AbstractMessageWriter",{enumerable:!0,get:function(){return Vp.AbstractMessageWriter}});Object.defineProperty(L,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return Vp.WriteableStreamMessageWriter}});var Dk=eR();Object.defineProperty(L,"AbstractMessageBuffer",{enumerable:!0,get:function(){return Dk.AbstractMessageBuffer}});var Wt=sR();Object.defineProperty(L,"ConnectionStrategy",{enumerable:!0,get:function(){return Wt.ConnectionStrategy}});Object.defineProperty(L,"ConnectionOptions",{enumerable:!0,get:function(){return Wt.ConnectionOptions}});Object.defineProperty(L,"NullLogger",{enumerable:!0,get:function(){return Wt.NullLogger}});Object.defineProperty(L,"createMessageConnection",{enumerable:!0,get:function(){return Wt.createMessageConnection}});Object.defineProperty(L,"ProgressToken",{enumerable:!0,get:function(){return Wt.ProgressToken}});Object.defineProperty(L,"ProgressType",{enumerable:!0,get:function(){return Wt.ProgressType}});Object.defineProperty(L,"Trace",{enumerable:!0,get:function(){return Wt.Trace}});Object.defineProperty(L,"TraceValues",{enumerable:!0,get:function(){return Wt.TraceValues}});Object.defineProperty(L,"TraceFormat",{enumerable:!0,get:function(){return Wt.TraceFormat}});Object.defineProperty(L,"SetTraceNotification",{enumerable:!0,get:function(){return Wt.SetTraceNotification}});Object.defineProperty(L,"LogTraceNotification",{enumerable:!0,get:function(){return Wt.LogTraceNotification}});Object.defineProperty(L,"ConnectionErrors",{enumerable:!0,get:function(){return Wt.ConnectionErrors}});Object.defineProperty(L,"ConnectionError",{enumerable:!0,get:function(){return Wt.ConnectionError}});Object.defineProperty(L,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return Wt.CancellationReceiverStrategy}});Object.defineProperty(L,"CancellationSenderStrategy",{enumerable:!0,get:function(){return Wt.CancellationSenderStrategy}});Object.defineProperty(L,"CancellationStrategy",{enumerable:!0,get:function(){return Wt.CancellationStrategy}});Object.defineProperty(L,"MessageStrategy",{enumerable:!0,get:function(){return Wt.MessageStrategy}});var Pk=ri();L.RAL=Pk.default});var lR=I(Gp=>{"use strict";Object.defineProperty(Gp,"__esModule",{value:!0});var uR=require("util"),Fr=Uc(),Wc=class r extends Fr.AbstractMessageBuffer{constructor(e="utf-8"){super(e)}emptyBuffer(){return r.emptyBuffer}fromString(e,t){return Buffer.from(e,t)}toString(e,t){return e instanceof Buffer?e.toString(t):new uR.TextDecoder(t).decode(e)}asNative(e,t){return t===void 0?e instanceof Buffer?e:Buffer.from(e):e instanceof Buffer?e.slice(0,t):Buffer.from(e,0,t)}allocNative(e){return Buffer.allocUnsafe(e)}};Wc.emptyBuffer=Buffer.allocUnsafe(0);var zp=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),Fr.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),Fr.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),Fr.Disposable.create(()=>this.stream.off("end",e))}onData(e){return this.stream.on("data",e),Fr.Disposable.create(()=>this.stream.off("data",e))}},Kp=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),Fr.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),Fr.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),Fr.Disposable.create(()=>this.stream.off("end",e))}write(e,t){return new Promise((n,i)=>{let s=o=>{o==null?n():i(o)};typeof e=="string"?this.stream.write(e,t,s):this.stream.write(e,s)})}end(){this.stream.end()}},dR=Object.freeze({messageBuffer:Object.freeze({create:r=>new Wc(r)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(r,e)=>{try{return Promise.resolve(Buffer.from(JSON.stringify(r,void 0,0),e.charset))}catch(t){return Promise.reject(t)}}}),decoder:Object.freeze({name:"application/json",decode:(r,e)=>{try{return r instanceof Buffer?Promise.resolve(JSON.parse(r.toString(e.charset))):Promise.resolve(JSON.parse(new uR.TextDecoder(e.charset).decode(r)))}catch(t){return Promise.reject(t)}}})}),stream:Object.freeze({asReadableStream:r=>new zp(r),asWritableStream:r=>new Kp(r)}),console,timer:Object.freeze({setTimeout(r,e,...t){let n=setTimeout(r,e,...t);return{dispose:()=>clearTimeout(n)}},setImmediate(r,...e){let t=setImmediate(r,...e);return{dispose:()=>clearImmediate(t)}},setInterval(r,e,...t){let n=setInterval(r,e,...t);return{dispose:()=>clearInterval(n)}}})});function Bp(){return dR}(function(r){function e(){Fr.RAL.install(dR)}r.install=e})(Bp||(Bp={}));Gp.default=Bp});var pR=I(xe=>{"use strict";var kk=xe&&xe.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Ek=xe&&xe.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&kk(e,r,t)};Object.defineProperty(xe,"__esModule",{value:!0});xe.createMessageConnection=xe.createServerSocketTransport=xe.createClientSocketTransport=xe.createServerPipeTransport=xe.createClientPipeTransport=xe.generateRandomPipeName=xe.StreamMessageWriter=xe.StreamMessageReader=xe.SocketMessageWriter=xe.SocketMessageReader=xe.PortMessageWriter=xe.PortMessageReader=xe.IPCMessageWriter=xe.IPCMessageReader=void 0;var ms=lR();ms.default.install();var fR=require("path"),xk=require("os"),Ik=require("crypto"),zc=require("net"),Mn=Uc();Ek(Uc(),xe);var Jp=class extends Mn.AbstractMessageReader{constructor(e){super(),this.process=e;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose())}listen(e){return this.process.on("message",e),Mn.Disposable.create(()=>this.process.off("message",e))}};xe.IPCMessageReader=Jp;var Xp=class extends Mn.AbstractMessageWriter{constructor(e){super(),this.process=e,this.errorCount=0;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose)}write(e){try{return typeof this.process.send=="function"&&this.process.send(e,void 0,void 0,t=>{t?(this.errorCount++,this.handleError(t,e)):this.errorCount=0}),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};xe.IPCMessageWriter=Xp;var Qp=class extends Mn.AbstractMessageReader{constructor(e){super(),this.onData=new Mn.Emitter,e.on("close",()=>this.fireClose),e.on("error",t=>this.fireError(t)),e.on("message",t=>{this.onData.fire(t)})}listen(e){return this.onData.event(e)}};xe.PortMessageReader=Qp;var Yp=class extends Mn.AbstractMessageWriter{constructor(e){super(),this.port=e,this.errorCount=0,e.on("close",()=>this.fireClose()),e.on("error",t=>this.fireError(t))}write(e){try{return this.port.postMessage(e),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};xe.PortMessageWriter=Yp;var Ti=class extends Mn.ReadableStreamMessageReader{constructor(e,t="utf-8"){super((0,ms.default)().stream.asReadableStream(e),t)}};xe.SocketMessageReader=Ti;var Di=class extends Mn.WriteableStreamMessageWriter{constructor(e,t){super((0,ms.default)().stream.asWritableStream(e),t),this.socket=e}dispose(){super.dispose(),this.socket.destroy()}};xe.SocketMessageWriter=Di;var Hc=class extends Mn.ReadableStreamMessageReader{constructor(e,t){super((0,ms.default)().stream.asReadableStream(e),t)}};xe.StreamMessageReader=Hc;var Vc=class extends Mn.WriteableStreamMessageWriter{constructor(e,t){super((0,ms.default)().stream.asWritableStream(e),t)}};xe.StreamMessageWriter=Vc;var hR=process.env.XDG_RUNTIME_DIR,qk=new Map([["linux",107],["darwin",103]]);function Ok(){let r=(0,Ik.randomBytes)(21).toString("hex");if(process.platform==="win32")return`\\\\.\\pipe\\vscode-jsonrpc-${r}-sock`;let e;hR?e=fR.join(hR,`vscode-ipc-${r}.sock`):e=fR.join(xk.tmpdir(),`vscode-${r}.sock`);let t=qk.get(process.platform);return t!==void 0&&e.length>t&&(0,ms.default)().console.warn(`WARNING: IPC handle "${e}" is longer than ${t} characters.`),e}xe.generateRandomPipeName=Ok;function Fk(r,e="utf-8"){let t,n=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let o=(0,zc.createServer)(a=>{o.close(),t([new Ti(a,e),new Di(a,e)])});o.on("error",s),o.listen(r,()=>{o.removeListener("error",s),i({onConnected:()=>n})})})}xe.createClientPipeTransport=Fk;function Lk(r,e="utf-8"){let t=(0,zc.createConnection)(r);return[new Ti(t,e),new Di(t,e)]}xe.createServerPipeTransport=Lk;function Mk(r,e="utf-8"){let t,n=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let o=(0,zc.createServer)(a=>{o.close(),t([new Ti(a,e),new Di(a,e)])});o.on("error",s),o.listen(r,"127.0.0.1",()=>{o.removeListener("error",s),i({onConnected:()=>n})})})}xe.createClientSocketTransport=Mk;function Nk(r,e="utf-8"){let t=(0,zc.createConnection)(r,"127.0.0.1");return[new Ti(t,e),new Di(t,e)]}xe.createServerSocketTransport=Nk;function Ak(r){let e=r;return e.read!==void 0&&e.addListener!==void 0}function jk(r){let e=r;return e.write!==void 0&&e.addListener!==void 0}function $k(r,e,t,n){t||(t=Mn.NullLogger);let i=Ak(r)?new Hc(r):r,s=jk(e)?new Vc(e):e;return Mn.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,Mn.createMessageConnection)(i,s,t,n)}xe.createMessageConnection=$k});var mR=I((Zq,gR)=>{"use strict";gR.exports=pR()});var Xk={};YR(Xk,{activate:()=>Bk,deactivate:()=>Gk});module.exports=ZR(Xk);var zR=re(require("os")),sn=re(require("vscode"));var HR=re(require("os")),VR=re(require("path")),N=re(require("vscode")),ig=re(sc());var to=class{provideTextDocumentContent(e){let t="Not a valid Ruby LSP document";switch(e.path){case"show-syntax-tree":t=e.query;break;case"show-diagnose-state":t=e.query;break}return t}};var LC=require("crypto"),wt=re(require("vscode")),wc=re(sc());var mc=re(require("path")),qh=re(require("os")),Ne=re(require("vscode"));var TC=require("child_process"),DC=require("crypto"),PC=require("util"),Zr=re(require("vscode"));var Qn=new Zr.EventEmitter,gn=(0,PC.promisify)(TC.exec),oc="Ruby LSP",Cr=Zr.window.createOutputChannel(oc,{log:!0}),ei=["ruby","erb"],Eh={tapiocaAddon:1,launcher:.1,fullTestDiscovery:1};function kC(r,e){let t=null;return function(...n){return t&&clearTimeout(t),new Promise((i,s)=>{t=setTimeout(()=>{r(...n).then(o=>i(o)).catch(o=>s(o))},e)})}}function qr(r){let e=Zr.workspace.getConfiguration("rubyLsp").get("featureFlags");if(e[r]===!1||e.all===!1)return!1;let t=Eh[r];if(e.all&&t!==-1||e[r])return!0;let n=Zr.env.machineId,i=(0,DC.createHash)("sha256").update(`${n}-${r}`).digest("hex");return parseInt(i.substring(0,8),16)/4294967295<t}var Ci=re(require("vscode"));var no=re(require("path")),EC=re(require("os")),Rr=re(require("vscode"));var ac="RUBY_LSP_ACTIVATION_SEPARATOR",tk="RUBY_LSP_VS",nk="RUBY_LSP_FS",Nt=class{constructor(e,t,n,i){this.workspaceFolder=e,this.outputChannel=t,this.context=n,this.manuallySelectRuby=i;let s=Rr.workspace.getConfiguration("rubyLsp").get("bundleGemfile");s.length>0&&(this.customBundleGemfile=no.default.isAbsolute(s)?s:no.default.resolve(no.default.join(this.workspaceFolder.uri.fsPath,s))),this.bundleUri=this.customBundleGemfile?Rr.Uri.file(no.default.dirname(this.customBundleGemfile)):e.uri}async runEnvActivationScript(e){let t=Rr.Uri.joinPath(this.context.extensionUri,"activation.rb"),n=await this.runScript(`${e} -EUTF-8:UTF-8 '${t.fsPath}'`),i=new RegExp(`${ac}([^]*)${ac}`).exec(n.stderr),[s,o,a,...c]=i[1].split(nk);return{version:s,gemPath:o.split(","),yjit:a==="true",env:Object.fromEntries(c.map(d=>d.split(tk)))}}runScript(e){let t;return Rr.env.shell.length>0&&EC.default.platform()!=="win32"&&(t=Rr.env.shell),this.outputChannel.info(`Running command: \`${e}\` in ${this.bundleUri.fsPath} using shell: ${t}`),gn(e,{cwd:this.bundleUri.fsPath,shell:t,env:process.env,encoding:"utf-8"})}async findExec(e,t){for(let n of e)try{let i=Rr.Uri.joinPath(n,t);return await Rr.workspace.fs.stat(i),this.outputChannel.info(`Found ${t} executable at ${n.fsPath}`),i.fsPath}catch{}return t}};var ro=class extends Error{},cc=class extends Nt{async activate(){try{await Ci.workspace.fs.stat(Ci.Uri.joinPath(this.bundleUri,".shadowenv.d"))}catch{throw new Error("The Ruby LSP version manager is configured to be shadowenv,         but no .shadowenv.d directory was found in the workspace")}let e=await this.findExec([Ci.Uri.file("/opt/homebrew/bin")],"shadowenv");try{let t=await this.runEnvActivationScript(`${e} exec -- ruby`);return delete t.env.BUNDLE_GEMFILE,{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}catch(t){if(t.message.includes("untrusted shadowenv program")){if(await Ci.window.showErrorMessage(`Tried to activate Shadowenv, but the workspace is untrusted.
           Workspaces must be trusted to before allowing Shadowenv to load the environment for security reasons.`,"Trust workspace","Shutdown Ruby LSP")==="Trust workspace")return await gn("shadowenv trust",{cwd:this.bundleUri.fsPath}),this.activate();throw new ro("Cannot activate Ruby environment in an untrusted workspace")}try{await gn("shadowenv --version")}catch{throw new Error(`Shadowenv executable not found. Ensure it is installed and available in the PATH.
           This error may happen if your shell configuration is failing to be sourced from the editor or if
           another extension is mutating the process PATH.`)}throw new Error(`Failed to activate Ruby environment with Shadowenv: ${t.message}`)}}};var xh=re(require("os")),Sr=re(require("path")),Me=re(require("vscode"));var io=class extends Error{},os=class extends Nt{constructor(t,n,i,s){super(t,n,i,s);this.rubyInstallationUris=[Me.Uri.joinPath(Me.Uri.file(xh.default.homedir()),".rubies"),Me.Uri.joinPath(Me.Uri.file("/"),"opt","rubies")];let o=Me.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.chrubyRubies");o&&this.rubyInstallationUris.push(...o.map(a=>Me.Uri.file(a)))}async activate(){let t=await this.discoverRubyVersion(),n;try{if(t)n=await this.findRubyUri(t);else{let d=await this.fallbackWithCancellation("No .ruby-version file found. Trying to fall back to latest installed Ruby in 10 seconds","You can create a .ruby-version file in a parent directory to configure a fallback",this.findFallbackRuby.bind(this),this.rubyVersionError.bind(this));t=d.rubyVersion,n=d.uri}}catch(d){if(d instanceof io)return this.activate();throw d}try{if(!n){let d={...t},p=await this.fallbackWithCancellation(`Couldn't find installation for ${t.version}. Trying to fall back to other Ruby in 10 seconds`,"You can cancel this fallback and install the required Ruby",async()=>this.findClosestRubyInstallation(d),()=>this.missingRubyError(d.version));t=p.rubyVersion,n=p.uri}}catch(d){if(d instanceof io)return this.activate();throw d}this.outputChannel.info(`Discovered Ruby installation at ${n.fsPath}`);let{defaultGems:i,gemHome:s,yjit:o,version:a}=await this.runActivationScript(n,t);this.outputChannel.info(`Activated Ruby environment: defaultGems=${i} gemHome=${s} yjit=${o}`);let c={GEM_HOME:s,GEM_PATH:`${s}${Sr.default.delimiter}${i}`,PATH:`${Sr.default.join(s,"bin")}${Sr.default.delimiter}${Sr.default.join(i,"bin")}${Sr.default.delimiter}${Sr.default.dirname(n.fsPath)}${Sr.default.delimiter}${this.getProcessPath()}`};return{env:{...process.env,...c},yjit:o,version:a,gemPath:[s,i]}}getProcessPath(){return process.env.PATH}async findRubyUri(t){let n=t.engine?[`${t.engine}-${t.version}`,t.version]:[t.version,`ruby-${t.version}`];for(let i of this.rubyInstallationUris){let s;try{s=(await Me.workspace.fs.readDirectory(i)).sort((o,a)=>a[0].localeCompare(o[0]))}catch{this.outputChannel.debug(`Tried searching for Ruby installation in ${i.fsPath} but it doesn't exist`);continue}for(let o of n){let a=s.find(([c])=>c.startsWith(o));if(a)return Me.Uri.joinPath(i,a[0],"bin","ruby")}}}async runActivationScript(t,n){let i=Me.Uri.joinPath(this.context.extensionUri,"chruby_activation.rb"),s=await this.runScript(`${t.fsPath} -EUTF-8:UTF-8 '${i.fsPath}' ${n.version}`),[o,a,c,d]=s.stderr.split(ac);return{defaultGems:o,gemHome:a,yjit:c==="true",version:d}}async findClosestRubyInstallation(t){let[n,i,s]=t.version.split("."),o=[];for(let c of this.rubyInstallationUris)try{(await Me.workspace.fs.readDirectory(c)).forEach(([d])=>{let p=/((?<engine>[A-Za-z]+)-)?(?<version>\d+\.\d+(\.\d+)?(-[A-Za-z0-9]+)?)/.exec(d);p?.groups&&p.groups.version.startsWith(n)&&o.push({uri:Me.Uri.joinPath(c,d,"bin","ruby"),rubyVersion:{engine:p.groups.engine,version:p.groups.version}})})}catch{this.outputChannel.debug(`Tried searching for Ruby installation in ${c.fsPath} but it doesn't exist`);continue}let a=o.sort((c,d)=>{let p=c.rubyVersion.version.split("."),v=d.rubyVersion.version.split("."),m=Math.abs(Number(p[1])-Number(i)),S=Math.abs(Number(v[1])-Number(i));return m===S?Number(v[2]||0)-Number(p[2]||0):m-S})[0];if(a)return a;throw new Error("Cannot find any Ruby installations")}async discoverRubyVersion(){let t=this.bundleUri,n=Sr.default.parse(t.fsPath).root,i,s;for(;t.fsPath!==n;){try{s=Me.Uri.joinPath(t,".ruby-version"),i=(await Me.workspace.fs.readFile(s)).toString().trim()}catch{t=Me.Uri.file(Sr.default.dirname(t.fsPath));continue}if(i==="")throw new Error(`Ruby version file ${s.fsPath} is empty`);let o=/((?<engine>[A-Za-z]+)-)?(?<version>\d+\.\d+(\.\d+)?(-[A-Za-z0-9]+)?)/.exec(i);if(!o?.groups)throw new Error(`Ruby version file ${s.fsPath} contains invalid format. Expected (engine-)?version, got ${i}`);return this.outputChannel.info(`Discovered Ruby version ${i} from ${s.fsPath}`),{engine:o.groups.engine,version:o.groups.version}}}async fallbackWithCancellation(t,n,i,s){let o;try{o=await Me.workspace.fs.readFile(Me.Uri.joinPath(this.workspaceFolder.uri,"Gemfile"))}catch{}if(o&&/^ruby(\s|\()("|')[\d.]+/.test(o.toString()))throw s();return await Me.window.withProgress({title:t,location:Me.ProgressLocation.Notification,cancellable:!0},async(c,d)=>{if(c.report({message:n}),await new Promise(p=>{setTimeout(p,1e4),d.onCancellationRequested(()=>{p()})}),d.isCancellationRequested)throw await this.handleCancelledFallback(s),new io;return i()})}async handleCancelledFallback(t){let n=await Me.window.showInformationMessage(`The Ruby LSP requires a Ruby version to launch.
      You can define a fallback for the system or for the Ruby LSP only`,"System","Ruby LSP only");throw n==="System"?await this.createParentRubyVersionFile(t):n==="Ruby LSP only"&&await this.manuallySelectRuby(),t()}async createParentRubyVersionFile(t){let n=[];for(let o of this.rubyInstallationUris){let a;try{a=(await Me.workspace.fs.readDirectory(o)).sort((c,d)=>d[0].localeCompare(c[0])),a.forEach(c=>{n.push({label:c[0]})})}catch{continue}}let i=await Me.window.showQuickPick(n,{title:"Select a Ruby version to use as fallback",ignoreFocusOut:!0});if(!i)throw t();let s=await Me.window.showOpenDialog({defaultUri:Me.Uri.file(xh.default.homedir()),openLabel:"Add fallback in this directory",canSelectFiles:!1,canSelectFolders:!0,canSelectMany:!1,title:"Select the directory to create the .ruby-version fallback in"});if(!s)throw t();await Me.workspace.fs.writeFile(Me.Uri.joinPath(s[0],".ruby-version"),Buffer.from(i.label))}async findFallbackRuby(){for(let t of this.rubyInstallationUris){let n;try{n=(await Me.workspace.fs.readDirectory(t)).sort((o,a)=>a[0].localeCompare(o[0]));let i,s;for(let o of n){let a=/((?<engine>[A-Za-z]+)-)?(?<version>\d+\.\d+(\.\d+)?(-[A-Za-z0-9]+)?)/.exec(o[0]);if(a?.groups){i=a.groups,s=o;break}}if(s&&i)return{uri:Me.Uri.joinPath(t,s[0],"bin","ruby"),rubyVersion:{engine:i.engine,version:i.version}}}catch{this.outputChannel.debug(`Tried searching for Ruby installation in ${t.fsPath} but it doesn't exist`);continue}}throw new Error("Cannot find any Ruby installations")}missingRubyError(t){return new Error(`Cannot find Ruby installation for version ${t}`)}rubyVersionError(){return new Error(`Cannot find .ruby-version file. Please specify the Ruby version in a
           .ruby-version either in ${this.bundleUri.fsPath} or in a parent directory`)}};var xC=re(require("os")),Yn=re(require("vscode"));var uc=class extends Nt{async activate(){let e=await this.findMiseUri(),t=await this.runEnvActivationScript(`${e.fsPath} x -- ruby`);return{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findMiseUri(){let t=Yn.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.miseExecutablePath");if(t){let i=Yn.Uri.file(t);try{return await Yn.workspace.fs.stat(i),i}catch{throw new Error(`Mise executable configured as ${i.fsPath}, but that file doesn't exist`)}}let n=[Yn.Uri.joinPath(Yn.Uri.file(xC.default.homedir()),".local","bin","mise"),Yn.Uri.joinPath(Yn.Uri.file("/"),"opt","homebrew","bin","mise"),Yn.Uri.joinPath(Yn.Uri.file("/"),"usr","bin","mise")];for(let i of n)try{return await Yn.workspace.fs.stat(i),i}catch{}throw new Error(`The Ruby LSP version manager is configured to be Mise, but could not find Mise installation. Searched in
        ${n.join(", ")}`)}};var dc=re(require("os")),ti=re(require("vscode"));var lc=class extends os{getProcessPath(){return process.env.Path??process.env.PATH??process.env.path}async findRubyUri(e){let[t,n,i]=e.version.split(".").map(Number),s=[ti.Uri.joinPath(ti.Uri.file("C:"),`Ruby${t}${n}-${dc.default.arch()}`),ti.Uri.joinPath(ti.Uri.file(dc.default.homedir()),`Ruby${t}${n}-${dc.default.arch()}`)];for(let o of s)try{return await ti.workspace.fs.stat(o),ti.Uri.joinPath(o,"bin","ruby")}catch{}throw new Error(`Cannot find installation directory for Ruby version ${e.version}.         Searched in ${s.map(o=>o.fsPath).join(", ")}`)}async runActivationScript(e,t){let n=await super.runActivationScript(e,t);return n.gemHome=n.gemHome.replace(/\//g,"\\"),n.defaultGems=n.defaultGems.replace(/\//g,"\\"),n}};var Ri=re(require("vscode"));var fc=class extends Nt{async activate(){let e=await this.findRbenv(),t=await this.runEnvActivationScript(`${e} exec ruby`);return{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findRbenv(){let t=Ri.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.rbenvExecutablePath");return t?this.ensureRbenvExistsAt(t):this.findExec([Ri.Uri.file("/opt/homebrew/bin"),Ri.Uri.file("/usr/local/bin")],"rbenv")}async ensureRbenvExistsAt(e){try{return await Ri.workspace.fs.stat(Ri.Uri.file(e)),e}catch{throw new Error(`The Ruby LSP version manager is configured to be rbenv, but ${e} does not exist`)}}};var IC=re(require("os")),Or=re(require("vscode"));var hc=class extends Nt{async activate(){let e=await this.findRvmInstallation(),t=await this.runEnvActivationScript(e.fsPath),n=Object.entries(t.env).map(([i,s])=>`${i}=${s}`).join(" ");return this.outputChannel.info(`Activated Ruby environment: ${n}`),{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findRvmInstallation(){let e=[Or.Uri.joinPath(Or.Uri.file(IC.default.homedir()),".rvm","bin","rvm-auto-ruby"),Or.Uri.joinPath(Or.Uri.file("/"),"usr","local","rvm","bin","rvm-auto-ruby"),Or.Uri.joinPath(Or.Uri.file("/"),"usr","share","rvm","bin","rvm-auto-ruby")];for(let t of e)try{return await Or.workspace.fs.stat(t),t}catch{}throw new Error(`Cannot find RVM installation directory. Searched in ${e.map(t=>t.fsPath).join(",")}`)}};var as=class extends Nt{constructor(e,t,n,i,s){super(e,t,n,i),this.rubyPath=s??"ruby"}async activate(){let e=await this.runEnvActivationScript(this.rubyPath);return{env:{...process.env,...e.env},yjit:e.yjit,version:e.version,gemPath:e.gemPath}}};var qC=re(require("vscode"));var pc=class extends Nt{async activate(){let e=await this.runEnvActivationScript(`${this.customCommand()} && ruby`);return{env:{...process.env,...e.env},yjit:e.yjit,version:e.version,gemPath:e.gemPath}}customCommand(){let t=qC.workspace.getConfiguration("rubyLsp").get("customRubyCommand");if(t===void 0)throw new Error("The customRubyCommand configuration must be set when 'custom' is selected as the version manager.         See the [README](https://shopify.github.io/ruby-lsp/version-managers.html) for instructions.");return t}};var OC=re(require("os")),Ih=re(require("path")),Tt=re(require("vscode"));var gc=class extends Nt{async activate(){let e=[Tt.Uri.joinPath(Tt.Uri.file("/"),"opt","homebrew","bin"),Tt.Uri.joinPath(Tt.Uri.file("/"),"usr","local","bin")],t=await this.getConfiguredAsdfPath()??await this.findAsdfInstallation()??await this.findExec(e,"asdf"),n=Ih.default.extname(t)===""?t:`. ${t} && asdf`,i=await this.runEnvActivationScript(`${n} exec ruby`);return{env:{...process.env,...i.env},yjit:i.yjit,version:i.version,gemPath:i.gemPath}}async findAsdfInstallation(){let e=Ih.default.basename(Tt.env.shell)==="fish"?"asdf.fish":"asdf.sh",t=[Tt.Uri.joinPath(Tt.Uri.file(OC.default.homedir()),".asdf",e),Tt.Uri.joinPath(Tt.Uri.file("/"),"opt","asdf-vm",e),Tt.Uri.joinPath(Tt.Uri.file("/"),"opt","homebrew","opt","asdf","libexec",e),Tt.Uri.joinPath(Tt.Uri.file("/"),"usr","local","opt","asdf","libexec",e)];for(let n of t)try{return await Tt.workspace.fs.stat(n),n.fsPath}catch{}this.outputChannel.info(`Could not find installation for ASDF < v0.16. Searched in ${t.join(", ")}`)}async getConfiguredAsdfPath(){let t=Tt.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.asdfExecutablePath");if(!t)return;let n=Tt.Uri.file(t);try{return await Tt.workspace.fs.stat(n),this.outputChannel.info(`Using configured ASDF executable path: ${t}`),n.fsPath}catch{throw new Error(`ASDF executable configured as ${n.fsPath}, but that file doesn't exist`)}}};async function rk(){let r=[Ne.Uri.joinPath(Ne.Uri.file(qh.default.homedir()),".local","bin","mise"),Ne.Uri.joinPath(Ne.Uri.file("/"),"opt","homebrew","bin","mise"),Ne.Uri.joinPath(Ne.Uri.file("/"),"usr","bin","mise")];for(let e of r)try{return await Ne.workspace.fs.stat(e),!0}catch{}return!1}var Oh=(p=>(p.Asdf="asdf",p.Auto="auto",p.Chruby="chruby",p.Rbenv="rbenv",p.Rvm="rvm",p.Shadowenv="shadowenv",p.Mise="mise",p.RubyInstaller="rubyInstaller",p.None="none",p.Custom="custom",p))(Oh||{}),vc=class{constructor(e,t,n,i){this.gemPath=[];this.#e=Ne.workspace.getConfiguration("rubyLsp").get("rubyVersionManager");this.shell=process.env.SHELL?.replace(/(\s+)/g,"\\$1");this._env={};this._error=!1;this.context=e,this.workspaceFolder=t,this.outputChannel=n,this.telemetry=i;let s=Ne.workspace.getConfiguration("rubyLsp").get("bundleGemfile");s.length>0&&(this.customBundleGemfile=mc.default.isAbsolute(s)?s:mc.default.resolve(mc.default.join(this.workspaceFolder.uri.fsPath,s)))}#e;get versionManager(){return this.#e}set versionManager(e){typeof e=="string"?this.#e.identifier=e:this.#e=e}get env(){return this._env}get error(){return this._error}async activateRuby(e=Ne.workspace.getConfiguration("rubyLsp").get("rubyVersionManager")){this.versionManager=e,this._error=!1;let t=await this.cachedWorkspaceRubyPath();if(t)await this.runActivation(new as(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this),t));else{this.versionManager.identifier==="auto"&&(await this.discoverVersionManager(),this.outputChannel.info(`Discovered version manager ${this.versionManager.identifier}`));try{await this.runManagerActivation()}catch(n){n instanceof ro||this.telemetry.logError(n,{appType:"extension",appVersion:this.context.extension.packageJSON.version,versionManager:this.versionManager.identifier,workspace:new Ne.TelemetryTrustedValue(this.workspaceFolder.name)});let i=Ne.workspace.getConfiguration("rubyLsp").get("rubyExecutablePath");if(i)await this.runActivation(new as(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this),i));else{if(this._error=!0,this.context.extensionMode===Ne.ExtensionMode.Test)throw n;await this.handleRubyError(n.message)}}}this.error||(this.fetchRubyVersionInfo(),await this.setupBundlePath())}async manuallySelectRuby(){let e=await Ne.window.showInformationMessage("Configure global or workspace specific fallback for the Ruby LSP?","global","workspace","clear previous workspace selection");if(!e)return;if(e==="clear previous workspace selection")return await this.context.workspaceState.update(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`,void 0),this.activateRuby();let t=await Ne.window.showOpenDialog({title:`Select Ruby binary path for ${e} configuration`,openLabel:"Select Ruby binary",canSelectMany:!1});if(!t)return;let n=t[0].fsPath;return e==="global"?await Ne.workspace.getConfiguration("rubyLsp").update("rubyExecutablePath",n,!0):await this.context.workspaceState.update(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`,n),this.activateRuby()}mergeComposedEnvironment(e){this._env={...this._env,...e}}async runActivation(e){let{env:t,version:n,yjit:i,gemPath:s}=await e.activate(),[o,a,c]=n.split(".").map(Number);this.sanitizeEnvironment(t),this.context.extensionMode!==Ne.ExtensionMode.Test&&(process.env=t),this._env=t,this.rubyVersion=n,this.yjitEnabled=i&&o>3||o===3&&a>=2,this.gemPath.push(...s)}fetchRubyVersionInfo(){let[e,t,n]=this.rubyVersion.split(".").map(Number);if(e<3)throw new Error(`The Ruby LSP requires Ruby 3.0 or newer to run. This project is using ${this.rubyVersion}.         [See alternatives](https://github.com/Shopify/ruby-lsp/blob/main/vscode/README.md#ruby-version-requirement)`);this.yjitEnabled&&e===3&&t===2&&(this._env.RUBYOPT?this._env.RUBYOPT.concat(" --yjit"):this._env.RUBYOPT="--yjit")}sanitizeEnvironment(e){Object.keys(e).forEach(t=>{t.startsWith("RUBY_GC")&&delete e[t]}),delete e.VERBOSE,delete e.DEBUG}async runManagerActivation(){switch(this.versionManager.identifier){case"asdf":await this.runActivation(new gc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"chruby":await this.runActivation(new os(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"rbenv":await this.runActivation(new fc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"rvm":await this.runActivation(new hc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"mise":await this.runActivation(new uc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"rubyInstaller":await this.runActivation(new lc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"custom":await this.runActivation(new pc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"none":await this.runActivation(new as(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;default:await this.runActivation(new cc(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break}}async setupBundlePath(){if(this.customBundleGemfile)try{await Ne.workspace.fs.stat(Ne.Uri.file(this.customBundleGemfile)),this._env.BUNDLE_GEMFILE=this.customBundleGemfile}catch{throw new Error(`The configured bundle gemfile ${this.customBundleGemfile} does not exist`)}}async discoverVersionManager(){try{await Ne.workspace.fs.stat(Ne.Uri.joinPath(this.workspaceFolder.uri,".shadowenv.d")),this.versionManager.identifier="shadowenv";return}catch{}let e=["chruby","rbenv","rvm","asdf"];for(let t of e)if(await this.toolExists(t)){this.versionManager=t;return}if(await rk()){this.versionManager="mise";return}if(qh.default.platform()==="win32"){this.versionManager="rubyInstaller";return}this.versionManager="none"}async toolExists(e){try{let t=this.shell?`${this.shell} -i -c '`:"";return t+=`${e} --version`,this.shell&&(t+="'"),this.outputChannel.info(`Checking if ${e} is available on the path with command: ${t}`),await gn(t,{cwd:this.workspaceFolder.uri.fsPath,timeout:1e3}),!0}catch{return!1}}async handleRubyError(e){let t=await Ne.window.showErrorMessage(`Automatic Ruby environment activation with ${this.versionManager.identifier} failed: ${e}`,"Retry","Select Ruby manually");if(t)return t==="Retry"&&await Ne.commands.executeCommand("workbench.action.reloadWindow"),this.manuallySelectRuby()}async cachedWorkspaceRubyPath(){let e=this.context.workspaceState.get(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`);if(e)try{return await Ne.workspace.fs.stat(Ne.Uri.file(e)),e}catch{this.context.workspaceState.update(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`,void 0);return}}};var cs=re(require("path")),Mh=re(require("os")),yc=require("perf_hooks"),Se=re(require("vscode")),Fn=re(sc());function ik(){let r=Object.keys(Eh);return Object.fromEntries(r.map(e=>[e,qr(e)]))}function sk(r,e){let t,n,i=Se.workspace.getConfiguration("rubyLsp"),s=i.get("branch"),o=i.get("bundleGemfile"),a=i.get("useBundlerCompose"),c=i.get("bypassTypechecker"),d={cwd:r.uri.fsPath,env:c?{...e,RUBY_LSP_BYPASS_TYPECHECKER:"true"}:e,shell:!0};if(o.length>0)t={command:"bundle",args:["exec","ruby-lsp"],options:d},n={command:"bundle",args:["exec","ruby-lsp","--debug"],options:d};else if(a)t={command:"bundle",args:["compose","gem","ruby-lsp"],options:d},n={command:"bundle",args:["compose","gem","ruby-lsp","--","--debug"],options:d};else{let p=r.uri.fsPath,v=cs.default.basename(p)==="ruby-lsp"&&Mh.default.platform()!=="win32"?cs.default.join(p,"exe","ruby-lsp"):"ruby-lsp",m=[];s.length>0&&m.push("--branch",s),qr("launcher")&&m.push("--use-launcher"),t={command:v,args:m,options:d},n={command:v,args:m.concat(["--debug"]),options:d}}return{run:t,debug:n}}function ok(r,e,t,n,i,s){let o=r.get("pullDiagnosticsOn"),a={onChange:o==="change"||o==="both",onSave:o==="save"||o==="both"},c=r.get("enabledFeatures"),d=Object.keys(c).filter(m=>c[m]),p=e.uri.fsPath.replace(/\/$/,""),v=ei.flatMap(m=>({scheme:"file",language:m,pattern:`${p}/**/*`}));return i&&ei.forEach(m=>{v.push({language:m,scheme:"untitled"})}),n.gemPath.forEach(m=>{let S=m.replace(/\\/g,"/");v.push({scheme:"file",language:"ruby",pattern:`${S}/**/*`}),/lib\/ruby\/gems\/(?=\d)/.test(S)&&v.push({scheme:"file",language:"ruby",pattern:`${S.replace(/lib\/ruby\/gems\/(?=\d)/,"lib/ruby/")}/**/*`})}),r.get("erbSupport")||(v=v.filter(m=>m.language!=="erb")),{documentSelector:v,workspaceFolder:e,diagnosticCollectionName:oc,outputChannel:t,revealOutputChannelOn:Fn.RevealOutputChannelOn.Never,diagnosticPullOptions:a,errorHandler:new Fh(e,s),initializationOptions:{enabledFeatures:d,featuresConfiguration:r.get("featuresConfiguration"),formatter:r.get("formatter"),linters:r.get("linters"),indexing:r.get("indexing"),addonSettings:r.get("addonSettings"),enabledFeatureFlags:ik(),telemetryMachineId:Se.env.machineId}}}var Fh=class{constructor(e,t){this.workspaceFolder=e,this.telemetry=t}error(e,t,n){return{action:Fn.ErrorAction.Shutdown,handled:!0}}async closed(){let e=Se.workspace.getConfiguration("rubyLsp").get("useLauncher")?"launcher":"direct";return this.telemetry.logUsage("ruby_lsp.launch_failure",{type:"counter",attributes:{label:e}}),await Se.window.showErrorMessage(`Launching the Ruby LSP failed. This typically happens due to an error with version manager
      integration or Bundler issues.

      [Logs](command:workbench.action.output.toggleOutput) |
      [Troubleshooting](https://shopify.github.io/ruby-lsp/troubleshooting.html) |
      [Run bundle install](command:rubyLsp.bundleInstall?"${this.workspaceFolder.uri.toString()}")`,"Retry","Shutdown")==="Retry"?{action:Fn.CloseAction.Restart,handled:!0}:{action:Fn.CloseAction.DoNotRestart,handled:!0}}},Lh=class{fillClientCapabilities(e){e.experimental={requestDelegation:!0}}initialize(e,t){}getState(){return{kind:"static"}}clear(){}},so=class extends Fn.LanguageClient{constructor(t,n,i,s,o,a,c,d=!1,p){super(oc,sk(o,i.env),ok(Se.workspace.getConfiguration("rubyLsp"),o,a,i,d,n),p);this.degraded=!1;this.virtualDocuments=new Map;this.subscriptions=[];this.registerFeature(new Lh),this.workspaceOutputChannel=a,this.virtualDocuments=c,this.registerMiddleware(),this.workingDirectory=o.uri.fsPath,this.baseFolder=cs.default.basename(this.workingDirectory),this.telemetry=n,this.createTestItems=s,this.#e=t,this.ruby=i,this.#t="",this.subscriptions.push(this.onNotification("delegate/textDocument/virtualState",v=>{this.virtualDocuments.set(v.textDocument.uri,v.textDocument.text)}),this.onTelemetry(v=>{v.type==="error"?this.telemetry.logError({message:v.errorMessage,name:v.errorClass,stack:v.stack},{appType:"server",appVersion:this.serverVersion,workspace:new Se.TelemetryTrustedValue(cs.default.basename(this.workingDirectory))}):v.type==="data"&&this.validServerTelemetry(v)&&this.telemetry.logUsage(v.eventName,v.data)})),this.indexingPromise=new Promise(v=>{this.clientOptions.middleware.handleWorkDoneProgress=(m,S,b)=>{m.toString()==="indexing-progress"&&S.kind==="end"&&v(),b(m,S)}})}#e;#t;async afterStart(){this.#t=this.initializeResult?.formatter,this.serverVersion=this.initializeResult?.serverInfo?.version,this.initializeResult?.degraded_mode&&(this.degraded=this.initializeResult?.degraded_mode),this.initializeResult?.bundle_env&&this.ruby.mergeComposedEnvironment(this.initializeResult.bundle_env),await this.fetchAddons()}async fetchAddons(){if(this.initializeResult?.capabilities.experimental?.addon_detection)try{this.addons=await this.sendRequest("rubyLsp/workspace/addons",{})}catch(t){this.workspaceOutputChannel.error(`Error while fetching addons: ${t.data.errorMessage}`)}}async waitForIndexing(){return this.indexingPromise}get formatter(){return this.#t}get context(){return this.#e}set context(t){this.#e=t}async sendShowSyntaxTreeRequest(t,n){return this.sendRequest("rubyLsp/textDocument/showSyntaxTree",{textDocument:{uri:t.toString()},range:n})}async discoverTests(t){return this.sendRequest("rubyLsp/discoverTests",{textDocument:{uri:t.toString()}})}async resolveTestCommands(t){return this.sendRequest("rubyLsp/resolveTestCommands",{items:t})}async dispose(t){return this.subscriptions.forEach(n=>n.dispose()),this.subscriptions=[],super.dispose(t)}async sendGoToRelevantFileRequest(t){return this.sendRequest("experimental/goToRelevantFile",{textDocument:{uri:t.toString()}})}async benchmarkMiddleware(t,n,i){if(this.state!==Fn.State.Running)return i();let s=typeof t=="string"?t:t.method;try{yc.performance.mark(`${s}.start`);let o=await i();yc.performance.mark(`${s}.end`);let a=yc.performance.measure("benchmarks",`${s}.start`,`${s}.end`);return this.logResponseTime(a.duration,s),o}catch(o){if(o.code===-32900)return this.executeDelegateRequest(t,n);if(o.data)if(this.baseFolder==="ruby-lsp"||this.baseFolder==="ruby-lsp-rails")await Se.window.showErrorMessage(`Ruby LSP error ${o.data.errorClass}: ${o.data.errorMessage}

${o.data.backtrace}`);else{let{errorMessage:a,errorClass:c,backtrace:d}=o.data;if(a&&c&&d&&o.code===Fn.ErrorCodes.InternalError){let p=new Se.TelemetryTrustedValue(d.split(`
`).map(v=>v.replace(Mh.default.homedir(),"~")).join(`
`));this.telemetry.logError({message:a,name:c,stack:p},{...o.data,appType:"server",appVersion:this.serverVersion,workspace:new Se.TelemetryTrustedValue(cs.default.basename(this.workingDirectory))})}}throw o}}async executeDelegateRequest(t,n){let i=typeof t=="string"?t:t.method,s=n.textDocument.uri;if(!s)return null;let o=this.virtualDocumentUri(s);switch(i){case"textDocument/completion":return Se.commands.executeCommand("vscode.executeCompletionItemProvider",Se.Uri.parse(o),n.position,n.context.triggerCharacter).then(a=>(a.items.forEach(c=>{c.documentation&&typeof c.documentation!="string"&&"value"in c.documentation&&(c.documentation.kind="markdown"),c.data={...c.data,delegateCompletion:!0}}),a));case"textDocument/hover":return Se.commands.executeCommand("vscode.executeHoverProvider",Se.Uri.parse(o),n.position);case"textDocument/definition":return Se.commands.executeCommand("vscode.executeDefinitionProvider",Se.Uri.parse(o),n.position);case"textDocument/signatureHelp":return Se.commands.executeCommand("vscode.executeSignatureHelpProvider",Se.Uri.parse(o),n.position,n.context?.triggerCharacter);case"textDocument/documentHighlight":return Se.commands.executeCommand("vscode.executeDocumentHighlights",Se.Uri.parse(o),n.position);default:return this.workspaceOutputChannel.warn(`Attempted to delegate unsupported request ${i}`),null}}registerMiddleware(){this.clientOptions.middleware={provideCodeLenses:async(t,n,i)=>{let s=await i(t,n);if(s){let o=s.filter(a=>a.data?.type==="test");o.length&&this.createTestItems(o)}return s},provideOnTypeFormattingEdits:async(t,n,i,s,o,a)=>{let c=await this.sendRequest("textDocument/onTypeFormatting",{textDocument:{uri:t.uri.toString()},position:n,ch:i,options:s},o);if(!c)return null;let d=c.find(x=>x.newText==="$0");if(!d)return c;c.splice(c.indexOf(d),1);let p=new Se.WorkspaceEdit;p.set(t.uri,c);let m=Se.window.activeTextEditor.document.lineAt(d.range.start.line).text;await Se.workspace.applyEdit(p);let S=Se.window.activeTextEditor?.options.insertSpaces?" ":"	",b=0;/^\s*$/.exec(m)&&(b=d.range.end.character);let E=S.repeat(b);return await Se.window.activeTextEditor.insertSnippet(new Se.SnippetString(`${E}${d.newText}`),new Se.Selection(d.range.start,d.range.end)),null},sendRequest:async(t,n,i,s)=>this.benchmarkMiddleware(t,n,()=>s(t,n,i)),sendNotification:async(t,n,i)=>this.benchmarkMiddleware(t,i,()=>n(t,i)),didClose:(t,n)=>(this.virtualDocuments.delete(t.uri.toString(!0)),n(t)),provideFoldingRanges:async(t,n,i,s)=>{if(t.languageId==="erb"){let o=this.virtualDocumentUri(t.uri.toString(!0)),a=await Se.commands.executeCommand("vscode.executeFoldingRangeProvider",Se.Uri.parse(o)),c=await s(t,n,i);return a.concat(c??[])}return s(t,n,i)},provideDocumentLinks:async(t,n,i)=>{if(t.languageId==="erb"){let s=this.virtualDocumentUri(t.uri.toString(!0)),o=await Se.commands.executeCommand("vscode.executeLinkProvider",Se.Uri.parse(s)),a=await i(t,n);return o.concat(a??[])}return i(t,n)}}}virtualDocumentUri(t){let n=/\.([^.]+)\.erb$/.exec(t)?.[1]||"html";return`embedded-content://${n}/${encodeURIComponent(t)}.${n}`}logResponseTime(t,n){this.telemetry.logUsage("ruby_lsp.response_time",{type:"histogram",value:t,attributes:{message:new Se.TelemetryTrustedValue(n),lspVersion:this.serverVersion,rubyVersion:this.ruby.rubyVersion}})}validServerTelemetry(t){let{eventName:n,data:{type:i,value:s}}=t;return typeof n=="string"&&(i==="histogram"&&typeof s=="number"||i==="counter"&&(typeof s=="number"||!s))}};var bc=class{constructor(e,t){this.prefix=`(${e})`,this.actualChannel=t,this.onDidChangeLogLevel=this.actualChannel.onDidChangeLogLevel}get name(){return this.actualChannel.name}get logLevel(){return this.actualChannel.logLevel}trace(e,...t){this.actualChannel.trace(`${this.prefix} ${e}`,...t)}debug(e,...t){this.actualChannel.debug(`${this.prefix} ${e}`,...t)}info(e,...t){this.actualChannel.info(`${this.prefix} ${e}`,...t)}warn(e,...t){this.actualChannel.warn(`${this.prefix} ${e}`,...t)}error(e,...t){this.actualChannel.error(`${this.prefix} ${e}`,...t)}append(e){this.actualChannel.append(`${this.prefix} ${e}`)}appendLine(e){this.actualChannel.appendLine(`${this.prefix} ${e}`)}replace(e){this.actualChannel.replace(`${this.prefix} ${e}`)}clear(){this.actualChannel.clear()}show(e,t){this.actualChannel.show(t)}hide(){this.actualChannel.hide()}dispose(){this.actualChannel.dispose()}};var FC=["Gemfile.lock","gems.locked"],Cc=class{constructor(e,t,n,i,s,o=!1){this.virtualDocuments=new Map;this.restartDocumentShas=new Map;this.needsRestart=!1;this.subscriptions=[];this.#e=!1;this.#t=!1;this.debouncedRestart=kC(async e=>{this.outputChannel.info(`Restarting the Ruby LSP because ${e}`),await this.restart()},5e3);this.context=e,this.workspaceFolder=t,this.outputChannel=new bc(t.name,Cr),this.telemetry=n,this.ruby=new vc(e,t,this.outputChannel,n),this.createTestItems=i,this.isMainWorkspace=o,this.virtualDocuments=s}#e;#t;async activate(){let e=wt.extensions.getExtension("vscode.git"),t=this.workspaceFolder.uri;if(e){let i=await e.exports.getAPI(1).openRepository(this.workspaceFolder.uri);i&&(t=i.rootUri)}this.registerCreateDeleteWatcher(t,".git/{rebase-merge,rebase-apply,BISECT_START,CHERRY_PICK_HEAD}"),this.registerRestarts();for(let n of FC){let i=wt.Uri.joinPath(this.workspaceFolder.uri,n),s=await this.fileContentsSha(i);s&&this.restartDocumentShas.set(i.fsPath,s)}}async start(e){if(await this.ruby.activateRuby(),this.ruby.error){this.error=!0;return}try{if((await wt.workspace.fs.stat(this.workspaceFolder.uri)).permissions)throw new Error(`Directory ${this.workspaceFolder.uri.fsPath} is readonly.`)}catch{this.error=!0,await wt.window.showErrorMessage(`Directory ${this.workspaceFolder.uri.fsPath} is not writable. The Ruby LSP server needs to be able to create a
        .ruby-lsp directory to function appropriately. Consider switching to a directory for which VS Code has write
        permissions`);return}try{await this.installOrUpdateServer(!1)}catch(t){this.error=!0,await wt.window.showErrorMessage(`Failed to setup the bundle: ${t.message}.         See [Troubleshooting](https://shopify.github.io/ruby-lsp/troubleshooting.html) for help`);return}this.lspClient&&await this.stop(),this.lspClient=new so(this.context,this.telemetry,this.ruby,this.createTestItems,this.workspaceFolder,this.outputChannel,this.virtualDocuments,this.isMainWorkspace,e);try{Qn.fire(this),await wt.window.withProgress({location:wt.ProgressLocation.Window,title:"Initializing Ruby LSP"},async()=>{await this.lspClient.start(),await this.lspClient.afterStart()}),Qn.fire(this),this.needsRestart&&(this.needsRestart=!1,await this.debouncedRestart("a restart was requested while the server was still booting"))}catch(t){this.error=!0,this.outputChannel.error(`Error starting the server: ${t.message}`)}}async stop(){await this.lspClient?.dispose()}async restart(){try{if(this.#e)return;if(this.error=!1,!this.lspClient)return this.start();let e=!1;switch(this.lspClient.state){case wc.State.Starting:this.needsRestart=!0;break;case wc.State.Running:e=!this.lspClient.initializeResult?.capabilities.experimental.compose_bundle||await this.composingBundleSucceeds(),e&&(await this.stop(),this.lspClient=void 0,await this.start());break;case wc.State.Stopped:await this.stop(),this.lspClient=void 0,await this.start();break}}catch(e){this.error=!0,this.outputChannel.error(`Error restarting the server: ${e.message}`)}}async dispose(){this.subscriptions.forEach(e=>e.dispose()),await this.lspClient?.dispose()}async installOrUpdateServer(e){if(wt.workspace.getConfiguration("rubyLsp").get("bundleGemfile").length>0)return;let n=1440*60*1e3,i=this.context.workspaceState.get("rubyLsp.lastGemUpdate"),s=["ruby-lsp","language_server-protocol","prism","rbs"],{stdout:o}=await gn(`gem list ${s.join(" ")}`,{cwd:this.workspaceFolder.uri.fsPath,env:this.ruby.env});if(!s.every(a=>new RegExp(`${a}\\s`).exec(o))){await gn("gem install ruby-lsp",{cwd:this.workspaceFolder.uri.fsPath,env:this.ruby.env}),await this.context.workspaceState.update("rubyLsp.lastGemUpdate",Date.now());return}if(e){let a=wt.Uri.joinPath(this.workspaceFolder.uri,".ruby-lsp");try{await wt.workspace.fs.delete(a,{recursive:!0})}catch{this.outputChannel.info(`Tried deleting ${a.fsPath}, but it doesn't exist`)}}if(e||i===void 0||Date.now()-i>n)try{await gn("gem update ruby-lsp",{cwd:this.workspaceFolder.uri.fsPath,env:this.ruby.env}),await this.context.workspaceState.update("rubyLsp.lastGemUpdate",Date.now())}catch(a){this.outputChannel.error(`Failed to update global ruby-lsp gem: ${a}`)}}get error(){return this.#t}set error(e){Qn.fire(this),this.#t=e}get inhibitRestart(){return this.#e}async execute(e,t=!1){t&&(this.outputChannel.show(),this.outputChannel.info(`Running "${e}"`));let n=await gn(e,{env:this.ruby.env,cwd:this.workspaceFolder.uri.fsPath});return t&&(n.stderr.length>0?this.outputChannel.error(n.stderr):this.outputChannel.info(n.stdout)),n}registerRestarts(){this.createRestartWatcher(`{${FC.join(",")}}`),this.subscriptions.push(wt.workspace.onDidChangeConfiguration(async e=>{e.affectsConfiguration("rubyLsp")&&await this.debouncedRestart("configuration changed")}))}createRestartWatcher(e){let t=wt.workspace.createFileSystemWatcher(new wt.RelativePattern(this.workspaceFolder,e)),n=async s=>{let o=s.fsPath,a=await this.fileContentsSha(s);a&&this.restartDocumentShas.get(o)!==a&&(this.restartDocumentShas.set(o,a),await this.debouncedRestart(`${o} changed, matching ${e}`))},i=async s=>{this.restartDocumentShas.delete(s.fsPath),await this.debouncedRestart(`${s.fsPath} changed, matching ${e}`)};this.subscriptions.push(t,t.onDidChange(n),t.onDidCreate(n),t.onDidDelete(i))}registerCreateDeleteWatcher(e,t){let n=wt.workspace.createFileSystemWatcher(new wt.RelativePattern(e,t)),i=()=>{this.#e=!0},s=async o=>{this.#e=!1,await this.debouncedRestart(`${o.fsPath} changed, matching ${t}`)};this.subscriptions.push(n,n.onDidCreate(i),n.onDidDelete(s))}async fileContentsSha(e){let t;try{t=await wt.workspace.fs.readFile(e)}catch{return}let n=(0,LC.createHash)("sha256");return n.update(t.toString()),n.digest("hex")}async composingBundleSucceeds(){if(!this.lspClient)return!1;try{return(await this.lspClient.sendRequest("rubyLsp/composeBundle")).success}catch{return!1}}};var mn=re(require("vscode")),Rc=re(ic());var MC=[{label:"Ruby LSP: Start",description:"rubyLsp.start"},{label:"Ruby LSP: Restart",description:"rubyLsp.restart"}],Nh=[{label:"Ruby LSP: Stop",description:"rubyLsp.stop"},{label:"Ruby LSP: Restart",description:"rubyLsp.restart"},{label:"Ruby LSP: Open server changelog in browser",description:"rubyLsp.showServerChangelog"}],Si=class{constructor(e){let t=ei.map(n=>({language:n}));this.item=mn.languages.createLanguageStatusItem(e,t)}dispose(){this.item.dispose()}},Ah=class extends Si{constructor(){super("rubyVersion"),this.item.name="Ruby Version",this.item.command={title:"Configure",command:"rubyLsp.selectRubyVersionManager"},this.item.text="Activating Ruby environment",this.item.severity=mn.LanguageStatusSeverity.Information}refresh(e){e.ruby.error?(this.item.text="Failed to activate Ruby",this.item.severity=mn.LanguageStatusSeverity.Error):(this.item.text=`Using Ruby ${e.ruby.rubyVersion} with ${e.ruby.versionManager.identifier}`,this.item.severity=mn.LanguageStatusSeverity.Information)}},jh=class extends Si{constructor(){super("server"),this.item.name="Ruby LSP Server Status",this.item.text="Ruby LSP: Starting",this.item.severity=mn.LanguageStatusSeverity.Information,this.item.command={title:"Configure",command:"rubyLsp.serverOptions",arguments:[Nh]}}refresh(e){if(e.error){this.item.text="Ruby LSP: Error",this.item.command.arguments=[MC],this.item.severity=mn.LanguageStatusSeverity.Error;return}if(e.lspClient)switch(e.lspClient.state){case Rc.State.Running:{this.item.text=e.lspClient.serverVersion?`Ruby LSP server v${e.lspClient.serverVersion}: Running`:"Ruby LSP: Running",e.lspClient.degraded?(this.item.text+=" (degraded)",this.item.severity=mn.LanguageStatusSeverity.Warning):this.item.severity=mn.LanguageStatusSeverity.Information,this.item.command.arguments=[Nh];break}case Rc.State.Starting:{this.item.text="Ruby LSP: Starting",this.item.command.arguments=[Nh],this.item.severity=mn.LanguageStatusSeverity.Information;break}case Rc.State.Stopped:{this.item.text="Ruby LSP: Stopped",this.item.command.arguments=[MC],this.item.severity=mn.LanguageStatusSeverity.Information;break}}}},$h=class extends Si{constructor(){super("features"),this.item.name="Ruby LSP Features",this.item.command={title:"Manage",command:"rubyLsp.toggleFeatures"},this.item.text="Fetching feature information"}refresh(e){let n=mn.workspace.getConfiguration("rubyLsp").get("enabledFeatures"),i=Object.keys(n).filter(s=>n[s]);this.item.text=`${i.length}/${Object.keys(n).length} features enabled`}},Uh=class extends Si{constructor(){super("formatter"),this.item.name="Ruby LSP Formatter",this.item.command={title:"Help",command:"rubyLsp.formatterHelp"},this.item.text="Fetching formatter information"}refresh(e){e.lspClient&&(e.lspClient.formatter?this.item.text=`Formatter: ${e.lspClient.formatter}`:this.item.text="Formatter: requires server to be v0.12.4 or higher to display this field")}},Wh=class extends Si{constructor(){super("addons"),this.item.name="Ruby LSP Add-ons",this.item.text="Fetching add-on information"}refresh(e){e.lspClient&&(e.lspClient.addons===void 0?this.item.text="Addons: requires server to be v0.17.4 or higher to display this field":e.lspClient.addons.length===0?this.item.text="Addons: none":(this.item.text=`Addons: ${e.lspClient.addons.length}`,this.item.command={title:"Details",command:"rubyLsp.displayAddons"}))}},Sc=class{constructor(){this.items=[];this.items=[new Ah,new jh,new $h,new Uh,new Wh],Qn.event(e=>{e&&this.items.forEach(t=>t.refresh(e))})}dispose(){this.items.forEach(e=>e.dispose())}};var kR=require("child_process"),ER=require("util"),Lr=re(require("path")),W=re(require("vscode"));var AC=re(require("vscode")),_c=class{constructor(e,...t){this.tokenSource=new AC.CancellationTokenSource;[e,...t].forEach(n=>{n.onCancellationRequested(()=>{this.tokenSource.cancel()})})}dispose(){this.tokenSource.dispose()}isCancellationRequested(){return this.tokenSource.token.isCancellationRequested}onCancellationRequested(e){this.tokenSource.token.onCancellationRequested(e)}};var vR=require("child_process"),yR=re(require("net")),bR=re(require("os")),wR=re(require("path")),Nn=re(mR()),rt=re(require("vscode")),vs={start:new Nn.NotificationType("start"),pass:new Nn.NotificationType("pass"),skip:new Nn.NotificationType("skip"),fail:new Nn.NotificationType("fail"),error:new Nn.NotificationType("error"),finish:new Nn.NotificationType("finish")};var Kc=class{constructor(e,t,n){this.promises=[];this.disposables=[];this.terminals=new Map;this.findTestItem=t,this.createTestRun=n,e.subscriptions.push(rt.window.onDidCloseTerminal(i=>{this.terminals.delete(i.name)}))}async activate(){this.tcpServer=await this.startServer()}async execute(e,t,n,i,s,o){this.currentWorkspace=i,this.run=e,await new Promise((a,c)=>{this.executionPromise={resolve:a,reject:c};let d=new AbortController;o.onCancellationRequested(async()=>{this.run.appendOutput(`\r
Test run cancelled.`),d.abort(),await this.finalize(!0)}),s==="run"?this.spawnTestProcess(t,n,i.workspaceFolder.uri.fsPath,d):s==="runInTerminal"?this.runInTerminal(t,i.workspaceFolder):this.launchDebugger(t,n,i)})}dispose(){this.tcpServer?.close(),this.connection?.dispose()}async launchDebugger(e,t,n){await rt.debug.startDebugging(n.workspaceFolder,{type:"ruby_lsp",name:"Debug",request:"launch",program:e,env:{...t,DISABLE_SPRING:"1"}},{testRun:this.run})||this.executionPromise.reject(new Error("Failed to start debugging session"));let s=new Promise(o=>{let a=rt.debug.onDidTerminateDebugSession(c=>{a.dispose(),o()})});this.promises.push(s)}runInTerminal(e,t){let n=t.uri.fsPath,i=`${t.name}: test`,s=rt.window.terminals.find(o=>o.name===i);s||(s=rt.window.createTerminal({name:i,cwd:n,env:{DISABLE_SPRING:"1"}})),this.terminals.set(i,s),s.show(),s.sendText(e)}spawnTestProcess(e,t,n,i){let s=new Promise((o,a)=>{let c=(0,vR.spawn)(e,{env:{...t,DISABLE_SPRING:"1"},stdio:["pipe","pipe","pipe"],shell:!0,signal:i.signal,cwd:n});c.stdout.on("data",d=>{this.run.appendOutput(d.toString().replace(/\n/g,`\r
`))}),c.stderr.on("data",d=>{this.run.appendOutput(d.toString().replace(/\n/g,`\r
`))}),c.on("exit",d=>{o()})});this.promises.push(s)}async startServer(){return new Promise((e,t)=>{let n=yR.default.createServer();n.on("error",t),n.unref(),n.listen(0,"localhost",async()=>{let i=n.address();if(!i)throw new Error("Failed setup TCP server for streaming updates");this.tcpPort=typeof i=="string"?i:i.port.toString();let s=this.tcpPort.toString();await this.updatePortMap(s),n.on("connection",o=>{this.connection=Nn.createMessageConnection(new Nn.StreamMessageReader(o),new Nn.StreamMessageWriter(o)),this.registerStreamingEvents(),this.run||(this.run=this.createTestRun(new rt.TestRunRequest(void 0,void 0,void 0,void 0,!0),"on_demand_run_in_terminal")),this.connection.listen()}),e(n)})})}async updatePortMap(e){let t=rt.Uri.file(wR.default.join(bR.default.tmpdir(),"ruby-lsp"));await rt.workspace.fs.createDirectory(t);let n=Object.fromEntries(rt.workspace.workspaceFolders.map(a=>[a.uri.fsPath,e])),i=rt.Uri.joinPath(t,"test_reporter_port_db.json"),s;try{let a=await rt.workspace.fs.readFile(i);s=JSON.parse(a.toString())}catch{s={}}let o={...s,...n};await rt.workspace.fs.writeFile(i,Buffer.from(JSON.stringify(o)))}async finalize(e){if(e&&this.currentWorkspace){let t=this.terminals.get(`${this.currentWorkspace.workspaceFolder.name}: test`);t&&t.sendText("")}await Promise.all(this.promises),this.disposables.forEach(t=>t.dispose()),this.promises=[],this.disposables=[],this.connection&&(this.connection.end(),this.connection.dispose()),this.run&&this.run.name==="on_demand_run_in_terminal"&&this.run.end(),this.run=void 0,this.executionPromise.resolve()}registerStreamingEvents(){if(!this.connection)return;let e=new Map,t=(n,i)=>{let s=e.get(n),o=s?Date.now()-s:void 0;i(o)};this.disposables.push(this.connection.onNotification(vs.finish,()=>this.finalize(!1))),this.disposables.push(this.connection.onNotification(vs.start,n=>{this.promises.push(this.findTestItem(n.id,rt.Uri.parse(n.uri),n.line).then(i=>{i&&(this.run.started(i),e.set(i.id,Date.now()))}))})),this.disposables.push(this.connection.onNotification(vs.pass,n=>{this.promises.push(this.findTestItem(n.id,rt.Uri.parse(n.uri)).then(i=>{i&&t(i.id,s=>this.run.passed(i,s))}))})),this.disposables.push(this.connection.onNotification(vs.fail,n=>{this.promises.push(this.findTestItem(n.id,rt.Uri.parse(n.uri)).then(i=>{i&&t(i.id,s=>this.run.failed(i,new rt.TestMessage(n.message),s))}))})),this.disposables.push(this.connection.onNotification(vs.error,n=>{this.promises.push(this.findTestItem(n.id,rt.Uri.parse(n.uri)).then(i=>{i&&t(i.id,s=>this.run.errored(i,new rt.TestMessage(n.message),s))}))})),this.disposables.push(this.connection.onNotification(vs.skip,n=>{this.promises.push(this.findTestItem(n.id,rt.Uri.parse(n.uri)).then(i=>{i&&this.run.skipped(i)}))}))}};var Wk=(0,ER.promisify)(kR.exec),xR="**/{test,spec,features}/**/",Zp=`${xR}{*_test.rb,test_*.rb,*_spec.rb,*.feature}`,CR=new W.TestTag("workspace"),RR=new W.TestTag("test_dir"),SR=new W.TestTag("test_group"),_r=new W.TestTag("debug"),_R=new W.TestTag("test_file"),eg="Run",TR="Run in terminal",DR="Debug",PR="Coverage",Bc=class{constructor(e,t,n,i){this.testTimeout=W.workspace.getConfiguration("rubyLsp").get("testTimeout");this.fullDiscovery=qr("fullTestDiscovery");this.coverageData=new WeakMap;this.telemetry=t,this.currentWorkspace=n,this.getOrActivateWorkspace=i,this.testController=W.tests.createTestController("rubyTests","Ruby Tests"),this.runner=new Kc(e,this.findTestItem.bind(this),this.testController.createTestRun.bind(this.testController)),this.fullDiscovery&&(this.testController.resolveHandler=this.resolveHandler.bind(this),this.testController.refreshHandler=this.refreshHandler.bind(this)),this.testCommands=new WeakMap,this.testRunProfile=this.testController.createRunProfile(eg,W.TestRunProfileKind.Run,this.fullDiscovery?this.runTest.bind(this):this.runHandler.bind(this),!0,void 0,!0),this.testDebugProfile=this.testController.createRunProfile(DR,W.TestRunProfileKind.Debug,this.fullDiscovery?this.runTest.bind(this):this.debugHandler.bind(this),!1,_r),this.coverageProfile=this.testController.createRunProfile(PR,W.TestRunProfileKind.Coverage,this.fullDiscovery?this.runTest.bind(this):async()=>{await W.window.showInformationMessage(`Running tests with coverage requires the new explorer implementation,
               which is currently under development.
               If you wish to enable it, set the "fullTestDiscovery" feature flag to "true"`)},!1),this.coverageProfile.loadDetailedCoverage=async(a,c,d)=>this.coverageData.get(c),this.runInTerminalProfile=this.testController.createRunProfile(TR,W.TestRunProfileKind.Run,this.runTest.bind(this),!1);let s=W.workspace.createFileSystemWatcher(Zp),o=W.workspace.createFileSystemWatcher(xR,!0,!0,!1);e.subscriptions.push(this.testController,this.testDebugProfile,this.testRunProfile,this.coverageProfile,this.runner,this.runInTerminalProfile,W.window.onDidCloseTerminal(a=>{a===this.terminal&&(this.terminal=void 0)}),s,o,s.onDidCreate(async a=>{let c=W.workspace.getWorkspaceFolder(a);if(!c||!W.workspace.workspaceFolders)return;let d=W.workspace.workspaceFolders.length===1?this.testController.items:this.testController.items.get(c.uri.toString())?.children;d&&await this.addTestItemsForFile(a,c,d)}),s.onDidChange(async a=>{let c=await this.getParentTestItem(a);if(c){let d=c.children.get(a.toString());d&&(d.children.replace([]),await this.resolveHandler(d))}}),o.onDidDelete(async a=>{if(a.fsPath.split(Lr.default.sep).includes(".git"))return;let d=await this.getParentTestItem(a);d&&d.children.delete(a.toString())}),s.onDidDelete(async a=>{let c=await this.getParentTestItem(a);c&&c.children.delete(a.toString())}))}createTestItems(e){if(this.fullDiscovery)return;this.testController.items.forEach(i=>{this.testController.items.delete(i.id),this.testCommands.delete(i)});let t=new Map,n=W.Uri.from({scheme:"file",path:e[0].command.arguments[0]});e.forEach(i=>{let[s,o,a,c,d]=i.command.arguments,p=this.testController.createTestItem(o,d||o,n),v=i.data;if(p.tags=[new W.TestTag(v.kind)],this.testCommands.set(p,a),p.range=new W.Range(new W.Position(c.start_line,c.start_column),new W.Position(c.end_line,c.end_column)),v.id?(t.set(v.id,p),p.canResolveChildren=!0):p.tags=[...p.tags,_r],v.group_id){let m=t.get(v.group_id);m?m.children.add(p):this.currentWorkspace()?.outputChannel.error(`Test example "${o}" is attached to group_id ${v.group_id}, but that group does not exist`)}else this.testController.items.add(p)})}runTestInTerminal(e,t,n){n??=this.testCommands.get(this.findTestByActiveLine())||"",this.terminal===void 0&&(this.terminal=this.getTerminal()),this.terminal.show(!0),this.terminal.sendText(n),this.telemetry.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"test_in_terminal",vscodemachineid:W.env.machineId}})}async runOnClick(e){let t=this.findTestById(e);if(!t)return;await W.commands.executeCommand("vscode.revealTestInExplorer",t);let n=new W.CancellationTokenSource;n.token.onCancellationRequested(async()=>{n?.dispose(),n=null,await W.window.showInformationMessage("Cancelled the progress")});let i=new W.TestRunRequest([t],[],this.testRunProfile);return this.testRunProfile.runHandler(i,n.token)}debugTest(e,t,n){n??=this.testCommands.get(this.findTestByActiveLine())||"";let i=this.currentWorkspace();if(!i)throw new Error("No workspace found. Debugging requires a workspace to be opened");return W.debug.startDebugging(i.workspaceFolder,{type:"ruby_lsp",name:"Debug",request:"launch",program:n,env:{...i.ruby.env,DISABLE_SPRING:"1"}})}buildRequestTestItems(e,t){if(!t)return e.map(i=>this.testItemToServerItem(i));let n=[];return e.forEach(i=>{let s=this.recursivelyFilter(i,t);s&&n.push(s)}),n}async runViaCommand(e,t,n){let i=W.Uri.file(e),s=await this.findTestItem(t,i);if(!s){await W.window.showErrorMessage(`Attempted to run "${t}" defined in "${e}", but that test has not been discovered.
        Does the file path match the expected glob pattern?
        [Read more](https://shopify.github.io/ruby-lsp/test_explorer.html)

        Expected pattern: "**/{test,spec,features}/**/{*_test.rb,test_*.rb,*_spec.rb,*.feature}"`);return}n==="run"&&await W.commands.executeCommand("vscode.revealTestInExplorer",s);let o=new W.CancellationTokenSource;o.token.onCancellationRequested(async()=>{o.dispose(),await W.window.showInformationMessage("Cancelled the progress")});let a;switch(n){case"debug":a=this.testDebugProfile;break;case"runInTerminal":a=this.runInTerminalProfile;break;default:a=this.testRunProfile;break}let c=new W.TestRunRequest([s],[],a);return this.runTest(c,o.token)}async runTest(e,t){if(this.telemetry.logUsage("ruby_lsp.test_explorer",{type:"counter",attributes:{label:e.profile?.label||eg,vscodemachineid:W.env.machineId,continuousMode:e.continuous??!1}}),e.continuous){let n=[],i=W.workspace.createFileSystemWatcher(Zp,!0,!1,!0);n.push(i,i.onDidChange(async()=>{let s=new W.TestRunRequest(e.include,e.exclude,e.profile,!1,e.preserveFocus);await this.handleTests(s,t)})),n.push(t.onCancellationRequested(()=>{n.forEach(s=>s.dispose())}))}else await this.handleTests(e,t)}async findTestItem(e,t,n){this.testController.items.size===0&&await W.window.withProgress({title:"Discovering tests",location:W.ProgressLocation.Notification},async a=>{await this.resolveHandler(void 0,a)});let i=await this.getParentTestItem(t);if(!i)return;if(i.id===e)return i;let s=i.children.get(t.toString());if(!s)return;if(s.id===e)return s;s.children.size===0&&await this.resolveHandler(s);let o=s.children.get(e);return o||this.findTestInGroup(e,s,n)}async activate(){await this.runner.activate()}get streamingPort(){return this.runner.tcpPort}async refreshHandler(e){this.testController.items.replace([]),this.testController.invalidateTestResults(),await this.testController.resolveHandler(void 0)}async handleTests(e,t){let n=this.testController.createTestRun(e),i=[];e.include?e.include.forEach(a=>i.push(a)):this.testController.items.forEach(a=>i.push(a)),await this.discoverFrameworkTag(i);let s=new Map;i.forEach(a=>{let c=W.workspace.getWorkspaceFolder(a.uri),d=s.get(c);d?d.push(a):s.set(c,[a])});let o=new _c(t,n.token);for(let[a,c]of s){if(o.isCancellationRequested())break;let d=this.buildRequestTestItems(c,e.exclude),p=await this.getOrActivateWorkspace(a);if(!p.lspClient?.initializeResult?.capabilities.experimental?.full_test_discovery){n.appendOutput(`The version of the Ruby LSP server being used by ${a.name} does not support the new
           test explorer functionality. Please make sure you are using the latest version of the server.
           See https://shopify.github.io/ruby-lsp/troubleshooting.html#outdated-version for more information.`);break}let v=await p.lspClient?.resolveTestCommands(d);if(!v){c.forEach(S=>n.errored(S,new W.TestMessage("Could not resolve test command to run selected tests")));continue}c.forEach(S=>n.enqueued(S));let m=e.profile;!m||m.label===eg||m.label===TR||m.label===PR?await this.executeTestCommands(v,p,n,m,o):m.label===DR&&await this.debugTestCommands(v,p,n,o)}n.end(),o.dispose()}async discoverFrameworkTag(e){let t=e.filter(n=>!n.tags.some(i=>i.id.startsWith("framework")));if(t.length!==0)for(let n of t){let i=n;for(;!i.tags.some(s=>s===_R);){let s;i.children.forEach(o=>{s===void 0&&(s=o)}),i=s}await this.resolveHandler(i),this.setFrameworkTagInAllParents(i)}}setFrameworkTagInAllParents(e){let t=e.tags.find(i=>i.id.startsWith("framework")),n=e.parent;for(;n;)n.tags.some(i=>i.id.startsWith("framework"))||(n.tags=[...n.tags,t]),n=n.parent}async executeTestCommands(e,t,n,i,s){let o;if(e.reporterPaths){let d=`-rbundler/setup ${e.reporterPaths.map(p=>`-r${p}`).join(" ")}`;o=t.ruby.env.RUBYOPT?`${t.ruby.env.RUBYOPT} ${d}`:d}let a=i===this.coverageProfile?"coverage":"run",c=i===this.runInTerminalProfile?"runInTerminal":"run";for(let d of e.commands){n.appendOutput(`Running tests with command:\r
"${d}"\r
\r
`);try{await this.runner.execute(n,d,{...t.ruby.env,RUBY_LSP_TEST_RUNNER:a,RUBYOPT:o},t,c,s)}catch(p){await W.window.showErrorMessage(`Running ${d} failed: ${p.message}`)}}i===this.coverageProfile&&(n.appendOutput(`\r
\r
Processing test coverage results...\r
\r
`),await this.processTestCoverageResults(n,t.workspaceFolder))}async debugTestCommands(e,t,n,i){for(let s of e.commands){if(i.isCancellationRequested())break;let o;if(e.reporterPaths){let a=`-rbundler/setup ${e.reporterPaths.map(c=>`-r${c}`).join(" ")}`;o=t.ruby.env.RUBYOPT?`${t.ruby.env.RUBYOPT} ${a}`:a}await this.runner.execute(n,s,{...t.ruby.env,RUBY_LSP_TEST_RUNNER:"debug",RUBYOPT:o},t,"debug",i)}}findTestInGroup(e,t,n){let i;if(t.children.forEach(d=>{(e.startsWith(`${d.id}#`)||e.startsWith(`${d.id}::`))&&(i=d)}),!i)return;let s=i.children.get(e);if(s)return s;if(e.startsWith(`${i.id}::`))return this.findTestInGroup(e,i,n);if(!n)return;let o=e.split("#")[1],a=this.testController.createTestItem(e,`\u2605 ${o}`,i.uri);a.description="dynamic test",a.range=new W.Range(new W.Position(n,0),new W.Position(n,1));let c=i.tags.find(d=>d.id.startsWith("framework"));return a.tags=c?[_r,c]:[_r],i.children.add(a),a}getTerminal(){let e=this.currentWorkspace(),t=e?`${e.workspaceFolder.name}: test`:"Ruby LSP: test",n=W.window.terminals.find(i=>i.name===t);return n||W.window.createTerminal({name:t})}async debugHandler(e,t){let n=this.testController.createTestRun(e,void 0,!0),i=e.include[0],s=Date.now();await this.debugTest("","",this.testCommands.get(i)),n.passed(i,Date.now()-s),n.end(),this.telemetry.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"debug",vscodemachineid:W.env.machineId}})}async runHandler(e,t){let n=this.testController.createTestRun(e,void 0,!0),i=[],s=a=>{i.push(a),n.enqueued(a)};e.include?e.include.forEach(s):this.testController.items.forEach(s);let o=this.currentWorkspace();for(;i.length>0&&!t.isCancellationRequested;){let a=i.pop();if(e.exclude?.includes(a)){n.skipped(a);continue}if(n.started(a),a.tags.find(c=>c.id==="example")){let c=Date.now();try{if(!o){n.errored(a,new W.TestMessage("No workspace found"));continue}let d=await this.assertTestPasses(a,o.workspaceFolder.uri.fsPath,o.ruby.env);n.appendOutput(d.replace(/\r?\n/g,`\r
`),void 0,a),n.passed(a,Date.now()-c)}catch(d){let p=d;n.appendOutput(p.message.replace(/\r?\n/g,`\r
`),void 0,a);let v=Date.now()-c;if(p.killed){n.errored(a,new W.TestMessage(`Test timed out after ${this.testTimeout} seconds`),v);continue}let m=p.message.split(`
`),S=m[0]===""?m.slice(10,m.length-2).join(`
`):m.slice(4,m.length-9).join(`
`),b=[new W.TestMessage(p.message),new W.TestMessage(S)];m.find(E=>E==="F")?n.failed(a,b,v):n.errored(a,b,v)}}a.children.forEach(s)}n.end(),this.telemetry.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"test",vscodemachineid:W.env.machineId}})}async assertTestPasses(e,t,n){try{return(await Wk(this.testCommands.get(e),{cwd:t,env:n,timeout:this.testTimeout*1e3})).stdout}catch(i){throw i.killed?i:new Error(i.stdout)}}findTestById(e,t=this.testController.items){if(!e)return this.findTestByActiveLine();let n=t.get(e);return n||(t.forEach(i=>{let s=this.findTestById(e,i.children);s&&(n=s)}),n)}findTestByActiveLine(e=W.window.activeTextEditor,t=this.testController.items){if(!e)return;let n=e.selection.active.line,i;return t.forEach(s=>{if(i)return;let o=s.range;if(s.uri?.toString()===e.document.uri.toString()&&o&&o.start.line<=n&&o.end.line>=n&&(i=s),s.children.size>0){let a=this.findTestByActiveLine(e,s.children);a&&(i=a)}}),i}async resolveHandler(e,t){let n=W.workspace.workspaceFolders;if(n&&!(e===void 0&&this.testController.items.size>0))if(e){let i=W.workspace.getWorkspaceFolder(e.uri);if(e.tags.some(s=>s===CR))await this.gatherWorkspaceTests(i,e);else if(!e.tags.some(s=>s===SR)){let s=await this.getOrActivateWorkspace(i);if(!s.lspClient?.initializeResult?.capabilities.experimental?.full_test_discovery){await W.window.showWarningMessage(`The version of the Ruby LSP server being used by ${i.name} does not support the new
             test explorer functionality. Please make sure you are using the latest version of the server.
             See https://shopify.github.io/ruby-lsp/troubleshooting.html#outdated-version for more information.`);return}let o=s.lspClient;if(o){await o.waitForIndexing();let a=await o.discoverTests(e.uri);a&&this.addDiscoveredItems(a,e)}}}else if(n.length===1)await W.commands.executeCommand("testing.clearTestResults"),await this.gatherWorkspaceTests(n[0],void 0,t);else{await W.commands.executeCommand("testing.clearTestResults");for(let i of n){let s=this.testPattern(i);if((await W.workspace.findFiles(s,void 0,1)).length===0)continue;let a=i.uri,c=this.testController.createTestItem(a.toString(),i.name,a);c.canResolveChildren=!0,c.tags=[CR,_r],this.testController.items.add(c)}}}async gatherWorkspaceTests(e,t,n){let i=t?t.children:this.testController.items,s=this.testPattern(e),o=await W.workspace.findFiles(s),a=Math.floor(o.length/100);for(let c of o)n&&n.report({message:`Processing ${Lr.default.basename(c.fsPath)}`,increment:a}),await this.addTestItemsForFile(c,e,i)}async addTestItemsForFile(e,t,n){let i=Lr.default.basename(e.fsPath),o=W.workspace.asRelativePath(e,!1).split(Lr.default.sep);if(this.shouldSkipTestFile(i,o))return;let{firstLevel:a,secondLevel:c}=await this.getOrCreateHierarchyLevels(e,t,n),d=c??a,p=this.testController.createTestItem(e.toString(),Lr.default.relative(d.uri.fsPath,e.fsPath),e);return p.canResolveChildren=!0,p.tags=[_R,_r],d.children.add(p),{firstLevel:a,secondLevel:c,testItem:p}}async detectHierarchyLevels(e,t){let i=W.workspace.asRelativePath(e,!1).split(Lr.default.sep),s=this.testDirectoryPosition(i),o=i.slice(0,s+1).join(Lr.default.sep),a=W.Uri.joinPath(t.uri,o),c=i.slice(s+1,s+2).join(Lr.default.sep);if(c.length>0){let d=W.Uri.joinPath(a,c);try{if((await W.workspace.fs.stat(d)).type===W.FileType.Directory)return{firstLevel:{name:o,uri:a},secondLevel:{name:c,uri:d}}}catch{}}return{firstLevel:{name:o,uri:a}}}async getOrCreateHierarchyLevels(e,t,n){let{firstLevel:i,secondLevel:s}=await this.detectHierarchyLevels(e,t),o=n.get(i.uri.toString());if(o||(o=this.testController.createTestItem(i.uri.toString(),i.name,i.uri),o.tags=[RR,_r],n.add(o)),s){let a=o.children.get(s.uri.toString());return a||(a=this.testController.createTestItem(s.uri.toString(),s.name,s.uri),a.tags=[RR,_r],o.children.add(a)),{firstLevel:o,secondLevel:a}}return{firstLevel:o,secondLevel:void 0}}shouldSkipTestFile(e,t){return!!(e==="test_helper.rb"||t.some(n=>n==="fixtures"))}testPattern(e){return new W.RelativePattern(e,Zp)}testDirectoryPosition(e){let t=e.indexOf("test");return t!==-1||(t=e.indexOf("spec"),t!==-1)?t:e.indexOf("features")}async getParentTestItem(e){let t=W.workspace.workspaceFolders;if(!t)return;let n=this.testController.items,i=t[0];if(t.length>1){i=W.workspace.getWorkspaceFolder(e);let c=n.get(i.uri.toString());n=c.children,n.size===0&&await this.resolveHandler(c)}let{firstLevel:s,secondLevel:o}=await this.detectHierarchyLevels(e,i),a=n.get(s.uri.toString());return o&&(a=a?.children.get(o.uri.toString())),a}addDiscoveredItems(e,t){if(e.length===0)return;e.forEach(i=>{let s=this.testController.createTestItem(i.id,i.label,W.Uri.parse(i.uri));s.canResolveChildren=i.children.length>0;let o=i.range.start,a=i.range.end;s.range=new W.Range(new W.Position(o.line,o.character),new W.Position(a.line,a.character));let c=i.tags.map(d=>new W.TestTag(d));s.tags=s.canResolveChildren?[SR,_r,...c]:[_r,...c],t.children.add(s),s.canResolveChildren&&this.addDiscoveredItems(i.children,s)});let n=e[0].tags.find(i=>i.startsWith("framework"));n&&(t.tags.some(i=>i.id.startsWith("framework"))||(t.tags=[...t.tags,new W.TestTag(n)]))}recursivelyFilter(e,t){if(t.includes(e))return null;let n=[];if(e.children.forEach(s=>{let o=this.recursivelyFilter(s,t);o&&n.push(o)}),e.children.size>0&&n.length===0)return null;let i={id:e.id,label:e.label,uri:e.uri.toString(),tags:e.tags.map(s=>s.id),children:[]};return e.range&&(i.range={start:{line:e.range.start.line,character:e.range.start.character},end:{line:e.range.end.line,character:e.range.end.character}}),e.children.size!==n.length&&(i.children=n),i}testItemToServerItem(e){let t=[];e.children.forEach(i=>{t.push(this.testItemToServerItem(i))});let n;return e.range&&(n={start:{line:e.range.start.line,character:e.range.start.character},end:{line:e.range.end.line,character:e.range.end.character}}),{id:e.id,label:e.label,uri:e.uri.toString(),range:n,children:t,tags:e.tags.map(i=>i.id)}}async processTestCoverageResults(e,t){try{let n=await W.workspace.fs.readFile(W.Uri.joinPath(t.uri,".ruby-lsp","coverage_result.json")),i=JSON.parse(n.toString());Object.entries(i).forEach(([s,o])=>{let a=W.FileCoverage.fromDetails(W.Uri.parse(s),o);e.addCoverage(a),this.coverageData.set(a,o)})}catch(n){e.appendOutput(`Failed to process coverage results: ${n.message}`)}}};var IR=re(require("path")),Ye=re(require("vscode"));async function qR(r,e,t){let{file:n,...i}=t,{line:s,character:o=0,endLine:a=s,endCharacter:c=o}=i,d=new Ye.Range(s,o,a,c),p=Ye.Uri.parse(`file://${n}`),v=await Ye.workspace.openTextDocument(p);await Ye.window.showTextDocument(v,{selection:d}),e?.lspClient?.serverVersion&&r.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"open_file",vscodemachineid:Ye.env.machineId}})}async function tg(r){if(r.length===1){await Ye.commands.executeCommand("vscode.open",Ye.Uri.parse(r[0]));return}let e=r.map(n=>{let i=Ye.Uri.parse(n);return{label:IR.default.basename(i.fsPath),iconPath:new Ye.ThemeIcon("go-to-file"),uri:i}}),t=await Ye.window.showQuickPick(e,{title:"Select a file to jump to"});t&&await Ye.commands.executeCommand("vscode.open",t.uri)}async function OR(){let r=await Ye.workspace.openTextDocument({language:"ruby"}),e=await Ye.window.showTextDocument(r,{preview:!1}),t=new Ye.Position(0,0);await e.insertSnippet(new Ye.SnippetString(`require "test_helper"

class $1Test < Minitest::Test
  def test_$2
    $3
  end
end
`),new Ye.Selection(t,t))}var FR=re(require("net")),LR=re(require("os")),MR=require("child_process"),Dt=re(require("vscode"));var ng=class{append(e){console.log(e)}appendLine(e){console.log(e)}},Gc=class{constructor(e,t){this.console=process.env.CI?new ng:Dt.debug.activeDebugConsole;this.workspaceResolver=t,e.subscriptions.push(Dt.debug.registerDebugConfigurationProvider("ruby_lsp",this),Dt.debug.registerDebugAdapterDescriptorFactory("ruby_lsp",this))}async createDebugAdapterDescriptor(e,t){return e.configuration.request==="launch"?this.spawnDebuggeeForLaunch(e):e.configuration.request==="attach"?this.attachDebuggee(e):new Promise((n,i)=>i(new Error(`Unknown request type: ${e.configuration.request}. Please review your launch configurations`)))}provideDebugConfigurations(e,t){return[{type:"ruby_lsp",name:"Debug script",request:"launch",program:"ruby ${file}"},{type:"ruby_lsp",name:"Debug test",request:"launch",program:"ruby -Itest ${relativeFile}"},{type:"ruby_lsp",name:"Attach debugger",request:"attach"}]}resolveDebugConfiguration(e,t,n){let i=e?.uri,s=this.workspaceResolver(i);if(!s)throw new Error(`Couldn't find a workspace for URI: ${i?.toString()}`);t.env?t.env=Object.assign(s.ruby.env,t.env):t.env=s.ruby.env;let o=s.workspaceFolder.uri;if(t.targetFolder={path:o.fsPath,name:s.workspaceFolder.name},t.env.BUNDLE_GEMFILE)return t;let a=Dt.Uri.joinPath(o,".ruby-lsp");return Dt.workspace.fs.readDirectory(a).then(c=>(c.some(d=>d[0]==="Gemfile")?t.env.BUNDLE_GEMFILE=Dt.Uri.joinPath(a,"Gemfile").fsPath:c.some(d=>d[0]==="gems.rb")&&(t.env.BUNDLE_GEMFILE=Dt.Uri.joinPath(a,"gems.rb").fsPath),t),()=>t)}dispose(){this.debugProcess&&this.debugProcess.kill("SIGTERM")}async getSockets(e){let t=e.configuration,n=e.configuration.debugSocketPath;if(n)return[n];let i=[];try{i=(await gn("bundle exec rdbg --util=list-socks",{cwd:e.workspaceFolder?.uri.fsPath,env:t.env})).stdout.toString().split(`
`).filter(o=>o.length>0)}catch(s){this.console.append(`Error listing sockets: ${s.message}`)}return i}async attachDebuggee(e){let t=e.configuration.debugPort;if(t){let s=e.configuration.debugHost;return s?new Dt.DebugAdapterServer(t,s):new Dt.DebugAdapterServer(t)}let n=await this.getSockets(e);if(n.length===0)throw new Error("No debuggee processes found. Is the process running?");if(n.length===1)return new Dt.DebugAdapterNamedPipeServer(n[0]);let i=await Dt.window.showQuickPick(n,{placeHolder:"Select a debuggee",ignoreFocusOut:!0}).then(s=>{if(s===void 0)throw new Error("No debuggee selected");return s});return new Dt.DebugAdapterNamedPipeServer(i)}async spawnDebuggeeForLaunch(e){let t="",n=!1,i=e.configuration,o=i.targetFolder.path,a=LR.default.platform()==="win32"?await this.availablePort():void 0;return new Promise((c,d)=>{let p=["exec","rdbg"];a&&p.push("--port",a.toString()),p.push("--open","--command","--",i.program),this.logDebuggerMessage(`Spawning debugger in directory ${o}`),this.logDebuggerMessage(`   Command bundle ${p.join(" ")}`),this.debugProcess=(0,MR.spawn)("bundle",p,{shell:!0,env:i.env,cwd:o}),this.debugProcess.stderr.on("data",v=>{let m=v.toString();if(this.logDebuggerMessage(m),n||(t+=m),t.includes("DEBUGGER: wait for debugger connection...")){n=!0;let b=RegExp(/DEBUGGER: Debugger can attach via UNIX domain socket \((.*)\)/).exec(t);a?c(new Dt.DebugAdapterServer(a)):b&&b.length===2?c(new Dt.DebugAdapterNamedPipeServer(b[1])):d(new Error("Debugger not found on UNIX socket"))}}),this.debugProcess.stdout.on("data",v=>{this.logDebuggerMessage(v.toString())}),this.debugProcess.on("error",v=>{this.logDebuggerMessage(v.message),d(v)}),this.debugProcess.on("close",v=>{if(v){let m=`Debugger exited with status ${v}.
Please make sure \`bundle ${p.join(" ")}\` runs without errors in the terminal.
Check the Ruby LSP output channel for more information.
`;this.logDebuggerMessage(m),d(new Error(m))}})})}async availablePort(){return new Promise((e,t)=>{let n=FR.default.createServer();n.unref(),n.on("error",t),n.listen(0,()=>{let i=n.address(),s=typeof i=="string"?Number(i):i?.port;n.close(()=>{e(s)})})})}logDebuggerMessage(e){Cr.info(`[debugger]: ${e.trimEnd()}`),this.console.append(e)}};var NR=re(require("path")),ze=re(require("vscode")),AR=re(ic());var Jc=class{constructor(){this._onDidChangeTreeData=new ze.EventEmitter;this.onDidChangeTreeData=this._onDidChangeTreeData.event;this.subscriptions=[];this.gemRootFolders={};this.treeView=ze.window.createTreeView("dependencies",{treeDataProvider:this,showCollapseAll:!0}),this.subscriptions.push(Qn.event(this.workspaceDidChange.bind(this)),ze.window.onDidChangeActiveTextEditor(this.activeEditorDidChange.bind(this)),this.treeView.onDidChangeVisibility(this.treeVisibilityDidChange.bind(this)))}dispose(){this.subscriptions.forEach(e=>e.dispose()),this.treeView.dispose()}getTreeItem(e){return e}getChildren(e){return e?e.getChildren():this.fetchDependencies()}getParent(e){let t=ze.Uri.joinPath(e.resourceUri,".."),n=NR.default.parse(t.path).root;if(t.path!==n)if(e instanceof ho||e instanceof ys){let i=this.gemRootFolders[t.toString()];return i||new ho(t)}else return}async refresh(){await this.fetchDependencies(),this._onDidChangeTreeData.fire(void 0)}async workspaceDidChange(e){if(!(!e||e===this.currentWorkspace))return this.currentWorkspace=e,this.refresh()}async activeEditorDidChange(e){let t=e?.document.uri;t&&(this.currentVisibleItem=new ys(t),this.treeView.visible&&await this.revealElement(this.currentVisibleItem))}async treeVisibilityDidChange(e){this.currentVisibleItem&&e.visible&&await this.revealElement(this.currentVisibleItem)}async revealElement(e){ze.workspace.getConfiguration("explorer").get("autoReveal")&&await this.treeView.reveal(e,{select:!0,focus:!1,expand:!0}),this.currentVisibleItem=void 0}async fetchDependencies(){if(this.gemRootFolders={},!this.currentWorkspace)return[];let e=this.currentWorkspace.lspClient;if(!e||e.state!==AR.State.Running)return[];let n=(await e.sendRequest("rubyLsp/workspace/dependencies",{})).sort((i,s)=>i.dependency===s.dependency?i.name.localeCompare(s.name):s.dependency?1:-1).map(i=>{let s=ze.Uri.file(i.path),o=new rg(i.name,i.version,s);return this.gemRootFolders[s.toString()]=o,o});return n.forEach(i=>{this.gemRootFolders[i.resourceUri.toString()]=i}),n}},rg=class extends ze.TreeItem{constructor(t,n,i){super(`${t} (${n})`,ze.TreeItemCollapsibleState.Collapsed);this.resourceUri=i;this.contextValue="dependency",this.iconPath=new ze.ThemeIcon("ruby")}async getChildren(){let t=this.resourceUri;return(await ze.workspace.fs.readDirectory(t)).map(([i,s])=>s===ze.FileType.Directory?new ho(ze.Uri.joinPath(t,i)):new ys(ze.Uri.joinPath(t,i)))}},ho=class r extends ze.TreeItem{constructor(t){super(t,ze.TreeItemCollapsibleState.Collapsed);this.resourceUri=t;this.contextValue="gem-directory-path",this.description=!0,this.command={command:"list.toggleExpand",title:"Toggle"}}async getChildren(){let t=this.resourceUri;return(await ze.workspace.fs.readDirectory(t)).map(([i,s])=>s===ze.FileType.Directory?new r(ze.Uri.joinPath(t,i)):new ys(ze.Uri.joinPath(t,i)))}},ys=class extends ze.TreeItem{constructor(t){super(t,ze.TreeItemCollapsibleState.None);this.resourceUri=t;this.contextValue="gem-file-path",this.description=!0,this.command={command:"vscode.open",title:"Open",arguments:[t]}}getChildren(){}};var $R=re(require("os")),yn=re(require("vscode")),jR=$R.default.platform()==="win32"?"ruby bin/rails":"bin/rails",Xc=class{constructor(e){this.showWorkspacePick=e}async generate(e,t){let n=t??await this.showWorkspacePick();if(!n)return;let i=[],s=`${jR} generate ${e}`;await yn.window.withProgress({location:yn.ProgressLocation.Notification,title:"Running Rails generate"},async o=>{o.report({message:`Running "${s}"`});let{stdout:a}=await n.execute(s,!0);a.split(`
`).forEach(c=>{let d=/create\s*(.*\..*)/.exec(c);d&&i.push(d[1])}),o.report({message:"Revealing generated files"}),await this.revealFormattedFiles(n,i)})}async destroy(e,t){let n=t??await this.showWorkspacePick();if(!n)return;let i=[],s=`${jR} destroy ${e}`;await yn.window.withProgress({location:yn.ProgressLocation.Notification,title:"Running Rails destroy"},async o=>{o.report({message:`Running "${s}"`});let{stdout:a}=await n.execute(s,!0);a.split(`
`).forEach(c=>{let d=/remove\s*(.*\..*)/.exec(c);d&&i.push(d[1])}),o.report({message:"Closing deleted files"});for(let c of i)await yn.commands.executeCommand("workbench.action.closeActiveEditor",yn.Uri.joinPath(n.workspaceFolder.uri,c))})}async revealFormattedFiles(e,t){for(let n of t){let i=yn.Uri.joinPath(e.workspaceFolder.uri,n);await yn.window.showTextDocument(i,{preview:!1}),await yn.commands.executeCommand("editor.action.formatDocument",i),await yn.commands.executeCommand("workbench.action.files.save",i)}}};var ut=re(require("vscode"));var UR="rubyLsp.chatAgent",Hk=`
  You are a domain driven design and Ruby on Rails expert.
  The user will provide you with details about their Rails application.
  The user will ask you to help model a single specific concept.

  Analyze the provided concept carefully and think step by step. Consider the following aspects:
  1. The core purpose of the concept
  2. Its relationships with other potential entities in the system
  3. The attributes that would best represent this concept in a database

  Based on your analysis, suggest an appropriate model name and attributes to effectively model the concept.
  Follow these guidelines:

  1. Choose a clear, singular noun for the model name that accurately represents the concept
  2. Select attributes that capture the essential characteristics of the concept
  3. Use appropriate data types for each attribute (e.g. string, integer, datetime, boolean)
  4. Consider adding foreign keys for relationships with other models, if applicable

  After determining the model structure, generate the Rails commands to create the model and any associated resources.
  Include all relevant \`generate\` commands in a single Markdown shell code block at the end of your response.

  The \`generate\` commands should ONLY include the type of generator and arguments, not the \`rails generate\` part
  (e.g.: \`model User name:string\` but not \`rails generate model User name:string\`).
  NEVER include commands to migrate the database as part of the code block.
  NEVER include redundant commands (e.g. including the migration and model generation commands for the same model).
`.trim(),Qc=class{constructor(e,t){this.agent=ut.chat.createChatParticipant(UR,this.handler.bind(this)),this.agent.iconPath=ut.Uri.joinPath(e.extensionUri,"icon.png"),this.showWorkspacePick=t}dispose(){this.agent.dispose()}async handler(e,t,n,i){return this.withinConversation("design",e,t)?this.runDesignCommand(e,t,n,i):(n.markdown("Please indicate which command you would like to use for our chat."),{metadata:{command:""}})}async runDesignCommand(e,t,n,i){let s=this.previousInteractions(t),o=[ut.LanguageModelChatMessage.User(`User prompt: ${e.prompt}`),ut.LanguageModelChatMessage.User(Hk),ut.LanguageModelChatMessage.User(`Previous interactions with the user: ${s}`)],a=await this.showWorkspacePick();if(e.command&&a){let c=await this.schema(a);c&&o.push(ut.LanguageModelChatMessage.User(`Existing application schema: ${c}`))}try{let[c]=await ut.lm.selectChatModels({vendor:"copilot",family:"gpt-4o"});n.progress("Designing the models for the requested concept...");let d=await c.sendRequest(o,{},i),p="";for await(let m of d.text)n.markdown(m),p+=m;let v=/(?<=```shell)[^.$]*(?=```)/.exec(p);if(a&&v&&v[0]){let m=v[0].trim().split(`
`).map(S=>S.replace(/\s*(bin\/rails|rails) generate\s*/,""));n.button({command:"rubyLsp.railsGenerate",title:"Generate with Rails",arguments:[m,a]}),n.button({command:"rubyLsp.railsDestroy",title:"Revert previous generation",arguments:[m,a]})}}catch(c){this.handleError(c,n)}return{metadata:{command:"design"}}}async schema(e){try{return(await ut.workspace.fs.readFile(ut.Uri.joinPath(e.workspaceFolder.uri,"db/schema.rb"))).toString()}catch{}try{return(await ut.workspace.fs.readFile(ut.Uri.joinPath(e.workspaceFolder.uri,"db/structure.sql"))).toString()}catch{}}withinConversation(e,t,n){return t.command===e||!t.command&&n.history.some(i=>i instanceof ut.ChatRequestTurn&&i.command===e)}handleError(e,t){if(e instanceof ut.LanguageModelError)e.cause instanceof Error&&e.cause.message.includes("off_topic")&&t.markdown("Sorry, I can only help you with Ruby related questions");else throw e}previousInteractions(e){let t="";return e.history.forEach(n=>{if(n instanceof ut.ChatResponseTurn){if(n.participant===UR){let i="";n.response.forEach(s=>{s instanceof ut.ChatResponseMarkdownPart&&(i+=s.value.value)}),t+=`Response: ${i}`}}else t+=`Request: ${n.prompt}`}),t}};var An=re(require("vscode"));async function WR(r){if(!r){await An.window.showErrorMessage("No active Ruby workspace found.");return}let e=Vk(r),t=An.window.createWebviewPanel("rubyLspInfo","Ruby LSP Information",An.ViewColumn.One,{enableScripts:!0});t.webview.html=Kk(e)}function Vk(r){let e=An.version,n=An.extensions.getExtension("Shopify.ruby-lsp").packageJSON.version,i=r.lspClient?.serverVersion??"Unknown",s=r.lspClient?.addons?.map(p=>`${p.name} (${p.version??"unknown"})`)??[],o=zk(),a=An.workspace.getConfiguration("rubyLsp",r.workspaceFolder),c=An.workspace.getConfiguration("rubyLsp"),d={};for(let p of Object.keys(a))a.inspect(p)?.workspaceValue!==void 0&&(d[p]=a.get(p));return{"VS Code Version":e,"Ruby LSP Extension Version":n,"Ruby LSP Server Version":i,"Ruby LSP Add-ons":s,"Ruby Version":r.ruby.rubyVersion??"Unknown","Ruby Version Manager":r.ruby.versionManager.identifier,"Installed Extensions":o.sort(),"Ruby LSP Settings":{Workspace:d,User:c}}}function zk(){return An.extensions.all.filter(r=>!(r.packageJSON.isBuiltin||r.packageJSON.license==="UNLICENSED"||!r.packageJSON.license)).map(r=>`${r.packageJSON.name} (${r.packageJSON.version})`)}function Kk(r){let e=`
### Ruby LSP Information

`;for(let[n,i]of Object.entries(r)){if(e+=`#### ${n}

`,Array.isArray(i))n==="Installed Extensions"?(e+=`&lt;details&gt;
&lt;summary&gt;Click to expand&lt;/summary&gt;

`,e+=`${i.map(s=>`- ${s}`).join(`
`)}
`,e+=`&lt;/details&gt;
`):e+=`${i.map(s=>`- ${s}`).join(`
`)}
`;else if(typeof i=="object"&&i!==null){e+=`&lt;details&gt;
&lt;summary&gt;Click to expand&lt;/summary&gt;

`;for(let[s,o]of Object.entries(i))e+=`##### ${s}

`,e+=`\`\`\`json
${JSON.stringify(o,null,2)}
\`\`\`

`;e+=`&lt;/details&gt;
`}else e+=`${i}
`;e+=`
`}return`
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Ruby LSP Information</title>
      <style>
        body { font-family: var(--vscode-font-family); padding: 20px; }
        h1, h2, h3, p, li { color: var(--vscode-editor-foreground); }
        pre {
          background-color: var(--vscode-textBlockQuote-background);
          padding: 16px;
          overflow-x: auto;
          position: relative;
        }
        code { font-family: var(--vscode-editor-font-family); }
        #copyButton {
          position: absolute;
          top: 5px;
          right: 5px;
          background-color: var(--vscode-button-background);
          color: var(--vscode-button-foreground);
          border: none;
          padding: 5px 10px;
          cursor: pointer;
        }
        #copyButton:hover { background-color: var(--vscode-button-hoverBackground); }
      </style>
    </head>
    <body>
      <h1>Ruby LSP Information</h1>
      <p>Please copy the content below and paste it into the issue you're opening:</p>
      <pre><button id="copyButton">Copy</button><code id="diagnosticContent">${e}</code></pre>
      <script>
        const copyButton = document.getElementById('copyButton');
        const diagnosticContent = document.getElementById('diagnosticContent');

        copyButton.addEventListener('click', () => {
          const range = document.createRange();
          range.selectNode(diagnosticContent);
          window.getSelection().removeAllRanges();
          window.getSelection().addRange(range);
          document.execCommand('copy');
          window.getSelection().removeAllRanges();

          copyButton.textContent = 'Copied!';
          setTimeout(() => {
            copyButton.textContent = 'Copy';
          }, 2000);
        });
      </script>
    </body>
    </html>
  `}var Yc=class{constructor(e,t){this.workspaces=new Map;this.virtualDocuments=new Map;this.workspacesBeingLaunched=new Map;this.context=e,this.telemetry=t,this.testController=new Bc(e,this.telemetry,this.currentActiveWorkspace.bind(this),this.getOrActivateWorkspace.bind(this)),this.debug=new Gc(e,this.workspaceResolver.bind(this)),this.rails=new Xc(this.showWorkspacePick.bind(this)),this.statusItems=new Sc;let n=new Jc;e.subscriptions.push(this.statusItems,this.debug,n,new Qc(e,this.showWorkspacePick.bind(this)),N.window.onDidChangeActiveTextEditor(i=>{Qn.fire(this.currentActiveWorkspace(i))}),N.workspace.onDidChangeWorkspaceFolders(async i=>{for(let s of i.removed){let o=this.getWorkspace(s.uri);o&&(await o.stop(),await o.dispose(),this.workspaces.delete(s.uri.toString()))}}),N.workspace.onDidOpenTextDocument(async i=>{if(!ei.includes(i.languageId))return;let s=N.workspace.getWorkspaceFolder(i.uri);if(!s)return;this.getWorkspace(s.uri)||await this.activateWorkspace(s,!1)}),N.workspace.registerTextDocumentContentProvider("embedded-content",{provideTextDocumentContent:i=>{let s=/^\/(.*)\.[^.]+$/.exec(i.path)?.[1];if(!s)return"";let o=decodeURIComponent(s);return this.virtualDocuments.get(o)}}),Cr,N.workspace.registerTextDocumentContentProvider("ruby-lsp",new to),...this.registerCommands())}async activate(){await N.commands.executeCommand("testing.clearTestResults");let e=N.workspace.workspaceFolders?.[0];e&&await this.activateWorkspace(e,!0);let t=N.window.activeTextEditor?.document;if(t&&ei.includes(t.languageId)){let n=N.workspace.getWorkspaceFolder(t.uri);n&&(this.workspaces.get(n.uri.toString())||await this.activateWorkspace(n,!1))}Qn.fire(this.currentActiveWorkspace()),await this.testController.activate()}async deactivate(){for(let e of this.workspaces.values())await e.stop(),await e.dispose()}async activateWorkspace(e,t){let n=this.workspacesBeingLaunched.get(e.index);if(n)return n;let i=this.runActivation(e,t);return this.workspacesBeingLaunched.set(e.index,i),i}async runActivation(e,t){let n=N.workspace.getConfiguration("rubyLsp").get("bundleGemfile"),i=await this.lockfileExists(e.uri);if(t&&!i){this.workspacesBeingLaunched.delete(e.index);return}n.length===0&&!i&&await this.showStandaloneWarning(e.uri.fsPath);let s=new Cc(this.context,e,this.telemetry,this.testController.createTestItems.bind(this.testController),this.virtualDocuments,this.workspaces.size===0);return await s.activate(),await s.start(),this.workspaces.set(e.uri.toString(),s),await N.commands.executeCommand("setContext","rubyLsp.activated",!0),await this.showFormatOnSaveModeWarning(s),this.workspacesBeingLaunched.delete(e.index),s}registerCommands(){return[N.commands.registerCommand("rubyLsp.update",async()=>{let e=await this.showWorkspacePick();e&&(await e.installOrUpdateServer(!0),await e.restart())}),N.commands.registerCommand("rubyLsp.start",async()=>{await(await this.showWorkspacePick())?.start()}),N.commands.registerCommand("rubyLsp.restart",async()=>{await(await this.showWorkspacePick())?.restart()}),N.commands.registerCommand("rubyLsp.stop",async()=>{await(await this.showWorkspacePick())?.dispose()}),N.commands.registerCommand("rubyLsp.showSyntaxTree",this.showSyntaxTree.bind(this)),N.commands.registerCommand("rubyLsp.diagnoseState",this.diagnoseState.bind(this)),N.commands.registerCommand("rubyLsp.showServerChangelog",()=>{let e=this.currentActiveWorkspace()?.lspClient?.serverVersion;if(e)return N.env.openExternal(N.Uri.parse(`https://github.com/Shopify/ruby-lsp/releases/tag/v${e}`))}),N.commands.registerCommand("rubyLsp.formatterHelp",()=>N.env.openExternal(N.Uri.parse("https://github.com/Shopify/ruby-lsp/blob/main/vscode/README.md#formatting"))),N.commands.registerCommand("rubyLsp.displayAddons",()=>{let e=this.currentActiveWorkspace()?.lspClient;if(!e||!e.addons)return;let t=e.addons.sort(i=>i.errored?1:-1).map(i=>({label:`${i.errored?"$(error)":"$(pass)"} ${i.name} ${i.version?`v${i.version}`:""}`})),n=N.window.createQuickPick();n.items=t,n.placeholder="Addons (click to view output)",n.onDidAccept(()=>{n.selectedItems[0]&&this.currentActiveWorkspace()?.outputChannel.show(),n.hide()}),n.onDidHide(()=>{n.dispose()}),n.show()}),N.commands.registerCommand("rubyLsp.toggleFeatures",async()=>{let e=N.extensions.getExtension("Shopify.ruby-lsp").packageJSON.contributes.configuration.properties["rubyLsp.enabledFeatures"].properties,t={};Object.entries(e).forEach(([c,d])=>{t[c]=d.description});let i=N.workspace.getConfiguration("rubyLsp").get("enabledFeatures"),s=Object.keys(i),o=s.map(c=>({label:c,picked:i[c],description:t[c]})),a=await N.window.showQuickPick(o,{canPickMany:!0,placeHolder:"Select the features you would like to enable"});a!==void 0&&(s.forEach(c=>{i[c]=a.some(d=>d.label===c)}),await N.workspace.getConfiguration("rubyLsp").update("enabledFeatures",i,!0,!0))}),N.commands.registerCommand("rubyLsp.toggleExperimentalFeatures",async()=>{let e=N.workspace.getConfiguration("rubyLsp"),t=e.get("enableExperimentalFeatures");await e.update("enableExperimentalFeatures",!t,!0,!0),Qn.fire(this.currentActiveWorkspace())}),N.commands.registerCommand("rubyLsp.serverOptions",async e=>{let t=await N.window.showQuickPick(e,{placeHolder:"Select server action"});t!==void 0&&await N.commands.executeCommand(t.description)}),N.commands.registerCommand("rubyLsp.selectRubyVersionManager",async()=>{let e=await N.window.showQuickPick(["Change version manager","Change manual Ruby configuration"],{placeHolder:"What would you like to do?"});if(!e)return;if(e==="Change version manager"){let n=N.workspace.getConfiguration("rubyLsp"),i=n.get("rubyVersionManager"),s=Object.values(Oh),o=await N.window.showQuickPick(s,{placeHolder:`Current: ${i.identifier}`});o!==void 0&&(i.identifier=o,await n.update("rubyVersionManager",i,!0));return}let t=await this.showWorkspacePick();t&&await t.ruby.manuallySelectRuby()}),N.commands.registerCommand("rubyLsp.runTest",(e,t,n)=>qr("fullTestDiscovery")?this.testController.runViaCommand(e,t,"run"):this.testController.runOnClick(t)),N.commands.registerCommand("rubyLsp.runTestInTerminal",(e,t,n)=>qr("fullTestDiscovery")?this.testController.runViaCommand(e,t,"runInTerminal"):this.testController.runTestInTerminal(e,t,n)),N.commands.registerCommand("rubyLsp.debugTest",(e,t,n)=>qr("fullTestDiscovery")?this.testController.runViaCommand(e,t,"debug"):this.testController.debugTest(e,t,n)),N.commands.registerCommand("rubyLsp.runTask",async e=>{let t=this.currentActiveWorkspace();t||(t=await this.showWorkspacePick()),t&&await t.execute(e,!0)}),N.commands.registerCommand("rubyLsp.bundleInstall",e=>{let t=this.workspaces.get(e);if(!t)return;let n=N.window.createTerminal({name:"Bundle install",cwd:t.workspaceFolder.uri.fsPath,env:t.ruby.env});n.show(),n.sendText("bundle install")}),N.commands.registerCommand("rubyLsp.openFile",e=>{if(typeof e[0]=="string")return tg(e);let[t,n]=e,i=this.currentActiveWorkspace();return qR(this.telemetry,i,{file:t,line:parseInt(n,10)-1})}),N.commands.registerCommand("rubyLsp.railsGenerate",async(e,t)=>{let n=e??await N.window.showInputBox({title:"Rails generate arguments",placeHolder:"model User name:string | scaffold Post title:string"});if(n){if(typeof n=="string"){await this.rails.generate(n,t);return}for(let i of n)await this.rails.generate(i,t)}}),N.commands.registerCommand("rubyLsp.railsDestroy",async(e,t)=>{let n=e??await N.window.showInputBox({title:"Rails destroy arguments",placeHolder:"model User name:string | scaffold Post title:string"});if(n){if(typeof n=="string"){await this.rails.destroy(n,t);return}for(let i of n)await this.rails.destroy(i,t)}}),N.commands.registerCommand("rubyLsp.fileOperation",async()=>{let e=await this.showWorkspacePick();if(!e)return;let t=[{label:"Minitest test",description:"Create a new Minitest test",iconPath:new N.ThemeIcon("new-file"),command:"rubyLsp.newMinitestFile",args:[]}];e.lspClient?.addons?.some(i=>i.name==="Ruby LSP Rails")&&t.push({label:"Rails generate",description:"Run Rails generate",iconPath:new N.ThemeIcon("new-file"),command:"rubyLsp.railsGenerate",args:[void 0,e]},{label:"Rails destroy",description:"Run Rails destroy",iconPath:new N.ThemeIcon("trash"),command:"rubyLsp.railsDestroy",args:[void 0,e]});let n=await N.window.showQuickPick(t,{title:"Select a Ruby file operation"});n&&await N.commands.executeCommand(n.command,...n.args)}),N.commands.registerCommand("rubyLsp.newMinitestFile",OR),N.commands.registerCommand("rubyLsp.collectRubyLspInfo",async()=>{let e=await this.showWorkspacePick();await WR(e)}),N.commands.registerCommand("rubyLsp.startServerInDebugMode",async()=>{await(await this.showWorkspacePick())?.start(!0)}),N.commands.registerCommand("rubyLsp.showOutput",()=>{Cr.show()}),N.commands.registerCommand("rubyLsp.migrateLaunchConfiguration",async()=>{if(!await this.showWorkspacePick())return;let n=(N.workspace.getConfiguration("launch")?.get("configurations")||[]).map(i=>{if(i.type==="rdbg"){if(i.request==="launch"){let s={...i};if(s.type="ruby_lsp",s.askParameters!==!0){delete s.rdbgPath,delete s.cwd,delete s.useBundler;let o=(s.command??"").replace("${workspaceRoot}/",""),a=s.script??"",c=(s.args??[]).join(" ");s.program=`${o} ${a} ${c}`.trim(),delete s.command,delete s.script,delete s.args,delete s.askParameters}return s}else if(i.request==="attach"){let s={...i};return s.type="ruby_lsp",s.debugSocketPath=i.debugPort,s}}return i});await N.workspace.getConfiguration("launch").update("configurations",n,N.ConfigurationTarget.Workspace)}),N.commands.registerCommand("rubyLsp.goToRelevantFile",async()=>{let e=N.window.activeTextEditor?.document.uri;if(!e)return;let t=await this.currentActiveWorkspace()?.lspClient?.sendGoToRelevantFileRequest(e);if(t&&t.locations.length>0)return tg(t.locations);await N.window.showInformationMessage("Couldn't find relevant files")}),N.commands.registerCommand("rubyLsp.profileCurrentFile",async()=>{let e=this.currentActiveWorkspace();if(!e){N.window.showInformationMessage("No workspace found");return}try{let{stdout:n}=await e.execute("vernier --version"),i=n.trim(),[s,o,a]=i.split(".").map(Number);if(s<1||s===1&&o<8)if(await N.window.showInformationMessage("Vernier version 1.8.0 or higher is required for profiling. Would you like to install it?","Install")==="Install")await e.execute("gem install vernier");else return}catch{if(await N.window.showInformationMessage("Vernier is required for profiling. Would you like to install it?","Install")==="Install")await e.execute("gem install vernier");else return}let t=N.window.activeTextEditor?.document.uri.fsPath;if(!t){N.window.showInformationMessage("No file opened in the editor to profile");return}await N.window.withProgress({location:N.ProgressLocation.Notification,title:"Profiling in progress...",cancellable:!1},async()=>{let n=N.Uri.file(VR.join(HR.tmpdir(),`profile-${Date.now()}.cpuprofile`));await e.execute(`vernier run --output ${n.fsPath} --format cpuprofile -- ruby ${t}`),await N.commands.executeCommand("vscode.open",n,{viewColumn:N.ViewColumn.Beside})})})]}currentActiveWorkspace(e=N.window.activeTextEditor){let t;if(e?t=N.workspace.getWorkspaceFolder(e.document.uri):t=N.workspace.workspaceFolders?.find(n=>n.name===N.workspace.name),!!t)return this.getWorkspace(t.uri)}async getOrActivateWorkspace(e){let t=this.getWorkspace(e.uri);return t||N.window.withProgress({location:N.ProgressLocation.Notification,title:`Workspace ${e.name} is not activated yet.`},async n=>(n.report({message:"Activating workspace..."}),this.activateWorkspace(e,!1)))}getWorkspace(e){return this.workspaces.get(e.toString())}workspaceResolver(e){if(!e)return this.currentActiveWorkspace();let t=this.workspaces.get(e.toString());return t||this.currentActiveWorkspace()}async showWorkspacePick(){if(this.workspaces.size===1)return this.workspaces.values().next().value;let e=await N.window.showWorkspaceFolderPick();if(e)return this.getWorkspace(e.uri)}async diagnoseState(){let t=await(await this.showWorkspacePick())?.lspClient?.sendRequest("rubyLsp/diagnoseState");if(t){let n=Object.entries(t.documents),i=[`Worker alive: ${t.workerAlive}`,`Incoming queue size: ${t.incomingQueueSize}`,`Backtrace:
${t.backtrace.join(`
`)}
`,`=========== Documents (${n.length}) ===========`,...n.map(([o,a])=>`URI: ${o}

${a}
===========`)].join(`
`),s=await N.workspace.openTextDocument(N.Uri.from({scheme:"ruby-lsp",path:"show-diagnose-state",query:i}));await N.window.showTextDocument(s,{viewColumn:N.ViewColumn.Beside,preserveFocus:!0})}}async showSyntaxTree(){let e=N.window.activeTextEditor;if(e){let t=e.document;if(t.languageId!=="ruby"){await N.window.showErrorMessage("Show syntax tree: not a Ruby file");return}let n=N.workspace.getWorkspaceFolder(t.uri);if(!n)return;let i=this.getWorkspace(n.uri),s=e.selection,o;s.active.isEqual(s.anchor)||(s.isReversed?o=ig.Range.create(s.active.line,s.active.character,s.anchor.line,s.anchor.character):o=ig.Range.create(s.anchor.line,s.anchor.character,s.active.line,s.active.character));let a=await i?.lspClient?.sendShowSyntaxTreeRequest(t.uri,o);if(a){let c=await N.workspace.openTextDocument(N.Uri.from({scheme:"ruby-lsp",path:"show-syntax-tree",query:a.ast}));await N.window.showTextDocument(c,{viewColumn:N.ViewColumn.Beside,preserveFocus:!0})}}}async showFormatOnSaveModeWarning(e){let t=N.workspace.getConfiguration("editor",{languageId:"ruby"}),n=t.get("formatOnSaveMode");if(n==="file")return;await N.window.showWarningMessage(`The "editor.formatOnSaveMode" setting is set to ${n} in workspace ${e.workspaceFolder.name}, which
      is currently unsupported by the Ruby LSP. If you'd like to have formatting enabled, please set it to 'file'`,"Change setting to 'file'","Use without formatting")==="Change setting to 'file'"&&await t.update("formatOnSaveMode","file",N.ConfigurationTarget.Global)}async lockfileExists(e){try{return await N.workspace.fs.stat(N.Uri.joinPath(e,"Gemfile.lock")),!0}catch{}try{return await N.workspace.fs.stat(N.Uri.joinPath(e,"gems.locked")),!0}catch{}return!1}async showStandaloneWarning(e){await N.window.withProgress({location:N.ProgressLocation.Notification,title:"No bundle found. Launching in standalone mode in 5 seconds",cancellable:!0},async(t,n)=>{if(t.report({message:"If working in a monorepo, cancel to see configuration instructions"}),await new Promise(i=>{n.onCancellationRequested(()=>{i()}),setTimeout(i,5e3)}),n.isCancellationRequested&&await N.window.showWarningMessage(`Could not find a lockfile in ${e}. Are you using a monorepo setup?`,"See the multi-root workspace docs","Launch anyway")==="See the multi-root workspace docs"){let s=N.Uri.parse("https://github.com/Shopify/ruby-lsp/blob/main/vscode/README.md?tab=readme-ov-file#multi-root-workspaces");await N.env.openExternal(s)}})}};var ur=re(require("vscode")),Zc=class{constructor(){this.disposables=[];this.decorationType=ur.window.createTextEditorDecorationType({opacity:ur.workspace.getConfiguration("rubyLsp").get("sigOpacityLevel")}),this.disposables.push(ur.window.onDidChangeActiveTextEditor(()=>this.updateDecorations()),ur.workspace.onDidChangeTextDocument(()=>this.updateDecorations())),this.updateDecorations()}reload(){let e=ur.workspace.getConfiguration("rubyLsp").get("sigOpacityLevel");this.decorationType.dispose(),this.decorationType=ur.window.createTextEditorDecorationType({opacity:e}),this.updateDecorations()}dispose(){this.decorationType.dispose(),this.disposables.forEach(e=>e.dispose())}updateDecorations(){let e=ur.window.activeTextEditor;if(!e||e.document.languageId!=="ruby")return;let t=e.document.getText(),n=[],i=t.split(`
`);for(let s=0;s<i.length;s++){let o=i[s];o.trim().startsWith("#:")&&n.push({range:new ur.Range(s,0,s,o.length)})}e.setDecorations(this.decorationType,n)}};var sg;async function Bk(r){if(!sn.workspace.workspaceFolders){await sn.window.showWarningMessage(`Using the Ruby LSP without any workspaces opened is currently not supported
      ([learn more](https://github.com/Shopify/ruby-lsp/issues/1780))`,"Open a workspace","Continue anyway")==="Open a workspace"&&await sn.commands.executeCommand("workbench.action.files.openFolder");return}let e=new Zc;r.subscriptions.push(e,sn.workspace.onDidChangeConfiguration(n=>{n.affectsConfiguration("rubyLsp.sigOpacityLevel")&&e.reload()}));let t=await Jk(r);r.subscriptions.push(t),sg=new Yc(r,t),await sg.activate()}async function Gk(){await sg.deactivate()}async function Jk(r){let e;switch(r.extensionMode){case sn.ExtensionMode.Development:e={sendEventData:(t,n)=>{Cr.debug(t,n)},sendErrorData:(t,n)=>{Cr.error(t,n)}};break;case sn.ExtensionMode.Test:e={sendEventData:(t,n)=>{},sendErrorData:(t,n)=>{}};break;default:try{let t=0;for(;!e&&t<5;)await sn.commands.executeCommand("getTelemetrySenderObject"),e=await sn.commands.executeCommand("getTelemetrySenderObject"),t++}catch{e={sendEventData:(n,i)=>{},sendErrorData:(n,i)=>{}}}break}return e||(e={sendEventData:(t,n)=>{},sendErrorData:(t,n)=>{}}),sn.env.createTelemetryLogger(e,{ignoreBuiltInCommonProperties:!0,ignoreUnhandledErrors:!0,additionalCommonProperties:{extensionVersion:r.extension.packageJSON.version,environment:zR.default.platform(),machineId:sn.env.machineId}})}0&&(module.exports={activate,deactivate});
